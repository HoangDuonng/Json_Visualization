{"version":3,"file":"static/chunks/77421.a40456e0c716d5df.js","mappings":"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","sources":["webpack://_N_E/./src/jsondraw/packages/math/vector.ts","webpack://_N_E/./src/jsondraw/packages/math/angle.ts","webpack://_N_E/./src/jsondraw/packages/math/constants.ts","webpack://_N_E/./src/jsondraw/packages/math/curve.ts","webpack://_N_E/./src/jsondraw/packages/math/polygon.ts","webpack://_N_E/./src/jsondraw/packages/math/range.ts","webpack://_N_E/./src/jsondraw/packages/math/rectangle.ts","webpack://_N_E/./src/jsondraw/packages/math/line.ts","webpack://_N_E/./src/jsondraw/packages/math/segment.ts","webpack://_N_E/./src/jsondraw/packages/math/triangle.ts","webpack://_N_E/./src/jsondraw/packages/math/index.ts","webpack://_N_E/./src/jsondraw/packages/math/utils.ts","webpack://_N_E/./src/jsondraw/packages/common/binary-heap.ts","webpack://_N_E/./src/jsondraw/packages/common/colors.ts","webpack://_N_E/./src/jsondraw/packages/common/constants.ts","webpack://_N_E/./src/jsondraw/packages/common/font-metadata.ts","webpack://_N_E/./src/jsondraw/packages/common/queue.ts","webpack://_N_E/./src/jsondraw/packages/common/editorInterface.ts","webpack://_N_E/./src/jsondraw/packages/common/keys.ts","webpack://_N_E/./src/jsondraw/packages/common/points.ts","webpack://_N_E/./src/jsondraw/packages/common/promise-pool.ts","webpack://_N_E/./src/jsondraw/packages/common/utils.ts","webpack://_N_E/./src/jsondraw/packages/common/random.ts","webpack://_N_E/./src/jsondraw/packages/common/url.ts","webpack://_N_E/./src/jsondraw/packages/common/emitter.ts","webpack://_N_E/./src/jsondraw/packages/common/index.ts","webpack://_N_E/./src/features/editor/views/JsonDrawView/LoadFromLinkDialog.tsx","webpack://_N_E/./src/features/editor/views/JsonDrawView/jsonToJsonDraw.ts","webpack://_N_E/./src/lib/db.ts","webpack://_N_E/./src/features/editor/views/JsonDrawView/shareBackend.ts","webpack://_N_E/./src/features/editor/views/JsonDrawView/shareLinkUtils.ts","webpack://_N_E/./src/features/editor/views/JsonDrawView/index.tsx","webpack://_N_E/./src/features/editor/views/TreeView/Label.tsx","webpack://_N_E/./src/features/editor/views/TreeView/Value.tsx","webpack://_N_E/./src/features/editor/views/TreeView/index.tsx","webpack://_N_E/./src/features/editor/LiveEditor.tsx","webpack://_N_E/./src/jsondraw/packages/math/point.ts"],"sourcesContent":["import type { GlobalPoint, LocalPoint, Vector } from \"./types\";\n\n/**\n * Create a vector from the x and y coordiante elements.\n *\n * @param x The X aspect of the vector\n * @param y T Y aspect of the vector\n * @returns The constructed vector with X and Y as the coordinates\n */\nexport function vector(\n  x: number,\n  y: number,\n  originX: number = 0,\n  originY: number = 0,\n): Vector {\n  return [x - originX, y - originY] as Vector;\n}\n\n/**\n * Turn a point into a vector with the origin point.\n *\n * @param p The point to turn into a vector\n * @param origin The origin point in a given coordiante system\n * @param threshold The threshold to consider the vector as 'undefined'\n * @param defaultValue The default value to return if the vector is 'undefined'\n * @returns The created vector from the point and the origin or default\n */\nexport function vectorFromPoint<Point extends GlobalPoint | LocalPoint>(\n  p: Point,\n  origin: Point = [0, 0] as Point,\n  threshold?: number,\n  defaultValue: Vector = [0, 1] as Vector,\n): Vector {\n  const vec = vector(p[0] - origin[0], p[1] - origin[1]);\n\n  if (threshold && vectorMagnitudeSq(vec) < threshold * threshold) {\n    return defaultValue;\n  }\n\n  return vec;\n}\n\n/**\n * Cross product is a binary operation on two vectors in 2D space.\n * It results in a vector that is perpendicular to both vectors.\n *\n * @param a One of the vectors to use for the directed area calculation\n * @param b The other vector to use for the directed area calculation\n * @returns The directed area value for the two vectos\n */\nexport function vectorCross(a: Vector, b: Vector): number {\n  return a[0] * b[1] - b[0] * a[1];\n}\n\n/**\n * Dot product is defined as the sum of the products of the\n * two vectors.\n *\n * @param a One of the vectors for which the sum of products is calculated\n * @param b The other vector for which the sum of products is calculated\n * @returns The sum of products of the two vectors\n */\nexport function vectorDot(a: Vector, b: Vector) {\n  return a[0] * b[0] + a[1] * b[1];\n}\n\n/**\n * Determines if the value has the shape of a Vector.\n *\n * @param v The value to test\n * @returns TRUE if the value has the shape and components of a Vectors\n */\nexport function isVector(v: unknown): v is Vector {\n  return (\n    Array.isArray(v) &&\n    v.length === 2 &&\n    typeof v[0] === \"number\" &&\n    !isNaN(v[0]) &&\n    typeof v[1] === \"number\" &&\n    !isNaN(v[1])\n  );\n}\n\n/**\n * Add two vectors by adding their coordinates.\n *\n * @param a One of the vectors to add\n * @param b The other vector to add\n * @returns The sum vector of the two provided vectors\n */\nexport function vectorAdd(a: Readonly<Vector>, b: Readonly<Vector>): Vector {\n  return [a[0] + b[0], a[1] + b[1]] as Vector;\n}\n\n/**\n * Add two vectors by adding their coordinates.\n *\n * @param start One of the vectors to add\n * @param end The other vector to add\n * @returns The sum vector of the two provided vectors\n */\nexport function vectorSubtract(\n  start: Readonly<Vector>,\n  end: Readonly<Vector>,\n): Vector {\n  return [start[0] - end[0], start[1] - end[1]] as Vector;\n}\n\n/**\n * Scale vector by a scalar.\n *\n * @param v The vector to scale\n * @param scalar The scalar to multiply the vector components with\n * @returns The new scaled vector\n */\nexport function vectorScale(v: Vector, scalar: number): Vector {\n  return vector(v[0] * scalar, v[1] * scalar);\n}\n\n/**\n * Calculates the sqare magnitude of a vector. Use this if you compare\n * magnitudes as it saves you an SQRT.\n *\n * @param v The vector to measure\n * @returns The scalar squared magnitude of the vector\n */\nexport function vectorMagnitudeSq(v: Vector) {\n  return v[0] * v[0] + v[1] * v[1];\n}\n\n/**\n * Calculates the magnitude of a vector.\n *\n * @param v The vector to measure\n * @returns The scalar magnitude of the vector\n */\nexport function vectorMagnitude(v: Vector) {\n  return Math.sqrt(vectorMagnitudeSq(v));\n}\n\n/**\n * Normalize the vector (i.e. make the vector magnitue equal 1).\n *\n * @param v The vector to normalize\n * @returns The new normalized vector\n */\nexport const vectorNormalize = (v: Vector): Vector => {\n  const m = vectorMagnitude(v);\n\n  if (m === 0) {\n    return vector(0, 0);\n  }\n\n  return vector(v[0] / m, v[1] / m);\n};\n\n/**\n * Calculate the right-hand normal of the vector.\n */\nexport const vectorNormal = (v: Vector): Vector => vector(v[1], -v[0]);\n","import { PRECISION } from \"./utils\";\n\nimport type {\n  Degrees,\n  GlobalPoint,\n  LocalPoint,\n  PolarCoords,\n  Radians,\n} from \"./types\";\n\nexport const normalizeRadians = (angle: Radians): Radians =>\n  angle < 0\n    ? (((angle % (2 * Math.PI)) + 2 * Math.PI) as Radians)\n    : ((angle % (2 * Math.PI)) as Radians);\n\n/**\n * Return the polar coordinates for the given cartesian point represented by\n * (x, y) for the center point 0,0 where the first number returned is the radius,\n * the second is the angle in radians.\n */\nexport const cartesian2Polar = <P extends GlobalPoint | LocalPoint>([\n  x,\n  y,\n]: P): PolarCoords => [\n  Math.hypot(x, y),\n  normalizeRadians(Math.atan2(y, x) as Radians),\n];\n\nexport function degreesToRadians(degrees: Degrees): Radians {\n  return ((degrees * Math.PI) / 180) as Radians;\n}\n\nexport function radiansToDegrees(degrees: Radians): Degrees {\n  return ((degrees * 180) / Math.PI) as Degrees;\n}\n\n/**\n * Determines if the provided angle is a right angle.\n *\n * @param rads The angle to measure\n * @returns TRUE if the provided angle is a right angle\n */\nexport function isRightAngleRads(rads: Radians): boolean {\n  return Math.abs(Math.sin(2 * rads)) < PRECISION;\n}\n\nexport function radiansBetweenAngles(\n  a: Radians,\n  min: Radians,\n  max: Radians,\n): boolean {\n  a = normalizeRadians(a);\n  min = normalizeRadians(min);\n  max = normalizeRadians(max);\n\n  if (min < max) {\n    return a >= min && a <= max;\n  }\n\n  // The range wraps around the 0 angle\n  return a >= min || a <= max;\n}\n\nexport function radiansDifference(a: Radians, b: Radians): Radians {\n  a = normalizeRadians(a);\n  b = normalizeRadians(b);\n\n  let diff = a - b;\n\n  if (diff < -Math.PI) {\n    diff = (diff + 2 * Math.PI) as Radians;\n  } else if (diff > Math.PI) {\n    diff = (diff - 2 * Math.PI) as Radians;\n  }\n\n  return Math.abs(diff) as Radians;\n}\n","export const PRECISION = 10e-5;\n\n// Legendre-Gauss abscissae (x values) and weights for n=24\n// Refeerence: https://pomax.github.io/bezierinfo/legendre-gauss.html\nexport const LegendreGaussN24TValues = [\n  -0.0640568928626056260850430826247450385909,\n  0.0640568928626056260850430826247450385909,\n  -0.1911188674736163091586398207570696318404,\n  0.1911188674736163091586398207570696318404,\n  -0.3150426796961633743867932913198102407864,\n  0.3150426796961633743867932913198102407864,\n  -0.4337935076260451384870842319133497124524,\n  0.4337935076260451384870842319133497124524,\n  -0.5454214713888395356583756172183723700107,\n  0.5454214713888395356583756172183723700107,\n  -0.6480936519369755692524957869107476266696,\n  0.6480936519369755692524957869107476266696,\n  -0.7401241915785543642438281030999784255232,\n  0.7401241915785543642438281030999784255232,\n  -0.8200019859739029219539498726697452080761,\n  0.8200019859739029219539498726697452080761,\n  -0.8864155270044010342131543419821967550873,\n  0.8864155270044010342131543419821967550873,\n  -0.9382745520027327585236490017087214496548,\n  0.9382745520027327585236490017087214496548,\n  -0.9747285559713094981983919930081690617411,\n  0.9747285559713094981983919930081690617411,\n  -0.9951872199970213601799974097007368118745,\n  0.9951872199970213601799974097007368118745,\n];\n\nexport const LegendreGaussN24CValues = [\n  0.1279381953467521569740561652246953718517,\n  0.1279381953467521569740561652246953718517,\n  0.1258374563468282961213753825111836887264,\n  0.1258374563468282961213753825111836887264,\n  0.121670472927803391204463153476262425607,\n  0.121670472927803391204463153476262425607,\n  0.1155056680537256013533444839067835598622,\n  0.1155056680537256013533444839067835598622,\n  0.1074442701159656347825773424466062227946,\n  0.1074442701159656347825773424466062227946,\n  0.0976186521041138882698806644642471544279,\n  0.0976186521041138882698806644642471544279,\n  0.086190161531953275917185202983742667185,\n  0.086190161531953275917185202983742667185,\n  0.0733464814110803057340336152531165181193,\n  0.0733464814110803057340336152531165181193,\n  0.0592985849154367807463677585001085845412,\n  0.0592985849154367807463677585001085845412,\n  0.0442774388174198061686027482113382288593,\n  0.0442774388174198061686027482113382288593,\n  0.0285313886289336631813078159518782864491,\n  0.0285313886289336631813078159518782864491,\n  0.0123412297999871995468056670700372915759,\n  0.0123412297999871995468056670700372915759,\n];\n","import { isPoint, pointDistance, pointFrom, pointFromVector } from \"./point\";\nimport { vector, vectorNormal, vectorNormalize, vectorScale } from \"./vector\";\nimport { LegendreGaussN24CValues, LegendreGaussN24TValues } from \"./constants\";\n\nimport type { Curve, GlobalPoint, LineSegment, LocalPoint } from \"./types\";\n\n/**\n *\n * @param a\n * @param b\n * @param c\n * @param d\n * @returns\n */\nexport function curve<Point extends GlobalPoint | LocalPoint>(\n  a: Point,\n  b: Point,\n  c: Point,\n  d: Point,\n) {\n  return [a, b, c, d] as Curve<Point>;\n}\n\nfunction solveWithAnalyticalJacobian<Point extends GlobalPoint | LocalPoint>(\n  curve: Curve<Point>,\n  lineSegment: LineSegment<Point>,\n  t0: number,\n  s0: number,\n  tolerance: number = 1e-3,\n  iterLimit: number = 10,\n): number[] | null {\n  let error = Infinity;\n  let iter = 0;\n\n  while (error >= tolerance) {\n    if (iter >= iterLimit) {\n      return null;\n    }\n\n    // Compute bezier point at parameter t0\n    const bt = 1 - t0;\n    const bt2 = bt * bt;\n    const bt3 = bt2 * bt;\n    const t0_2 = t0 * t0;\n    const t0_3 = t0_2 * t0;\n\n    const bezierX =\n      bt3 * curve[0][0] +\n      3 * bt2 * t0 * curve[1][0] +\n      3 * bt * t0_2 * curve[2][0] +\n      t0_3 * curve[3][0];\n    const bezierY =\n      bt3 * curve[0][1] +\n      3 * bt2 * t0 * curve[1][1] +\n      3 * bt * t0_2 * curve[2][1] +\n      t0_3 * curve[3][1];\n\n    // Compute line point at parameter s0\n    const lineX =\n      lineSegment[0][0] + s0 * (lineSegment[1][0] - lineSegment[0][0]);\n    const lineY =\n      lineSegment[0][1] + s0 * (lineSegment[1][1] - lineSegment[0][1]);\n\n    // Function values\n    const fx = bezierX - lineX;\n    const fy = bezierY - lineY;\n\n    error = Math.abs(fx) + Math.abs(fy);\n\n    if (error < tolerance) {\n      break;\n    }\n\n    // Analytical derivatives\n    const dfx_dt =\n      -3 * bt2 * curve[0][0] +\n      3 * bt2 * curve[1][0] -\n      6 * bt * t0 * curve[1][0] -\n      3 * t0_2 * curve[2][0] +\n      6 * bt * t0 * curve[2][0] +\n      3 * t0_2 * curve[3][0];\n\n    const dfy_dt =\n      -3 * bt2 * curve[0][1] +\n      3 * bt2 * curve[1][1] -\n      6 * bt * t0 * curve[1][1] -\n      3 * t0_2 * curve[2][1] +\n      6 * bt * t0 * curve[2][1] +\n      3 * t0_2 * curve[3][1];\n\n    // Line derivatives\n    const dfx_ds = -(lineSegment[1][0] - lineSegment[0][0]);\n    const dfy_ds = -(lineSegment[1][1] - lineSegment[0][1]);\n\n    // Jacobian determinant\n    const det = dfx_dt * dfy_ds - dfx_ds * dfy_dt;\n\n    if (Math.abs(det) < 1e-12) {\n      return null;\n    }\n\n    // Newton step\n    const invDet = 1 / det;\n    const dt = invDet * (dfy_ds * -fx - dfx_ds * -fy);\n    const ds = invDet * (-dfy_dt * -fx + dfx_dt * -fy);\n\n    t0 += dt;\n    s0 += ds;\n    iter += 1;\n  }\n\n  return [t0, s0];\n}\n\nexport const bezierEquation = <Point extends GlobalPoint | LocalPoint>(\n  c: Curve<Point>,\n  t: number,\n) =>\n  pointFrom<Point>(\n    (1 - t) ** 3 * c[0][0] +\n      3 * (1 - t) ** 2 * t * c[1][0] +\n      3 * (1 - t) * t ** 2 * c[2][0] +\n      t ** 3 * c[3][0],\n    (1 - t) ** 3 * c[0][1] +\n      3 * (1 - t) ** 2 * t * c[1][1] +\n      3 * (1 - t) * t ** 2 * c[2][1] +\n      t ** 3 * c[3][1],\n  );\n\nconst initial_guesses: [number, number][] = [\n  [0.5, 0],\n  [0.2, 0],\n  [0.8, 0],\n];\n\nconst calculate = <Point extends GlobalPoint | LocalPoint>(\n  [t0, s0]: [number, number],\n  l: LineSegment<Point>,\n  c: Curve<Point>,\n) => {\n  const solution = solveWithAnalyticalJacobian(c, l, t0, s0, 1e-2, 4);\n\n  if (!solution) {\n    return null;\n  }\n\n  const [t, s] = solution;\n\n  if (t < 0 || t > 1 || s < 0 || s > 1) {\n    return null;\n  }\n\n  return bezierEquation(c, t);\n};\n\n/**\n * Computes the intersection between a cubic spline and a line segment.\n */\nexport function curveIntersectLineSegment<\n  Point extends GlobalPoint | LocalPoint,\n>(c: Curve<Point>, l: LineSegment<Point>): Point[] {\n  let solution = calculate(initial_guesses[0], l, c);\n  if (solution) {\n    return [solution];\n  }\n\n  solution = calculate(initial_guesses[1], l, c);\n  if (solution) {\n    return [solution];\n  }\n\n  solution = calculate(initial_guesses[2], l, c);\n  if (solution) {\n    return [solution];\n  }\n\n  return [];\n}\n\n/**\n * Finds the closest point on the Bezier curve from another point\n *\n * @param x\n * @param y\n * @param P0\n * @param P1\n * @param P2\n * @param P3\n * @param tolerance\n * @param maxLevel\n * @returns\n */\nexport function curveClosestPoint<Point extends GlobalPoint | LocalPoint>(\n  c: Curve<Point>,\n  p: Point,\n  tolerance: number = 1e-3,\n): Point | null {\n  const localMinimum = (\n    min: number,\n    max: number,\n    f: (t: number) => number,\n    e: number = tolerance,\n  ) => {\n    let m = min;\n    let n = max;\n    let k;\n\n    while (n - m > e) {\n      k = (n + m) / 2;\n      if (f(k - e) < f(k + e)) {\n        n = k;\n      } else {\n        m = k;\n      }\n    }\n\n    return k;\n  };\n\n  const maxSteps = 30;\n  let closestStep = 0;\n  for (let min = Infinity, step = 0; step < maxSteps; step++) {\n    const d = pointDistance(p, bezierEquation(c, step / maxSteps));\n    if (d < min) {\n      min = d;\n      closestStep = step;\n    }\n  }\n\n  const t0 = Math.max((closestStep - 1) / maxSteps, 0);\n  const t1 = Math.min((closestStep + 1) / maxSteps, 1);\n  const solution = localMinimum(t0, t1, (t) =>\n    pointDistance(p, bezierEquation(c, t)),\n  );\n\n  if (!solution) {\n    return null;\n  }\n\n  return bezierEquation(c, solution);\n}\n\n/**\n * Determines the distance between a point and the closest point on the\n * Bezier curve.\n *\n * @param c The curve to test\n * @param p The point to measure from\n */\nexport function curvePointDistance<Point extends GlobalPoint | LocalPoint>(\n  c: Curve<Point>,\n  p: Point,\n) {\n  const closest = curveClosestPoint(c, p);\n\n  if (!closest) {\n    return 0;\n  }\n\n  return pointDistance(p, closest);\n}\n\n/**\n * Determines if the parameter is a Curve\n */\nexport function isCurve<P extends GlobalPoint | LocalPoint>(\n  v: unknown,\n): v is Curve<P> {\n  return (\n    Array.isArray(v) &&\n    v.length === 4 &&\n    isPoint(v[0]) &&\n    isPoint(v[1]) &&\n    isPoint(v[2]) &&\n    isPoint(v[3])\n  );\n}\n\nexport function curveTangent<Point extends GlobalPoint | LocalPoint>(\n  [p0, p1, p2, p3]: Curve<Point>,\n  t: number,\n) {\n  return vector(\n    -3 * (1 - t) * (1 - t) * p0[0] +\n      3 * (1 - t) * (1 - t) * p1[0] -\n      6 * t * (1 - t) * p1[0] -\n      3 * t * t * p2[0] +\n      6 * t * (1 - t) * p2[0] +\n      3 * t * t * p3[0],\n    -3 * (1 - t) * (1 - t) * p0[1] +\n      3 * (1 - t) * (1 - t) * p1[1] -\n      6 * t * (1 - t) * p1[1] -\n      3 * t * t * p2[1] +\n      6 * t * (1 - t) * p2[1] +\n      3 * t * t * p3[1],\n  );\n}\n\nexport function curveCatmullRomQuadraticApproxPoints(\n  points: GlobalPoint[],\n  tension = 0.5,\n) {\n  if (points.length < 2) {\n    return;\n  }\n\n  const pointSets: [GlobalPoint, GlobalPoint][] = [];\n  for (let i = 0; i < points.length - 1; i++) {\n    const p0 = points[i - 1 < 0 ? 0 : i - 1];\n    const p1 = points[i];\n    const p2 = points[i + 1 >= points.length ? points.length - 1 : i + 1];\n    const cpX = p1[0] + ((p2[0] - p0[0]) * tension) / 2;\n    const cpY = p1[1] + ((p2[1] - p0[1]) * tension) / 2;\n\n    pointSets.push([\n      pointFrom<GlobalPoint>(cpX, cpY),\n      pointFrom<GlobalPoint>(p2[0], p2[1]),\n    ]);\n  }\n\n  return pointSets;\n}\n\nexport function curveCatmullRomCubicApproxPoints<\n  Point extends GlobalPoint | LocalPoint,\n>(points: Point[], tension = 0.5) {\n  if (points.length < 2) {\n    return;\n  }\n\n  const pointSets: Curve<Point>[] = [];\n  for (let i = 0; i < points.length - 1; i++) {\n    const p0 = points[i - 1 < 0 ? 0 : i - 1];\n    const p1 = points[i];\n    const p2 = points[i + 1 >= points.length ? points.length - 1 : i + 1];\n    const p3 = points[i + 2 >= points.length ? points.length - 1 : i + 2];\n    const tangent1 = [(p2[0] - p0[0]) * tension, (p2[1] - p0[1]) * tension];\n    const tangent2 = [(p3[0] - p1[0]) * tension, (p3[1] - p1[1]) * tension];\n    const cp1x = p1[0] + tangent1[0] / 3;\n    const cp1y = p1[1] + tangent1[1] / 3;\n    const cp2x = p2[0] - tangent2[0] / 3;\n    const cp2y = p2[1] - tangent2[1] / 3;\n\n    pointSets.push(\n      curve(\n        pointFrom(p1[0], p1[1]),\n        pointFrom(cp1x, cp1y),\n        pointFrom(cp2x, cp2y),\n        pointFrom(p2[0], p2[1]),\n      ),\n    );\n  }\n\n  return pointSets;\n}\n\nexport function curveOffsetPoints(\n  [p0, p1, p2, p3]: Curve<GlobalPoint>,\n  offset: number,\n  steps = 50,\n) {\n  const offsetPoints = [];\n\n  for (let i = 0; i <= steps; i++) {\n    const t = i / steps;\n    const c = curve(p0, p1, p2, p3);\n    const point = bezierEquation(c, t);\n    const tangent = vectorNormalize(curveTangent(c, t));\n    const normal = vectorNormal(tangent);\n\n    offsetPoints.push(pointFromVector(vectorScale(normal, offset), point));\n  }\n\n  return offsetPoints;\n}\n\nexport function offsetPointsForQuadraticBezier(\n  p0: GlobalPoint,\n  p1: GlobalPoint,\n  p2: GlobalPoint,\n  offsetDist: number,\n  steps = 50,\n) {\n  const offsetPoints = [];\n\n  for (let i = 0; i <= steps; i++) {\n    const t = i / steps;\n    const t1 = 1 - t;\n    const point = pointFrom<GlobalPoint>(\n      t1 * t1 * p0[0] + 2 * t1 * t * p1[0] + t * t * p2[0],\n      t1 * t1 * p0[1] + 2 * t1 * t * p1[1] + t * t * p2[1],\n    );\n    const tangentX = 2 * (1 - t) * (p1[0] - p0[0]) + 2 * t * (p2[0] - p1[0]);\n    const tangentY = 2 * (1 - t) * (p1[1] - p0[1]) + 2 * t * (p2[1] - p1[1]);\n    const tangent = vectorNormalize(vector(tangentX, tangentY));\n    const normal = vectorNormal(tangent);\n\n    offsetPoints.push(pointFromVector(vectorScale(normal, offsetDist), point));\n  }\n\n  return offsetPoints;\n}\n\n/**\n * Implementation based on Legendre-Gauss quadrature for more accurate arc\n * length calculation.\n *\n * Reference: https://pomax.github.io/bezierinfo/#arclength\n *\n * @param c The curve to calculate the length of\n * @returns The approximated length of the curve\n */\nexport function curveLength<P extends GlobalPoint | LocalPoint>(\n  c: Curve<P>,\n): number {\n  const z2 = 0.5;\n  let sum = 0;\n\n  for (let i = 0; i < 24; i++) {\n    const t = z2 * LegendreGaussN24TValues[i] + z2;\n    const derivativeVector = curveTangent(c, t);\n    const magnitude = Math.sqrt(\n      derivativeVector[0] * derivativeVector[0] +\n        derivativeVector[1] * derivativeVector[1],\n    );\n    sum += LegendreGaussN24CValues[i] * magnitude;\n  }\n\n  return z2 * sum;\n}\n\n/**\n * Calculates the curve length from t=0 to t=parameter using the same\n * Legendre-Gauss quadrature method used in curveLength\n *\n * @param c The curve to calculate the partial length for\n * @param t The parameter value (0 to 1) to calculate length up to\n * @returns The length of the curve from beginning to parameter t\n */\nexport function curveLengthAtParameter<P extends GlobalPoint | LocalPoint>(\n  c: Curve<P>,\n  t: number,\n): number {\n  if (t <= 0) {\n    return 0;\n  }\n  if (t >= 1) {\n    return curveLength(c);\n  }\n\n  // Scale and shift the integration interval from [0,t] to [-1,1]\n  // which is what the Legendre-Gauss quadrature expects\n  const z1 = t / 2;\n  const z2 = t / 2;\n\n  let sum = 0;\n\n  for (let i = 0; i < 24; i++) {\n    const parameter = z1 * LegendreGaussN24TValues[i] + z2;\n    const derivativeVector = curveTangent(c, parameter);\n    const magnitude = Math.sqrt(\n      derivativeVector[0] * derivativeVector[0] +\n        derivativeVector[1] * derivativeVector[1],\n    );\n    sum += LegendreGaussN24CValues[i] * magnitude;\n  }\n\n  return z1 * sum; // Scale the result back to the original interval\n}\n\n/**\n * Calculates the point at a specific percentage of a curve's total length\n * using binary search for improved efficiency and accuracy.\n *\n * @param c The curve to calculate point on\n * @param percent A value between 0 and 1 representing the percentage of the curve's length\n * @returns The point at the specified percentage of curve length\n */\nexport function curvePointAtLength<P extends GlobalPoint | LocalPoint>(\n  c: Curve<P>,\n  percent: number,\n): P {\n  if (percent <= 0) {\n    return bezierEquation(c, 0);\n  }\n\n  if (percent >= 1) {\n    return bezierEquation(c, 1);\n  }\n\n  const totalLength = curveLength(c);\n  const targetLength = totalLength * percent;\n\n  // Binary search to find parameter t where length at t equals target length\n  let tMin = 0;\n  let tMax = 1;\n  let t = percent; // Start with a reasonable guess (t = percent)\n  let currentLength = 0;\n\n  // Tolerance for length comparison and iteration limit to avoid infinite loops\n  const tolerance = totalLength * 0.0001;\n  const maxIterations = 20;\n\n  for (let iteration = 0; iteration < maxIterations; iteration++) {\n    currentLength = curveLengthAtParameter(c, t);\n    const error = Math.abs(currentLength - targetLength);\n\n    if (error < tolerance) {\n      break;\n    }\n\n    if (currentLength < targetLength) {\n      tMin = t;\n    } else {\n      tMax = t;\n    }\n\n    t = (tMin + tMax) / 2;\n  }\n\n  return bezierEquation(c, t);\n}\n","import { pointsEqual } from \"./point\";\nimport { lineSegment, pointOnLineSegment } from \"./segment\";\nimport { PRECISION } from \"./utils\";\n\nimport type { GlobalPoint, LocalPoint, Polygon } from \"./types\";\n\nexport function polygon<Point extends GlobalPoint | LocalPoint>(\n  ...points: Point[]\n) {\n  return polygonClose(points) as Polygon<Point>;\n}\n\nexport function polygonFromPoints<Point extends GlobalPoint | LocalPoint>(\n  points: Point[],\n) {\n  return polygonClose(points) as Polygon<Point>;\n}\n\nexport const polygonIncludesPoint = <Point extends LocalPoint | GlobalPoint>(\n  point: Point,\n  polygon: Polygon<Point>,\n) => {\n  const x = point[0];\n  const y = point[1];\n  let inside = false;\n\n  for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {\n    const xi = polygon[i][0];\n    const yi = polygon[i][1];\n    const xj = polygon[j][0];\n    const yj = polygon[j][1];\n\n    if (\n      ((yi > y && yj <= y) || (yi <= y && yj > y)) &&\n      x < ((xj - xi) * (y - yi)) / (yj - yi) + xi\n    ) {\n      inside = !inside;\n    }\n  }\n\n  return inside;\n};\n\nexport const polygonIncludesPointNonZero = <Point extends [number, number]>(\n  point: Point,\n  polygon: Point[],\n): boolean => {\n  const [x, y] = point;\n  let windingNumber = 0;\n\n  for (let i = 0; i < polygon.length; i++) {\n    const j = (i + 1) % polygon.length;\n    const [xi, yi] = polygon[i];\n    const [xj, yj] = polygon[j];\n\n    if (yi <= y) {\n      if (yj > y) {\n        if ((xj - xi) * (y - yi) - (x - xi) * (yj - yi) > 0) {\n          windingNumber++;\n        }\n      }\n    } else if (yj <= y) {\n      if ((xj - xi) * (y - yi) - (x - xi) * (yj - yi) < 0) {\n        windingNumber--;\n      }\n    }\n  }\n\n  return windingNumber !== 0;\n};\n\nexport const pointOnPolygon = <Point extends LocalPoint | GlobalPoint>(\n  p: Point,\n  poly: Polygon<Point>,\n  threshold = PRECISION,\n) => {\n  let on = false;\n\n  for (let i = 0, l = poly.length - 1; i < l; i++) {\n    if (pointOnLineSegment(p, lineSegment(poly[i], poly[i + 1]), threshold)) {\n      on = true;\n      break;\n    }\n  }\n\n  return on;\n};\n\nfunction polygonClose<Point extends LocalPoint | GlobalPoint>(\n  polygon: Point[],\n) {\n  return polygonIsClosed(polygon)\n    ? polygon\n    : ([...polygon, polygon[0]] as Polygon<Point>);\n}\n\nfunction polygonIsClosed<Point extends LocalPoint | GlobalPoint>(\n  polygon: Point[],\n) {\n  return pointsEqual(polygon[0], polygon[polygon.length - 1]);\n}\n","import { toBrandedType } from \"@jsondraw/common\";\n\nimport type { InclusiveRange } from \"./types\";\n\n/**\n * Create an inclusive range from the two numbers provided.\n *\n * @param start Start of the range\n * @param end End of the range\n * @returns\n */\nexport function rangeInclusive(start: number, end: number): InclusiveRange {\n  return toBrandedType<InclusiveRange>([start, end]);\n}\n\n/**\n * Turn a number pair into an inclusive range.\n *\n * @param pair The number pair to convert to an inclusive range\n * @returns The new inclusive range\n */\nexport function rangeInclusiveFromPair(pair: [start: number, end: number]) {\n  return toBrandedType<InclusiveRange>(pair);\n}\n\n/**\n * Given two ranges, return if the two ranges overlap with each other e.g.\n * [1, 3] overlaps with [2, 4] while [1, 3] does not overlap with [4, 5].\n *\n * @param param0 One of the ranges to compare\n * @param param1 The other range to compare against\n * @returns TRUE if the ranges overlap\n */\nexport const rangesOverlap = (\n  [a0, a1]: InclusiveRange,\n  [b0, b1]: InclusiveRange,\n): boolean => {\n  if (a0 <= b0) {\n    return a1 >= b0;\n  }\n\n  if (a0 >= b0) {\n    return b1 >= a0;\n  }\n\n  return false;\n};\n\n/**\n * Given two ranges,return ther intersection of the two ranges if any e.g. the\n * intersection of [1, 3] and [2, 4] is [2, 3].\n *\n * @param param0 The first range to compare\n * @param param1 The second range to compare\n * @returns The inclusive range intersection or NULL if no intersection\n */\nexport const rangeIntersection = (\n  [a0, a1]: InclusiveRange,\n  [b0, b1]: InclusiveRange,\n): InclusiveRange | null => {\n  const rangeStart = Math.max(a0, b0);\n  const rangeEnd = Math.min(a1, b1);\n\n  if (rangeStart <= rangeEnd) {\n    return toBrandedType<InclusiveRange>([rangeStart, rangeEnd]);\n  }\n\n  return null;\n};\n\n/**\n * Determine if a value is inside a range.\n *\n * @param value The value to check\n * @param range The range\n * @returns\n */\nexport const rangeIncludesValue = (\n  value: number,\n  [min, max]: InclusiveRange,\n): boolean => {\n  return value >= min && value <= max;\n};\n","import { pointFrom } from \"./point\";\nimport { lineSegment, lineSegmentIntersectionPoints } from \"./segment\";\n\nimport type { GlobalPoint, LineSegment, LocalPoint, Rectangle } from \"./types\";\n\nexport function rectangle<P extends GlobalPoint | LocalPoint>(\n  topLeft: P,\n  bottomRight: P,\n): Rectangle<P> {\n  return [topLeft, bottomRight] as Rectangle<P>;\n}\n\nexport function rectangleFromNumberSequence<\n  Point extends LocalPoint | GlobalPoint,\n>(minX: number, minY: number, maxX: number, maxY: number) {\n  return rectangle(pointFrom<Point>(minX, minY), pointFrom<Point>(maxX, maxY));\n}\n\nexport function rectangleIntersectLineSegment<\n  Point extends LocalPoint | GlobalPoint,\n>(r: Rectangle<Point>, l: LineSegment<Point>): Point[] {\n  return [\n    lineSegment(r[0], pointFrom(r[1][0], r[0][1])),\n    lineSegment(pointFrom(r[1][0], r[0][1]), r[1]),\n    lineSegment(r[1], pointFrom(r[0][0], r[1][1])),\n    lineSegment(pointFrom(r[0][0], r[1][1]), r[0]),\n  ]\n    .map((s) => lineSegmentIntersectionPoints(l, s))\n    .filter((i): i is Point => !!i);\n}\n\nexport function rectangleIntersectRectangle<\n  Point extends LocalPoint | GlobalPoint,\n>(rectangle1: Rectangle<Point>, rectangle2: Rectangle<Point>): boolean {\n  const [[minX1, minY1], [maxX1, maxY1]] = rectangle1;\n  const [[minX2, minY2], [maxX2, maxY2]] = rectangle2;\n\n  return minX1 < maxX2 && maxX1 > minX2 && minY1 < maxY2 && maxY1 > minY2;\n}\n","import { pointFrom } from \"./point\";\n\nimport type { GlobalPoint, Line, LocalPoint } from \"./types\";\n\n/**\n * Create a line from two points.\n *\n * @param points The two points lying on the line\n * @returns The line on which the points lie\n */\nexport function line<P extends GlobalPoint | LocalPoint>(a: P, b: P): Line<P> {\n  return [a, b] as Line<P>;\n}\n\n/**\n * Determines the intersection point (unless the lines are parallel) of two\n * lines\n *\n * @param a\n * @param b\n * @returns\n */\nexport function linesIntersectAt<Point extends GlobalPoint | LocalPoint>(\n  a: Line<Point>,\n  b: Line<Point>,\n): Point | null {\n  const A1 = a[1][1] - a[0][1];\n  const B1 = a[0][0] - a[1][0];\n  const A2 = b[1][1] - b[0][1];\n  const B2 = b[0][0] - b[1][0];\n  const D = A1 * B2 - A2 * B1;\n  if (D !== 0) {\n    const C1 = A1 * a[0][0] + B1 * a[0][1];\n    const C2 = A2 * b[0][0] + B2 * b[0][1];\n    return pointFrom<Point>((C1 * B2 - C2 * B1) / D, (A1 * C2 - A2 * C1) / D);\n  }\n\n  return null;\n}\n","import { line, linesIntersectAt } from \"./line\";\nimport {\n  isPoint,\n  pointCenter,\n  pointFromVector,\n  pointRotateRads,\n} from \"./point\";\nimport { PRECISION } from \"./utils\";\nimport {\n  vectorAdd,\n  vectorCross,\n  vectorFromPoint,\n  vectorScale,\n  vectorSubtract,\n} from \"./vector\";\n\nimport type { GlobalPoint, LineSegment, LocalPoint, Radians } from \"./types\";\n\n/**\n * Create a line segment from two points.\n *\n * @param points The two points delimiting the line segment on each end\n * @returns The line segment delineated by the points\n */\nexport function lineSegment<P extends GlobalPoint | LocalPoint>(\n  a: P,\n  b: P,\n): LineSegment<P> {\n  return [a, b] as LineSegment<P>;\n}\n\n/**\n *\n * @param segment\n * @returns\n */\nexport const isLineSegment = <Point extends GlobalPoint | LocalPoint>(\n  segment: unknown,\n): segment is LineSegment<Point> =>\n  Array.isArray(segment) &&\n  segment.length === 2 &&\n  isPoint(segment[0]) &&\n  isPoint(segment[0]);\n\n/**\n * Return the coordinates resulting from rotating the given line about an origin by an angle in radians\n * note that when the origin is not given, the midpoint of the given line is used as the origin.\n *\n * @param l\n * @param angle\n * @param origin\n * @returns\n */\nexport const lineSegmentRotate = <Point extends LocalPoint | GlobalPoint>(\n  l: LineSegment<Point>,\n  angle: Radians,\n  origin?: Point,\n): LineSegment<Point> => {\n  return lineSegment(\n    pointRotateRads(l[0], origin || pointCenter(l[0], l[1]), angle),\n    pointRotateRads(l[1], origin || pointCenter(l[0], l[1]), angle),\n  );\n};\n\n/**\n * Calculates the point two line segments with a definite start and end point\n * intersect at.\n */\nexport const segmentsIntersectAt = <Point extends GlobalPoint | LocalPoint>(\n  a: Readonly<LineSegment<Point>>,\n  b: Readonly<LineSegment<Point>>,\n): Point | null => {\n  const a0 = vectorFromPoint(a[0]);\n  const a1 = vectorFromPoint(a[1]);\n  const b0 = vectorFromPoint(b[0]);\n  const b1 = vectorFromPoint(b[1]);\n  const r = vectorSubtract(a1, a0);\n  const s = vectorSubtract(b1, b0);\n  const denominator = vectorCross(r, s);\n\n  if (denominator === 0) {\n    return null;\n  }\n\n  const i = vectorSubtract(vectorFromPoint(b[0]), vectorFromPoint(a[0]));\n  const u = vectorCross(i, r) / denominator;\n  const t = vectorCross(i, s) / denominator;\n\n  if (u === 0) {\n    return null;\n  }\n\n  const p = vectorAdd(a0, vectorScale(r, t));\n\n  if (t >= 0 && t < 1 && u >= 0 && u < 1) {\n    return pointFromVector<Point>(p);\n  }\n\n  return null;\n};\n\nexport const pointOnLineSegment = <Point extends LocalPoint | GlobalPoint>(\n  point: Point,\n  line: LineSegment<Point>,\n  threshold = PRECISION,\n) => {\n  const distance = distanceToLineSegment(point, line);\n\n  if (distance === 0) {\n    return true;\n  }\n\n  return distance < threshold;\n};\n\nexport const distanceToLineSegment = <Point extends LocalPoint | GlobalPoint>(\n  point: Point,\n  line: LineSegment<Point>,\n) => {\n  const [x, y] = point;\n  const [[x1, y1], [x2, y2]] = line;\n\n  const A = x - x1;\n  const B = y - y1;\n  const C = x2 - x1;\n  const D = y2 - y1;\n\n  const dot = A * C + B * D;\n  const len_sq = C * C + D * D;\n  let param = -1;\n  if (len_sq !== 0) {\n    param = dot / len_sq;\n  }\n\n  let xx;\n  let yy;\n\n  if (param < 0) {\n    xx = x1;\n    yy = y1;\n  } else if (param > 1) {\n    xx = x2;\n    yy = y2;\n  } else {\n    xx = x1 + param * C;\n    yy = y1 + param * D;\n  }\n\n  const dx = x - xx;\n  const dy = y - yy;\n  return Math.sqrt(dx * dx + dy * dy);\n};\n\n/**\n * Returns the intersection point of a segment and a line\n *\n * @param l\n * @param s\n * @returns\n */\nexport function lineSegmentIntersectionPoints<\n  Point extends GlobalPoint | LocalPoint,\n>(\n  l: LineSegment<Point>,\n  s: LineSegment<Point>,\n  threshold?: number,\n): Point | null {\n  const candidate = linesIntersectAt(line(l[0], l[1]), line(s[0], s[1]));\n\n  if (\n    !candidate ||\n    !pointOnLineSegment(candidate, s, threshold) ||\n    !pointOnLineSegment(candidate, l, threshold)\n  ) {\n    return null;\n  }\n\n  return candidate;\n}\n\nexport function lineSegmentsDistance<Point extends GlobalPoint | LocalPoint>(\n  s1: LineSegment<Point>,\n  s2: LineSegment<Point>,\n): number {\n  if (lineSegmentIntersectionPoints(s1, s2)) {\n    return 0;\n  }\n\n  return Math.min(\n    distanceToLineSegment(s1[0], s2),\n    distanceToLineSegment(s1[1], s2),\n    distanceToLineSegment(s2[0], s1),\n    distanceToLineSegment(s2[1], s1),\n  );\n}\n","import type { GlobalPoint, LocalPoint, Triangle } from \"./types\";\n\n// Types\n\n/**\n * Tests if a point lies inside a triangle. This function\n * will return FALSE if the point lies exactly on the sides\n * of the triangle.\n *\n * @param triangle The triangle to test the point for\n * @param p The point to test whether is in the triangle\n * @returns TRUE if the point is inside of the triangle\n */\nexport function triangleIncludesPoint<P extends GlobalPoint | LocalPoint>(\n  [a, b, c]: Triangle<P>,\n  p: P,\n): boolean {\n  const triangleSign = (p1: P, p2: P, p3: P) =>\n    (p1[0] - p3[0]) * (p2[1] - p3[1]) - (p2[0] - p3[0]) * (p1[1] - p3[1]);\n  const d1 = triangleSign(p, a, b);\n  const d2 = triangleSign(p, b, c);\n  const d3 = triangleSign(p, c, a);\n\n  const has_neg = d1 < 0 || d2 < 0 || d3 < 0;\n  const has_pos = d1 > 0 || d2 > 0 || d3 > 0;\n\n  return !(has_neg && has_pos);\n}\n","export * from \"./angle\";\nexport * from \"./curve\";\nexport * from \"./ellipse\";\nexport * from \"./line\";\nexport * from \"./point\";\nexport * from \"./polygon\";\nexport * from \"./range\";\nexport * from \"./rectangle\";\nexport * from \"./segment\";\nexport * from \"./triangle\";\nexport * from \"./types\";\nexport * from \"./vector\";\nexport * from \"./utils\";\n","export const PRECISION = 10e-5;\n\nexport const clamp = (value: number, min: number, max: number) => {\n  return Math.min(Math.max(value, min), max);\n};\n\nexport const round = (\n  value: number,\n  precision: number,\n  func: \"round\" | \"floor\" | \"ceil\" = \"round\",\n) => {\n  const multiplier = Math.pow(10, precision);\n\n  return Math[func]((value + Number.EPSILON) * multiplier) / multiplier;\n};\n\nexport const roundToStep = (\n  value: number,\n  step: number,\n  func: \"round\" | \"floor\" | \"ceil\" = \"round\",\n): number => {\n  const factor = 1 / step;\n  return Math[func](value * factor) / factor;\n};\n\nexport const average = (a: number, b: number) => (a + b) / 2;\n\nexport const isFiniteNumber = (value: any): value is number => {\n  return typeof value === \"number\" && Number.isFinite(value);\n};\n\nexport const isCloseTo = (a: number, b: number, precision = PRECISION) =>\n  Math.abs(a - b) < precision;\n","export class BinaryHeap<T> {\n  private content: T[] = [];\n\n  constructor(private scoreFunction: (node: T) => number) {}\n\n  sinkDown(idx: number) {\n    const node = this.content[idx];\n    const nodeScore = this.scoreFunction(node);\n    while (idx > 0) {\n      const parentN = ((idx + 1) >> 1) - 1;\n      const parent = this.content[parentN];\n      if (nodeScore < this.scoreFunction(parent)) {\n        this.content[idx] = parent;\n        idx = parentN; // TODO: Optimize\n      } else {\n        break;\n      }\n    }\n    this.content[idx] = node;\n  }\n\n  bubbleUp(idx: number) {\n    const length = this.content.length;\n    const node = this.content[idx];\n    const score = this.scoreFunction(node);\n\n    while (true) {\n      const child1N = ((idx + 1) << 1) - 1;\n      const child2N = child1N + 1;\n      let smallestIdx = idx;\n      let smallestScore = score;\n\n      // Check left child\n      if (child1N < length) {\n        const child1Score = this.scoreFunction(this.content[child1N]);\n        if (child1Score < smallestScore) {\n          smallestIdx = child1N;\n          smallestScore = child1Score;\n        }\n      }\n\n      // Check right child\n      if (child2N < length) {\n        const child2Score = this.scoreFunction(this.content[child2N]);\n        if (child2Score < smallestScore) {\n          smallestIdx = child2N;\n        }\n      }\n\n      if (smallestIdx === idx) {\n        break;\n      }\n\n      // Move the smaller child up, continue finding position for node\n      this.content[idx] = this.content[smallestIdx];\n      idx = smallestIdx;\n    }\n\n    // Place node in its final position\n    this.content[idx] = node;\n  }\n\n  push(node: T) {\n    this.content.push(node);\n    this.sinkDown(this.content.length - 1);\n  }\n\n  pop(): T | null {\n    if (this.content.length === 0) {\n      return null;\n    }\n\n    const result = this.content[0];\n    const end = this.content.pop()!;\n\n    if (this.content.length > 0) {\n      this.content[0] = end;\n      this.bubbleUp(0);\n    }\n\n    return result;\n  }\n\n  remove(node: T) {\n    if (this.content.length === 0) {\n      return;\n    }\n\n    const i = this.content.indexOf(node);\n    const end = this.content.pop()!;\n\n    if (i < this.content.length) {\n      this.content[i] = end;\n\n      if (this.scoreFunction(end) < this.scoreFunction(node)) {\n        this.sinkDown(i);\n      } else {\n        this.bubbleUp(i);\n      }\n    }\n  }\n\n  size(): number {\n    return this.content.length;\n  }\n\n  rescoreElement(node: T) {\n    this.sinkDown(this.content.indexOf(node));\n  }\n}\n","import tinycolor from \"tinycolor2\";\n\nimport { clamp } from \"@jsondraw/math\";\nimport { degreesToRadians } from \"@jsondraw/math\";\n\nimport type { Degrees } from \"@jsondraw/math\";\n\n// ---------------------------------------------------------------------------\n// Dark mode color transformation\n// ---------------------------------------------------------------------------\n\n// Browser-only cache to avoid memory leaks on server\nconst DARK_MODE_COLORS_CACHE: Map<string, string> | null =\n  typeof window !== \"undefined\" ? new Map() : null;\n\nfunction cssHueRotate(\n  red: number,\n  green: number,\n  blue: number,\n  degrees: Degrees,\n): { r: number; g: number; b: number } {\n  // normalize\n  const r = red / 255;\n  const g = green / 255;\n  const b = blue / 255;\n\n  // Convert degrees to radians\n  const a = degreesToRadians(degrees);\n\n  const c = Math.cos(a);\n  const s = Math.sin(a);\n\n  // rotation matrix\n  const matrix = [\n    0.213 + c * 0.787 - s * 0.213,\n    0.715 - c * 0.715 - s * 0.715,\n    0.072 - c * 0.072 + s * 0.928,\n    0.213 - c * 0.213 + s * 0.143,\n    0.715 + c * 0.285 + s * 0.14,\n    0.072 - c * 0.072 - s * 0.283,\n    0.213 - c * 0.213 - s * 0.787,\n    0.715 - c * 0.715 + s * 0.715,\n    0.072 + c * 0.928 + s * 0.072,\n  ];\n\n  // transform\n  const newR = r * matrix[0] + g * matrix[1] + b * matrix[2];\n  const newG = r * matrix[3] + g * matrix[4] + b * matrix[5];\n  const newB = r * matrix[6] + g * matrix[7] + b * matrix[8];\n\n  // clamp the values to [0, 1] range and convert back to [0, 255]\n  return {\n    r: Math.round(Math.max(0, Math.min(1, newR)) * 255),\n    g: Math.round(Math.max(0, Math.min(1, newG)) * 255),\n    b: Math.round(Math.max(0, Math.min(1, newB)) * 255),\n  };\n}\n\nconst cssInvert = (\n  r: number,\n  g: number,\n  b: number,\n  percent: number,\n): { r: number; g: number; b: number } => {\n  const p = clamp(percent, 0, 100) / 100;\n\n  // Function to invert a single color component\n  const invertComponent = (color: number): number => {\n    // Apply the invert formula\n    const inverted = color * (1 - p) + (255 - color) * p;\n    // Round to the nearest integer and clamp to [0, 255]\n    return Math.round(clamp(inverted, 0, 255));\n  };\n\n  // Calculate the inverted RGB components\n  const invertedR = invertComponent(r);\n  const invertedG = invertComponent(g);\n  const invertedB = invertComponent(b);\n\n  return { r: invertedR, g: invertedG, b: invertedB };\n};\n\nexport const applyDarkModeFilter = (color: string): string => {\n  const cached = DARK_MODE_COLORS_CACHE?.get(color);\n  if (cached) {\n    return cached;\n  }\n\n  const tc = tinycolor(color);\n  const alpha = tc.getAlpha();\n\n  // order of operations matters\n  // (corresponds to \"filter: invert(invertPercent) hue-rotate(hueDegrees)\" in css)\n  const rgb = tc.toRgb();\n  const inverted = cssInvert(rgb.r, rgb.g, rgb.b, 93);\n  const rotated = cssHueRotate(\n    inverted.r,\n    inverted.g,\n    inverted.b,\n    180 as Degrees,\n  );\n\n  const result = rgbToHex(rotated.r, rotated.g, rotated.b, alpha);\n\n  if (DARK_MODE_COLORS_CACHE) {\n    DARK_MODE_COLORS_CACHE.set(color, result);\n  }\n\n  return result;\n};\n\n// ---------------------------------------------------------------------------\n// Color palette\n// ---------------------------------------------------------------------------\n\n// FIXME can't put to utils.ts rn because of circular dependency\nconst pick = <R extends Record<string, any>, K extends readonly (keyof R)[]>(\n  source: R,\n  keys: K,\n) => {\n  return keys.reduce((acc, key: K[number]) => {\n    if (key in source) {\n      acc[key] = source[key];\n    }\n    return acc;\n  }, {} as Pick<R, K[number]>) as Pick<R, K[number]>;\n};\n\nexport type ColorTuple = readonly [string, string, string, string, string];\n\n// used general type instead of specific type (ColorPalette) to support custom colors\nexport type ColorPaletteCustom = { [key: string]: ColorTuple | string };\nexport type ColorShadesIndexes = [number, number, number, number, number];\n\nexport const MAX_CUSTOM_COLORS_USED_IN_CANVAS = 5;\nexport const COLORS_PER_ROW = 5;\n\nexport const DEFAULT_CHART_COLOR_INDEX = 4;\n\nexport const DEFAULT_ELEMENT_STROKE_COLOR_INDEX = 4;\nexport const DEFAULT_ELEMENT_BACKGROUND_COLOR_INDEX = 1;\n\nexport const COLOR_PALETTE = {\n  transparent: \"transparent\",\n  black: \"#1e1e1e\",\n  white: \"#ffffff\",\n  // open-color from https://github.com/yeun/open-color/blob/master/open-color.js\n  // corresponds to indexes [0,2,4,6,8] (weights: 50, 200, 400, 600, 800)\n  gray: [\"#f8f9fa\", \"#e9ecef\", \"#ced4da\", \"#868e96\", \"#343a40\"],\n  red: [\"#fff5f5\", \"#ffc9c9\", \"#ff8787\", \"#fa5252\", \"#e03131\"],\n  pink: [\"#fff0f6\", \"#fcc2d7\", \"#f783ac\", \"#e64980\", \"#c2255c\"],\n  grape: [\"#f8f0fc\", \"#eebefa\", \"#da77f2\", \"#be4bdb\", \"#9c36b5\"],\n  violet: [\"#f3f0ff\", \"#d0bfff\", \"#9775fa\", \"#7950f2\", \"#6741d9\"],\n  blue: [\"#e7f5ff\", \"#a5d8ff\", \"#4dabf7\", \"#228be6\", \"#1971c2\"],\n  cyan: [\"#e3fafc\", \"#99e9f2\", \"#3bc9db\", \"#15aabf\", \"#0c8599\"],\n  teal: [\"#e6fcf5\", \"#96f2d7\", \"#38d9a9\", \"#12b886\", \"#099268\"],\n  green: [\"#ebfbee\", \"#b2f2bb\", \"#69db7c\", \"#40c057\", \"#2f9e44\"],\n  yellow: [\"#fff9db\", \"#ffec99\", \"#ffd43b\", \"#fab005\", \"#f08c00\"],\n  orange: [\"#fff4e6\", \"#ffd8a8\", \"#ffa94d\", \"#fd7e14\", \"#e8590c\"],\n  // radix bronze shades [3,5,7,9,11]\n  bronze: [\"#f8f1ee\", \"#eaddd7\", \"#d2bab0\", \"#a18072\", \"#846358\"],\n} as const;\n\nexport type ColorPalette = typeof COLOR_PALETTE;\nexport type ColorPickerColor = keyof typeof COLOR_PALETTE;\n\nconst COMMON_ELEMENT_SHADES = pick(COLOR_PALETTE, [\n  \"cyan\",\n  \"blue\",\n  \"violet\",\n  \"grape\",\n  \"pink\",\n  \"green\",\n  \"teal\",\n  \"yellow\",\n  \"orange\",\n  \"red\",\n]);\n\n// quick picks defaults\n// -----------------------------------------------------------------------------\n\n// ORDER matters for positioning in quick picker\nexport const DEFAULT_ELEMENT_STROKE_PICKS = [\n  COLOR_PALETTE.black,\n  COLOR_PALETTE.red[DEFAULT_ELEMENT_STROKE_COLOR_INDEX],\n  COLOR_PALETTE.green[DEFAULT_ELEMENT_STROKE_COLOR_INDEX],\n  COLOR_PALETTE.blue[DEFAULT_ELEMENT_STROKE_COLOR_INDEX],\n  COLOR_PALETTE.yellow[DEFAULT_ELEMENT_STROKE_COLOR_INDEX],\n] as ColorTuple;\n\n// ORDER matters for positioning in quick picker\nexport const DEFAULT_ELEMENT_BACKGROUND_PICKS = [\n  COLOR_PALETTE.transparent,\n  COLOR_PALETTE.red[DEFAULT_ELEMENT_BACKGROUND_COLOR_INDEX],\n  COLOR_PALETTE.green[DEFAULT_ELEMENT_BACKGROUND_COLOR_INDEX],\n  COLOR_PALETTE.blue[DEFAULT_ELEMENT_BACKGROUND_COLOR_INDEX],\n  COLOR_PALETTE.yellow[DEFAULT_ELEMENT_BACKGROUND_COLOR_INDEX],\n] as ColorTuple;\n\n// ORDER matters for positioning in quick picker\nexport const DEFAULT_CANVAS_BACKGROUND_PICKS = [\n  COLOR_PALETTE.white,\n  // radix slate2\n  \"#f8f9fa\",\n  // radix blue2\n  \"#f5faff\",\n  // radix yellow2\n  \"#fffce8\",\n  // radix bronze2\n  \"#fdf8f6\",\n] as ColorTuple;\n\n// palette defaults\n// -----------------------------------------------------------------------------\n\nexport const DEFAULT_ELEMENT_STROKE_COLOR_PALETTE = {\n  // 1st row\n  transparent: COLOR_PALETTE.transparent,\n  white: COLOR_PALETTE.white,\n  gray: COLOR_PALETTE.gray,\n  black: COLOR_PALETTE.black,\n  bronze: COLOR_PALETTE.bronze,\n  // rest\n  ...COMMON_ELEMENT_SHADES,\n} as const;\n\n// ORDER matters for positioning in pallete (5x3 grid)s\nexport const DEFAULT_ELEMENT_BACKGROUND_COLOR_PALETTE = {\n  transparent: COLOR_PALETTE.transparent,\n  white: COLOR_PALETTE.white,\n  gray: COLOR_PALETTE.gray,\n  black: COLOR_PALETTE.black,\n  bronze: COLOR_PALETTE.bronze,\n\n  ...COMMON_ELEMENT_SHADES,\n} as const;\n\n// color palette helpers\n// -----------------------------------------------------------------------------\n\n// !!!MUST BE WITHOUT GRAY, TRANSPARENT AND BLACK!!!\nexport const getAllColorsSpecificShade = (index: 0 | 1 | 2 | 3 | 4) =>\n  [\n    // 2nd row\n    COLOR_PALETTE.cyan[index],\n    COLOR_PALETTE.blue[index],\n    COLOR_PALETTE.violet[index],\n    COLOR_PALETTE.grape[index],\n    COLOR_PALETTE.pink[index],\n\n    // 3rd row\n    COLOR_PALETTE.green[index],\n    COLOR_PALETTE.teal[index],\n    COLOR_PALETTE.yellow[index],\n    COLOR_PALETTE.orange[index],\n    COLOR_PALETTE.red[index],\n  ] as const;\n\n// -----------------------------------------------------------------------------\n// other helpers\n// -----------------------------------------------------------------------------\n\nexport const rgbToHex = (r: number, g: number, b: number, a?: number) => {\n  // (1 << 24) adds 0x1000000 to ensure the hex string is always 7 chars,\n  // then slice(1) removes the leading \"1\" to get exactly 6 hex digits\n  // e.g. rgb(0,0,0) -> 0x1000000 -> \"1000000\" -> \"000000\"\n  const hex6 = `#${((1 << 24) + (r << 16) + (g << 8) + b)\n    .toString(16)\n    .slice(1)}`;\n  if (a !== undefined && a < 1) {\n    // convert alpha from 0-1 float to 0-255 int, then to 2-digit hex\n    // e.g. 0.5 -> 128 -> \"80\"\n    const alphaHex = Math.round(a * 255)\n      .toString(16)\n      .padStart(2, \"0\");\n    return `${hex6}${alphaHex}`;\n  }\n  return hex6;\n};\n\n/**\n * @returns #RRGGBB or #RRGGBBAA based on color containing non-opaque alpha,\n *  null if not valid color\n */\nexport const colorToHex = (color: string): string | null => {\n  const tc = tinycolor(color);\n  if (!tc.isValid()) {\n    return null;\n  }\n  const { r, g, b, a } = tc.toRgb();\n  return rgbToHex(r, g, b, a);\n};\n\nexport const isTransparent = (color: string) => {\n  return tinycolor(color).getAlpha() === 0;\n};\n\n// -----------------------------------------------------------------------------\n// color contract helpers\n// -----------------------------------------------------------------------------\n\nexport const COLOR_OUTLINE_CONTRAST_THRESHOLD = 240;\n\nconst calculateContrast = (r: number, g: number, b: number): number => {\n  const yiq = (r * 299 + g * 587 + b * 114) / 1000;\n  return yiq;\n};\n\n// YIQ algo, inspiration from https://stackoverflow.com/a/11868398\nexport const isColorDark = (color: string, threshold = 160): boolean => {\n  // no color (\"\") -> assume it default to black\n  if (!color) {\n    return true;\n  }\n\n  if (isTransparent(color)) {\n    return false;\n  }\n\n  const tc = tinycolor(color);\n  if (!tc.isValid()) {\n    // invalid color -> assume it defaults to black\n    return true;\n  }\n\n  const { r, g, b } = tc.toRgb();\n  return calculateContrast(r, g, b) < threshold;\n};\n\n// -----------------------------------------------------------------------------\n// normalization\n// -----------------------------------------------------------------------------\n\n/**\n * tries to keep the input color as-is if it's valid, making minimal adjustments\n * (trimming whitespace or adding `#` to hex colors)\n */\nexport const normalizeInputColor = (color: string): string | null => {\n  color = color.trim();\n  if (isTransparent(color)) {\n    return color;\n  }\n\n  const tc = tinycolor(color);\n  if (tc.isValid()) {\n    // testing for `#` first fixes a bug on Electron (more specfically, an\n    // Obsidian popout window), where a hex color without `#` is considered valid\n    if (tc.getFormat() === \"hex\" && !color.startsWith(\"#\")) {\n      return `#${color}`;\n    }\n    return color;\n  }\n\n  return null;\n};\n","import type { JsonDrawElement, FontFamilyValues } from \"@jsondraw/element/types\";\nimport type { AppProps, AppState } from \"@jsondraw/jsondraw/types\";\nimport { COLOR_PALETTE } from \"./colors\";\n\nexport const supportsResizeObserver = typeof window !== \"undefined\" && \"ResizeObserver\" in window;\n\nexport const APP_NAME = \"JsonDraw\";\n\n// distance when creating text before it's considered `autoResize: false`\n// we're using higher threshold so that clicks that end up being drags\n// don't unintentionally create text elements that are wrapped to a few chars\n// (happens a lot with fast clicks with the text tool)\nexport const TEXT_AUTOWRAP_THRESHOLD = 36; // px\nexport const DRAGGING_THRESHOLD = 10; // px\nexport const MINIMUM_ARROW_SIZE = 20; // px\nexport const LINE_CONFIRM_THRESHOLD = 8; // px\nexport const ELEMENT_SHIFT_TRANSLATE_AMOUNT = 5;\nexport const ELEMENT_TRANSLATE_AMOUNT = 1;\nexport const TEXT_TO_CENTER_SNAP_THRESHOLD = 30;\nexport const SHIFT_LOCKING_ANGLE = Math.PI / 12;\nexport const DEFAULT_LASER_COLOR = \"red\";\nexport const CURSOR_TYPE = {\n  TEXT: \"text\",\n  CROSSHAIR: \"crosshair\",\n  GRABBING: \"grabbing\",\n  GRAB: \"grab\",\n  POINTER: \"pointer\",\n  MOVE: \"move\",\n  AUTO: \"\",\n};\nexport const POINTER_BUTTON = {\n  MAIN: 0,\n  WHEEL: 1,\n  SECONDARY: 2,\n  TOUCH: -1,\n  ERASER: 5,\n} as const;\n\nexport const POINTER_EVENTS = {\n  enabled: \"all\",\n  disabled: \"none\",\n  // asserted as any so it can be freely assigned to React Element\n  // \"pointerEnvets\" CSS prop\n  inheritFromUI: \"var(--ui-pointerEvents)\" as any,\n} as const;\n\nexport enum EVENT {\n  COPY = \"copy\",\n  PASTE = \"paste\",\n  CUT = \"cut\",\n  KEYDOWN = \"keydown\",\n  KEYUP = \"keyup\",\n  MOUSE_MOVE = \"mousemove\",\n  RESIZE = \"resize\",\n  UNLOAD = \"unload\",\n  FOCUS = \"focus\",\n  BLUR = \"blur\",\n  DRAG_OVER = \"dragover\",\n  DROP = \"drop\",\n  GESTURE_END = \"gestureend\",\n  BEFORE_UNLOAD = \"beforeunload\",\n  GESTURE_START = \"gesturestart\",\n  GESTURE_CHANGE = \"gesturechange\",\n  POINTER_MOVE = \"pointermove\",\n  POINTER_DOWN = \"pointerdown\",\n  POINTER_UP = \"pointerup\",\n  STATE_CHANGE = \"statechange\",\n  WHEEL = \"wheel\",\n  TOUCH_START = \"touchstart\",\n  TOUCH_END = \"touchend\",\n  HASHCHANGE = \"hashchange\",\n  VISIBILITY_CHANGE = \"visibilitychange\",\n  SCROLL = \"scroll\",\n  // custom events\n  JSONDRAW_LINK = \"jsondraw-link\",\n  MENU_ITEM_SELECT = \"menu.itemSelect\",\n  MESSAGE = \"message\",\n  FULLSCREENCHANGE = \"fullscreenchange\",\n}\n\nexport const YOUTUBE_STATES = {\n  UNSTARTED: -1,\n  ENDED: 0,\n  PLAYING: 1,\n  PAUSED: 2,\n  BUFFERING: 3,\n  CUED: 5,\n} as const;\n\nexport const ENV = {\n  TEST: \"test\",\n  DEVELOPMENT: \"development\",\n  PRODUCTION: \"production\",\n};\n\nexport const CLASSES = {\n  SIDEBAR: \"sidebar\",\n  SHAPE_ACTIONS_MENU: \"App-menu__left\",\n  ZOOM_ACTIONS: \"zoom-actions\",\n  SEARCH_MENU_INPUT_WRAPPER: \"layer-ui__search-inputWrapper\",\n  CONVERT_ELEMENT_TYPE_POPUP: \"ConvertElementTypePopup\",\n  SHAPE_ACTIONS_THEME_SCOPE: \"shape-actions-theme-scope\",\n  FRAME_NAME: \"frame-name\",\n  DROPDOWN_MENU_EVENT_WRAPPER: \"dropdown-menu-event-wrapper\",\n};\n\nexport const FONT_SIZES = {\n  sm: 16,\n  md: 20,\n  lg: 28,\n  xl: 36,\n} as const;\n\nexport const CJK_HAND_DRAWN_FALLBACK_FONT = \"Xiaolai\";\nexport const WINDOWS_EMOJI_FALLBACK_FONT = \"Segoe UI Emoji\";\n\n/**\n * // TODO: shouldn't be really `const`, likely neither have integers as values, due to value for the custom fonts, which should likely be some hash.\n *\n * Let's think this through and consider:\n * - https://developer.mozilla.org/en-US/docs/Web/CSS/generic-family\n * - https://drafts.csswg.org/css-fonts-4/#font-family-prop\n * - https://learn.microsoft.com/en-us/typography/opentype/spec/ibmfc\n */\nexport const FONT_FAMILY = {\n  Virgil: 1,\n  Helvetica: 2,\n  Cascadia: 3,\n  // leave 4 unused as it was historically used for Assistant (which we don't use anymore) or custom font (Obsidian)\n  Excalifont: 5,\n  Nunito: 6,\n  \"Lilita One\": 7,\n  \"Comic Shanns\": 8,\n  \"Liberation Sans\": 9,\n  Assistant: 10,\n};\n\n// Segoe UI Emoji fails to properly fallback for some glyphs: , , \n// so we need to have generic font fallback before it\nexport const SANS_SERIF_GENERIC_FONT = \"sans-serif\";\nexport const MONOSPACE_GENERIC_FONT = \"monospace\";\n\nexport const FONT_FAMILY_GENERIC_FALLBACKS = {\n  [SANS_SERIF_GENERIC_FONT]: 998,\n  [MONOSPACE_GENERIC_FONT]: 999,\n};\n\nexport const FONT_FAMILY_FALLBACKS = {\n  [CJK_HAND_DRAWN_FALLBACK_FONT]: 100,\n  ...FONT_FAMILY_GENERIC_FALLBACKS,\n  [WINDOWS_EMOJI_FALLBACK_FONT]: 1000,\n};\n\nexport function getGenericFontFamilyFallback(\n  fontFamily: number\n): keyof typeof FONT_FAMILY_GENERIC_FALLBACKS {\n  switch (fontFamily) {\n    case FONT_FAMILY.Cascadia:\n    case FONT_FAMILY[\"Comic Shanns\"]:\n      return MONOSPACE_GENERIC_FONT;\n\n    default:\n      return SANS_SERIF_GENERIC_FONT;\n  }\n}\n\nexport const getFontFamilyFallbacks = (\n  fontFamily: number\n): Array<keyof typeof FONT_FAMILY_FALLBACKS> => {\n  const genericFallbackFont = getGenericFontFamilyFallback(fontFamily);\n\n  switch (fontFamily) {\n    case FONT_FAMILY.Excalifont:\n      return [CJK_HAND_DRAWN_FALLBACK_FONT, genericFallbackFont, WINDOWS_EMOJI_FALLBACK_FONT];\n    default:\n      return [genericFallbackFont, WINDOWS_EMOJI_FALLBACK_FONT];\n  }\n};\n\nexport const THEME = {\n  LIGHT: \"light\",\n  DARK: \"dark\",\n} as const;\n\nexport const DARK_THEME_FILTER = \"invert(93%) hue-rotate(180deg)\";\n\nexport const FRAME_STYLE = {\n  strokeColor: \"#bbb\" as JsonDrawElement[\"strokeColor\"],\n  strokeWidth: 2 as JsonDrawElement[\"strokeWidth\"],\n  strokeStyle: \"solid\" as JsonDrawElement[\"strokeStyle\"],\n  fillStyle: \"solid\" as JsonDrawElement[\"fillStyle\"],\n  roughness: 0 as JsonDrawElement[\"roughness\"],\n  roundness: null as JsonDrawElement[\"roundness\"],\n  backgroundColor: \"transparent\" as JsonDrawElement[\"backgroundColor\"],\n  radius: 8,\n  nameOffsetY: 3,\n  nameColorLightTheme: \"#999999\",\n  nameColorDarkTheme: \"#7a7a7a\",\n  nameFontSize: 14,\n  nameLineHeight: 1.25,\n};\n\nexport const MIN_FONT_SIZE = 1;\nexport const DEFAULT_FONT_SIZE = 20;\nexport const DEFAULT_FONT_FAMILY: FontFamilyValues = FONT_FAMILY.Excalifont;\nexport const DEFAULT_TEXT_ALIGN = \"left\";\nexport const DEFAULT_VERTICAL_ALIGN = \"top\";\nexport const DEFAULT_VERSION = \"{version}\";\nexport const DEFAULT_TRANSFORM_HANDLE_SPACING = 2;\n\nexport const SIDE_RESIZING_THRESHOLD = 2 * DEFAULT_TRANSFORM_HANDLE_SPACING;\n// a small epsilon to make side resizing always take precedence\n// (avoids an increase in renders and changes to tests)\nexport const EPSILON = 0.00001;\nexport const DEFAULT_COLLISION_THRESHOLD = 2 * SIDE_RESIZING_THRESHOLD - EPSILON;\n\nexport const COLOR_WHITE = \"#ffffff\";\nexport const COLOR_CHARCOAL_BLACK = \"#1e1e1e\";\n// keep this in sync with CSS\nexport const COLOR_VOICE_CALL = \"#a2f1a6\";\n\nexport const CANVAS_ONLY_ACTIONS = [\"selectAll\"];\n\nexport const DEFAULT_GRID_SIZE = 20;\nexport const DEFAULT_GRID_STEP = 5;\n\nexport const IMAGE_MIME_TYPES = {\n  svg: \"image/svg+xml\",\n  png: \"image/png\",\n  jpg: \"image/jpeg\",\n  gif: \"image/gif\",\n  webp: \"image/webp\",\n  bmp: \"image/bmp\",\n  ico: \"image/x-icon\",\n  avif: \"image/avif\",\n  jfif: \"image/jfif\",\n} as const;\n\nexport const STRING_MIME_TYPES = {\n  text: \"text/plain\",\n  html: \"text/html\",\n  json: \"application/json\",\n  // jsondraw data\n  jsondraw: \"application/vnd.jsondraw+json\",\n  jsondrawClipboard: \"application/vnd.jsondraw.clipboard+json\",\n  // LEGACY: fully-qualified library JSON data\n  jsondrawlib: \"application/vnd.jsondrawlib+json\",\n  // list of jsondraw library item ids\n  jsondrawlibIds: \"application/vnd.jsondrawlib.ids+json\",\n} as const;\n\nexport const MIME_TYPES = {\n  ...STRING_MIME_TYPES,\n  // image-encoded jsondraw data\n  \"jsondraw.svg\": \"image/svg+xml\",\n  \"jsondraw.png\": \"image/png\",\n  // binary\n  binary: \"application/octet-stream\",\n  // image\n  ...IMAGE_MIME_TYPES,\n} as const;\n\nexport const ALLOWED_PASTE_MIME_TYPES = [\n  MIME_TYPES.text,\n  MIME_TYPES.html,\n  ...Object.values(IMAGE_MIME_TYPES),\n] as const;\n\nexport const EXPORT_IMAGE_TYPES = {\n  png: \"png\",\n  svg: \"svg\",\n  clipboard: \"clipboard\",\n} as const;\n\nexport const EXPORT_DATA_TYPES = {\n  jsondraw: \"jsondraw\",\n  jsondrawClipboard: \"jsondraw/clipboard\",\n  jsondrawLibrary: \"jsondrawlib\",\n  jsondrawClipboardWithAPI: \"jsondraw-api/clipboard\",\n} as const;\n\nexport const getExportSource = () => window.JSONDRAW_EXPORT_SOURCE || window.location.origin;\n\n// time in milliseconds\nexport const IMAGE_RENDER_TIMEOUT = 500;\nexport const TAP_TWICE_TIMEOUT = 300;\nexport const TOUCH_CTX_MENU_TIMEOUT = 500;\nexport const TITLE_TIMEOUT = 10000;\nexport const VERSION_TIMEOUT = 30000;\nexport const SCROLL_TIMEOUT = 100;\nexport const ZOOM_STEP = 0.1;\nexport const MIN_ZOOM = 0.1;\nexport const MAX_ZOOM = 30;\nexport const HYPERLINK_TOOLTIP_DELAY = 300;\n\n// Report a user inactive after IDLE_THRESHOLD milliseconds\nexport const IDLE_THRESHOLD = 60_000;\n// Report a user active each ACTIVE_THRESHOLD milliseconds\nexport const ACTIVE_THRESHOLD = 3_000;\n\nexport const URL_QUERY_KEYS = {\n  addLibrary: \"addLibrary\",\n} as const;\n\nexport const URL_HASH_KEYS = {\n  addLibrary: \"addLibrary\",\n} as const;\n\nexport const DEFAULT_UI_OPTIONS: AppProps[\"UIOptions\"] = {\n  canvasActions: {\n    changeViewBackgroundColor: true,\n    clearCanvas: true,\n    export: { saveFileToDisk: true },\n    loadScene: true,\n    saveToActiveFile: true,\n    toggleTheme: null,\n    saveAsImage: true,\n  },\n  tools: {\n    image: true,\n  },\n};\n\nexport const MAX_DECIMALS_FOR_SVG_EXPORT = 2;\n\nexport const EXPORT_SCALES = [1, 2, 3];\nexport const DEFAULT_EXPORT_PADDING = 10; // px\n\nexport const DEFAULT_MAX_IMAGE_WIDTH_OR_HEIGHT = 1440;\n\nexport const MAX_ALLOWED_FILE_BYTES = 4 * 1024 * 1024;\n\nexport const SVG_NS = \"http://www.w3.org/2000/svg\";\nexport const SVG_DOCUMENT_PREAMBLE = `<?xml version=\"1.0\" standalone=\"no\"?>\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n`;\n\nexport const ENCRYPTION_KEY_BITS = 128;\n\nexport const VERSIONS = {\n  jsondraw: 2,\n  jsondrawLibrary: 2,\n} as const;\n\nexport const BOUND_TEXT_PADDING = 5;\nexport const ARROW_LABEL_WIDTH_FRACTION = 0.7;\nexport const ARROW_LABEL_FONT_SIZE_TO_MIN_WIDTH_RATIO = 11;\n\nexport const VERTICAL_ALIGN = {\n  TOP: \"top\",\n  MIDDLE: \"middle\",\n  BOTTOM: \"bottom\",\n};\n\nexport const TEXT_ALIGN = {\n  LEFT: \"left\",\n  CENTER: \"center\",\n  RIGHT: \"right\",\n};\n\nexport const ELEMENT_READY_TO_ERASE_OPACITY = 20;\n\n// Radius represented as 25% of element's largest side (width/height).\n// Used for LEGACY and PROPORTIONAL_RADIUS algorithms, or when the element is\n// below the cutoff size.\nexport const DEFAULT_PROPORTIONAL_RADIUS = 0.25;\n// Fixed radius for the ADAPTIVE_RADIUS algorithm. In pixels.\nexport const DEFAULT_ADAPTIVE_RADIUS = 32;\n// roundness type (algorithm)\nexport const ROUNDNESS = {\n  // Used for legacy rounding (rectangles), which currently works the same\n  // as PROPORTIONAL_RADIUS, but we need to differentiate for UI purposes and\n  // forwards-compat.\n  LEGACY: 1,\n\n  // Used for linear elements & diamonds\n  PROPORTIONAL_RADIUS: 2,\n\n  // Current default algorithm for rectangles, using fixed pixel radius.\n  // It's working similarly to a regular border-radius, but attemps to make\n  // radius visually similar across differnt element sizes, especially\n  // very large and very small elements.\n  //\n  // NOTE right now we don't allow configuration and use a constant radius\n  // (see DEFAULT_ADAPTIVE_RADIUS constant)\n  ADAPTIVE_RADIUS: 3,\n} as const;\n\nexport const ROUGHNESS = {\n  architect: 0,\n  artist: 1,\n  cartoonist: 2,\n} as const;\n\nexport const STROKE_WIDTH = {\n  thin: 1,\n  bold: 2,\n  extraBold: 4,\n} as const;\n\nexport const DEFAULT_ELEMENT_PROPS: {\n  strokeColor: JsonDrawElement[\"strokeColor\"];\n  backgroundColor: JsonDrawElement[\"backgroundColor\"];\n  fillStyle: JsonDrawElement[\"fillStyle\"];\n  strokeWidth: JsonDrawElement[\"strokeWidth\"];\n  strokeStyle: JsonDrawElement[\"strokeStyle\"];\n  roughness: JsonDrawElement[\"roughness\"];\n  opacity: JsonDrawElement[\"opacity\"];\n  locked: JsonDrawElement[\"locked\"];\n} = {\n  strokeColor: COLOR_PALETTE.black,\n  backgroundColor: COLOR_PALETTE.transparent,\n  fillStyle: \"solid\",\n  strokeWidth: 2,\n  strokeStyle: \"solid\",\n  roughness: ROUGHNESS.artist,\n  opacity: 100,\n  locked: false,\n};\n\nexport const LIBRARY_SIDEBAR_TAB = \"library\";\nexport const CANVAS_SEARCH_TAB = \"search\";\n\nexport const DEFAULT_SIDEBAR = {\n  name: \"default\",\n  defaultTab: LIBRARY_SIDEBAR_TAB,\n} as const;\n\nexport const LIBRARY_DISABLED_TYPES = new Set([\"iframe\", \"embeddable\", \"image\"] as const);\n\n// use these constants to easily identify reference sites\nexport const TOOL_TYPE = {\n  selection: \"selection\",\n  lasso: \"lasso\",\n  rectangle: \"rectangle\",\n  diamond: \"diamond\",\n  ellipse: \"ellipse\",\n  arrow: \"arrow\",\n  line: \"line\",\n  freedraw: \"freedraw\",\n  text: \"text\",\n  image: \"image\",\n  eraser: \"eraser\",\n  hand: \"hand\",\n  frame: \"frame\",\n  magicframe: \"magicframe\",\n  embeddable: \"embeddable\",\n  laser: \"laser\",\n} as const;\n\nexport const EDITOR_LS_KEYS = {\n  OAI_API_KEY: \"jsondraw-oai-api-key\",\n  // legacy naming (non)scheme\n  MERMAID_TO_JSONDRAW: \"mermaid-to-jsondraw\",\n  PUBLISH_LIBRARY: \"publish-library-data\",\n} as const;\n\n/**\n * not translated as this is used only in public, stateless API as default value\n * where filename is optional and we can't retrieve name from app state\n */\nexport const DEFAULT_FILENAME = \"Untitled\";\n\nexport const STATS_PANELS = { generalStats: 1, elementProperties: 2 } as const;\n\nexport const MIN_WIDTH_OR_HEIGHT = 1;\n\nexport const ARROW_TYPE: { [T in AppState[\"currentItemArrowType\"]]: T } = {\n  sharp: \"sharp\",\n  round: \"round\",\n  elbow: \"elbow\",\n};\n\nexport const DEFAULT_REDUCED_GLOBAL_ALPHA = 0.3;\nexport const ELEMENT_LINK_KEY = \"element\";\n\n/** used in tests */\nexport const ORIG_ID = Symbol.for(\"__test__originalId__\");\n\nexport enum UserIdleState {\n  ACTIVE = \"active\",\n  AWAY = \"away\",\n  IDLE = \"idle\",\n}\n\n/**\n * distance at which we merge points instead of adding a new merge-point\n * when converting a line to a polygon (merge currently means overlaping\n * the start and end points)\n */\nexport const LINE_POLYGON_POINT_MERGE_DISTANCE = 20;\n\nexport const DOUBLE_TAP_POSITION_THRESHOLD = 35;\n\nexport const BIND_MODE_TIMEOUT = 700; // ms\n\n// glass background for mobile action buttons\nexport const MOBILE_ACTION_BUTTON_BG = {\n  background: \"var(--mobile-action-button-bg)\",\n} as const;\n","import type {\n  JsonDrawTextElement,\n  FontFamilyValues,\n} from \"@jsondraw/element/types\";\n\nimport { FONT_FAMILY, FONT_FAMILY_FALLBACKS } from \"./constants\";\n\n/**\n * Encapsulates font metrics with additional font metadata.\n * */\nexport interface FontMetadata {\n  /** for head & hhea metrics read the woff2 with https://fontdrop.info/ */\n  metrics: {\n    /** head.unitsPerEm metric */\n    unitsPerEm: 1000 | 1024 | 2048;\n    /** hhea.ascender metric */\n    ascender: number;\n    /** hhea.descender metric */\n    descender: number;\n    /** harcoded unitless line-height, https://github.com/jsondraw/jsondraw/pull/6360#issuecomment-1477635971 */\n    lineHeight: number;\n  };\n  /** flag to indicate a deprecated font */\n  deprecated?: true;\n  /**\n   * whether this is a font that users can use (= shown in font picker)\n   */\n  private?: true;\n  /** flag to indiccate a local-only font */\n  local?: true;\n  /** flag to indicate a fallback font */\n  fallback?: true;\n}\n\nexport const FONT_METADATA: Record<number, FontMetadata> = {\n  [FONT_FAMILY.Excalifont]: {\n    metrics: {\n      unitsPerEm: 1000,\n      ascender: 886,\n      descender: -374,\n      lineHeight: 1.25,\n    },\n  },\n  [FONT_FAMILY.Nunito]: {\n    metrics: {\n      unitsPerEm: 1000,\n      ascender: 1011,\n      descender: -353,\n      lineHeight: 1.25,\n    },\n  },\n  [FONT_FAMILY[\"Lilita One\"]]: {\n    metrics: {\n      unitsPerEm: 1000,\n      ascender: 923,\n      descender: -220,\n      lineHeight: 1.15,\n    },\n  },\n  [FONT_FAMILY[\"Comic Shanns\"]]: {\n    metrics: {\n      unitsPerEm: 1000,\n      ascender: 750,\n      descender: -250,\n      lineHeight: 1.25,\n    },\n  },\n  [FONT_FAMILY.Virgil]: {\n    metrics: {\n      unitsPerEm: 1000,\n      ascender: 886,\n      descender: -374,\n      lineHeight: 1.25,\n    },\n    deprecated: true,\n  },\n  [FONT_FAMILY.Helvetica]: {\n    metrics: {\n      unitsPerEm: 2048,\n      ascender: 1577,\n      descender: -471,\n      lineHeight: 1.15,\n    },\n    deprecated: true,\n    local: true,\n  },\n  [FONT_FAMILY.Cascadia]: {\n    metrics: {\n      unitsPerEm: 2048,\n      ascender: 1900,\n      descender: -480,\n      lineHeight: 1.2,\n    },\n    deprecated: true,\n  },\n  [FONT_FAMILY[\"Liberation Sans\"]]: {\n    metrics: {\n      unitsPerEm: 2048,\n      ascender: 1854,\n      descender: -434,\n      lineHeight: 1.15,\n    },\n    private: true,\n  },\n  [FONT_FAMILY.Assistant]: {\n    metrics: {\n      unitsPerEm: 2048,\n      ascender: 1021,\n      descender: -287,\n      lineHeight: 1.25,\n    },\n    private: true,\n  },\n  [FONT_FAMILY_FALLBACKS.Xiaolai]: {\n    metrics: {\n      unitsPerEm: 1000,\n      ascender: 880,\n      descender: -144,\n      lineHeight: 1.25,\n    },\n    fallback: true,\n  },\n  [FONT_FAMILY_FALLBACKS[\"Segoe UI Emoji\"]]: {\n    metrics: {\n      // reusing Excalifont metrics\n      unitsPerEm: 1000,\n      ascender: 886,\n      descender: -374,\n      lineHeight: 1.25,\n    },\n    local: true,\n    fallback: true,\n  },\n};\n\n/** Unicode ranges defined by google fonts */\nexport const GOOGLE_FONTS_RANGES = {\n  LATIN:\n    \"U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD\",\n  LATIN_EXT:\n    \"U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF\",\n  CYRILIC_EXT:\n    \"U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F\",\n  CYRILIC: \"U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116\",\n  VIETNAMESE:\n    \"U+0102-0103, U+0110-0111, U+0128-0129, U+0168-0169, U+01A0-01A1, U+01AF-01B0, U+0300-0301, U+0303-0304, U+0308-0309, U+0323, U+0329, U+1EA0-1EF9, U+20AB\",\n};\n\n/** local protocol to skip the local font from registering or inlining */\nexport const LOCAL_FONT_PROTOCOL = \"local:\";\n\n/**\n * Calculates vertical offset for a text with alphabetic baseline.\n */\nexport const getVerticalOffset = (\n  fontFamily: JsonDrawTextElement[\"fontFamily\"],\n  fontSize: JsonDrawTextElement[\"fontSize\"],\n  lineHeightPx: number,\n) => {\n  const { unitsPerEm, ascender, descender } =\n    FONT_METADATA[fontFamily]?.metrics ||\n    FONT_METADATA[FONT_FAMILY.Excalifont].metrics;\n\n  const fontSizeEm = fontSize / unitsPerEm;\n  const lineGap =\n    (lineHeightPx - fontSizeEm * ascender + fontSizeEm * descender) / 2;\n\n  const verticalOffset = fontSizeEm * ascender + lineGap;\n  return verticalOffset;\n};\n\n/**\n * Gets line height for a selected family.\n */\nexport const getLineHeight = (fontFamily: FontFamilyValues) => {\n  const { lineHeight } =\n    FONT_METADATA[fontFamily]?.metrics ||\n    FONT_METADATA[FONT_FAMILY.Excalifont].metrics;\n\n  return lineHeight as JsonDrawTextElement[\"lineHeight\"];\n};\n","import { promiseTry, resolvablePromise } from \".\";\n\nimport type { ResolvablePromise } from \".\";\n\nimport type { MaybePromise } from \"./utility-types\";\n\ntype Job<T, TArgs extends unknown[]> = (...args: TArgs) => MaybePromise<T>;\n\ntype QueueJob<T, TArgs extends unknown[]> = {\n  jobFactory: Job<T, TArgs>;\n  promise: ResolvablePromise<T>;\n  args: TArgs;\n};\n\nexport class Queue {\n  private jobs: QueueJob<any, any[]>[] = [];\n  private running = false;\n\n  private tick() {\n    if (this.running) {\n      return;\n    }\n    const job = this.jobs.shift();\n    if (job) {\n      this.running = true;\n      job.promise.resolve(\n        promiseTry(job.jobFactory, ...job.args).finally(() => {\n          this.running = false;\n          this.tick();\n        }),\n      );\n    } else {\n      this.running = false;\n    }\n  }\n\n  push<TValue, TArgs extends unknown[]>(\n    jobFactory: Job<TValue, TArgs>,\n    ...args: TArgs\n  ): Promise<TValue> {\n    const promise = resolvablePromise<TValue>();\n    this.jobs.push({ jobFactory, promise, args });\n\n    this.tick();\n\n    return promise;\n  }\n}\n","export type StylesPanelMode = \"compact\" | \"full\" | \"mobile\";\n\nexport type EditorInterface = Readonly<{\n  formFactor: \"phone\" | \"tablet\" | \"desktop\";\n  desktopUIMode: \"compact\" | \"full\";\n  userAgent: Readonly<{\n    isMobileDevice: boolean;\n    platform: \"ios\" | \"android\" | \"other\" | \"unknown\";\n  }>;\n  isTouchScreen: boolean;\n  canFitSidebar: boolean;\n  isLandscape: boolean;\n}>;\n\n// storage key\nconst DESKTOP_UI_MODE_STORAGE_KEY = \"jsondraw.desktopUIMode\";\n\n// breakpoints\nexport const MQ_MAX_MOBILE = 599;\n\nexport const MQ_MAX_WIDTH_LANDSCAPE = 1000;\nexport const MQ_MAX_HEIGHT_LANDSCAPE = 500;\n\n// tablets\nexport const MQ_MIN_TABLET = MQ_MAX_MOBILE + 1; // lower bound (excludes phones)\nexport const MQ_MAX_TABLET = 1180; // ipad air\n\n// desktop/laptop (NOTE: not used for form factor detection)\nexport const MQ_MIN_WIDTH_DESKTOP = 1440;\n\n// sidebar\nexport const MQ_RIGHT_SIDEBAR_MIN_WIDTH = 1229;\n\n// -----------------------------------------------------------------------------\n\n// user agent detections\nexport const isDarwin = /Mac|iPod|iPhone|iPad/.test(navigator.platform);\nexport const isWindows = /^Win/.test(navigator.platform);\nexport const isAndroid = /\\b(android)\\b/i.test(navigator.userAgent);\nexport const isFirefox =\n  typeof window !== \"undefined\" &&\n  \"netscape\" in window &&\n  navigator.userAgent.indexOf(\"rv:\") > 1 &&\n  navigator.userAgent.indexOf(\"Gecko\") > 1;\nexport const isChrome = navigator.userAgent.indexOf(\"Chrome\") !== -1;\nexport const isSafari =\n  !isChrome && navigator.userAgent.indexOf(\"Safari\") !== -1;\nexport const isIOS =\n  /iPad|iPhone/i.test(navigator.platform) ||\n  // iPadOS 13+\n  (navigator.userAgent.includes(\"Mac\") && \"ontouchend\" in document);\n// keeping function so it can be mocked in test\nexport const isBrave = () =>\n  (navigator as any).brave?.isBrave?.name === \"isBrave\";\n\n// export const isMobile =\n//   isIOS ||\n//   /android|webos|ipod|blackberry|iemobile|opera mini/i.test(\n//     navigator.userAgent,\n//   ) ||\n//   /android|ios|ipod|blackberry|windows phone/i.test(navigator.platform);\n\n// utilities\nexport const isMobileBreakpoint = (width: number, height: number) => {\n  return (\n    width <= MQ_MAX_MOBILE ||\n    (height < MQ_MAX_HEIGHT_LANDSCAPE && width < MQ_MAX_WIDTH_LANDSCAPE)\n  );\n};\n\nexport const isTabletBreakpoint = (\n  editorWidth: number,\n  editorHeight: number,\n) => {\n  const minSide = Math.min(editorWidth, editorHeight);\n  const maxSide = Math.max(editorWidth, editorHeight);\n\n  return minSide >= MQ_MIN_TABLET && maxSide <= MQ_MAX_TABLET;\n};\n\nconst isMobileOrTablet = (): boolean => {\n  const ua = navigator.userAgent || \"\";\n  const platform = navigator.platform || \"\";\n  const uaData = (navigator as any).userAgentData as\n    | { mobile?: boolean; platform?: string }\n    | undefined;\n\n  // --- 1) chromium: prefer ua client hints -------------------------------\n  if (uaData) {\n    const plat = (uaData.platform || \"\").toLowerCase();\n    const isDesktopOS =\n      plat === \"windows\" ||\n      plat === \"macos\" ||\n      plat === \"linux\" ||\n      plat === \"chrome os\";\n    if (uaData.mobile === true) {\n      return true;\n    }\n    if (uaData.mobile === false && plat === \"android\") {\n      const looksTouchTablet =\n        matchMedia?.(\"(hover: none)\").matches &&\n        matchMedia?.(\"(pointer: coarse)\").matches;\n      return looksTouchTablet;\n    }\n    if (isDesktopOS) {\n      return false;\n    }\n  }\n\n  // --- 2) ios (includes ipad) --------------------------------------------\n  if (isIOS) {\n    return true;\n  }\n\n  // --- 3) android legacy ua fallback -------------------------------------\n  if (isAndroid) {\n    const isAndroidPhone = /Mobile/i.test(ua);\n    const isAndroidTablet = !isAndroidPhone;\n    if (isAndroidPhone || isAndroidTablet) {\n      const looksTouchTablet =\n        matchMedia?.(\"(hover: none)\").matches &&\n        matchMedia?.(\"(pointer: coarse)\").matches;\n      return looksTouchTablet;\n    }\n  }\n\n  // --- 4) last resort desktop exclusion ----------------------------------\n  const looksDesktopPlatform =\n    /Win|Linux|CrOS|Mac/.test(platform) ||\n    /Windows NT|X11|CrOS|Macintosh/.test(ua);\n  if (looksDesktopPlatform) {\n    return false;\n  }\n  return false;\n};\n\nexport const getFormFactor = (\n  editorWidth: number,\n  editorHeight: number,\n): EditorInterface[\"formFactor\"] => {\n  if (isMobileBreakpoint(editorWidth, editorHeight)) {\n    return \"phone\";\n  }\n\n  if (isTabletBreakpoint(editorWidth, editorHeight)) {\n    return \"tablet\";\n  }\n\n  return \"desktop\";\n};\n\nexport const deriveStylesPanelMode = (\n  editorInterface: EditorInterface,\n): StylesPanelMode => {\n  if (editorInterface.formFactor === \"phone\") {\n    return \"mobile\";\n  }\n\n  if (editorInterface.formFactor === \"tablet\") {\n    return \"compact\";\n  }\n\n  return editorInterface.desktopUIMode;\n};\n\nexport const createUserAgentDescriptor = (\n  userAgentString: string,\n): EditorInterface[\"userAgent\"] => {\n  const normalizedUA = userAgentString ?? \"\";\n  let platform: EditorInterface[\"userAgent\"][\"platform\"] = \"unknown\";\n\n  if (isIOS) {\n    platform = \"ios\";\n  } else if (isAndroid) {\n    platform = \"android\";\n  } else if (normalizedUA) {\n    platform = \"other\";\n  }\n\n  return {\n    isMobileDevice: isMobileOrTablet(),\n    platform,\n  } as const;\n};\n\nexport const loadDesktopUIModePreference = () => {\n  if (typeof window === \"undefined\") {\n    return null;\n  }\n\n  try {\n    const stored = window.localStorage.getItem(DESKTOP_UI_MODE_STORAGE_KEY);\n    if (stored === \"compact\" || stored === \"full\") {\n      return stored as EditorInterface[\"desktopUIMode\"];\n    }\n  } catch (error) {\n    // ignore storage access issues (e.g., Safari private mode)\n  }\n\n  return null;\n};\n\nconst persistDesktopUIMode = (mode: EditorInterface[\"desktopUIMode\"]) => {\n  if (typeof window === \"undefined\") {\n    return;\n  }\n  try {\n    window.localStorage.setItem(DESKTOP_UI_MODE_STORAGE_KEY, mode);\n  } catch (error) {\n    // ignore storage access issues (e.g., Safari private mode)\n  }\n};\n\nexport const setDesktopUIMode = (mode: EditorInterface[\"desktopUIMode\"]) => {\n  if (mode !== \"compact\" && mode !== \"full\") {\n    return;\n  }\n\n  persistDesktopUIMode(mode);\n\n  return mode;\n};\n","import { isDarwin } from \"./editorInterface\";\n\nimport type { ValueOf } from \"./utility-types\";\n\nexport const CODES = {\n  EQUAL: \"Equal\",\n  MINUS: \"Minus\",\n  NUM_ADD: \"NumpadAdd\",\n  NUM_SUBTRACT: \"NumpadSubtract\",\n  NUM_ZERO: \"Numpad0\",\n  BRACKET_RIGHT: \"BracketRight\",\n  BRACKET_LEFT: \"BracketLeft\",\n  ONE: \"Digit1\",\n  TWO: \"Digit2\",\n  THREE: \"Digit3\",\n  NINE: \"Digit9\",\n  QUOTE: \"Quote\",\n  ZERO: \"Digit0\",\n  SLASH: \"Slash\",\n  C: \"KeyC\",\n  D: \"KeyD\",\n  H: \"KeyH\",\n  V: \"KeyV\",\n  Z: \"KeyZ\",\n  Y: \"KeyY\",\n  R: \"KeyR\",\n  S: \"KeyS\",\n} as const;\n\nexport const KEYS = {\n  ARROW_DOWN: \"ArrowDown\",\n  ARROW_LEFT: \"ArrowLeft\",\n  ARROW_RIGHT: \"ArrowRight\",\n  ARROW_UP: \"ArrowUp\",\n  PAGE_UP: \"PageUp\",\n  PAGE_DOWN: \"PageDown\",\n  BACKSPACE: \"Backspace\",\n  ALT: \"Alt\",\n  CTRL_OR_CMD: isDarwin ? \"metaKey\" : \"ctrlKey\",\n  DELETE: \"Delete\",\n  ENTER: \"Enter\",\n  ESCAPE: \"Escape\",\n  QUESTION_MARK: \"?\",\n  SPACE: \" \",\n  TAB: \"Tab\",\n  CHEVRON_LEFT: \"<\",\n  CHEVRON_RIGHT: \">\",\n  PERIOD: \".\",\n  COMMA: \",\",\n  SUBTRACT: \"-\",\n  SLASH: \"/\",\n\n  A: \"a\",\n  C: \"c\",\n  D: \"d\",\n  E: \"e\",\n  F: \"f\",\n  G: \"g\",\n  H: \"h\",\n  I: \"i\",\n  L: \"l\",\n  O: \"o\",\n  P: \"p\",\n  Q: \"q\",\n  R: \"r\",\n  S: \"s\",\n  T: \"t\",\n  V: \"v\",\n  X: \"x\",\n  Y: \"y\",\n  Z: \"z\",\n  K: \"k\",\n  W: \"w\",\n\n  0: \"0\",\n  1: \"1\",\n  2: \"2\",\n  3: \"3\",\n  4: \"4\",\n  5: \"5\",\n  6: \"6\",\n  7: \"7\",\n  8: \"8\",\n  9: \"9\",\n} as const;\n\nexport type Key = keyof typeof KEYS;\n\n// defines key code mapping for matching codes as fallback to respective keys on non-latin keyboard layouts\nexport const KeyCodeMap = new Map<ValueOf<typeof KEYS>, ValueOf<typeof CODES>>([\n  [KEYS.Z, CODES.Z],\n  [KEYS.Y, CODES.Y],\n]);\n\nexport const isLatinChar = (key: string) => /^[a-z]$/.test(key.toLowerCase());\n\n/**\n * Used to match key events for any keyboard layout, especially on Windows and Linux,\n * where non-latin character with modified (CMD) is not substituted with latin-based alternative.\n *\n * Uses `event.key` when it's latin, otherwise fallbacks to `event.code` (if mapping exists).\n *\n * Example of pressing \"z\" on different layouts, with the chosen key or code highlighted in []:\n *\n * Layout                | Code  | Key | Comment\n * --------------------- | ----- | --- | -------\n * U.S.                  |  KeyZ  | [z] |\n * Czech                 |  KeyY  | [z] |\n * Turkish               |  KeyN  | [z] |\n * French                |  KeyW  | [z] |\n * Macedonian            | [KeyZ] |    | z with cmd;  is Cyrillic equivalent of z\n * Russian               | [KeyZ] |    | z with cmd\n * Serbian               | [KeyZ] |    | z with cmd\n * Greek                 | [KeyZ] |    | z with cmd; also  is Greek equivalent of z\n * Hebrew                | [KeyZ] |    | z with cmd; also  is Hebrew equivalent of z\n * Pinyin - Simplified   |  KeyZ  | [z] | due to IME\n * Cangije - Traditional | [KeyZ] |   | z with cmd\n * Japanese              | [KeyZ] |   | z with cmd\n * 2-Set Korean          | [KeyZ] |   | z with cmd\n *\n * More details in https://github.com/jsondraw/jsondraw/pull/5944\n */\nexport const matchKey = (\n  event: KeyboardEvent | React.KeyboardEvent<Element>,\n  key: ValueOf<typeof KEYS>,\n): boolean => {\n  // for latin layouts use key\n  if (key === event.key.toLowerCase()) {\n    return true;\n  }\n\n  // non-latin layouts fallback to code\n  const code = KeyCodeMap.get(key);\n  return Boolean(code && !isLatinChar(event.key) && event.code === code);\n};\n\nexport const isArrowKey = (key: string) =>\n  key === KEYS.ARROW_LEFT ||\n  key === KEYS.ARROW_RIGHT ||\n  key === KEYS.ARROW_DOWN ||\n  key === KEYS.ARROW_UP;\n\nexport const shouldResizeFromCenter = (event: MouseEvent | KeyboardEvent) =>\n  event.altKey;\n\nexport const shouldMaintainAspectRatio = (event: MouseEvent | KeyboardEvent) =>\n  event.shiftKey;\n\nexport const shouldRotateWithDiscreteAngle = (\n  event: MouseEvent | KeyboardEvent | React.PointerEvent<HTMLCanvasElement>,\n) => event.shiftKey;\n","import {\n  pointFromPair,\n  type GlobalPoint,\n  type LocalPoint,\n} from \"@jsondraw/math\";\n\nimport type { NullableGridSize } from \"@jsondraw/jsondraw/types\";\n\nexport const getSizeFromPoints = (\n  points: readonly (GlobalPoint | LocalPoint)[],\n) => {\n  const xs = points.map((point) => point[0]);\n  const ys = points.map((point) => point[1]);\n  return {\n    width: Math.max(...xs) - Math.min(...xs),\n    height: Math.max(...ys) - Math.min(...ys),\n  };\n};\n\n/** @arg dimension, 0 for rescaling only x, 1 for y */\nexport const rescalePoints = <Point extends GlobalPoint | LocalPoint>(\n  dimension: 0 | 1,\n  newSize: number,\n  points: readonly Point[],\n  normalize: boolean,\n): Point[] => {\n  const coordinates = points.map((point) => point[dimension]);\n  const maxCoordinate = Math.max(...coordinates);\n  const minCoordinate = Math.min(...coordinates);\n  const size = maxCoordinate - minCoordinate;\n  const scale = size === 0 ? 1 : newSize / size;\n\n  let nextMinCoordinate = Infinity;\n\n  const scaledPoints = points.map((point): Point => {\n    const newCoordinate = point[dimension] * scale;\n    const newPoint = [...point];\n    newPoint[dimension] = newCoordinate;\n    if (newCoordinate < nextMinCoordinate) {\n      nextMinCoordinate = newCoordinate;\n    }\n    return newPoint as Point;\n  });\n\n  if (!normalize) {\n    return scaledPoints;\n  }\n\n  if (scaledPoints.length === 2) {\n    // we don't translate two-point lines\n    return scaledPoints;\n  }\n\n  const translation = minCoordinate - nextMinCoordinate;\n\n  const nextPoints = scaledPoints.map((scaledPoint) =>\n    pointFromPair<Point>(\n      scaledPoint.map((value, currentDimension) => {\n        return currentDimension === dimension ? value + translation : value;\n      }) as [number, number],\n    ),\n  );\n\n  return nextPoints;\n};\n\n// TODO: Rounding this point causes some shake when free drawing\nexport const getGridPoint = (\n  x: number,\n  y: number,\n  gridSize: NullableGridSize,\n): [number, number] => {\n  if (gridSize) {\n    return [\n      Math.round(x / gridSize) * gridSize,\n      Math.round(y / gridSize) * gridSize,\n    ];\n  }\n  return [x, y];\n};\n","import Pool from \"es6-promise-pool\";\n\n// extending the missing types\n// relying on the [Index, T] to keep a correct order\ntype TPromisePool<T, Index = number> = Pool<[Index, T][]> & {\n  addEventListener: (\n    type: \"fulfilled\",\n    listener: (event: { data: { result: [Index, T] } }) => void,\n  ) => (event: { data: { result: [Index, T] } }) => void;\n  removeEventListener: (\n    type: \"fulfilled\",\n    listener: (event: { data: { result: [Index, T] } }) => void,\n  ) => void;\n};\n\nexport class PromisePool<T> {\n  private readonly pool: TPromisePool<T>;\n  private readonly entries: Record<number, T> = {};\n\n  constructor(\n    source: IterableIterator<Promise<void | readonly [number, T]>>,\n    concurrency: number,\n  ) {\n    this.pool = new Pool(\n      source as unknown as () => void | PromiseLike<[number, T][]>,\n      concurrency,\n    ) as TPromisePool<T>;\n  }\n\n  public all() {\n    const listener = (event: { data: { result: void | [number, T] } }) => {\n      if (event.data.result) {\n        // by default pool does not return the results, so we are gathering them manually\n        // with the correct call order (represented by the index in the tuple)\n        const [index, value] = event.data.result;\n        this.entries[index] = value;\n      }\n    };\n\n    this.pool.addEventListener(\"fulfilled\", listener);\n\n    return this.pool.start().then(() => {\n      setTimeout(() => {\n        this.pool.removeEventListener(\"fulfilled\", listener);\n      });\n\n      return Object.values(this.entries);\n    });\n  }\n}\n","import type { FontFamilyValues, FontString } from \"@jsondraw/element/types\";\nimport type {\n  ActiveTool,\n  AppState,\n  ToolType,\n  UnsubscribeCallback,\n  Zoom,\n} from \"@jsondraw/jsondraw/types\";\nimport { average } from \"@jsondraw/math\";\nimport {\n  DEFAULT_VERSION,\n  ENV,\n  FONT_FAMILY,\n  getFontFamilyFallbacks,\n  WINDOWS_EMOJI_FALLBACK_FONT,\n} from \"./constants\";\nimport type { EVENT } from \"./constants\";\nimport type { MaybePromise, ResolutionType } from \"./utility-types\";\n\nlet mockDateTime: string | null = null;\n\nexport const setDateTimeForTests = (dateTime: string) => {\n  mockDateTime = dateTime;\n};\n\nexport const getDateTime = () => {\n  if (mockDateTime) {\n    return mockDateTime;\n  }\n\n  const date = new Date();\n  const year = date.getFullYear();\n  const month = `${date.getMonth() + 1}`.padStart(2, \"0\");\n  const day = `${date.getDate()}`.padStart(2, \"0\");\n  const hr = `${date.getHours()}`.padStart(2, \"0\");\n  const min = `${date.getMinutes()}`.padStart(2, \"0\");\n\n  return `${year}-${month}-${day}-${hr}${min}`;\n};\n\nexport const capitalizeString = (str: string) => str.charAt(0).toUpperCase() + str.slice(1);\n\nexport const isToolIcon = (target: Element | EventTarget | null): target is HTMLElement =>\n  target instanceof HTMLElement && target.className.includes(\"ToolIcon\");\n\nexport const isInputLike = (\n  target: Element | EventTarget | null\n): target is\n  | HTMLInputElement\n  | HTMLTextAreaElement\n  | HTMLSelectElement\n  | HTMLBRElement\n  | HTMLDivElement =>\n  (target instanceof HTMLElement && target.dataset.type === \"wysiwyg\") ||\n  target instanceof HTMLBRElement || // newline in wysiwyg\n  target instanceof HTMLInputElement ||\n  target instanceof HTMLTextAreaElement ||\n  target instanceof HTMLSelectElement;\n\nexport const isInteractive = (target: Element | EventTarget | null) => {\n  return isInputLike(target) || (target instanceof Element && !!target.closest(\"label, button\"));\n};\n\nexport const isWritableElement = (\n  target: Element | EventTarget | null\n): target is HTMLInputElement | HTMLTextAreaElement | HTMLBRElement | HTMLDivElement =>\n  (target instanceof HTMLElement && target.dataset.type === \"wysiwyg\") ||\n  target instanceof HTMLBRElement || // newline in wysiwyg\n  target instanceof HTMLTextAreaElement ||\n  (target instanceof HTMLInputElement &&\n    (target.type === \"text\" ||\n      target.type === \"number\" ||\n      target.type === \"password\" ||\n      target.type === \"search\"));\n\nexport const getFontFamilyString = ({ fontFamily }: { fontFamily: FontFamilyValues }) => {\n  for (const [fontFamilyString, id] of Object.entries(FONT_FAMILY)) {\n    if (id === fontFamily) {\n      return `${fontFamilyString}${getFontFamilyFallbacks(id)\n        .map(x => `, ${x}`)\n        .join(\"\")}`;\n    }\n  }\n  return WINDOWS_EMOJI_FALLBACK_FONT;\n};\n\n/** returns fontSize+fontFamily string for assignment to DOM elements */\nexport const getFontString = ({\n  fontSize,\n  fontFamily,\n}: {\n  fontSize: number;\n  fontFamily: FontFamilyValues;\n}) => {\n  return `${fontSize}px ${getFontFamilyString({ fontFamily })}` as FontString;\n};\n\n/** executes callback in the frame that's after the current one */\nexport const nextAnimationFrame = async (cb: () => any) => {\n  requestAnimationFrame(() => requestAnimationFrame(cb));\n};\n\nexport const debounce = <T extends any[]>(fn: (...args: T) => void, timeout: number) => {\n  let handle = 0;\n  let lastArgs: T | null = null;\n  const ret = (...args: T) => {\n    lastArgs = args;\n    clearTimeout(handle);\n    handle = window.setTimeout(() => {\n      lastArgs = null;\n      fn(...args);\n    }, timeout);\n  };\n  ret.flush = () => {\n    clearTimeout(handle);\n    if (lastArgs) {\n      const _lastArgs = lastArgs;\n      lastArgs = null;\n      fn(..._lastArgs);\n    }\n  };\n  ret.cancel = () => {\n    lastArgs = null;\n    clearTimeout(handle);\n  };\n  return ret;\n};\n\n// throttle callback to execute once per animation frame\nexport const throttleRAF = <T extends any[]>(\n  fn: (...args: T) => void,\n  opts?: { trailing?: boolean }\n) => {\n  let timerId: number | null = null;\n  let lastArgs: T | null = null;\n  let lastArgsTrailing: T | null = null;\n\n  const scheduleFunc = (args: T) => {\n    timerId = window.requestAnimationFrame(() => {\n      timerId = null;\n      fn(...args);\n      lastArgs = null;\n      if (lastArgsTrailing) {\n        lastArgs = lastArgsTrailing;\n        lastArgsTrailing = null;\n        scheduleFunc(lastArgs);\n      }\n    });\n  };\n\n  const ret = (...args: T) => {\n    if (isTestEnv()) {\n      fn(...args);\n      return;\n    }\n    lastArgs = args;\n    if (timerId === null) {\n      scheduleFunc(lastArgs);\n    } else if (opts?.trailing) {\n      lastArgsTrailing = args;\n    }\n  };\n  ret.flush = () => {\n    if (timerId !== null) {\n      cancelAnimationFrame(timerId);\n      timerId = null;\n    }\n    if (lastArgs) {\n      fn(...(lastArgsTrailing || lastArgs));\n      lastArgs = lastArgsTrailing = null;\n    }\n  };\n  ret.cancel = () => {\n    lastArgs = lastArgsTrailing = null;\n    if (timerId !== null) {\n      cancelAnimationFrame(timerId);\n      timerId = null;\n    }\n  };\n  return ret;\n};\n\n/**\n * Exponential ease-out method\n *\n * @param {number} k - The value to be tweened.\n * @returns {number} The tweened value.\n */\nexport const easeOut = (k: number) => {\n  return 1 - Math.pow(1 - k, 4);\n};\n\nconst easeOutInterpolate = (from: number, to: number, progress: number) => {\n  return (to - from) * easeOut(progress) + from;\n};\n\n/**\n * Animates values from `fromValues` to `toValues` using the requestAnimationFrame API.\n * Executes the `onStep` callback on each step with the interpolated values.\n * Returns a function that can be called to cancel the animation.\n *\n * @example\n * // Example usage:\n * const fromValues = { x: 0, y: 0 };\n * const toValues = { x: 100, y: 200 };\n * const onStep = ({x, y}) => {\n *   setState(x, y)\n * };\n * const onCancel = () => {\n *   console.log(\"Animation canceled\");\n * };\n *\n * const cancelAnimation = easeToValuesRAF({\n *   fromValues,\n *   toValues,\n *   onStep,\n *   onCancel,\n * });\n *\n * // To cancel the animation:\n * cancelAnimation();\n */\nexport const easeToValuesRAF = <T extends Record<keyof T, number>, K extends keyof T>({\n  fromValues,\n  toValues,\n  onStep,\n  duration = 250,\n  interpolateValue,\n  onStart,\n  onEnd,\n  onCancel,\n}: {\n  fromValues: T;\n  toValues: T;\n  /**\n   * Interpolate a single value.\n   * Return undefined to be handled by the default interpolator.\n   */\n  interpolateValue?: (\n    fromValue: number,\n    toValue: number,\n    /** no easing applied  */\n    progress: number,\n    key: K\n  ) => number | undefined;\n  onStep: (values: T) => void;\n  duration?: number;\n  onStart?: () => void;\n  onEnd?: () => void;\n  onCancel?: () => void;\n}) => {\n  let canceled = false;\n  let frameId = 0;\n  let startTime: number;\n\n  function step(timestamp: number) {\n    if (canceled) {\n      return;\n    }\n    if (startTime === undefined) {\n      startTime = timestamp;\n      onStart?.();\n    }\n\n    const elapsed = Math.min(timestamp - startTime, duration);\n    const factor = easeOut(elapsed / duration);\n\n    const newValues = {} as T;\n\n    Object.keys(fromValues).forEach(key => {\n      const _key = key as keyof T;\n      const result = ((toValues[_key] - fromValues[_key]) * factor +\n        fromValues[_key]) as T[keyof T];\n      newValues[_key] = result;\n    });\n\n    onStep(newValues);\n\n    if (elapsed < duration) {\n      const progress = elapsed / duration;\n\n      const newValues = {} as T;\n\n      Object.keys(fromValues).forEach(key => {\n        const _key = key as K;\n        const startValue = fromValues[_key];\n        const endValue = toValues[_key];\n\n        let result;\n\n        result = interpolateValue\n          ? interpolateValue(startValue, endValue, progress, _key)\n          : easeOutInterpolate(startValue, endValue, progress);\n\n        if (result == null) {\n          result = easeOutInterpolate(startValue, endValue, progress);\n        }\n\n        newValues[_key] = result as T[K];\n      });\n      onStep(newValues);\n\n      frameId = window.requestAnimationFrame(step);\n    } else {\n      onStep(toValues);\n      onEnd?.();\n    }\n  }\n\n  frameId = window.requestAnimationFrame(step);\n\n  return () => {\n    onCancel?.();\n    canceled = true;\n    window.cancelAnimationFrame(frameId);\n  };\n};\n\n// https://github.com/lodash/lodash/blob/es/chunk.js\nexport const chunk = <T extends any>(array: readonly T[], size: number): T[][] => {\n  if (!array.length || size < 1) {\n    return [];\n  }\n  let index = 0;\n  let resIndex = 0;\n  const result = Array(Math.ceil(array.length / size));\n  while (index < array.length) {\n    result[resIndex++] = array.slice(index, (index += size));\n  }\n  return result;\n};\n\nexport const selectNode = (node: Element) => {\n  const selection = window.getSelection();\n  if (selection) {\n    const range = document.createRange();\n    range.selectNodeContents(node);\n    selection.removeAllRanges();\n    selection.addRange(range);\n  }\n};\n\nexport const removeSelection = () => {\n  const selection = window.getSelection();\n  if (selection) {\n    selection.removeAllRanges();\n  }\n};\n\nexport const distance = (x: number, y: number) => Math.abs(x - y);\n\nexport const isSelectionLikeTool = (type: ToolType | \"custom\") => {\n  return type === \"selection\" || type === \"lasso\";\n};\n\nexport const updateActiveTool = (\n  appState: Pick<AppState, \"activeTool\">,\n  data: ((\n    | {\n        type: ToolType;\n      }\n    | { type: \"custom\"; customType: string }\n  ) & { locked?: boolean; fromSelection?: boolean }) & {\n    lastActiveToolBeforeEraser?: ActiveTool | null;\n  }\n): AppState[\"activeTool\"] => {\n  if (data.type === \"custom\") {\n    return {\n      ...appState.activeTool,\n      type: \"custom\",\n      customType: data.customType,\n      locked: data.locked ?? appState.activeTool.locked,\n    };\n  }\n\n  return {\n    ...appState.activeTool,\n    lastActiveTool:\n      data.lastActiveToolBeforeEraser === undefined\n        ? appState.activeTool.lastActiveTool\n        : data.lastActiveToolBeforeEraser,\n    type: data.type,\n    customType: null,\n    locked: data.locked ?? appState.activeTool.locked,\n    fromSelection: data.fromSelection ?? false,\n  };\n};\n\nexport const isFullScreen = () => document.fullscreenElement?.nodeName === \"HTML\";\n\nexport const allowFullScreen = () => document.documentElement.requestFullscreen();\n\nexport const exitFullScreen = () => document.exitFullscreen();\n\nexport const viewportCoordsToSceneCoords = (\n  { clientX, clientY }: { clientX: number; clientY: number },\n  {\n    zoom,\n    offsetLeft,\n    offsetTop,\n    scrollX,\n    scrollY,\n  }: {\n    zoom: Zoom;\n    offsetLeft: number;\n    offsetTop: number;\n    scrollX: number;\n    scrollY: number;\n  }\n) => {\n  const x = (clientX - offsetLeft) / zoom.value - scrollX;\n  const y = (clientY - offsetTop) / zoom.value - scrollY;\n\n  return { x, y };\n};\n\nexport const sceneCoordsToViewportCoords = (\n  { sceneX, sceneY }: { sceneX: number; sceneY: number },\n  {\n    zoom,\n    offsetLeft,\n    offsetTop,\n    scrollX,\n    scrollY,\n  }: {\n    zoom: Zoom;\n    offsetLeft: number;\n    offsetTop: number;\n    scrollX: number;\n    scrollY: number;\n  }\n) => {\n  const x = (sceneX + scrollX) * zoom.value + offsetLeft;\n  const y = (sceneY + scrollY) * zoom.value + offsetTop;\n  return { x, y };\n};\n\nexport const getGlobalCSSVariable = (name: string) =>\n  getComputedStyle(document.documentElement).getPropertyValue(`--${name}`);\n\nconst RS_LTR_CHARS =\n  \"A-Za-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02B8\\u0300-\\u0590\\u0800-\\u1FFF\" +\n  \"\\u2C00-\\uFB1C\\uFDFE-\\uFE6F\\uFEFD-\\uFFFF\";\nconst RS_RTL_CHARS = \"\\u0591-\\u07FF\\uFB1D-\\uFDFD\\uFE70-\\uFEFC\";\nconst RE_RTL_CHECK = new RegExp(`^[^${RS_LTR_CHARS}]*[${RS_RTL_CHARS}]`);\n/**\n * Checks whether first directional character is RTL. Meaning whether it starts\n *  with RTL characters, or indeterminate (numbers etc.) characters followed by\n *  RTL.\n * See https://github.com/jsondraw/jsondraw/pull/1722#discussion_r436340171\n */\nexport const isRTL = (text: string) => RE_RTL_CHECK.test(text);\n\nexport const tupleToCoors = (xyTuple: readonly [number, number]): { x: number; y: number } => {\n  const [x, y] = xyTuple;\n  return { x, y };\n};\n\n/** use as a rejectionHandler to mute filesystem Abort errors */\nexport const muteFSAbortError = (error?: Error) => {\n  if (error?.name === \"AbortError\") {\n    console.warn(error);\n    return;\n  }\n  throw error;\n};\n\nexport const findIndex = <T>(\n  array: readonly T[],\n  cb: (element: T, index: number, array: readonly T[]) => boolean,\n  fromIndex: number = 0\n) => {\n  if (fromIndex < 0) {\n    fromIndex = array.length + fromIndex;\n  }\n  fromIndex = Math.min(array.length, Math.max(fromIndex, 0));\n  let index = fromIndex - 1;\n  while (++index < array.length) {\n    if (cb(array[index], index, array)) {\n      return index;\n    }\n  }\n  return -1;\n};\n\nexport const findLastIndex = <T>(\n  array: readonly T[],\n  cb: (element: T, index: number, array: readonly T[]) => boolean,\n  fromIndex: number = array.length - 1\n) => {\n  if (fromIndex < 0) {\n    fromIndex = array.length + fromIndex;\n  }\n  fromIndex = Math.min(array.length - 1, Math.max(fromIndex, 0));\n  let index = fromIndex + 1;\n  while (--index > -1) {\n    if (cb(array[index], index, array)) {\n      return index;\n    }\n  }\n  return -1;\n};\n\n/** returns the first non-null mapped value */\nexport const mapFind = <T, K>(\n  collection: readonly T[],\n  iteratee: (value: T, index: number) => K | undefined | null\n): K | undefined => {\n  for (let idx = 0; idx < collection.length; idx++) {\n    const result = iteratee(collection[idx], idx);\n    if (result != null) {\n      return result;\n    }\n  }\n  return undefined;\n};\n\nexport type ResolvablePromise<T> = Promise<T> & {\n  resolve: [T] extends [undefined]\n    ? (value?: MaybePromise<Awaited<T>>) => void\n    : (value: MaybePromise<Awaited<T>>) => void;\n  reject: (error: Error) => void;\n};\nexport const resolvablePromise = <T>() => {\n  let resolve!: any;\n  let reject!: any;\n  const promise = new Promise((_resolve, _reject) => {\n    resolve = _resolve;\n    reject = _reject;\n  });\n  (promise as any).resolve = resolve;\n  (promise as any).reject = reject;\n  return promise as ResolvablePromise<T>;\n};\n\n//https://stackoverflow.com/a/9462382/8418\nexport const nFormatter = (num: number, digits: number): string => {\n  const si = [\n    { value: 1, symbol: \"b\" },\n    { value: 1e3, symbol: \"k\" },\n    { value: 1e6, symbol: \"M\" },\n    { value: 1e9, symbol: \"G\" },\n  ];\n  const rx = /\\.0+$|(\\.[0-9]*[1-9])0+$/;\n  let index;\n  for (index = si.length - 1; index > 0; index--) {\n    if (num >= si[index].value) {\n      break;\n    }\n  }\n  return (num / si[index].value).toFixed(digits).replace(rx, \"$1\") + si[index].symbol;\n};\n\nexport const getVersion = () => {\n  return (\n    document.querySelector<HTMLMetaElement>('meta[name=\"version\"]')?.content || DEFAULT_VERSION\n  );\n};\n\n// Adapted from https://github.com/Modernizr/Modernizr/blob/master/feature-detects/emoji.js\nexport const supportsEmoji = () => {\n  const canvas = document.createElement(\"canvas\");\n  const ctx = canvas.getContext(\"2d\");\n  if (!ctx) {\n    return false;\n  }\n  const offset = 12;\n  ctx.fillStyle = \"#f00\";\n  ctx.textBaseline = \"top\";\n  ctx.font = \"32px Arial\";\n  // Modernizr used , but it is sort of supported on Windows 7.\n  // Luckily  isn't supported.\n  ctx.fillText(\"\", 0, 0);\n  return ctx.getImageData(offset, offset, 1, 1).data[0] !== 0;\n};\n\nexport const getNearestScrollableContainer = (element: HTMLElement): HTMLElement | Document => {\n  let parent = element.parentElement;\n  while (parent) {\n    if (parent === document.body) {\n      return document;\n    }\n    const { overflowY } = window.getComputedStyle(parent);\n    const hasScrollableContent = parent.scrollHeight > parent.clientHeight;\n    if (\n      hasScrollableContent &&\n      (overflowY === \"auto\" || overflowY === \"scroll\" || overflowY === \"overlay\")\n    ) {\n      return parent;\n    }\n    parent = parent.parentElement;\n  }\n  return document;\n};\n\nexport const focusNearestParent = (element: HTMLInputElement) => {\n  let parent = element.parentElement;\n  while (parent) {\n    if (parent.tabIndex > -1) {\n      parent.focus();\n      return;\n    }\n    parent = parent.parentElement;\n  }\n};\n\nexport const preventUnload = (event: BeforeUnloadEvent) => {\n  event.preventDefault();\n  // NOTE: modern browsers no longer allow showing a custom message here\n  event.returnValue = \"\";\n};\n\nexport const bytesToHexString = (bytes: Uint8Array) => {\n  return Array.from(bytes)\n    .map(byte => `0${byte.toString(16)}`.slice(-2))\n    .join(\"\");\n};\n\nexport const getUpdatedTimestamp = () => (isTestEnv() ? 1 : Date.now());\n\n/**\n * Transforms array of objects containing `id` attribute,\n * or array of ids (strings), into a Map, keyd by `id`.\n */\nexport const arrayToMap = <T extends { id: string } | string>(\n  items: readonly T[] | Map<string, T>\n) => {\n  if (items instanceof Map) {\n    return items;\n  }\n  return items.reduce(\n    (acc: Map<string, T>, element) => {\n      acc.set(typeof element === \"string\" ? element : element.id, element);\n      return acc;\n    },\n    new Map() as Map<string, T>\n  );\n};\n\nexport const arrayToMapWithIndex = <T extends { id: string }>(elements: readonly T[]) =>\n  elements.reduce((acc, element: T, idx) => {\n    acc.set(element.id, [element, idx]);\n    return acc;\n  }, new Map<string, [element: T, index: number]>());\n\n/**\n * Transform array into an object, use only when array order is irrelevant.\n */\nexport const arrayToObject = <T>(array: readonly T[], groupBy?: (value: T) => string | number) =>\n  array.reduce(\n    (acc, value, idx) => {\n      acc[groupBy ? groupBy(value) : idx] = value;\n      return acc;\n    },\n    {} as { [key: string]: T }\n  );\n\n/** Doubly linked node */\nexport type Node<T> = T & {\n  prev: Node<T> | null;\n  next: Node<T> | null;\n};\n\n/**\n * Creates a circular doubly linked list by adding `prev` and `next` props to the existing array nodes.\n */\nexport const arrayToList = <T>(array: readonly T[]): Node<T>[] =>\n  array.reduce((acc, curr, index) => {\n    const node: Node<T> = { ...curr, prev: null, next: null };\n\n    // no-op for first item, we don't want circular references on a single item\n    if (index !== 0) {\n      const prevNode = acc[index - 1];\n      node.prev = prevNode;\n      prevNode.next = node;\n\n      if (index === array.length - 1) {\n        // make the references circular and connect head & tail\n        const firstNode = acc[0];\n        node.next = firstNode;\n        firstNode.prev = node;\n      }\n    }\n\n    acc.push(node);\n\n    return acc;\n  }, [] as Node<T>[]);\n\n/**\n * Converts a readonly array or map into an iterable.\n * Useful for avoiding entry allocations when iterating object / map on each iteration.\n */\nexport const toIterable = <T>(values: readonly T[] | ReadonlyMap<string, T>): Iterable<T> => {\n  return Array.isArray(values) ? values : values.values();\n};\n\n/**\n * Converts a readonly array or map into an array.\n */\nexport const toArray = <T>(values: readonly T[] | ReadonlyMap<string, T>): T[] => {\n  return Array.isArray(values) ? values : Array.from(toIterable(values));\n};\n\nexport const isTestEnv = () => import.meta.env.MODE === ENV.TEST;\n\nexport const isDevEnv = () => import.meta.env.MODE === ENV.DEVELOPMENT;\n\nexport const isProdEnv = () => import.meta.env.MODE === ENV.PRODUCTION;\n\nexport const isServerEnv = () => typeof process !== \"undefined\" && !!process?.env?.NODE_ENV;\n\nexport const wrapEvent = <T extends Event>(name: EVENT, nativeEvent: T) => {\n  return new CustomEvent(name, {\n    detail: {\n      nativeEvent,\n    },\n    cancelable: true,\n  });\n};\n\nexport const updateObject = <T extends Record<string, any>>(obj: T, updates: Partial<T>): T => {\n  let didChange = false;\n  for (const key in updates) {\n    const value = (updates as any)[key];\n    if (typeof value !== \"undefined\") {\n      if (\n        (obj as any)[key] === value &&\n        // if object, always update because its attrs could have changed\n        (typeof value !== \"object\" || value === null)\n      ) {\n        continue;\n      }\n      didChange = true;\n    }\n  }\n\n  if (!didChange) {\n    return obj;\n  }\n\n  return {\n    ...obj,\n    ...updates,\n  };\n};\n\nexport const isPrimitive = (val: any) => {\n  const type = typeof val;\n  return val == null || (type !== \"object\" && type !== \"function\");\n};\n\nexport const getFrame = () => {\n  try {\n    return window.self === window.top ? \"top\" : \"iframe\";\n  } catch (error) {\n    return \"iframe\";\n  }\n};\n\nexport const isRunningInIframe = () => getFrame() === \"iframe\";\n\nexport const isPromiseLike = (value: any): value is Promise<ResolutionType<typeof value>> => {\n  return (\n    !!value &&\n    typeof value === \"object\" &&\n    \"then\" in value &&\n    \"catch\" in value &&\n    \"finally\" in value\n  );\n};\n\nexport const queryFocusableElements = (container: HTMLElement | null) => {\n  const focusableElements = container?.querySelectorAll<HTMLElement>(\n    \"button, a, input, select, textarea, div[tabindex], label[tabindex]\"\n  );\n\n  return focusableElements\n    ? Array.from(focusableElements).filter(\n        element => element.tabIndex > -1 && !(element as HTMLInputElement).disabled\n      )\n    : [];\n};\n\n/** use as a fallback after identity check (for perf reasons) */\nconst _defaultIsShallowComparatorFallback = (a: any, b: any): boolean => {\n  // consider two empty arrays equal\n  if (Array.isArray(a) && Array.isArray(b) && a.length === 0 && b.length === 0) {\n    return true;\n  }\n  return a === b;\n};\n\n/**\n * Returns whether object/array is shallow equal.\n * Considers empty object/arrays as equal (whether top-level or second-level).\n */\nexport const isShallowEqual = <T extends Record<string, any>, K extends readonly unknown[]>(\n  objA: T,\n  objB: T,\n  comparators?:\n    | { [key in keyof T]?: (a: T[key], b: T[key]) => boolean }\n    | (keyof T extends K[number]\n        ? K extends readonly (keyof T)[]\n          ? K\n          : {\n              _error: \"keys are either missing or include keys not in compared obj\";\n            }\n        : {\n            _error: \"keys are either missing or include keys not in compared obj\";\n          }),\n  debug = false\n) => {\n  const aKeys = Object.keys(objA);\n  const bKeys = Object.keys(objB);\n  if (aKeys.length !== bKeys.length) {\n    if (debug) {\n      console.warn(\n        `%cisShallowEqual: objects don't have same properties ->`,\n        \"color: #8B4000\",\n        objA,\n        objB\n      );\n    }\n    return false;\n  }\n\n  if (comparators && Array.isArray(comparators)) {\n    for (const key of comparators) {\n      const ret =\n        objA[key] === objB[key] || _defaultIsShallowComparatorFallback(objA[key], objB[key]);\n      if (!ret) {\n        if (debug) {\n          console.warn(\n            `%cisShallowEqual: ${key} not equal ->`,\n            \"color: #8B4000\",\n            objA[key],\n            objB[key]\n          );\n        }\n        return false;\n      }\n    }\n    return true;\n  }\n\n  return aKeys.every(key => {\n    const comparator = (comparators as { [key in keyof T]?: (a: T[key], b: T[key]) => boolean })?.[\n      key as keyof T\n    ];\n    const ret = comparator\n      ? comparator(objA[key], objB[key])\n      : objA[key] === objB[key] || _defaultIsShallowComparatorFallback(objA[key], objB[key]);\n\n    if (!ret && debug) {\n      console.warn(`%cisShallowEqual: ${key} not equal ->`, \"color: #8B4000\", objA[key], objB[key]);\n    }\n    return ret;\n  });\n};\n\n// taken from Radix UI\n// https://github.com/radix-ui/primitives/blob/main/packages/core/primitive/src/primitive.tsx\nexport const composeEventHandlers = <E>(\n  originalEventHandler?: (event: E) => void,\n  ourEventHandler?: (event: E) => void,\n  { checkForDefaultPrevented = true } = {}\n) => {\n  return function handleEvent(event: E) {\n    originalEventHandler?.(event);\n\n    if (!checkForDefaultPrevented || !(event as unknown as Event)?.defaultPrevented) {\n      return ourEventHandler?.(event);\n    }\n  };\n};\n\n/**\n * supply `null` as message if non-never value is valid, you just need to\n * typecheck against it\n */\nexport const assertNever = (value: never, message: string | null, softAssert?: boolean): never => {\n  if (!message) {\n    return value;\n  }\n  if (softAssert) {\n    console.error(message);\n    return value;\n  }\n\n  throw new Error(message);\n};\n\nexport function invariant(condition: any, message: string): asserts condition {\n  if (!condition) {\n    throw new Error(message);\n  }\n}\n\n/**\n * Memoizes on values of `opts` object (strict equality).\n */\nexport const memoize = <T extends Record<string, any>, R extends any>(func: (opts: T) => R) => {\n  let lastArgs: Map<string, any> | undefined;\n  let lastResult: R | undefined;\n\n  const ret = function (opts: T) {\n    const currentArgs = Object.entries(opts);\n\n    if (lastArgs) {\n      let argsAreEqual = true;\n      for (const [key, value] of currentArgs) {\n        if (lastArgs.get(key) !== value) {\n          argsAreEqual = false;\n          break;\n        }\n      }\n      if (argsAreEqual) {\n        return lastResult;\n      }\n    }\n\n    const result = func(opts);\n\n    lastArgs = new Map(currentArgs);\n    lastResult = result;\n\n    return result;\n  };\n\n  ret.clear = () => {\n    lastArgs = undefined;\n    lastResult = undefined;\n  };\n\n  return ret as typeof func & { clear: () => void };\n};\n\n/** Checks if value is inside given collection. Useful for type-safety. */\nexport const isMemberOf = <T extends string>(\n  /** Set/Map/Array/Object */\n  collection: Set<T> | readonly T[] | Record<T, any> | Map<T, any>,\n  /** value to look for */\n  value: string\n): value is T => {\n  return collection instanceof Set || collection instanceof Map\n    ? collection.has(value as T)\n    : \"includes\" in collection\n      ? collection.includes(value as T)\n      : collection.hasOwnProperty(value);\n};\n\nexport const cloneJSON = <T>(obj: T): T => JSON.parse(JSON.stringify(obj));\n\nexport const updateStable = <T extends any[] | Record<string, any>>(prevValue: T, nextValue: T) => {\n  if (isShallowEqual(prevValue, nextValue)) {\n    return prevValue;\n  }\n  return nextValue;\n};\n\n// Window\nexport function addEventListener<K extends keyof WindowEventMap>(\n  target: Window & typeof globalThis,\n  type: K,\n  listener: (this: Window, ev: WindowEventMap[K]) => any,\n  options?: boolean | AddEventListenerOptions\n): UnsubscribeCallback;\nexport function addEventListener(\n  target: Window & typeof globalThis,\n  type: string,\n  listener: (this: Window, ev: Event) => any,\n  options?: boolean | AddEventListenerOptions\n): UnsubscribeCallback;\n// Document\nexport function addEventListener<K extends keyof DocumentEventMap>(\n  target: Document,\n  type: K,\n  listener: (this: Document, ev: DocumentEventMap[K]) => any,\n  options?: boolean | AddEventListenerOptions\n): UnsubscribeCallback;\nexport function addEventListener(\n  target: Document,\n  type: string,\n  listener: (this: Document, ev: Event) => any,\n  options?: boolean | AddEventListenerOptions\n): UnsubscribeCallback;\n// FontFaceSet (document.fonts)\nexport function addEventListener<K extends keyof FontFaceSetEventMap>(\n  target: FontFaceSet,\n  type: K,\n  listener: (this: FontFaceSet, ev: FontFaceSetEventMap[K]) => any,\n  options?: boolean | AddEventListenerOptions\n): UnsubscribeCallback;\n// HTMLElement / mix\nexport function addEventListener<K extends keyof HTMLElementEventMap>(\n  target: Document | (Window & typeof globalThis) | HTMLElement | undefined | null | false,\n  type: K,\n  listener: (this: HTMLDivElement, ev: HTMLElementEventMap[K]) => any,\n  options?: boolean | AddEventListenerOptions\n): UnsubscribeCallback;\n// implem\nexport function addEventListener(\n  /**\n   * allows for falsy values so you don't have to type check when adding\n   * event listeners to optional elements\n   */\n  target:\n    | Document\n    | (Window & typeof globalThis)\n    | FontFaceSet\n    | HTMLElement\n    | undefined\n    | null\n    | false,\n  type: keyof WindowEventMap | keyof DocumentEventMap | string,\n  listener: (ev: Event) => any,\n  options?: boolean | AddEventListenerOptions\n): UnsubscribeCallback {\n  if (!target) {\n    return () => {};\n  }\n  target?.addEventListener?.(type, listener, options);\n  return () => {\n    target?.removeEventListener?.(type, listener, options);\n  };\n}\n\nexport function getSvgPathFromStroke(points: number[][], closed = true) {\n  const len = points.length;\n\n  if (len < 4) {\n    return ``;\n  }\n\n  let a = points[0];\n  let b = points[1];\n  const c = points[2];\n\n  let result = `M${a[0].toFixed(2)},${a[1].toFixed(2)} Q${b[0].toFixed(\n    2\n  )},${b[1].toFixed(2)} ${average(b[0], c[0]).toFixed(2)},${average(b[1], c[1]).toFixed(2)} T`;\n\n  for (let i = 2, max = len - 1; i < max; i++) {\n    a = points[i];\n    b = points[i + 1];\n    result += `${average(a[0], b[0]).toFixed(2)},${average(a[1], b[1]).toFixed(2)} `;\n  }\n\n  if (closed) {\n    result += \"Z\";\n  }\n\n  return result;\n}\n\nexport const normalizeEOL = (str: string) => {\n  return str.replace(/\\r?\\n|\\r/g, \"\\n\");\n};\n\n// -----------------------------------------------------------------------------\nexport type HasBrand<T> = {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  [K in keyof T]: K extends `~brand${infer _}` | \"_brand\" ? true : never;\n}[keyof T];\n\ntype RemoveAllBrands<T> =\n  HasBrand<T> extends true\n    ? {\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        [K in keyof T as K extends `~brand~${infer _}` | \"_brand\" ? never : K]: T[K];\n      }\n    : T;\n\n// For accepting values - uses loose matching for branded types\n// Preserves readonly modifier: mutable array requires mutable input\ntype UnbrandForValue<T> =\n  T extends Map<infer E, infer F>\n    ? Map<UnbrandForValue<E>, UnbrandForValue<F>>\n    : T extends Set<infer E>\n      ? Set<UnbrandForValue<E>>\n      : T extends readonly any[]\n        ? T extends any[]\n          ? unknown[] // mutable array - require mutable input\n          : readonly unknown[] // readonly array - accept readonly input\n        : RemoveAllBrands<T>;\n\n// For return types - preserves array element unbranding\nexport type Unbrand<T> =\n  T extends Map<infer E, infer F>\n    ? Map<Unbrand<E>, Unbrand<F>>\n    : T extends Set<infer E>\n      ? Set<Unbrand<E>>\n      : T extends readonly (infer E)[]\n        ? Array<Unbrand<E>>\n        : RemoveAllBrands<T>;\n\nexport type CombineBrands<BrandedType, CurrentType> = BrandedType extends readonly (infer BE)[]\n  ? CurrentType extends readonly (infer CE)[]\n    ? Array<CE & BE>\n    : CurrentType & BrandedType\n  : CurrentType & BrandedType;\n\nexport type CombineBrandsIfNeeded<T, Required> = [T] extends [Required]\n  ? T[]\n  : HasBrand<T> extends true\n    ? CombineBrands<T, Required>[]\n    : Required[];\n\n/**\n * Makes type into a branded type, ensuring that value is assignable to\n * the base unbranded type. Optionally you can explicitly supply current value\n * type to combine both (useful for composite branded types. Make sure you\n * compose branded types which are not composite themselves.)\n */\nexport function toBrandedType<BrandedType>(value: UnbrandForValue<BrandedType>): BrandedType;\nexport function toBrandedType<BrandedType, CurrentType>(\n  value: CurrentType\n): CombineBrands<BrandedType, CurrentType>;\nexport function toBrandedType(value: unknown) {\n  return value;\n}\n\n// -----------------------------------------------------------------------------\n\n// Promise.try, adapted from https://github.com/sindresorhus/p-try\nexport const promiseTry = async <TValue, TArgs extends unknown[]>(\n  fn: (...args: TArgs) => PromiseLike<TValue> | TValue,\n  ...args: TArgs\n): Promise<TValue> => {\n  return new Promise(resolve => {\n    resolve(fn(...args));\n  });\n};\n\nexport const isAnyTrue = (...args: boolean[]): boolean =>\n  Math.max(...args.map(arg => (arg ? 1 : 0))) > 0;\n\nexport const safelyParseJSON = (json: string): Record<string, any> | null => {\n  try {\n    return JSON.parse(json);\n  } catch {\n    return null;\n  }\n};\n\n/**\n * use when you need to render unsafe string as HTML attribute, but MAKE SURE\n * the attribute is double-quoted when constructing the HTML string\n */\nexport const escapeDoubleQuotes = (str: string) => {\n  return str.replace(/\"/g, \"&quot;\");\n};\n\nexport const castArray = <T>(value: T | T[]): T[] => (Array.isArray(value) ? value : [value]);\n\n/** hack for Array.isArray type guard not working with readonly value[] */\nexport const isReadonlyArray = (value?: any): value is readonly any[] => {\n  return Array.isArray(value);\n};\n\nexport const sizeOf = (\n  value:\n    | readonly unknown[]\n    | Readonly<Map<string, unknown>>\n    | Readonly<Record<string, unknown>>\n    | ReadonlySet<unknown>\n): number => {\n  return isReadonlyArray(value)\n    ? value.length\n    : value instanceof Map || value instanceof Set\n      ? value.size\n      : Object.keys(value).length;\n};\n\nexport const reduceToCommonValue = <T, R = T>(\n  collection: readonly T[] | ReadonlySet<T>,\n  getValue?: (item: T) => R\n): R | null => {\n  if (sizeOf(collection) === 0) {\n    return null;\n  }\n\n  const valueExtractor = getValue || ((item: T) => item as unknown as R);\n\n  let commonValue: R | null = null;\n\n  for (const item of collection) {\n    const value = valueExtractor(item);\n    if ((commonValue === null || commonValue === value) && value != null) {\n      commonValue = value;\n    } else {\n      return null;\n    }\n  }\n\n  return commonValue;\n};\n\ntype FEATURE_FLAGS = {\n  COMPLEX_BINDINGS: boolean;\n};\n\nconst FEATURE_FLAGS_STORAGE_KEY = \"jsondraw-feature-flags\";\nconst DEFAULT_FEATURE_FLAGS: FEATURE_FLAGS = {\n  COMPLEX_BINDINGS: false,\n};\nlet featureFlags: FEATURE_FLAGS | null = null;\n\nexport const getFeatureFlag = <F extends keyof FEATURE_FLAGS>(flag: F): FEATURE_FLAGS[F] => {\n  if (!featureFlags) {\n    try {\n      const serializedFlags = localStorage.getItem(FEATURE_FLAGS_STORAGE_KEY);\n      if (serializedFlags) {\n        const flags = JSON.parse(serializedFlags);\n        featureFlags = flags ?? DEFAULT_FEATURE_FLAGS;\n      }\n    } catch {}\n  }\n\n  return (featureFlags || DEFAULT_FEATURE_FLAGS)[flag];\n};\n\nexport const setFeatureFlag = <F extends keyof FEATURE_FLAGS>(flag: F, value: FEATURE_FLAGS[F]) => {\n  try {\n    featureFlags = {\n      ...(featureFlags || DEFAULT_FEATURE_FLAGS),\n      [flag]: value,\n    };\n    localStorage.setItem(FEATURE_FLAGS_STORAGE_KEY, JSON.stringify(featureFlags));\n  } catch (e) {\n    console.error(\"unable to set feature flag\", e);\n  }\n};\n","import { nanoid } from \"nanoid\";\nimport { Random } from \"roughjs/bin/math\";\n\nimport { isTestEnv } from \"./utils\";\n\nlet random = new Random(Date.now());\nlet testIdBase = 0;\n\nexport const randomInteger = () => Math.floor(random.next() * 2 ** 31);\n\nexport const reseed = (seed: number) => {\n  random = new Random(seed);\n  testIdBase = 0;\n};\n\nexport const randomId = () => (isTestEnv() ? `id${testIdBase++}` : nanoid());\n","import { sanitizeUrl } from \"@braintree/sanitize-url\";\n\nimport { escapeDoubleQuotes } from \"./utils\";\n\nexport const normalizeLink = (link: string) => {\n  link = link.trim();\n  if (!link) {\n    return link;\n  }\n  return sanitizeUrl(escapeDoubleQuotes(link));\n};\n\nexport const isLocalLink = (link: string | null) => {\n  return !!(link?.includes(location.origin) || link?.startsWith(\"/\"));\n};\n\n/**\n * Returns URL sanitized and safe for usage in places such as\n * iframe's src attribute or <a> href attributes.\n */\nexport const toValidURL = (link: string) => {\n  link = normalizeLink(link);\n\n  // make relative links into fully-qualified urls\n  if (link.startsWith(\"/\")) {\n    return `${location.origin}${link}`;\n  }\n\n  try {\n    new URL(link);\n  } catch {\n    // if link does not parse as URL, assume invalid and return blank page\n    return \"about:blank\";\n  }\n\n  return link;\n};\n","import type { UnsubscribeCallback } from \"@jsondraw/jsondraw/types\";\n\ntype Subscriber<T extends any[]> = (...payload: T) => void;\n\nexport class Emitter<T extends any[] = []> {\n  public subscribers: Subscriber<T>[] = [];\n\n  /**\n   * Attaches subscriber\n   *\n   * @returns unsubscribe function\n   */\n  on(...handlers: Subscriber<T>[] | Subscriber<T>[][]): UnsubscribeCallback {\n    const _handlers = handlers\n      .flat()\n      .filter((item) => typeof item === \"function\");\n\n    this.subscribers.push(..._handlers);\n\n    return () => this.off(_handlers);\n  }\n\n  once(...handlers: Subscriber<T>[] | Subscriber<T>[][]): UnsubscribeCallback {\n    const _handlers = handlers\n      .flat()\n      .filter((item) => typeof item === \"function\");\n\n    _handlers.push(() => detach());\n\n    const detach = this.on(..._handlers);\n    return detach;\n  }\n\n  off(...handlers: Subscriber<T>[] | Subscriber<T>[][]) {\n    const _handlers = handlers.flat();\n    this.subscribers = this.subscribers.filter(\n      (handler) => !_handlers.includes(handler),\n    );\n  }\n\n  trigger(...payload: T) {\n    for (const handler of this.subscribers) {\n      handler(...payload);\n    }\n    return this;\n  }\n\n  clear() {\n    this.subscribers = [];\n  }\n}\n","export * from \"./binary-heap\";\nexport * from \"./bounds\";\nexport * from \"./colors\";\nexport * from \"./constants\";\nexport * from \"./font-metadata\";\nexport * from \"./queue\";\nexport * from \"./keys\";\nexport * from \"./points\";\nexport * from \"./promise-pool\";\nexport * from \"./random\";\nexport * from \"./url\";\nexport * from \"./utils\";\nexport * from \"./emitter\";\nexport * from \"./editorInterface\";\n","import React from \"react\";\nimport { Modal, Box, Text, Button, Stack } from \"@mantine/core\";\nimport styled from \"styled-components\";\nimport { FiAlertTriangle, FiDownload } from \"react-icons/fi\";\n\nconst WarningBanner = styled.div<{ $dark: boolean }>`\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  gap: 1rem;\n  padding: 1.75rem 2rem;\n  border-radius: 0.5rem;\n  background: ${({ $dark }) => ($dark ? \"rgba(220, 38, 38, 0.12)\" : \"#fef2f2\")};\n  color: ${({ $dark }) => ($dark ? \"#fca5a5\" : \"#991b1b\")};\n\n  @media (max-width: 600px) {\n    flex-direction: column;\n    text-align: center;\n  }\n`;\n\nconst IconWrapper = styled.div<{ $dark: boolean }>`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-shrink: 0;\n  width: 3rem;\n  height: 3rem;\n  border-radius: 50%;\n  background: ${({ $dark }) => ($dark ? \"rgba(220, 38, 38, 0.2)\" : \"#fee2e2\")};\n\n  svg {\n    width: 1.4rem;\n    height: 1.4rem;\n    color: ${({ $dark }) => ($dark ? \"#f87171\" : \"#dc2626\")};\n  }\n`;\n\nconst ActionCard = styled.div<{ $dark: boolean }>`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding: 1.5rem;\n  gap: 0.75rem;\n  text-align: center;\n\n  h4 {\n    margin: 0;\n    font-weight: 700;\n    font-size: 1.125rem;\n    color: ${({ $dark }) => ($dark ? \"#e5e5e5\" : \"#1f2937\")};\n  }\n\n  p {\n    margin: 0;\n    font-size: 0.875rem;\n    color: ${({ $dark }) => ($dark ? \"#a3a3a3\" : \"#6b7280\")};\n    line-height: 1.5;\n  }\n`;\n\ninterface LoadFromLinkDialogProps {\n  opened: boolean;\n  darkMode: boolean;\n  onReplace: () => void;\n  onClose: () => void;\n  onSaveToDisk: () => void;\n}\n\nexport const LoadFromLinkDialog: React.FC<LoadFromLinkDialogProps> = ({\n  opened,\n  darkMode,\n  onReplace,\n  onClose,\n  onSaveToDisk,\n}) => {\n  return (\n    <Modal\n      opened={opened}\n      onClose={onClose}\n      title={null}\n      withCloseButton={false}\n      centered\n      size={700}\n      padding=\"xl\"\n      radius=\"lg\"\n      styles={{\n        content: {\n          backgroundColor: darkMode ? \"#1e1e1e\" : \"#ffffff\",\n        },\n        overlay: {\n          backgroundColor: darkMode ? \"rgba(0, 0, 0, 0.7)\" : \"rgba(0, 0, 0, 0.4)\",\n        },\n      }}\n    >\n      <Stack gap=\"lg\">\n        {/* Title */}\n        <Text\n          fw={700}\n          size=\"xl\"\n          style={{\n            fontFamily: \"Assistant, sans-serif\",\n            fontSize: \"1.3rem\",\n            color: darkMode ? \"#e5e5e5\" : \"#111827\",\n          }}\n        >\n          Load from link\n        </Text>\n\n        {/* Warning Banner + Replace Button */}\n        <WarningBanner $dark={darkMode}>\n          <IconWrapper $dark={darkMode}>\n            <FiAlertTriangle />\n          </IconWrapper>\n          <div>\n            Loading external drawing will{\" \"}\n            <strong style={{ color: darkMode ? \"#f87171\" : \"#dc2626\" }}>\n              replace your existing content\n            </strong>\n            .\n            <br />\n            You can back up your drawing first by using one of the options below.\n          </div>\n          <div style={{ flexGrow: 1 }} />\n          <Button color=\"red\" size=\"md\" onClick={onReplace} style={{ flexShrink: 0 }}>\n            Replace my content\n          </Button>\n        </WarningBanner>\n\n        {/* Save to disk action */}\n        <ActionCard $dark={darkMode}>\n          <h4>Save to disk</h4>\n          <p>Export the scene data to a file from which you can import later.</p>\n          <Button\n            variant=\"outline\"\n            color=\"gray\"\n            size=\"md\"\n            fullWidth\n            leftSection={<FiDownload size={16} />}\n            onClick={onSaveToDisk}\n            styles={{\n              root: {\n                maxWidth: 300,\n                borderColor: darkMode ? \"#404040\" : \"#d1d5db\",\n                color: darkMode ? \"#d4d4d4\" : \"#374151\",\n              },\n            }}\n          >\n            Save to disk\n          </Button>\n        </ActionCard>\n      </Stack>\n    </Modal>\n  );\n};\n","/**\n * Converter: JSON NodeData/EdgeData  JsonDraw Elements\n *\n * Maps the existing graph model (from jsonParser) into JsonDraw-compatible\n * element format so JSON data can be visualized on the JsonDraw whiteboard.\n */\nimport { FONT_FAMILY } from \"@jsondraw/common\";\nimport type { NodeData, EdgeData } from \"../../../../types/graph\";\n\n// JsonDraw element types (simplified)\ninterface JsonDrawBaseElement {\n  id: string;\n  type: string;\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n  angle: 0;\n  strokeColor: string;\n  backgroundColor: string;\n  fillStyle: \"solid\" | \"hachure\" | \"cross-hatch\";\n  strokeWidth: number;\n  roughness: number;\n  opacity: number;\n  groupIds: string[];\n  roundness: { type: number } | null;\n  seed: number;\n  version: number;\n  versionNonce: number;\n  isDeleted: false;\n  boundElements: { id: string; type: \"text\" | \"arrow\" }[] | null;\n  index: string | null;\n  updated: number;\n  link: null;\n  locked: false;\n  frameId: null;\n}\n\ninterface JsonDrawRectangleElement extends JsonDrawBaseElement {\n  type: \"rectangle\";\n}\n\ninterface JsonDrawTextElement extends JsonDrawBaseElement {\n  type: \"text\";\n  text: string;\n  fontSize: number;\n  fontFamily: number;\n  textAlign: \"left\" | \"center\" | \"right\";\n  verticalAlign: \"top\" | \"middle\" | \"bottom\";\n  containerId: string | null;\n  originalText: string;\n  autoResize: boolean;\n  lineHeight: number;\n}\n\n// Keeping local interface for now or import?\n// The file defined JsonDrawArrowElement locally but extended Base.\n// Wait, the original file had `interface JsonDrawArrowElement extends JsonDrawBaseElement`.\n// But it imported `JsonDrawArrowElement` type from packages/element/types?\n// Step 905 line 7: `import type { JsonDrawArrowElement } from ...`\n// But line 54 defines `interface JsonDrawArrowElement extends ...`.\n// This is shadowing or extending? TS allows interface merging but here it likely conflicts if imported as type.\n// Ah, line 7 imports it, but line 54 re-declares it?\n// Actually line 7 imports `JsonDrawArrowElement`.\n// And line 54 defines `interface JsonDrawArrowElement`.\n// This would be a specialized version or augmentation?\n// No, line 7 in Step 905 is: `import type { NodeData, EdgeData } from \"../../../../types/graph\";`\n// Wait. Line 7 is NodeData/EdgeData.\n// Where is JsonDrawArrowElement imported?\n// Ah, Step 900 replaced import but failed.\n// Step 905 shows the file content.\n// It does NOT import JsonDrawArrowElement in lines 1-10.\n// Let me check imports again.\n// Line 7: `import type { NodeData, EdgeData } ...`\n// Line 9: `// JsonDraw element types (simplified)`\n// Line 54: `interface JsonDrawArrowElement extends JsonDrawBaseElement`.\n// So it defines them LOCALLY. It does not import them (except maybe `JsonDrawElement` type at line 74 union).\n// Line 74: `type JsonDrawElement = ...`\n// So this file defines its OWN types that match JsonDraw's structure.\n// So I should rename these LOCAL interfaces to JsonDraw...\n// And I don't need to import `JsonDrawArrowElement` if I define it here.\n// But `jsonToJsonDrawElements` returns `JsonDrawElement[]`.\n// Use the local type.\n// So I will rename all local interfaces and the return type.\n\ninterface JsonDrawArrowElement extends JsonDrawBaseElement {\n  type: \"arrow\";\n  points: [number, number][];\n  startBinding: {\n    elementId: string;\n    focus: number;\n    gap: number;\n    fixedPoint: [number, number];\n  } | null;\n  endBinding: {\n    elementId: string;\n    focus: number;\n    gap: number;\n    fixedPoint: [number, number];\n  } | null;\n  startArrowhead: null;\n  endArrowhead: \"arrow\";\n  elbowed: boolean;\n}\n\ntype JsonDrawElement = JsonDrawRectangleElement | JsonDrawTextElement | JsonDrawArrowElement;\n\n// Simple random seed generator\nconst randomSeed = () => Math.floor(Math.random() * 2000000000);\nconst randomNonce = () => Math.floor(Math.random() * 2000000000);\n\nconst NODE_PADDING = 16;\nconst ROW_HEIGHT = 24;\nconst FONT_SIZE = 16;\nconst HORIZONTAL_GAP = 200;\nconst VERTICAL_GAP = 40;\n\n/**\n * Format node text content for display inside JsonDraw rectangle\n */\nconst formatNodeText = (node: NodeData): string => {\n  if (!node.text || node.text.length === 0) return \"\";\n\n  return node.text\n    .map(row => {\n      if (row.key !== null && row.key !== undefined) {\n        if (row.type === \"object\") return `${row.key}: {${row.childrenCount ?? 0} keys}`;\n        if (row.type === \"array\") return `${row.key}: [${row.childrenCount ?? 0} items]`;\n        if (row.value === null) return `${row.key}: null`;\n        return `${row.key}: ${row.value}`;\n      }\n      return `${row.value ?? \"\"}`;\n    })\n    .join(\"\\n\");\n};\n\n/**\n * Layout nodes using a simple layered approach (BFS by depth from root).\n * Returns map of nodeId  { x, y }.\n */\nconst layoutNodes = (\n  nodes: NodeData[],\n  edges: EdgeData[]\n): Map<string, { x: number; y: number }> => {\n  const positions = new Map<string, { x: number; y: number }>();\n\n  if (nodes.length === 0) return positions;\n\n  // Build adjacency list (parent  children)\n  const children = new Map<string, string[]>();\n  const hasParent = new Set<string>();\n\n  for (const edge of edges) {\n    const ch = children.get(edge.from) ?? [];\n    ch.push(edge.to);\n    children.set(edge.from, ch);\n    hasParent.add(edge.to);\n  }\n\n  // Find root nodes (no incoming edges)\n  const roots = nodes.filter(n => !hasParent.has(n.id)).map(n => n.id);\n  if (roots.length === 0 && nodes.length > 0) {\n    roots.push(nodes[0].id);\n  }\n\n  // BFS to assign layers\n  const nodeMap = new Map(nodes.map(n => [n.id, n]));\n  const layers: string[][] = [];\n  const visited = new Set<string>();\n  let queue = [...roots];\n\n  while (queue.length > 0) {\n    const layer: string[] = [];\n    const nextQueue: string[] = [];\n\n    for (const id of queue) {\n      if (visited.has(id)) continue;\n      visited.add(id);\n      layer.push(id);\n\n      const ch = children.get(id) ?? [];\n      for (const childId of ch) {\n        if (!visited.has(childId)) nextQueue.push(childId);\n      }\n    }\n\n    if (layer.length > 0) layers.push(layer);\n    queue = nextQueue;\n  }\n\n  // Also add any orphan nodes (not connected via edges)\n  const orphans = nodes.filter(n => !visited.has(n.id)).map(n => n.id);\n  if (orphans.length > 0) layers.push(orphans);\n\n  // Assign positions by layer (horizontal layout: layers go right)\n  let currentX = 50;\n\n  for (const layer of layers) {\n    let maxWidth = 0;\n    let currentY = 50;\n\n    for (const nodeId of layer) {\n      const node = nodeMap.get(nodeId);\n      if (!node) continue;\n\n      positions.set(nodeId, { x: currentX, y: currentY });\n      currentY += node.height + VERTICAL_GAP;\n      maxWidth = Math.max(maxWidth, node.width);\n    }\n\n    currentX += maxWidth + HORIZONTAL_GAP;\n  }\n\n  return positions;\n};\n\n/**\n * Convert Json-viz NodeData[] + EdgeData[]  JsonDraw elements\n */\nexport const jsonToJsonDrawElements = (nodes: NodeData[], edges: EdgeData[]): JsonDrawElement[] => {\n  const elements: JsonDrawElement[] = [];\n  const positions = layoutNodes(nodes, edges);\n\n  const now = Date.now();\n  let indexCounter = 0;\n  const getNextIndex = () => `a${(indexCounter++).toString().padStart(6, \"0\")}`;\n\n  // Map to track rectangle element IDs for arrow bindings\n  const rectIds = new Map<string, string>();\n\n  // Create rectangle + text for each node\n  for (const node of nodes) {\n    const pos = positions.get(node.id) ?? { x: 0, y: 0 };\n    const rectId = `rect-${node.id}`;\n    const textId = `text-${node.id}`;\n    const text = formatNodeText(node);\n\n    rectIds.set(node.id, rectId);\n\n    const width = Math.max(node.width + NODE_PADDING * 2, 120);\n    const textRows = node.text?.length ?? 1;\n    const height = Math.max(textRows * ROW_HEIGHT + NODE_PADDING * 2, 50);\n\n    // Collect arrow bindings for this rectangle\n    const boundElements: { id: string; type: \"text\" | \"arrow\" }[] = [{ id: textId, type: \"text\" }];\n\n    for (const edge of edges) {\n      if (edge.from === node.id || edge.to === node.id) {\n        boundElements.push({ id: `arrow-${edge.id}`, type: \"arrow\" });\n      }\n    }\n\n    // Rectangle element\n    const rect: JsonDrawRectangleElement = {\n      id: rectId,\n      type: \"rectangle\",\n      x: pos.x,\n      y: pos.y,\n      width,\n      height,\n      angle: 0,\n      strokeColor: \"#1e1e1e\",\n      backgroundColor: \"transparent\",\n      fillStyle: \"solid\",\n      strokeWidth: 1,\n      roughness: 1,\n      opacity: 100,\n      groupIds: [],\n      roundness: { type: 3 },\n      seed: randomSeed(),\n      version: 1,\n      versionNonce: randomNonce(),\n      isDeleted: false,\n      boundElements,\n      index: getNextIndex(),\n      updated: now,\n      link: null,\n      locked: false,\n      frameId: null,\n    };\n    elements.push(rect);\n\n    // Text element (bound to rectangle)\n    const textEl: JsonDrawTextElement = {\n      id: textId,\n      type: \"text\",\n      x: pos.x + NODE_PADDING,\n      y: pos.y + NODE_PADDING,\n      width: width - NODE_PADDING * 2,\n      height: height - NODE_PADDING * 2,\n      angle: 0,\n      strokeColor: \"#1e1e1e\",\n      backgroundColor: \"transparent\",\n      fillStyle: \"solid\",\n      strokeWidth: 1,\n      roughness: 1,\n      opacity: 100,\n      groupIds: [],\n      roundness: null,\n      seed: randomSeed(),\n      version: 1,\n      versionNonce: randomNonce(),\n      isDeleted: false,\n      boundElements: null,\n      index: getNextIndex(),\n      updated: now,\n      link: null,\n      locked: false,\n      frameId: null,\n      text,\n      fontSize: FONT_SIZE,\n      fontFamily: FONT_FAMILY.Excalifont,\n      textAlign: \"left\",\n      verticalAlign: \"top\",\n      containerId: rectId,\n      originalText: text,\n      autoResize: true,\n      lineHeight: 1.25,\n    };\n    elements.push(textEl);\n  }\n\n  // Create arrows for each edge\n  for (const edge of edges) {\n    const fromRectId = rectIds.get(edge.from);\n    const toRectId = rectIds.get(edge.to);\n    if (!fromRectId || !toRectId) continue;\n\n    const fromPos = positions.get(edge.from);\n    const toPos = positions.get(edge.to);\n    if (!fromPos || !toPos) continue;\n\n    const fromNode = nodes.find(n => n.id === edge.from);\n    const toNode = nodes.find(n => n.id === edge.to);\n    if (!fromNode || !toNode) continue;\n\n    const fromWidth = Math.max(fromNode.width + NODE_PADDING * 2, 120);\n    const fromHeight = Math.max((fromNode.text?.length ?? 1) * ROW_HEIGHT + NODE_PADDING * 2, 50);\n    const toHeight = Math.max((toNode.text?.length ?? 1) * ROW_HEIGHT + NODE_PADDING * 2, 50);\n\n    // Arrow starts from right edge of source, ends at left edge of target\n    const startX = fromPos.x + fromWidth;\n    const startY = fromPos.y + fromHeight / 2;\n    const endX = toPos.x;\n    const endY = toPos.y + toHeight / 2;\n\n    const arrow: JsonDrawArrowElement = {\n      id: `arrow-${edge.id}`,\n      type: \"arrow\",\n      x: startX,\n      y: startY,\n      width: Math.abs(endX - startX),\n      height: Math.abs(endY - startY),\n      angle: 0,\n      strokeColor: \"#1e1e1e\",\n      backgroundColor: \"transparent\",\n      fillStyle: \"solid\",\n      strokeWidth: 1,\n      roughness: 1,\n      opacity: 100,\n      groupIds: [],\n      roundness: { type: 2 },\n      seed: randomSeed(),\n      version: 1,\n      versionNonce: randomNonce(),\n      isDeleted: false,\n      boundElements: null,\n      index: getNextIndex(),\n      updated: now,\n      link: null,\n      locked: false,\n      frameId: null,\n      points: [\n        [0, 0],\n        [endX - startX, endY - startY],\n      ],\n      startBinding: {\n        elementId: fromRectId,\n        focus: 0,\n        gap: 5,\n        fixedPoint: [1, 0.5],\n      },\n      endBinding: {\n        elementId: toRectId,\n        focus: 0,\n        gap: 5,\n        fixedPoint: [0, 0.5],\n      },\n      startArrowhead: null,\n      endArrowhead: \"arrow\",\n      elbowed: false,\n    };\n    elements.push(arrow);\n  }\n\n  return elements;\n};\n","import { initializeApp, getApps } from \"firebase/app\";\nimport { getDatabase, Database } from \"firebase/database\";\n\nconst dbConfig = {\n  apiKey: process.env.NEXT_PUBLIC_DB_API_KEY,\n  authDomain: process.env.NEXT_PUBLIC_DB_AUTH_DOMAIN,\n  databaseURL: process.env.NEXT_PUBLIC_DB_URL,\n  projectId: process.env.NEXT_PUBLIC_DB_PROJECT_ID,\n  storageBucket: process.env.NEXT_PUBLIC_DB_STORAGE_BUCKET,\n  messagingSenderId: process.env.NEXT_PUBLIC_DB_SENDER_ID,\n  appId: process.env.NEXT_PUBLIC_DB_APP_ID,\n};\n\nlet _db: Database | null = null;\n\n/**\n * Get database instance lazily  only initializes on first call.\n * This prevents the app from crashing if config is missing.\n */\nexport const getDb = (): Database => {\n  if (_db) return _db;\n\n  if (!dbConfig.databaseURL || !dbConfig.projectId) {\n    throw new Error(\n      \"Database configuration is missing. Please set NEXT_PUBLIC_DB_* environment variables.\"\n    );\n  }\n\n  const app = getApps().length === 0 ? initializeApp(dbConfig) : getApps()[0];\n  _db = getDatabase(app);\n  return _db;\n};\n","import { ref, set, get } from \"firebase/database\";\nimport { getDb } from \"../../../../lib/db\";\n\n/**\n * Convert Uint8Array to base64 string (without spread operator for TS compat)\n */\nconst uint8ToBase64 = (bytes: Uint8Array): string => {\n  let binary = \"\";\n  const chunkSize = 8000;\n  for (let i = 0; i < bytes.length; i += chunkSize) {\n    binary += String.fromCharCode.apply(null, Array.from(bytes.slice(i, i + chunkSize)));\n  }\n  return btoa(binary);\n};\n\n/**\n * Convert base64 string to Uint8Array\n */\nconst base64ToUint8 = (base64: string): Uint8Array => {\n  const binary = atob(base64);\n  const bytes = new Uint8Array(binary.length);\n  for (let i = 0; i < binary.length; i++) {\n    bytes[i] = binary.charCodeAt(i);\n  }\n  return bytes;\n};\n\n/**\n * Generate a short random ID for share links (URL-safe, 20 chars)\n */\nconst generateId = (): string => {\n  const array = new Uint8Array(15);\n  crypto.getRandomValues(array);\n  const base64 = uint8ToBase64(array);\n  return base64.replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=+$/, \"\");\n};\n\n/**\n * Generate an AES-GCM encryption key and return it as a base64url string\n */\nexport const generateEncryptionKey = async (): Promise<string> => {\n  const key = await crypto.subtle.generateKey({ name: \"AES-GCM\", length: 128 }, true, [\n    \"encrypt\",\n    \"decrypt\",\n  ]);\n  const exported = await crypto.subtle.exportKey(\"raw\", key);\n  const bytes = new Uint8Array(exported);\n  const base64 = uint8ToBase64(bytes);\n  return base64.replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=+$/, \"\");\n};\n\n/**\n * Import an AES-GCM key from a base64url string\n */\nconst importKey = async (keyStr: string): Promise<CryptoKey> => {\n  // Convert base64url back to standard base64\n  let base64 = keyStr.replace(/-/g, \"+\").replace(/_/g, \"/\");\n  while (base64.length % 4) base64 += \"=\";\n\n  const raw = base64ToUint8(base64);\n  return crypto.subtle.importKey(\"raw\", raw.buffer as ArrayBuffer, { name: \"AES-GCM\" }, false, [\n    \"encrypt\",\n    \"decrypt\",\n  ]);\n};\n\n/**\n * Encrypt data using AES-GCM.\n * Returns a Uint8Array with IV prepended to ciphertext.\n */\nconst encryptData = async (data: Uint8Array, keyStr: string): Promise<Uint8Array> => {\n  const key = await importKey(keyStr);\n  const iv = crypto.getRandomValues(new Uint8Array(12));\n  const encrypted = await crypto.subtle.encrypt(\n    { name: \"AES-GCM\", iv },\n    key,\n    data.buffer as ArrayBuffer\n  );\n  // Prepend IV to ciphertext\n  const result = new Uint8Array(iv.length + encrypted.byteLength);\n  result.set(iv);\n  result.set(new Uint8Array(encrypted), iv.length);\n  return result;\n};\n\n/**\n * Decrypt data using AES-GCM.\n * Expects IV prepended to ciphertext.\n */\nconst decryptData = async (data: Uint8Array, keyStr: string): Promise<Uint8Array> => {\n  const key = await importKey(keyStr);\n  const iv = data.slice(0, 12);\n  const ciphertext = data.slice(12);\n  const decrypted = await crypto.subtle.decrypt(\n    { name: \"AES-GCM\", iv },\n    key,\n    ciphertext.buffer as ArrayBuffer\n  );\n  return new Uint8Array(decrypted);\n};\n\n/**\n * Upload encrypted + compressed scene data to the backend.\n * Returns { id, encryptionKey } for the share link.\n */\nexport const exportToBackend = async (\n  compressedData: Uint8Array\n): Promise<{ id: string; encryptionKey: string }> => {\n  const id = generateId();\n  const encryptionKey = await generateEncryptionKey();\n\n  // Encrypt the compressed data\n  const encrypted = await encryptData(compressedData, encryptionKey);\n\n  // Convert to base64 for storage (DB stores strings)\n  const base64Data = uint8ToBase64(encrypted);\n\n  // Store in database\n  const dbRef = ref(getDb(), `shared/${id}`);\n  await set(dbRef, {\n    data: base64Data,\n    createdAt: Date.now(),\n  });\n\n  return { id, encryptionKey };\n};\n\n/**\n * Download and decrypt scene data from the backend.\n * Returns decrypted data as Uint8Array, or null if not found.\n */\nexport const importFromBackend = async (\n  id: string,\n  encryptionKey: string\n): Promise<Uint8Array | null> => {\n  try {\n    const dbRef = ref(getDb(), `shared/${id}`);\n    const snapshot = await get(dbRef);\n\n    if (!snapshot.exists()) {\n      console.error(\"Share link data not found:\", id);\n      return null;\n    }\n\n    const { data: base64Data } = snapshot.val();\n\n    // Convert base64 back to Uint8Array\n    const encrypted = base64ToUint8(base64Data);\n\n    // Decrypt\n    const decrypted = await decryptData(encrypted, encryptionKey);\n\n    return decrypted;\n  } catch (error) {\n    console.error(\"Failed to import shared data:\", error);\n    return null;\n  }\n};\n","import pako from \"pako\";\nimport { exportToBackend, importFromBackend } from \"./shareBackend\";\n\n//  Backend-based share link \n\n/**\n * Create a shareable link by uploading encrypted data to the backend.\n * Returns a short URL like: https://jsonviz.online/draw#json=<id>,<key>\n */\nexport const createShareLink = async (elements: any[], appState: any): Promise<string> => {\n  const data = {\n    elements: elements.filter(el => !el.isDeleted).map(el => ({ ...el, isDeleted: undefined })),\n    appState: {\n      viewBackgroundColor: appState.viewBackgroundColor,\n      theme: appState.theme,\n    },\n  };\n\n  const jsonString = JSON.stringify(data);\n  const compressed = pako.deflate(new TextEncoder().encode(jsonString));\n\n  const { id, encryptionKey } = await exportToBackend(compressed);\n\n  // Key is stored in hash  never sent to server  end-to-end encrypted\n  const hash = `#json=${id},${encryptionKey}`;\n  return `${window.location.origin}${window.location.pathname}${hash}`;\n};\n\n/**\n * Load scene data from a share link.\n * Hash format: #json=<id>,<key>\n */\nexport const loadFromShareLink = async (\n  hash: string\n): Promise<{ elements: any[]; appState: any } | null> => {\n  const match = hash.match(/^#json=([a-zA-Z0-9_-]+),([a-zA-Z0-9_-]+)$/);\n  if (!match) return null;\n\n  const [, id, encryptionKey] = match;\n\n  const decrypted = await importFromBackend(id, encryptionKey);\n  if (!decrypted) return null;\n\n  try {\n    const jsonString = pako.inflate(decrypted, { to: \"string\" });\n    return JSON.parse(jsonString);\n  } catch (error) {\n    console.error(\"Failed to decompress share link data:\", error);\n    return null;\n  }\n};\n\n/**\n * Check if the current URL hash is a backend share link\n */\nexport const isBackendShareLink = (hash: string): boolean => {\n  return /^#json=([a-zA-Z0-9_-]+),([a-zA-Z0-9_-]+)$/.test(hash);\n};\n\n//  Legacy URL-based share link (backward compatibility) \n\n/**\n * Decode legacy #data= format (base64 in URL).\n * Kept for backward compatibility with old shared links.\n * @deprecated Use loadFromShareLink instead for new links.\n */\nexport const decodeDataFromUrlHash = (hash: string) => {\n  try {\n    let base64 = hash.replace(\"#data=\", \"\");\n\n    // Backward compatibility: try to decode legacy encodeURIComponent strings\n    try {\n      base64 = decodeURIComponent(base64);\n    } catch (e) {\n      // Ignore\n    }\n\n    // Convert from url-safe base64 to standard base64\n    base64 = base64.replace(/-/g, \"+\").replace(/_/g, \"/\");\n    // Restore padding if necessary\n    while (base64.length % 4) {\n      base64 += \"=\";\n    }\n\n    const binaryString = window.atob(base64);\n\n    const bytes = new Uint8Array(binaryString.length);\n    for (let i = 0; i < binaryString.length; i++) {\n      bytes[i] = binaryString.charCodeAt(i);\n    }\n\n    const decompressed = pako.inflate(bytes, { to: \"string\" });\n    return JSON.parse(decompressed);\n  } catch (error) {\n    console.error(\"Failed to decode legacy sharelink data\", error);\n    return null;\n  }\n};\n","import React from \"react\";\nimport {\n  Box,\n  LoadingOverlay,\n  Modal,\n  Text,\n  Stack,\n  Button,\n  TextInput,\n  ActionIcon,\n} from \"@mantine/core\";\nimport styled from \"styled-components\";\nimport { toast } from \"react-hot-toast\";\nimport { FiCopy, FiCheck, FiLock, FiX } from \"react-icons/fi\";\nimport useConfig from \"../../../../store/useConfig\";\nimport useGraph from \"../GraphView/stores/useGraph\";\nimport { LoadFromLinkDialog } from \"./LoadFromLinkDialog\";\nimport { jsonToJsonDrawElements } from \"./jsonToJsonDraw\";\nimport {\n  createShareLink,\n  loadFromShareLink,\n  isBackendShareLink,\n  decodeDataFromUrlHash,\n} from \"./shareLinkUtils\";\n\nconst StyledJsonDrawWrapper = styled.div<{ $ready: boolean }>`\n  width: 100%;\n  height: 100%;\n  position: relative;\n  opacity: ${({ $ready }) => ($ready ? 1 : 0)};\n  transition: opacity 0.2s ease;\n\n  .jsondraw-wrapper {\n    width: 100%;\n    height: 100%;\n  }\n`;\n\nexport const JsonDrawView = () => {\n  const nodes = useGraph(state => state.nodes);\n  const edges = useGraph(state => state.edges);\n  const darkmodeEnabled = useConfig(state => state.darkmodeEnabled);\n\n  const [JsonDrawModule, setJsonDrawModule] = React.useState<{\n    JsonDraw: React.ComponentType<any>;\n  } | null>(null);\n  const [drawReady, setDrawReady] = React.useState(false);\n\n  const jsonDrawAPIRef = React.useRef<any>(null);\n  const hasInitialized = React.useRef(false);\n  const hasUserDrawing = React.useRef(false);\n  const [showClearModal, setShowClearModal] = React.useState(false);\n\n  // Share Modal states\n  const [showShareModal, setShowShareModal] = React.useState(false);\n  const [shareUrl, setShareUrl] = React.useState(\"\");\n  const [justCopied, setJustCopied] = React.useState(false);\n  const [isSharing, setIsSharing] = React.useState(false);\n  const copyTimerRef = React.useRef<number | null>(null);\n\n  // Load from link dialog states\n  const [showLoadFromLinkDialog, setShowLoadFromLinkDialog] = React.useState(false);\n  const pendingShareDataRef = React.useRef<{ elements: any[]; appState: any } | null>(null);\n\n  // Auto-save to localStorage\n  const handleChange = React.useCallback((elements: any, appState: any, files: any) => {\n    hasUserDrawing.current = true;\n\n    try {\n      localStorage.setItem(\n        \"jsondraw-autosave\",\n        JSON.stringify({ elements, appState: { theme: appState.theme, zoom: appState.zoom } })\n      );\n    } catch (error) {\n      console.warn(\"Failed to save to localStorage:\", error);\n    }\n  }, []);\n\n  // Set font asset path before loading JsonDraw\n  React.useEffect(() => {\n    if (typeof window !== \"undefined\") {\n      window.JSONDRAW_ASSET_PATH = \"/jsondraw-fonts/\";\n    }\n  }, []);\n\n  // Dynamic import to avoid SSR issues (Canvas API is client-only)\n  React.useEffect(() => {\n    import(\"../../../../jsondraw\").then(mod => {\n      setJsonDrawModule({ JsonDraw: mod.JsonDraw });\n      setDrawReady(false);\n    });\n  }, []);\n\n  const scrollToContent = React.useCallback((api: any, delay = 120) => {\n    requestAnimationFrame(() => {\n      setTimeout(() => {\n        api.scrollToContent(undefined, { fitToViewport: true, viewportZoomFactor: 0.8 });\n        setDrawReady(true);\n      }, delay);\n    });\n  }, []);\n\n  // Apply shared data to the scene (called after user confirms or if canvas is empty)\n  const applySharedData = React.useCallback(\n    (data: { elements: any[]; appState: any }) => {\n      const api = jsonDrawAPIRef.current;\n      if (!api) return;\n\n      hasUserDrawing.current = true;\n      hasInitialized.current = true;\n      setDrawReady(false);\n\n      requestAnimationFrame(() => {\n        api.updateScene({ elements: data.elements, appState: data.appState });\n        scrollToContent(api, 120);\n      });\n\n      // Clean up the URL hash without reloading\n      window.history.replaceState({}, \"\", window.location.pathname);\n    },\n    [scrollToContent]\n  );\n\n  // Handle replace action from LoadFromLinkDialog\n  const handleReplaceContent = React.useCallback(() => {\n    const data = pendingShareDataRef.current;\n    if (!data) return;\n\n    applySharedData(data);\n    pendingShareDataRef.current = null;\n    setShowLoadFromLinkDialog(false);\n    toast.success(\"Drawing loaded from shared link!\");\n  }, [applySharedData]);\n\n  // Handle save to disk\n  const handleSaveToDisk = React.useCallback(() => {\n    const api = jsonDrawAPIRef.current;\n    if (!api) return;\n\n    try {\n      const elements = api.getSceneElementsIncludingDeleted();\n      const appState = api.getAppState();\n      const data = JSON.stringify({ elements, appState }, null, 2);\n      const blob = new Blob([data], { type: \"application/json\" });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement(\"a\");\n      a.href = url;\n      a.download = `jsondraw-backup-${Date.now()}.json`;\n      a.click();\n      URL.revokeObjectURL(url);\n      toast.success(\"Drawing saved to disk!\");\n    } catch (error) {\n      toast.error(\"Failed to save drawing.\");\n    }\n  }, []);\n\n  // Update scene elements when nodes/edges change AFTER API is ready\n  // BUT only if user hasn't drawn anything yet\n  React.useEffect(() => {\n    const api = jsonDrawAPIRef.current;\n    if (!api || nodes.length === 0 || hasUserDrawing.current) return;\n\n    const elements = jsonToJsonDrawElements(nodes, edges);\n    api.updateScene({ elements });\n    scrollToContent(api, 80);\n  }, [nodes, edges, scrollToContent]);\n\n  const handleJsonDrawAPI = React.useCallback(\n    (api: any) => {\n      jsonDrawAPIRef.current = api;\n\n      if (typeof window === \"undefined\") return;\n\n      const hash = window.location.hash;\n\n      //  Backend share link: #json=<id>,<key> \n      if (isBackendShareLink(hash)) {\n        setDrawReady(false);\n        loadFromShareLink(hash)\n          .then(data => {\n            if (!data || !data.elements) {\n              toast.error(\"Could not load shared drawing. The link may be invalid or expired.\");\n              // Fall through to normal init\n              initFromLocalOrJson(api);\n              return;\n            }\n\n            // Check if there's existing content\n            const saved = localStorage.getItem(\"jsondraw-autosave\");\n            const hasExistingContent = saved && JSON.parse(saved).elements?.length > 0;\n\n            if (hasExistingContent) {\n              // Show confirmation dialog\n              pendingShareDataRef.current = data;\n              setShowLoadFromLinkDialog(true);\n              // Still show current drawing while dialog is open\n              initFromLocalOrJson(api);\n            } else {\n              // No existing content  load directly\n              applySharedData(data);\n            }\n          })\n          .catch(err => {\n            console.error(\"Failed to load share link:\", err);\n            toast.error(\"Failed to load shared drawing.\");\n            initFromLocalOrJson(api);\n          });\n        return;\n      }\n\n      //  Legacy share link: #data=... (backward compatibility) \n      if (hash.startsWith(\"#data=\")) {\n        const decoded = decodeDataFromUrlHash(hash);\n        if (decoded && decoded.elements) {\n          // Check if there's existing content\n          const saved = localStorage.getItem(\"jsondraw-autosave\");\n          const hasExistingContent = saved && JSON.parse(saved).elements?.length > 0;\n\n          if (hasExistingContent) {\n            pendingShareDataRef.current = decoded;\n            setShowLoadFromLinkDialog(true);\n            initFromLocalOrJson(api);\n          } else {\n            applySharedData(decoded);\n          }\n          return;\n        }\n      }\n\n      //  Normal initialization \n      initFromLocalOrJson(api);\n    },\n    [nodes, edges, scrollToContent, applySharedData]\n  );\n\n  // Helper: Initialize from localStorage or JSON data\n  const initFromLocalOrJson = React.useCallback(\n    (api: any) => {\n      // Try to restore from localStorage first\n      const saved = localStorage.getItem(\"jsondraw-autosave\");\n      if (saved) {\n        try {\n          const { elements, appState } = JSON.parse(saved);\n          hasUserDrawing.current = true;\n          setDrawReady(false);\n          requestAnimationFrame(() => {\n            api.updateScene({ elements, appState });\n            scrollToContent(api, 120);\n          });\n          return;\n        } catch (error) {\n          console.warn(\"Failed to restore from localStorage:\", error);\n        }\n      }\n\n      // Set initial elements from JSON only if no saved drawing\n      if (nodes.length > 0 && !hasInitialized.current) {\n        hasInitialized.current = true;\n        const elements = jsonToJsonDrawElements(nodes, edges);\n        setDrawReady(false);\n\n        requestAnimationFrame(() => {\n          api.updateScene({ elements });\n          scrollToContent(api, 200);\n        });\n      }\n    },\n    [nodes, edges, scrollToContent]\n  );\n\n  const handleClearDrawing = React.useCallback(() => {\n    if (!jsonDrawAPIRef.current) return;\n\n    localStorage.removeItem(\"jsondraw-autosave\");\n    hasUserDrawing.current = false;\n    hasInitialized.current = false;\n\n    const elements = jsonToJsonDrawElements(nodes, edges);\n    jsonDrawAPIRef.current.updateScene({ elements });\n    setDrawReady(false);\n    scrollToContent(jsonDrawAPIRef.current, 120);\n\n    setShowClearModal(false);\n    toast.success(\"Drawing cleared! Loaded JSON visualization.\");\n  }, [nodes, edges, scrollToContent]);\n\n  const handleCopyLink = React.useCallback(() => {\n    navigator.clipboard\n      .writeText(shareUrl)\n      .then(() => {\n        setJustCopied(true);\n        if (copyTimerRef.current) window.clearTimeout(copyTimerRef.current);\n        copyTimerRef.current = window.setTimeout(() => setJustCopied(false), 3000) as any;\n      })\n      .catch(() => toast.error(\"Failed to copy link.\"));\n  }, [shareUrl]);\n\n  const handleShareClick = React.useCallback(async () => {\n    const api = jsonDrawAPIRef.current;\n    if (!api) return;\n\n    setIsSharing(true);\n    try {\n      const elements = api.getSceneElementsIncludingDeleted();\n      const appState = api.getAppState();\n\n      const url = await createShareLink(elements, appState);\n      setShareUrl(url);\n      setShowShareModal(true);\n    } catch (error: any) {\n      console.error(\"Share failed:\", error);\n      toast.error(\"Failed to create share link. Please try again.\");\n    } finally {\n      setIsSharing(false);\n    }\n  }, []);\n\n  if (!JsonDrawModule) {\n    return (\n      <Box pos=\"relative\" h=\"100%\" w=\"100%\">\n        <LoadingOverlay visible />\n      </Box>\n    );\n  }\n\n  const { JsonDraw } = JsonDrawModule;\n\n  return (\n    <Box pos=\"relative\" h=\"100%\" w=\"100%\">\n      <LoadingOverlay visible={!drawReady} />\n\n      {/* Clear Drawing Modal */}\n      <Modal\n        opened={showClearModal}\n        onClose={() => setShowClearModal(false)}\n        title=\"Clear Drawing Session\"\n        centered\n      >\n        <Stack gap=\"md\">\n          <Text>\n            This will <strong>permanently delete</strong> your current drawing session and load a\n            fresh visualization from the JSON data.\n          </Text>\n          <Text c=\"dimmed\" size=\"sm\">\n            Make sure to save your work first. Your current drawing will be lost and cannot be\n            recovered.\n          </Text>\n          <Box style={{ display: \"flex\", gap: \"8px\", justifyContent: \"flex-end\" }}>\n            <Button variant=\"default\" onClick={() => setShowClearModal(false)}>\n              Cancel\n            </Button>\n            <Button color=\"red\" onClick={handleClearDrawing}>\n              Clear & Load JSON\n            </Button>\n          </Box>\n        </Stack>\n      </Modal>\n\n      {/* Share Link Modal */}\n      <Modal\n        opened={showShareModal}\n        onClose={() => setShowShareModal(false)}\n        title={null}\n        withCloseButton={false}\n        centered\n        size=\"md\"\n        padding=\"xl\"\n        radius=\"lg\"\n        styles={{\n          content: {\n            backgroundColor: darkmodeEnabled ? \"#121212\" : \"#ffffff\",\n          },\n        }}\n      >\n        <Stack gap=\"lg\">\n          <Box style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\" }}>\n            <Text fw={700} size=\"xl\" style={{ fontFamily: \"Assistant, sans-serif\" }}>\n              Shareable link\n            </Text>\n            <ActionIcon variant=\"subtle\" color=\"gray\" onClick={() => setShowShareModal(false)}>\n              <FiX size={20} />\n            </ActionIcon>\n          </Box>\n          <Box style={{ display: \"flex\", gap: \"12px\", alignItems: \"flex-end\" }}>\n            <TextInput\n              label=\"Link\"\n              readOnly\n              value={shareUrl}\n              style={{ flex: 1 }}\n              styles={{\n                input: {\n                  backgroundColor: darkmodeEnabled ? \"rgba(255,255,255,0.05)\" : \"#f3f4f6\",\n                  border: \"none\",\n                  boxShadow: \"none\",\n                  height: 40,\n                },\n                label: {\n                  marginBottom: 8,\n                  fontSize: 12,\n                  fontWeight: 600,\n                  color: darkmodeEnabled ? \"#a3a3a3\" : \"#4b5563\",\n                },\n              }}\n              onClick={e => (e.target as HTMLInputElement).select()}\n            />\n            <Button\n              size=\"md\"\n              leftSection={justCopied ? <FiCheck size={18} /> : <FiCopy size={18} />}\n              color={justCopied ? \"teal\" : \"violet\"}\n              onClick={handleCopyLink}\n              style={{\n                height: 40,\n                minWidth: 120,\n                transition: \"background-color 0.2s\",\n              }}\n            >\n              Copy link\n            </Button>\n          </Box>\n          <Box\n            style={{\n              borderTop: `1px solid ${darkmodeEnabled ? \"#333\" : \"#e5e7eb\"}`,\n              paddingTop: 16,\n            }}\n          >\n            <Text\n              size=\"sm\"\n              c=\"dimmed\"\n              style={{ display: \"flex\", alignItems: \"center\", gap: \"8px\" }}\n            >\n              <FiLock size={16} /> D liu c m ha u-cui. Ch ngi c link mi xem c.\n            </Text>\n          </Box>\n        </Stack>\n      </Modal>\n\n      {/* Load from Link Confirmation Dialog */}\n      <LoadFromLinkDialog\n        opened={showLoadFromLinkDialog}\n        darkMode={darkmodeEnabled}\n        onReplace={handleReplaceContent}\n        onClose={() => {\n          setShowLoadFromLinkDialog(false);\n          pendingShareDataRef.current = null;\n          // Clean URL\n          window.history.replaceState({}, \"\", window.location.pathname);\n        }}\n        onSaveToDisk={handleSaveToDisk}\n      />\n\n      <StyledJsonDrawWrapper $ready={drawReady}>\n        <div className=\"jsondraw-wrapper\">\n          <JsonDraw\n            jsondrawAPI={handleJsonDrawAPI}\n            onChange={handleChange}\n            viewModeEnabled={false}\n            zenModeEnabled={false}\n            gridModeEnabled={false}\n            theme={darkmodeEnabled ? \"dark\" : \"light\"}\n            UIOptions={{\n              canvasActions: {\n                export: { saveFileToDisk: true },\n                clearDrawing: () => setShowClearModal(true),\n              },\n            }}\n            initialData={{\n              appState: {\n                activeTool: {\n                  type: \"hand\",\n                  customType: null,\n                  lastActiveTool: null,\n                  locked: false,\n                  fromSelection: false,\n                },\n              },\n            }}\n            renderTopRightUI={(isMobile: boolean) => (\n              <Box px=\"md\">\n                <Button\n                  size=\"sm\"\n                  color=\"violet\"\n                  loading={isSharing}\n                  onClick={handleShareClick}\n                  title=\"To link chia s min ph (m ha u-cui)\"\n                >\n                  Share View\n                </Button>\n              </Box>\n            )}\n          />\n        </div>\n      </StyledJsonDrawWrapper>\n    </Box>\n  );\n};\n","import React from \"react\";\nimport type { DefaultTheme } from \"styled-components\";\nimport { styled } from \"styled-components\";\nimport type { KeyPath } from \"react-json-tree\";\n\ninterface LabelProps {\n  keyPath: KeyPath;\n  nodeType: string;\n}\n\nfunction getLabelColor({ $type, theme }: { $type?: string; theme: DefaultTheme }) {\n  if ($type === \"Object\") return theme.NODE_COLORS.PARENT_OBJ;\n  if ($type === \"Array\") return theme.NODE_COLORS.PARENT_ARR;\n  return theme.NODE_COLORS.PARENT_OBJ;\n}\n\nconst StyledLabel = styled.span<{ $nodeType?: string }>`\n  color: ${({ theme, $nodeType }) => getLabelColor({ theme, $type: $nodeType })};\n\n  &:hover {\n    filter: brightness(1.5);\n    transition: filter 0.2s ease-in-out;\n  }\n`;\n\nexport const Label = ({ keyPath, nodeType }: LabelProps) => {\n  return <StyledLabel $nodeType={nodeType}>{keyPath[0]}:</StyledLabel>;\n};\n","import React from \"react\";\nimport type { DefaultTheme } from \"styled-components\";\nimport { useTheme } from \"styled-components\";\nimport { TextRenderer } from \"../GraphView/CustomNode/TextRenderer\";\n\ntype TextColorFn = {\n  theme: DefaultTheme;\n  $value?: string | unknown;\n};\n\nfunction getValueColor({ $value, theme }: TextColorFn) {\n  if ($value && !Number.isNaN(+$value)) return theme.NODE_COLORS.INTEGER;\n  if ($value === \"true\") return theme.NODE_COLORS.BOOL.TRUE;\n  if ($value === \"false\") return theme.NODE_COLORS.BOOL.FALSE;\n  if ($value === \"null\") return theme.NODE_COLORS.NULL;\n\n  // default\n  return theme.NODE_COLORS.NODE_VALUE;\n}\n\ninterface ValueProps {\n  valueAsString: unknown;\n  value: unknown;\n}\n\nexport const Value = (props: ValueProps) => {\n  const theme = useTheme();\n  const { valueAsString, value } = props;\n\n  return (\n    <span\n      style={{\n        color: getValueColor({\n          theme,\n          $value: valueAsString,\n        }),\n      }}\n    >\n      <TextRenderer>{JSON.stringify(value)}</TextRenderer>\n    </span>\n  );\n};\n","import React from \"react\";\nimport { useTheme } from \"styled-components\";\nimport { JSONTree } from \"react-json-tree\";\nimport useJson from \"../../../../store/useJson\";\nimport { Label } from \"./Label\";\nimport { Value } from \"./Value\";\n\nexport const TreeView = () => {\n  const theme = useTheme();\n  const json = useJson(state => state.json);\n\n  return (\n    <JSONTree\n      hideRoot\n      data={JSON.parse(json)}\n      valueRenderer={(valueAsString, value) => <Value {...{ valueAsString, value }} />}\n      labelRenderer={(keyPath, nodeType) => <Label {...{ keyPath, nodeType }} />}\n      theme={{\n        extend: {\n          overflow: \"scroll\",\n          height: \"100%\",\n          scheme: \"monokai\",\n          author: \"wimer hazenberg (http://www.monokai.nl)\",\n          base00: theme.GRID_BG_COLOR,\n        },\n      }}\n    />\n  );\n};\n","import React from \"react\";\nimport { useSessionStorage } from \"@mantine/hooks\";\nimport styled from \"styled-components\";\nimport { ViewMode } from \"../../enums/viewMode.enum\";\nimport { JsonDrawView } from \"./views/JsonDrawView\";\nimport { GraphView } from \"./views/GraphView\";\nimport { TreeView } from \"./views/TreeView\";\n\nconst StyledLiveEditor = styled.div`\n  position: relative;\n  height: 100%;\n  background: ${({ theme }) => theme.GRID_BG_COLOR};\n  overflow: auto;\n  cursor: url(\"/assets/cursor.svg\"), auto;\n\n  & > ul {\n    margin-top: 0 !important;\n    padding: 12px !important;\n    font-family: monospace;\n    font-size: 14px;\n    font-weight: 500;\n  }\n\n  .tab-group {\n    position: absolute;\n    top: 10px;\n    left: 10px;\n    z-index: 2;\n  }\n`;\n\nconst View = () => {\n  const [viewMode] = useSessionStorage({\n    key: \"viewMode\",\n    defaultValue: ViewMode.Graph,\n  });\n\n  if (viewMode === ViewMode.Graph) return <GraphView />;\n  if (viewMode === ViewMode.Tree) return <TreeView />;\n  if (viewMode === ViewMode.JsonDraw) return <JsonDrawView />;\n  return null;\n};\n\nconst LiveEditor = () => {\n  return (\n    <StyledLiveEditor onContextMenuCapture={e => e.preventDefault()}>\n      <View />\n    </StyledLiveEditor>\n  );\n};\n\nexport default LiveEditor;\n","import { degreesToRadians } from \"./angle\";\nimport { PRECISION } from \"./utils\";\nimport { vectorFromPoint, vectorScale } from \"./vector\";\n\nimport type {\n  LocalPoint,\n  GlobalPoint,\n  Radians,\n  Degrees,\n  Vector,\n} from \"./types\";\n\n/**\n * Create a properly typed Point instance from the X and Y coordinates.\n *\n * @param x The X coordinate\n * @param y The Y coordinate\n * @returns The branded and created point\n */\nexport function pointFrom<Point extends GlobalPoint | LocalPoint>(\n  x: number,\n  y: number,\n): Point {\n  return [x, y] as Point;\n}\n\n/**\n * Converts and remaps an array containing a pair of numbers to Point.\n *\n * @param numberArray The number array to check and to convert to Point\n * @returns The point instance\n */\nexport function pointFromArray<Point extends GlobalPoint | LocalPoint>(\n  numberArray: number[],\n): Point | undefined {\n  return numberArray.length === 2\n    ? pointFrom<Point>(numberArray[0], numberArray[1])\n    : undefined;\n}\n\n/**\n * Converts and remaps a pair of numbers to Point.\n *\n * @param pair A number pair to convert to Point\n * @returns The point instance\n */\nexport function pointFromPair<Point extends GlobalPoint | LocalPoint>(\n  pair: [number, number],\n): Point {\n  return pair as Point;\n}\n\n/**\n * Convert a vector to a point.\n *\n * @param v The vector to convert\n * @returns The point the vector points at with origin 0,0\n */\nexport function pointFromVector<P extends GlobalPoint | LocalPoint>(\n  v: Vector,\n  offset: P = pointFrom(0, 0),\n): P {\n  return pointFrom<P>(offset[0] + v[0], offset[1] + v[1]);\n}\n\n/**\n * Checks if the provided value has the shape of a Point.\n *\n * @param p The value to attempt verification on\n * @returns TRUE if the provided value has the shape of a local or global point\n */\nexport function isPoint(p: unknown): p is LocalPoint | GlobalPoint {\n  return (\n    Array.isArray(p) &&\n    p.length === 2 &&\n    typeof p[0] === \"number\" &&\n    !isNaN(p[0]) &&\n    typeof p[1] === \"number\" &&\n    !isNaN(p[1])\n  );\n}\n\n/**\n * Compare two points coordinate-by-coordinate and if\n * they are closer than INVERSE_PRECISION it returns TRUE.\n *\n * @param a Point The first point to compare\n * @param b Point The second point to compare\n * @returns TRUE if the points are sufficiently close to each other\n */\nexport function pointsEqual<Point extends GlobalPoint | LocalPoint>(\n  a: Point,\n  b: Point,\n  tolerance: number = PRECISION,\n): boolean {\n  const abs = Math.abs;\n  return abs(a[0] - b[0]) < tolerance && abs(a[1] - b[1]) < tolerance;\n}\n\n/**\n * Rotate a point by [angle] radians.\n *\n * @param point The point to rotate\n * @param center The point to rotate around, the center point\n * @param angle The radians to rotate the point by\n * @returns The rotated point\n */\nexport function pointRotateRads<Point extends GlobalPoint | LocalPoint>(\n  [x, y]: Point,\n  [cx, cy]: Point,\n  angle: Radians,\n): Point {\n  return pointFrom(\n    (x - cx) * Math.cos(angle) - (y - cy) * Math.sin(angle) + cx,\n    (x - cx) * Math.sin(angle) + (y - cy) * Math.cos(angle) + cy,\n  );\n}\n\n/**\n * Rotate a point by [angle] degree.\n *\n * @param point The point to rotate\n * @param center The point to rotate around, the center point\n * @param angle The degree to rotate the point by\n * @returns The rotated point\n */\nexport function pointRotateDegs<Point extends GlobalPoint | LocalPoint>(\n  point: Point,\n  center: Point,\n  angle: Degrees,\n): Point {\n  return pointRotateRads(point, center, degreesToRadians(angle));\n}\n\n/**\n * Translate a point by a vector.\n *\n * WARNING: This is not for translating JsonDraw element points!\n *          You need to account for rotation on base coordinates\n *          on your own.\n *          CONSIDER USING AN APPROPRIATE ELEMENT-AWARE TRANSLATE!\n *\n * @param p The point to apply the translation on\n * @param v The vector to translate by\n * @returns\n */\n// TODO 99% of use is translating between global and local coords, which need to be formalized\nexport function pointTranslate<\n  From extends GlobalPoint | LocalPoint,\n  To extends GlobalPoint | LocalPoint,\n>(p: From, v: Vector = [0, 0] as Vector): To {\n  return pointFrom(p[0] + v[0], p[1] + v[1]);\n}\n\n/**\n * Find the center point at equal distance from both points.\n *\n * @param a One of the points to create the middle point for\n * @param b The other point to create the middle point for\n * @returns The middle point\n */\nexport function pointCenter<P extends LocalPoint | GlobalPoint>(a: P, b: P): P {\n  return pointFrom((a[0] + b[0]) / 2, (a[1] + b[1]) / 2);\n}\n\n/**\n * Calculate the distance between two points.\n *\n * @param a First point\n * @param b Second point\n * @returns The euclidean distance between the two points.\n */\nexport function pointDistance<P extends LocalPoint | GlobalPoint>(\n  a: P,\n  b: P,\n): number {\n  return Math.hypot(b[0] - a[0], b[1] - a[1]);\n}\n\n/**\n * Calculate the squared distance between two points.\n *\n * Note: Use this if you only compare distances, it saves a square root.\n *\n * @param a First point\n * @param b Second point\n * @returns The euclidean distance between the two points.\n */\nexport function pointDistanceSq<P extends LocalPoint | GlobalPoint>(\n  a: P,\n  b: P,\n): number {\n  const xDiff = b[0] - a[0];\n  const yDiff = b[1] - a[1];\n\n  return xDiff * xDiff + yDiff * yDiff;\n}\n\n/**\n * Scale a point from a given origin by the multiplier.\n *\n * @param p The point to scale\n * @param mid The origin to scale from\n * @param multiplier The scaling factor\n * @returns\n */\nexport const pointScaleFromOrigin = <P extends GlobalPoint | LocalPoint>(\n  p: P,\n  mid: P,\n  multiplier: number,\n) => pointTranslate(mid, vectorScale(vectorFromPoint(p, mid), multiplier));\n\n/**\n * Returns whether `q` lies inside the segment/rectangle defined by `p` and `r`.\n * This is an approximation to \"does `q` lie on a segment `pr`\" check.\n *\n * @param p The first point to compare against\n * @param q The actual point this function checks whether is in between\n * @param r The other point to compare against\n * @returns TRUE if q is indeed between p and r\n */\nexport const isPointWithinBounds = <P extends GlobalPoint | LocalPoint>(\n  p: P,\n  q: P,\n  r: P,\n) => {\n  return (\n    q[0] <= Math.max(p[0], r[0]) &&\n    q[0] >= Math.min(p[0], r[0]) &&\n    q[1] <= Math.max(p[1], r[1]) &&\n    q[1] >= Math.min(p[1], r[1])\n  );\n};\n"],"names":["vector","x","y","originX","originY","vectorFromPoint","p","origin","threshold","defaultValue","vec","vectorMagnitudeSq","vectorCross","a","b","vectorDot","vectorAdd","vectorSubtract","start","end","vectorScale","v","scalar","vectorNormalize","m","Math","vectorMagnitude","sqrt","normalizeRadians","angle","PI","degreesToRadians","degrees","radiansToDegrees","isRightAngleRads","rads","abs","sin","PRECISION","radiansBetweenAngles","min","max","radiansDifference","diff","LegendreGaussN24TValues","curve","c","d","bezierEquation","t","pointFrom","calculate","t0","s0","l","solution","solveWithAnalyticalJacobian","lineSegment","tolerance","iterLimit","error","Infinity","iter","bt","bt2","bt3","t0_2","t0_3","bezierX","bezierY","lineX","lineY","fx","fy","dfx_dt","dfy_dt","dfx_ds","dfy_ds","det","invDet","dt","ds","s","curveIntersectLineSegment","initial_guesses","curvePointDistance","closest","curveClosestPoint","closestStep","step","maxSteps","pointDistance","localMinimum","f","e","t1","k","n","curveTangent","p0","p1","p2","p3","curveCatmullRomCubicApproxPoints","points","tension","length","pointSets","i","tangent1","tangent2","cp1x","cp1y","cp2x","cp2y","push","curveOffsetPoints","offset","steps","offsetPoints","point","tangent","normal","vectorNormal","pointFromVector","curveLength","sum","derivativeVector","z2","magnitude","LegendreGaussN24CValues","curvePointAtLength","percent","totalLength","targetLength","tMin","tMax","currentLength","iteration","maxIterations","curveLengthAtParameter","z1","parameter","polygon","polygonClose","polygonFromPoints","polygonIncludesPointNonZero","windingNumber","j","xi","yi","xj","yj","polygonIsClosed","pointsEqual","rangeInclusive","toBrandedType","rangesOverlap","a0","a1","b0","b1","rangeIntersection","rangeStart","rangeEnd","value","rectangle","topLeft","bottomRight","pointOnLineSegment","line","distance","distanceToLineSegment","xx","yy","x1","y1","x2","y2","C","D","len_sq","param","dot","A","B","dx","dy","lineSegmentIntersectionPoints","candidate","linesIntersectAt","A1","B1","A2","B2","C1","C2","lineSegmentsDistance","s1","s2","triangleIncludesPoint","triangleSign","d1","d2","d3","has_neg","has_pos","clamp","round","precision","func","multiplier","pow","Number","EPSILON","factor","isFinite","isCloseTo","BinaryHeap","scoreFunction","content","sinkDown","idx","node","nodeScore","parentN","parent","bubbleUp","score","child1N","child2N","smallestIdx","smallestScore","child1Score","pop","result","remove","indexOf","size","rescoreElement","EVENT","UserIdleState","DARK_MODE_COLORS_CACHE","Map","applyDarkModeFilter","green","g","matrix","cached","get","color","tc","tinycolor","alpha","getAlpha","rgb","toRgb","inverted","r","cssInvert","invertedR","invertComponent","invertedG","invertedB","rotated","red","cssHueRotate","blue","cos","newR","newG","newB","rgbToHex","set","COLOR_PALETTE","transparent","black","white","gray","pink","grape","violet","cyan","teal","yellow","orange","bronze","COMMON_ELEMENT_SHADES","keys","pick","reduce","acc","key","source","DEFAULT_ELEMENT_STROKE_PICKS","DEFAULT_ELEMENT_STROKE_COLOR_INDEX","DEFAULT_ELEMENT_BACKGROUND_PICKS","DEFAULT_ELEMENT_BACKGROUND_COLOR_INDEX","index","hex6","toString","slice","undefined","alphaHex","padStart","COLOR_OUTLINE_CONTRAST_THRESHOLD","isColorDark","isTransparent","isValid","calculateContrast","trim","getFormat","startsWith","window","LINE_CONFIRM_THRESHOLD","ELEMENT_SHIFT_TRANSLATE_AMOUNT","TEXT","CROSSHAIR","GRABBING","GRAB","POINTER","MOVE","AUTO","MAIN","WHEEL","SECONDARY","TOUCH","ERASER","enabled","disabled","inheritFromUI","YOUTUBE_STATES","UNSTARTED","ENDED","PLAYING","PAUSED","BUFFERING","CUED","SIDEBAR","SHAPE_ACTIONS_MENU","ZOOM_ACTIONS","SEARCH_MENU_INPUT_WRAPPER","CONVERT_ELEMENT_TYPE_POPUP","SHAPE_ACTIONS_THEME_SCOPE","FRAME_NAME","DROPDOWN_MENU_EVENT_WRAPPER","sm","md","lg","xl","Virgil","Helvetica","Cascadia","Excalifont","Nunito","Assistant","CJK_HAND_DRAWN_FALLBACK_FONT","SANS_SERIF_GENERIC_FONT","MONOSPACE_GENERIC_FONT","WINDOWS_EMOJI_FALLBACK_FONT","FONT_FAMILY_GENERIC_FALLBACKS","genericFallbackFont","getGenericFontFamilyFallback","fontFamily","FONT_FAMILY","LIGHT","DARK","strokeColor","strokeWidth","strokeStyle","fillStyle","roughness","roundness","backgroundColor","radius","nameOffsetY","nameColorLightTheme","nameColorDarkTheme","nameFontSize","nameLineHeight","DEFAULT_TEXT_ALIGN","DEFAULT_COLLISION_THRESHOLD","DEFAULT_TRANSFORM_HANDLE_SPACING","SIDE_RESIZING_THRESHOLD","COLOR_WHITE","COLOR_CHARCOAL_BLACK","svg","png","jpg","gif","webp","bmp","ico","avif","jfif","MIME_TYPES","text","html","json","jsondraw","jsondrawClipboard","jsondrawlib","jsondrawlibIds","binary","IMAGE_MIME_TYPES","Object","values","clipboard","jsondrawLibrary","jsondrawClipboardWithAPI","JSONDRAW_EXPORT_SOURCE","location","IMAGE_RENDER_TIMEOUT","TAP_TWICE_TIMEOUT","SCROLL_TIMEOUT","ZOOM_STEP","MIN_ZOOM","MAX_ZOOM","canvasActions","changeViewBackgroundColor","clearCanvas","export","saveFileToDisk","loadScene","saveToActiveFile","toggleTheme","saveAsImage","tools","image","DEFAULT_EXPORT_PADDING","SVG_NS","ARROW_LABEL_FONT_SIZE_TO_MIN_WIDTH_RATIO","VERTICAL_ALIGN","TOP","MIDDLE","BOTTOM","LEFT","CENTER","RIGHT","DEFAULT_ADAPTIVE_RADIUS","LEGACY","PROPORTIONAL_RADIUS","ADAPTIVE_RADIUS","architect","artist","cartoonist","thin","bold","extraBold","ROUGHNESS","opacity","locked","CANVAS_SEARCH_TAB","name","defaultTab","LIBRARY_SIDEBAR_TAB","Set","selection","lasso","diamond","ellipse","arrow","freedraw","eraser","hand","frame","magicframe","embeddable","laser","OAI_API_KEY","MERMAID_TO_JSONDRAW","PUBLISH_LIBRARY","generalStats","elementProperties","MIN_WIDTH_OR_HEIGHT","sharp","elbow","ELEMENT_LINK_KEY","Symbol","for","LINE_POLYGON_POINT_MERGE_DISTANCE","DOUBLE_TAP_POSITION_THRESHOLD","background","metrics","unitsPerEm","ascender","descender","lineHeight","deprecated","local","private","FONT_FAMILY_FALLBACKS","Xiaolai","fallback","GOOGLE_FONTS_RANGES","LATIN","LATIN_EXT","CYRILIC_EXT","CYRILIC","VIETNAMESE","fontSize","lineHeightPx","FONT_METADATA","fontSizeEm","getLineHeight","Queue","tick","running","job","jobs","shift","promise","resolve","promiseTry","jobFactory","args","finally","resolvablePromise","DESKTOP_UI_MODE_STORAGE_KEY","MQ_MIN_WIDTH_DESKTOP","test","navigator","platform","isAndroid","userAgent","isSafari","isIOS","includes","document","brave","isBrave","editorWidth","editorHeight","maxSide","width","isMobileBreakpoint","height","MQ_MAX_MOBILE","MQ_MAX_WIDTH_LANDSCAPE","minSide","isTabletBreakpoint","MQ_MIN_TABLET","editorInterface","formFactor","desktopUIMode","createUserAgentDescriptor","userAgentString","isMobileDevice","isMobileOrTablet","ua","uaData","userAgentData","plat","toLowerCase","mobile","matchMedia","matches","isDesktopOS","isAndroidPhone","isAndroidTablet","stored","localStorage","getItem","setDesktopUIMode","mode","setItem","CODES","EQUAL","MINUS","NUM_ADD","NUM_SUBTRACT","NUM_ZERO","BRACKET_RIGHT","BRACKET_LEFT","ONE","TWO","THREE","NINE","QUOTE","ZERO","SLASH","H","V","Z","Y","R","S","ARROW_DOWN","ARROW_LEFT","ARROW_RIGHT","ARROW_UP","PAGE_UP","PAGE_DOWN","BACKSPACE","ALT","CTRL_OR_CMD","isDarwin","DELETE","ENTER","ESCAPE","QUESTION_MARK","SPACE","TAB","CHEVRON_LEFT","CHEVRON_RIGHT","PERIOD","COMMA","SUBTRACT","E","F","G","I","L","O","P","Q","T","X","K","W","KeyCodeMap","KEYS","event","code","Boolean","isLatinChar","altKey","shiftKey","shouldRotateWithDiscreteAngle","xs","map","ys","dimension","newSize","normalize","coordinates","maxCoordinate","minCoordinate","scale","nextMinCoordinate","scaledPoints","newCoordinate","newPoint","translation","pointFromPair","scaledPoint","currentDimension","gridSize","PromisePool","concurrency","entries","pool","Pool","all","listener","data","addEventListener","then","setTimeout","removeEventListener","getDateTime","date","Date","year","getFullYear","month","getMonth","day","getDate","hr","getHours","getMinutes","str","charAt","toUpperCase","target","HTMLElement","className","isInputLike","dataset","type","HTMLBRElement","HTMLInputElement","HTMLTextAreaElement","HTMLSelectElement","Element","isWritableElement","getFontFamilyString","fontFamilyString","id","getFontFamilyFallbacks","nextAnimationFrame","cb","requestAnimationFrame","fn","timeout","handle","lastArgs","ret","clearTimeout","flush","_lastArgs","cancel","opts","timerId","lastArgsTrailing","scheduleFunc","trailing","cancelAnimationFrame","easeOutInterpolate","from","to","progress","easeOut","easeToValuesRAF","fromValues","toValues","onStep","duration","interpolateValue","onStart","onEnd","onCancel","startTime","canceled","frameId","timestamp","elapsed","newValues","forEach","_key","startValue","endValue","array","resIndex","Array","ceil","updateActiveTool","appState","activeTool","customType","lastActiveTool","lastActiveToolBeforeEraser","fromSelection","viewportCoordsToSceneCoords","clientX","clientY","zoom","offsetLeft","offsetTop","scrollX","scrollY","sceneCoordsToViewportCoords","sceneX","sceneY","getGlobalCSSVariable","getComputedStyle","documentElement","getPropertyValue","RS_LTR_CHARS","RS_RTL_CHARS","isRTL","RE_RTL_CHECK","tupleToCoors","xyTuple","console","warn","fromIndex","collection","iteratee","reject","Promise","_resolve","_reject","element","parentElement","body","overflowY","scrollHeight","clientHeight","tabIndex","focus","bytes","byte","join","getUpdatedTimestamp","isTestEnv","now","items","arrayToMapWithIndex","elements","arrayToObject","groupBy","curr","prev","next","prevNode","firstNode","isArray","toArray","toIterable","isDevEnv","ENV","isProdEnv","TEST","isServerEnv","PRODUCTION","wrapEvent","process","nativeEvent","CustomEvent","NODE_ENV","detail","cancelable","updateObject","obj","updates","didChange","self","top","isPromiseLike","queryFocusableElements","focusableElements","container","querySelectorAll","filter","isShallowEqual","objA","objB","comparators","debug","aKeys","bKeys","_defaultIsShallowComparatorFallback","every","comparator","originalEventHandler","ourEventHandler","checkForDefaultPrevented","handleEvent","defaultPrevented","assertNever","message","softAssert","Error","invariant","condition","memoize","lastResult","currentArgs","argsAreEqual","clear","has","hasOwnProperty","cloneJSON","JSON","parse","stringify","updateStable","prevValue","nextValue","options","getSvgPathFromStroke","closed","len","toFixed","average","normalizeEOL","replace","isAnyTrue","arg","escapeDoubleQuotes","castArray","reduceToCommonValue","getValue","sizeOf","valueExtractor","item","commonValue","COMPLEX_BINDINGS","featureFlags","getFeatureFlag","serializedFlags","FEATURE_FLAGS_STORAGE_KEY","DEFAULT_FEATURE_FLAGS","flag","Random","testIdBase","randomInteger","floor","randomId","nanoid","normalizeLink","link","sanitizeUrl","isLocalLink","toValidURL","URL","Emitter","on","handlers","_handlers","flat","subscribers","off","once","detach","handler","trigger","payload","WarningBanner","styled","div","$dark","IconWrapper","ActionCard","LoadFromLinkDialog","opened","darkMode","onReplace","onClose","onSaveToDisk","Modal","title","withCloseButton","centered","padding","styles","overlay","Stack","gap","Text","fw","style","FiAlertTriangle","strong","br","flexGrow","Button","onClick","flexShrink","h4","variant","fullWidth","leftSection","FiDownload","root","maxWidth","borderColor","randomSeed","random","randomNonce","formatNodeText","row","childrenCount","jsonToJsonDrawElements","nodes","edges","positions","layoutNodes","children","hasParent","edge","ch","add","roots","nodeMap","layers","visited","queue","layer","nextQueue","childId","orphans","currentX","currentY","nodeId","VERTICAL_GAP","HORIZONTAL_GAP","indexCounter","getNextIndex","rectIds","pos","rectId","textId","NODE_PADDING","textRows","ROW_HEIGHT","boundElements","rect","groupIds","seed","version","versionNonce","isDeleted","updated","textEl","FONT_SIZE","textAlign","verticalAlign","containerId","originalText","autoResize","fromRectId","toRectId","fromPos","toPos","fromNode","find","toNode","fromWidth","fromHeight","toHeight","startX","endX","endY","startY","startBinding","elementId","fixedPoint","endBinding","startArrowhead","endArrowhead","elbowed","dbConfig","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","_db","getDb","app","getApps","initializeApp","getDatabase","chunkSize","String","fromCharCode","apply","btoa","base64ToUint8","atob","base64","Uint8Array","charCodeAt","generateEncryptionKey","crypto","subtle","generateKey","uint8ToBase64","exportKey","keyStr","raw","importKey","buffer","encryptData","iv","getRandomValues","encrypted","encrypt","byteLength","decryptData","ciphertext","decrypted","decrypt","exportToBackend","compressedData","generateId","encryptionKey","base64Data","dbRef","ref","createdAt","snapshot","exists","val","jsonString","el","viewBackgroundColor","theme","compressed","pako","TextEncoder","encode","hash","pathname","match","importFromBackend","StyledJsonDrawWrapper","$ready","JsonDrawView","useGraph","state","darkmodeEnabled","useConfig","JsonDrawModule","setJsonDrawModule","React","drawReady","setDrawReady","jsonDrawAPIRef","hasInitialized","hasUserDrawing","showClearModal","setShowClearModal","showShareModal","setShowShareModal","shareUrl","setShareUrl","justCopied","setJustCopied","isSharing","setIsSharing","copyTimerRef","showLoadFromLinkDialog","setShowLoadFromLinkDialog","pendingShareDataRef","handleChange","files","current","JSONDRAW_ASSET_PATH","mod","JsonDraw","scrollToContent","api","delay","fitToViewport","viewportZoomFactor","applySharedData","updateScene","history","replaceState","handleReplaceContent","toast","success","handleSaveToDisk","getSceneElementsIncludingDeleted","getAppState","blob","Blob","url","createObjectURL","createElement","href","download","click","revokeObjectURL","handleJsonDrawAPI","isBackendShareLink","loadFromShareLink","initFromLocalOrJson","saved","catch","err","decoded","decodeDataFromUrlHash","decodeURIComponent","binaryString","decompressed","handleClearDrawing","removeItem","handleCopyLink","writeText","handleShareClick","createShareLink","Box","h","w","LoadingOverlay","visible","display","justifyContent","alignItems","ActionIcon","FiX","TextInput","label","readOnly","flex","input","border","boxShadow","marginBottom","fontWeight","select","FiCheck","FiCopy","minWidth","transition","borderTop","paddingTop","FiLock","jsondrawAPI","onChange","viewModeEnabled","zenModeEnabled","gridModeEnabled","UIOptions","clearDrawing","initialData","renderTopRightUI","px","loading","StyledLabel","span","$nodeType","getLabelColor","$type","NODE_COLORS","PARENT_OBJ","PARENT_ARR","Label","keyPath","nodeType","Value","useTheme","valueAsString","props","getValueColor","$value","isNaN","INTEGER","BOOL","TRUE","FALSE","NULL","NODE_VALUE","TextRenderer","useJson","JSONTree","hideRoot","valueRenderer","labelRenderer","extend","overflow","scheme","author","base00","GRID_BG_COLOR","View","viewMode","useSessionStorage","ViewMode","Graph","GraphView","Tree","TreeView","StyledLiveEditor","onContextMenuCapture","LiveEditor","preventDefault","pointFromArray","numberArray","pair","pointRotateRads","cx","cy","pointTranslate","pointCenter","hypot","pointDistanceSq","xDiff","yDiff","pointScaleFromOrigin","mid","isPointWithinBounds","q"],"sourceRoot":"","ignoreList":[]}