"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[75373],{75373:(e,t,r)=>{r.r(t),r.d(t,{default:()=>ed});var n=r(37876),l=r(14232),o=r(38335),a=r(31158),i=r(53070),s=r(70671),c=r(95171),d=r(44969),u=r(79021),p=r(45050),f=r(44193),h=r(11210),g=r(31408),m=r(87871),w=r(74188),x=r(34826),y=r(52509),b=r(97685),j=r(18571),S=r(58021),k=r(79501),v=r(98417),C=r(51641),z=r(9456);let A=a.Ay.div.withConfig({componentId:"sc-6476bd35-0"})(["display:flex;flex-direction:row;align-items:flex-start;gap:1rem;padding:1.75rem 2rem;border-radius:0.5rem;background:",";color:",";@media (max-width:600px){flex-direction:column;text-align:center;align-items:center;}"],({$dark:e})=>e?"rgba(220, 38, 38, 0.12)":"#fef2f2",({$dark:e})=>e?"#fca5a5":"#991b1b"),E=a.Ay.div.withConfig({componentId:"sc-6476bd35-1"})(["display:flex;align-items:center;justify-content:center;flex-shrink:0;width:3rem;height:3rem;border-radius:50%;background:",";svg{width:1.4rem;height:1.4rem;color:",";}"],({$dark:e})=>e?"rgba(220, 38, 38, 0.2)":"#fee2e2",({$dark:e})=>e?"#f87171":"#dc2626"),R=a.Ay.div.withConfig({componentId:"sc-6476bd35-2"})(["display:flex;flex-direction:column;align-items:center;padding:1.5rem;gap:0.75rem;text-align:center;h4{margin:0;font-weight:700;font-size:1.125rem;color:",";}p{margin:0;font-size:0.875rem;color:",";line-height:1.5;}"],({$dark:e})=>e?"#e5e5e5":"#1f2937",({$dark:e})=>e?"#a3a3a3":"#6b7280"),I=a.Ay.div.withConfig({componentId:"sc-6476bd35-3"})(["flex:1;min-width:0;font-size:0.95rem;line-height:1.5;color:",";strong{color:",";}@media (max-width:600px){text-align:center;}"],({$dark:e})=>e?"#fca5a5":"#991b1b",({$dark:e})=>e?"#f87171":"#dc2626"),O=({opened:e,darkMode:t,onReplace:r,onClose:l,onSaveToDisk:o,title:a,message:i})=>(0,n.jsx)(d.a,{opened:e,onClose:l,title:null,withCloseButton:!1,centered:!0,size:700,padding:"xl",radius:"lg",styles:{content:{backgroundColor:t?"#1e1e1e":"#ffffff"},overlay:{backgroundColor:t?"rgba(0, 0, 0, 0.7)":"rgba(0, 0, 0, 0.4)"}},children:(0,n.jsxs)(u.B,{gap:"lg",children:[(0,n.jsx)(p.E,{fw:700,size:"xl",style:{fontFamily:"Assistant, sans-serif",fontSize:"1.3rem",color:t?"#e5e5e5":"#111827"},children:a||"Load from link"}),(0,n.jsxs)(A,{$dark:t,children:[(0,n.jsx)(E,{$dark:t,children:(0,n.jsx)(j.eHT,{})}),(0,n.jsx)(I,{$dark:t,children:i||(0,n.jsxs)(n.Fragment,{children:["Loading external drawing will ",(0,n.jsx)("strong",{children:"replace your existing content"}),". You can back up your drawing first by using one of the options below."]})}),(0,n.jsx)(f.$,{color:"red",size:"md",onClick:r,style:{flexShrink:0},children:"Replace my content"})]}),(0,n.jsxs)(R,{$dark:t,children:[(0,n.jsx)("h4",{children:"Save to disk"}),(0,n.jsx)("p",{children:"Export the scene data to a file from which you can import later."}),(0,n.jsx)(f.$,{variant:"outline",color:"gray",size:"md",fullWidth:!0,leftSection:(0,n.jsx)(j.a4x,{size:16}),onClick:o,styles:{root:{maxWidth:300,borderColor:t?"#404040":"#d1d5db",color:t?"#d4d4d4":"#374151"}},children:"Save to disk"})]})]})});var F=r(46553);let T=()=>Math.floor(2e9*Math.random()),D=()=>Math.floor(2e9*Math.random()),$=e=>e.text&&0!==e.text.length?e.text.map(e=>null!==e.key&&void 0!==e.key?"object"===e.type?`${e.key}: {${e.childrenCount??0} keys}`:"array"===e.type?`${e.key}: [${e.childrenCount??0} items]`:null===e.value?`${e.key}: null`:`${e.key}: ${e.value}`:`${e.value??""}`).join("\n"):"",L=(e,t)=>{let r=[],n=((e,t)=>{let r=new Map;if(0===e.length)return r;let n=new Map,l=new Set;for(let e of t){let t=n.get(e.from)??[];t.push(e.to),n.set(e.from,t),l.add(e.to)}let o=e.filter(e=>!l.has(e.id)).map(e=>e.id);0===o.length&&e.length>0&&o.push(e[0].id);let a=new Map(e.map(e=>[e.id,e])),s=[],c=new Set,d=[...o];for(;d.length>0;){let e=[],t=[];for(let r of d)if(!c.has(r))for(let l of(c.add(r),e.push(r),n.get(r)??[]))c.has(l)||t.push(l);e.length>0&&s.push(e),d=t}let u=e.filter(e=>!c.has(e.id)).map(e=>e.id);u.length>0&&s.push(u);let p=50;for(let e of s){let t=0,n=50;for(let l of e){let e=a.get(l);e&&(r.set(l,{x:p,y:n}),n+=e.height+i.BF,t=Math.max(t,e.width))}p+=t+i.xy}return r})(e,t),l=Date.now(),o=0,a=()=>`a${(o++).toString().padStart(6,"0")}`,s=new Map;for(let o of e){let e=n.get(o.id)??{x:0,y:0},c=`rect-${o.id}`,d=`text-${o.id}`,u=$(o);s.set(o.id,c);let p=Math.max(o.width+2*i._k,120),f=Math.max((o.text?.length??1)*i.C+2*i._k,50),h=[{id:d,type:"text"}];for(let e of t)(e.from===o.id||e.to===o.id)&&h.push({id:`arrow-${e.id}`,type:"arrow"});let g={id:c,type:"rectangle",x:e.x,y:e.y,width:p,height:f,angle:0,strokeColor:"#1e1e1e",backgroundColor:"transparent",fillStyle:"solid",strokeWidth:1,roughness:1,opacity:100,groupIds:[],roundness:{type:3},seed:T(),version:1,versionNonce:D(),isDeleted:!1,boundElements:h,index:a(),updated:l,link:null,locked:!1,frameId:null};r.push(g);let m={id:d,type:"text",x:e.x+i._k,y:e.y+i._k,width:p-2*i._k,height:f-2*i._k,angle:0,strokeColor:"#1e1e1e",backgroundColor:"transparent",fillStyle:"solid",strokeWidth:1,roughness:1,opacity:100,groupIds:[],roundness:null,seed:T(),version:1,versionNonce:D(),isDeleted:!1,boundElements:null,index:a(),updated:l,link:null,locked:!1,frameId:null,text:u,fontSize:i.TZ,fontFamily:F.F2R.Excalifont,textAlign:"left",verticalAlign:"top",containerId:c,originalText:u,autoResize:!0,lineHeight:1.25};r.push(m)}for(let o of t){let t=s.get(o.from),c=s.get(o.to);if(!t||!c)continue;let d=n.get(o.from),u=n.get(o.to);if(!d||!u)continue;let p=e.find(e=>e.id===o.from),f=e.find(e=>e.id===o.to);if(!p||!f)continue;let h=Math.max(p.width+2*i._k,120),g=Math.max((p.text?.length??1)*i.C+2*i._k,50),m=Math.max((f.text?.length??1)*i.C+2*i._k,50),w=d.x+h,x=d.y+g/2,y=u.x,b=u.y+m/2,j={id:`arrow-${o.id}`,type:"arrow",x:w,y:x,width:Math.abs(y-w),height:Math.abs(b-x),angle:0,strokeColor:"#1e1e1e",backgroundColor:"transparent",fillStyle:"solid",strokeWidth:1,roughness:1,opacity:100,groupIds:[],roundness:{type:2},seed:T(),version:1,versionNonce:D(),isDeleted:!1,boundElements:null,index:a(),updated:l,link:null,locked:!1,frameId:null,points:[[0,0],[y-w,b-x]],startBinding:{elementId:t,focus:0,gap:5,fixedPoint:[1,.5]},endBinding:{elementId:c,focus:0,gap:5,fixedPoint:[0,.5]},startArrowhead:null,endArrowhead:"arrow",elbowed:!1};r.push(j)}return r};var _=r(278),N=r(15940),M=r(16042);let P={apiKey:"AIzaSyDvMXBp-ixnFg_voZfMIEGFaotCrbVOAcs",authDomain:"json-viz-draw.firebaseapp.com",databaseURL:"https://json-viz-draw-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"json-viz-draw",storageBucket:"json-viz-draw.firebasestorage.app",messagingSenderId:"202083822464",appId:"1:202083822464:web:870613fe58ad8f08652f65"},U=null,B=()=>{if(U)return U;if(!P.databaseURL||!P.projectId)throw Error("Database configuration is missing. Please set NEXT_PUBLIC_DB_* environment variables.");let e=0===(0,M.Dk)().length?(0,M.Wp)(P):(0,M.Dk)()[0];return U=(0,N.C3)(e)},J=e=>{let t="";for(let r=0;r<e.length;r+=8e3)t+=String.fromCharCode.apply(null,Array.from(e.slice(r,r+8e3)));return btoa(t)},Y=e=>{let t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r},W=async()=>{let e=await crypto.subtle.generateKey({name:"AES-GCM",length:128},!0,["encrypt","decrypt"]);return J(new Uint8Array(await crypto.subtle.exportKey("raw",e))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")},V=async e=>{let t=e.replace(/-/g,"+").replace(/_/g,"/");for(;t.length%4;)t+="=";let r=Y(t);return crypto.subtle.importKey("raw",r.buffer,{name:"AES-GCM"},!1,["encrypt","decrypt"])},G=async(e,t)=>{let r=await V(t),n=crypto.getRandomValues(new Uint8Array(12)),l=await crypto.subtle.encrypt({name:"AES-GCM",iv:n},r,e.buffer),o=new Uint8Array(n.length+l.byteLength);return o.set(n),o.set(new Uint8Array(l),n.length),o},X=async(e,t)=>{let r=await V(t),n=e.slice(0,12),l=e.slice(12);return new Uint8Array(await crypto.subtle.decrypt({name:"AES-GCM",iv:n},r,l.buffer))},H=async e=>{let t,r=(t=new Uint8Array(15),crypto.getRandomValues(t),J(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")),n=await W(),l=J(await G(e,n)),o=(0,N.KR)(B(),`shared/${r}`);return await (0,N.hZ)(o,{data:l,createdAt:Date.now()}),{id:r,encryptionKey:n}},Z=async(e,t)=>{try{let r=(0,N.KR)(B(),`shared/${e}`),n=await (0,N.Jt)(r);if(!n.exists())return console.error("Share link data not found:",e),null;let{data:l}=n.val(),o=Y(l);return await X(o,t)}catch(e){return console.error("Failed to import shared data:",e),null}},K=async(e,t,r)=>{let n=e.filter(e=>!e.isDeleted).map(e=>({...e,isDeleted:void 0})),l=JSON.stringify({elements:n,files:((e,t)=>{if(!t)return;let r=new Set;for(let t of e)t&&"object"==typeof t&&"fileId"in t&&t.fileId&&r.add(t.fileId);if(0===r.size)return;let n={};for(let e of r)t[e]&&(n[e]=t[e]);return Object.keys(n).length?n:void 0})(n,r),appState:{viewBackgroundColor:t.viewBackgroundColor,theme:t.theme}}),o=_.Ay.deflate(new TextEncoder().encode(l)),{id:a,encryptionKey:i}=await H(o),s=`#json=${a},${i}`;return`${window.location.origin}${window.location.pathname}${s}`},q=async e=>{let t=e.match(/^#json=([a-zA-Z0-9_-]+),([a-zA-Z0-9_-]+)$/);if(!t)return null;let[,r,n]=t,l=await Z(r,n);if(!l)return null;try{let e=_.Ay.inflate(l,{to:"string"});return JSON.parse(e)}catch(e){return console.error("Failed to decompress share link data:",e),null}},Q=a.Ay.div.withConfig({componentId:"sc-5d16a29-0"})(["width:100%;height:100%;position:relative;opacity:",";transition:opacity 0.2s ease;.jsondraw-wrapper{width:100%;height:100%;}"],({$ready:e})=>+!!e),ee=()=>{let e=(0,z.A)(e=>e.nodes),t=(0,z.A)(e=>e.edges),o=(0,k.A)(e=>e.darkmodeEnabled),[a,s]=l.useState(null),[A,E]=l.useState(!1),R=l.useRef(null),I=l.useRef(!1),F=l.useRef(!1),[T,D]=l.useState(!1),[$,N]=l.useState(!1),[M,P]=l.useState(""),[U,B]=l.useState(!1),[J,Y]=l.useState(!1),W=l.useRef(null),[V,G]=l.useState(null),{isCollaborating:X,roomId:H,startCollaboration:Z,stopCollaboration:ee,collaborators:et,currentUserId:er,isRoomOwner:en,maxCollaborators:el,kickCollaborator:eo,passwordRequiredRoom:ea,setPasswordRequiredRoom:ei,waitingForApproval:es,pendingRequests:ec,approveJoin:ed,rejectJoin:eu,submitRoomPassword:ep}=(0,v.H)(),[ef,eh]=l.useState(!1),[eg,em]=l.useState(""),[ew,ex]=l.useState(""),[ey,eb]=l.useState(null),[ej,eS]=l.useState(!1),ek=l.useRef(null),ev=l.useRef(!1),eC=l.useRef(null),{broadcastDrawingChanges:ez,broadcastPointer:eA,centerOnFollowedUser:eE}=(e=>{let t=(0,v.H)(),{socket:r,isCollaborating:n,roomId:o,collaborators:a,isRoomOwner:s}=t,c=t._p2pRoom,d="boolean"!=typeof t.canSync||t.canSync,u=(0,C.mv)(),p=(0,l.useRef)(-1),f=(0,l.useRef)(new Map),h=(0,l.useRef)(!1),g=(0,l.useRef)(null),m=(0,l.useRef)(null);return(0,l.useEffect)(()=>{n&&d?h.current=s:(h.current=!1,p.current=-1)},[n,s,d]),(0,l.useEffect)(()=>{let l=new Map;a.forEach(e=>{if(r&&e.id===r.id||!r&&u===i.UV.P2P&&e.id===t.currentUserId)return;let n=f.current.get(e.id);l.set(e.id,{pointer:n?.pointer,button:n?.button||"up",username:e.username,color:{background:e.color||"#eee",stroke:e.color||"#eee"},id:e.id,socketId:e.id})}),f.current=l,e.current&&n&&d&&e.current.updateScene({collaborators:l})},[a,e,n,r,u,t,d]),(0,l.useEffect)(()=>{if(n&&d){if(u===i.UV.Socket){if(!r)return;let t=t=>{let r=e.current;if(!r)return;let n=r.getSceneElementsIncludingDeleted(),l=r.getAppState(),o=[];if(s||h.current){let e=(0,S.restoreElements)(t,n);o=(0,S.reconcileElements)(n,e,l)}else o=(0,S.restoreElements)(t,null),h.current=!0;p.current=(0,S.getSceneVersion)(o),r.updateScene({elements:o,commitToHistory:!1})};return r.on("client-draw",t),g.current=e=>{o&&r.emit("server-draw",o,e)},()=>{r.off("client-draw",t),g.current=null}}if(u===i.UV.P2P&&c){let[t,r]=c.makeAction("draw");return r(t=>{let r=e.current;if(!r)return;let n=r.getSceneElementsIncludingDeleted(),l=r.getAppState(),o=[];if(s||h.current){let e=(0,S.restoreElements)(t,n);o=(0,S.reconcileElements)(n,e,l)}else o=(0,S.restoreElements)(t,null),h.current=!0;p.current=(0,S.getSceneVersion)(o),r.updateScene({elements:o,commitToHistory:!1})}),g.current=e=>{t(e)},()=>{g.current=null}}}},[r,n,e,s,u,c,o,d]),(0,l.useEffect)(()=>{if(n&&d){if(u===i.UV.Socket){if(!r)return;let t=(t,r)=>{let n=e.current;if(!n)return;let l=f.current,o=l.get(t);if(o){o.pointer=r.pointer,o.button=r.button,o.viewport=r.viewport||o.viewport;let e=new Map(l);f.current=e,n.updateScene({collaborators:e});try{let e="function"==typeof n.getAppState?n.getAppState():null,l=e?.userToFollow?.socketId;if(l&&l===t&&r.viewport){let t=r.viewport,l=e?.zoom&&"number"==typeof e.zoom.value?{...e.zoom,value:t.zoom}:{value:t.zoom};n.updateScene({appState:{scrollX:t.scrollX,scrollY:t.scrollY,zoom:l}})}}catch{}}};return r.on("client-pointer",t),m.current=e=>{o&&r.emit("server-pointer",o,e)},()=>{r.off("client-pointer",t),m.current=null}}if(u===i.UV.P2P&&c){let[t,r]=c.makeAction("pointer");return r((t,r)=>{let n=e.current;if(!n)return;let l=f.current,o=l.get(r);if(o){o.pointer=t.pointer,o.button=t.button,o.viewport=t.viewport||o.viewport;let e=new Map(l);f.current=e,n.updateScene({collaborators:e});try{let e="function"==typeof n.getAppState?n.getAppState():null,l=e?.userToFollow?.socketId;if(l&&l===r&&t.viewport){let r=t.viewport,l=e?.zoom&&"number"==typeof e.zoom.value?{...e.zoom,value:r.zoom}:{value:r.zoom};n.updateScene({appState:{scrollX:r.scrollX,scrollY:r.scrollY,zoom:l}})}}catch{}}}),m.current=e=>{t(e)},()=>{m.current=null}}}},[r,n,e,u,c,o,d]),(0,l.useEffect)(()=>{if(n&&s&&d){if(u===i.UV.Socket){if(!r)return;let t=()=>{let t=e.current;if(!t)return;let r=t.getSceneElementsIncludingDeleted();r.length>0&&g.current&&g.current(r)};return r.on("new-user",t),()=>{r.off("new-user",t)}}if(u===i.UV.P2P&&c)return c.onPeerJoin(t=>{let r=e.current;if(!r)return;let n=r.getSceneElementsIncludingDeleted();if(0===n.length)return;let[l]=c.makeAction("draw");l(n,t)}),()=>{c.onPeerJoin(()=>{})}}},[r,n,o,e,s,u,c,d]),{broadcastDrawingChanges:e=>{if(!n||!d||!s&&!h.current)return;let t=(0,S.getSceneVersion)(e);t>p.current&&(g.current&&g.current(e),p.current=t)},broadcastPointer:e=>{n&&m.current&&m.current(e)},centerOnFollowedUser:()=>{let t=e.current;if(t)try{let e="function"==typeof t.getAppState?t.getAppState():null,r=e?.userToFollow?.socketId;if(!r)return;let n=f.current.get(r),l=n?.viewport;if(l){let r=e?.zoom&&"number"==typeof e.zoom.value?{...e.zoom,value:l.zoom}:{value:l.zoom};t.updateScene({appState:{scrollX:l.scrollX,scrollY:l.scrollY,zoom:r}});return}let o=n?.pointer;if(!o)return;let a=e.width||0,i=e.height||0,{x:s,y:c}=o;t.updateScene({appState:{scrollX:s-a/2,scrollY:c-i/2}})}catch{}}}})(R),eR=l.useRef(null),eI=l.useCallback((e,t,r)=>{F.current=!0,ez(e);try{let n=r??R.current?.getFiles?.()??null;localStorage.setItem("jsondraw-autosave",JSON.stringify({elements:e,files:n,appState:{theme:t.theme,zoom:t.zoom}}))}catch(e){console.warn("Failed to save to localStorage:",e)}},[ez]);l.useEffect(()=>{window.JSONDRAW_ASSET_PATH="/"},[]),l.useEffect(()=>{Promise.resolve().then(r.bind(r,58021)).then(e=>{s({JsonDraw:e.JsonDraw}),E(!1)});{let e=new URLSearchParams(window.location.hash.replace(/^#/,"")).get("collabRoomId");if(e&&!H){let t=!1,r=localStorage.getItem("jsondraw-autosave");if(r)try{let e=JSON.parse(r);Array.isArray(e.elements)&&e.elements.length>0&&(t=!0)}catch(e){t=!0}t?eb(e):Z(e,void 0,{asOwner:!1})}}},[]);let eO=l.useCallback((e,t=120)=>{requestAnimationFrame(()=>{setTimeout(()=>{e.scrollToContent(void 0,{fitToViewport:!0,viewportZoomFactor:.8}),E(!0)},t)})},[]),eF=l.useCallback(e=>{let t=R.current;if(!t)return;F.current=!0,I.current=!0,E(!1);let r=(0,S.restoreElements)(e.elements,null),n={...(0,S.restoreAppState)(e.appState,t.getAppState()),isLoading:!1};requestAnimationFrame(()=>{e.files&&Object.keys(e.files).length>0&&t.addFiles(e.files),t.updateScene({elements:r,appState:n}),eO(t,120)}),window.history.replaceState({},"",window.location.pathname)},[eO]),eT=l.useCallback(()=>{let e=ek.current;e&&(eF(e),ek.current=null,eS(!1),b.oR.success("Drawing loaded from shared link!"))},[eF]),eD=l.useCallback(async()=>{let e=R.current;if(e)try{let t=e.getSceneElementsIncludingDeleted(),r=e.getAppState(),n=e.getFiles(),l=e.getName?.()||r.name;await (0,S.saveAsJSON)(t,r,n,l),b.oR.success("Drawing saved to disk!")}catch(e){b.oR.error("Failed to save drawing.")}},[]),e$=l.useCallback(r=>{let n=localStorage.getItem("jsondraw-autosave");if(n)try{let{elements:e,appState:t,files:l}=JSON.parse(n),o=(0,S.restoreElements)(e,null),a={...(0,S.restoreAppState)(t,r.getAppState()),isLoading:!1};F.current=!0,E(!1),requestAnimationFrame(()=>{l&&Object.keys(l).length>0&&r.addFiles(l),r.updateScene({elements:o,appState:a}),eO(r,120)});return}catch(e){console.warn("Failed to restore from localStorage:",e)}if(e.length>0&&!I.current){I.current=!0;let n=(0,S.restoreElements)(L(e,t),null);E(!1),requestAnimationFrame(()=>{r.updateScene({elements:n,appState:{isLoading:!1}}),eO(r,200)})}},[e,t,eO]),eL=l.useCallback(()=>{let e=localStorage.getItem("jsondraw-autosave");if(e)try{let t=JSON.parse(e);if(Array.isArray(t.elements)&&t.elements.length>0)return!0}catch(e){return console.warn("Failed to parse autosave data:",e),!0}let t=R.current;if(!t)return!1;let r=t.getSceneElementsIncludingDeleted();return Array.isArray(r)&&r.length>0},[]),e_=l.useCallback(async e=>{if(!e||!/^#json=([a-zA-Z0-9_-]+),([a-zA-Z0-9_-]+)$/.test(e)&&!e.startsWith("#data="))return!1;let t=R.current;if(!t)return!1;if(e===eC.current||ev.current)return!0;eC.current=e,ev.current=!0,E(!1);try{if(/^#json=([a-zA-Z0-9_-]+),([a-zA-Z0-9_-]+)$/.test(e)){let r=await q(e);if(!r||!r.elements)return b.oR.error("Could not load shared drawing. The link may be invalid or expired."),e$(t),!0;return eL()?(ek.current=r,eS(!0),e$(t)):eF(r),!0}let r=(e=>{try{let t=e.replace("#data=","");try{t=decodeURIComponent(t)}catch{}for(t=t.replace(/-/g,"+").replace(/_/g,"/");t.length%4;)t+="=";let r=window.atob(t),n=new Uint8Array(r.length);for(let e=0;e<r.length;e++)n[e]=r.charCodeAt(e);let l=_.Ay.inflate(n,{to:"string"});return JSON.parse(l)}catch(e){return console.error("Failed to decode legacy sharelink data",e),null}})(e);if(r&&r.elements)return eL()?(ek.current=r,eS(!0),e$(t)):eF(r),!0;return e$(t),!0}catch(e){return console.error("Failed to load share link:",e),b.oR.error("Failed to load shared drawing."),e$(t),!0}finally{ev.current=!1}},[eF,eL,e$]);l.useEffect(()=>{let r=R.current;if(!r||0===e.length||F.current)return;let n=L(e,t);r.updateScene({elements:n}),eO(r,80)},[e,t,eO]);let eN=l.useCallback(e=>{R.current=e,e.onUserFollow&&e.onUserFollow(e=>{e&&e.userToFollow?"FOLLOW"===e.action?G(e.userToFollow.socketId||null):"UNFOLLOW"===e.action&&G(t=>t===e.userToFollow.socketId?null:t):G(null)}),e_(window.location.hash).then(t=>{t||e$(e)})},[e_,e$]);l.useEffect(()=>{let e=()=>{e_(window.location.hash)};return window.addEventListener("hashchange",e),()=>window.removeEventListener("hashchange",e)},[e_]);let eM=l.useRef(ec?.length||0);l.useEffect(()=>{if(ec&&ec.length>eM.current){let e=ec[ec.length-1];(0,b.oR)(`${e.username} wants to join the room!`,{icon:"\uD83D\uDC4B"})}eM.current=ec?.length||0},[ec]);let eP=l.useCallback(()=>{if(!R.current)return;localStorage.removeItem("jsondraw-autosave"),F.current=!1,I.current=!1;let r=L(e,t);R.current.updateScene({elements:r}),E(!1),eO(R.current,120),D(!1),b.oR.success("Drawing cleared! Loaded JSON visualization.")},[e,t,eO]),eU=l.useCallback(()=>{navigator.clipboard.writeText(M).then(()=>{B(!0),W.current&&window.clearTimeout(W.current),W.current=window.setTimeout(()=>B(!1),3e3)}).catch(()=>b.oR.error("Failed to copy link."))},[M]),eB=l.useCallback(async()=>{let e=R.current;if(e){Y(!0);try{let t=e.getSceneElementsIncludingDeleted(),r=e.getAppState(),n=e.getFiles(),l=await K(t,r,n);P(l),N(!0)}catch(e){console.error("Share failed:",e),b.oR.error("Failed to create share link. Please try again.")}finally{Y(!1)}}},[]);l.useEffect(()=>{if(!X)return;let e=window.setInterval(()=>{let e=R.current;if(!e||"function"!=typeof e.getAppState)return;let t=e.getAppState(),r=t.zoom&&"number"==typeof t.zoom.value?t.zoom.value:1,n={scrollX:t.scrollX||0,scrollY:t.scrollY||0,zoom:r};eA({pointer:eR.current||null,button:"none",viewport:n})},600);return()=>{window.clearInterval(e)}},[X,eA]);let eJ=l.useCallback((e,t)=>{let r=R.current;if(!r||"function"!=typeof r.getAppState)return;let n=r.getAppState(),l=n?.userToFollow?.socketId;l&&l===e?(r.updateScene({appState:{userToFollow:null}}),G(null)):(r.updateScene({appState:{userToFollow:{socketId:e,username:t||""}}}),G(e),eE())},[eE]),eY=l.useCallback(()=>{H||Z(Math.random().toString(36).substring(2,10),eg,{asOwner:!0})},[H,eg,Z]),eW=l.useCallback(()=>{ea&&(ep(ew),ei(null),ex(""))},[ea,ew,ep,ei]),eV=l.useCallback(()=>{ei(null),ex(""),window.location.hash=""},[ei]),eG=l.useCallback(()=>{ee(),window.location.hash=""},[ee]),eX=()=>{if(H){let e=new URL(window.location.href);e.search="";let t=new URLSearchParams;return t.set("collabRoomId",H),e.hash=t.toString(),e.toString()}return""};if(!a)return(0,n.jsx)(c.a,{pos:"relative",h:"100%",w:"100%",children:(0,n.jsx)(c.a,{pos:"absolute",inset:0,style:{display:"grid",placeItems:"center"},children:(0,n.jsx)(S.HamsterLoader,{})})});let{JsonDraw:eH}=a;return(0,n.jsxs)(c.a,{pos:"relative",h:"100%",w:"100%",children:[!A&&(0,n.jsx)(c.a,{pos:"absolute",inset:0,style:{display:"grid",placeItems:"center"},children:(0,n.jsx)(S.HamsterLoader,{})}),(0,n.jsx)(d.a,{opened:T,onClose:()=>D(!1),title:"Clear Drawing Session",centered:!0,children:(0,n.jsxs)(u.B,{gap:"md",children:[(0,n.jsxs)(p.E,{children:["This will ",(0,n.jsx)("strong",{children:"permanently delete"})," your current drawing session and load a fresh visualization from the JSON data."]}),(0,n.jsx)(p.E,{c:"dimmed",size:"sm",children:"Make sure to save your work first. Your current drawing will be lost and cannot be recovered."}),(0,n.jsxs)(c.a,{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:[(0,n.jsx)(f.$,{variant:"default",onClick:()=>D(!1),children:"Cancel"}),(0,n.jsx)(f.$,{color:"red",onClick:eP,children:"Clear & Load JSON"})]})]})}),(0,n.jsx)(d.a,{opened:$,onClose:()=>N(!1),title:null,withCloseButton:!1,centered:!0,size:"md",padding:"xl",radius:"lg",styles:{content:{backgroundColor:o?"#121212":"#ffffff"}},children:(0,n.jsxs)(u.B,{gap:"lg",children:[(0,n.jsxs)(c.a,{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsx)(p.E,{fw:700,size:"xl",style:{fontFamily:"Assistant, sans-serif"},children:"Shareable link"}),(0,n.jsx)(h.M,{variant:"subtle",color:"gray",onClick:()=>N(!1),children:(0,n.jsx)(j.yGN,{size:20})})]}),(0,n.jsxs)(c.a,{style:{display:"flex",gap:"12px",alignItems:"flex-end"},children:[(0,n.jsx)(g.k,{label:"Link",readOnly:!0,value:M,style:{flex:1},styles:{input:{backgroundColor:o?"rgba(255,255,255,0.05)":"#f3f4f6",border:"none",boxShadow:"none",height:40},label:{marginBottom:8,fontSize:12,fontWeight:600,color:o?"#a3a3a3":"#4b5563"}},onClick:e=>e.target.select()}),(0,n.jsx)(f.$,{size:"md",leftSection:U?(0,n.jsx)(j.YrT,{size:18}):(0,n.jsx)(j.nxz,{size:18}),color:U?"teal":"violet",onClick:eU,style:{height:40,minWidth:120,transition:"background-color 0.2s"},children:"Copy link"})]}),(0,n.jsx)(c.a,{style:{borderTop:`1px solid ${o?"#333":"#e5e7eb"}`,paddingTop:16},children:(0,n.jsxs)(p.E,{size:"sm",c:"dimmed",style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,n.jsx)(j.F5$,{size:16})," Data is end-to-end encrypted. Only people with the link can view."]})})]})}),(0,n.jsx)(d.a,{opened:es,onClose:eG,withCloseButton:!1,centered:!0,size:"sm",radius:"lg",padding:"xl",styles:{content:{backgroundColor:o?"#121212":"#ffffff"}},children:(0,n.jsxs)(u.B,{gap:"md",align:"center",children:[(0,n.jsx)(p.E,{fw:700,size:"lg",style:{fontFamily:"Assistant, sans-serif"},children:"Waiting for Approval"}),(0,n.jsx)(S.HamsterLoader,{}),(0,n.jsx)(p.E,{size:"sm",c:"dimmed",ta:"center",children:"Please wait while the room owner approves your request to join..."}),(0,n.jsx)(f.$,{variant:"default",onClick:eG,fullWidth:!0,mt:"sm",children:"Cancel"})]})}),(0,n.jsx)(d.a,{opened:!!ea,onClose:eV,title:(0,n.jsx)(p.E,{fw:700,size:"xl",style:{fontFamily:"Assistant, sans-serif"},children:"Room Password Required"}),centered:!0,size:"md",radius:"lg",padding:"xl",styles:{content:{backgroundColor:o?"#121212":"#ffffff"}},children:(0,n.jsxs)(u.B,{gap:"md",children:[(0,n.jsx)(p.E,{size:"sm",c:"dimmed",children:"This live collaboration room is protected by a password. Please enter the password to join."}),(0,n.jsx)(m.y,{label:"Password",placeholder:"Enter room password",value:ew,onChange:e=>ex(e.currentTarget.value),leftSection:(0,n.jsx)(j.Fv0,{size:14}),styles:{input:{backgroundColor:o?"rgba(255,255,255,0.05)":"#f3f4f6",border:"none"}},"data-autofocus":!0,onKeyDown:e=>{"Enter"===e.key&&eW()}}),(0,n.jsxs)(c.a,{style:{display:"flex",gap:"8px",justifyContent:"flex-end",marginTop:10},children:[(0,n.jsx)(f.$,{variant:"default",onClick:eV,children:"Cancel"}),(0,n.jsx)(f.$,{color:"blue",onClick:eW,children:"Join Room"})]})]})}),(0,n.jsx)(O,{opened:!!ey,darkMode:o,title:"Join Collaborative Room",message:(0,n.jsxs)(n.Fragment,{children:["Joining this room will ",(0,n.jsx)("strong",{children:"permanently replace your existing content"})," with the room's content. You can back up your drawing first by using the option below."]}),onReplace:()=>{ey&&(Z(ey,void 0,{asOwner:!1}),eb(null))},onClose:()=>eb(null),onSaveToDisk:eD}),(0,n.jsx)(d.a,{opened:ef,onClose:()=>eh(!1),title:(0,n.jsx)(p.E,{fw:700,size:"xl",style:{fontFamily:"Assistant, sans-serif"},children:"Live Collaboration"}),centered:!0,size:"md",radius:"lg",padding:"xl",styles:{content:{backgroundColor:o?"#121212":"#ffffff"}},children:(0,n.jsx)(u.B,{gap:"md",children:X&&H?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(p.E,{size:"sm",c:"dimmed",children:"You are live. Anyone with this link can join and draw in real-time."}),(0,n.jsxs)(w.Y,{gap:"apart",style:{background:o?"rgba(255,255,255,0.05)":"#f8f9fa",padding:"10px",borderRadius:"8px"},children:[(0,n.jsxs)(c.a,{children:[(0,n.jsxs)(p.E,{size:"sm",fw:600,children:["Room ID: ",H]}),(0,n.jsxs)(x.E,{color:"green",variant:"light",size:"sm",children:["Online (",et.length,"/",el," users)"]})]}),(0,n.jsx)(f.$,{color:"red",variant:"subtle",size:"xs",leftSection:(0,n.jsx)(j.QeK,{}),onClick:ee,children:"Stop Session"})]}),(0,n.jsxs)(c.a,{style:{display:"flex",gap:"12px",alignItems:"flex-end",marginTop:10},children:[(0,n.jsx)(g.k,{label:"Collab Link",readOnly:!0,value:eX(),style:{flex:1},styles:{input:{backgroundColor:o?"rgba(255,255,255,0.05)":"#f3f4f6",border:"none"}},onClick:e=>e.target.select()}),(0,n.jsx)(f.$,{leftSection:U?(0,n.jsx)(j.YrT,{size:18}):(0,n.jsx)(j.nxz,{size:18}),color:U?"teal":"blue",onClick:()=>{navigator.clipboard.writeText(eX()),B(!0),W.current&&window.clearTimeout(W.current),W.current=window.setTimeout(()=>B(!1),3e3)},children:"Copy"})]}),ec&&ec.length>0&&(0,n.jsxs)(c.a,{style:{marginTop:12,borderRadius:8,padding:10,background:o?"rgba(255,165,0,0.1)":"#fff5e6",border:`1px solid ${o?"rgba(255,165,0,0.3)":"#ffe0b2"}`},children:[(0,n.jsxs)(p.E,{size:"xs",c:"orange",fw:600,mb:8,children:["Pending Requests (",ec.length,")"]}),(0,n.jsx)(u.B,{gap:6,children:ec.map(e=>(0,n.jsxs)(w.Y,{justify:"space-between",wrap:"nowrap",children:[(0,n.jsxs)(w.Y,{gap:8,children:[(0,n.jsx)(c.a,{w:10,h:10,style:{borderRadius:"50%",background:e.color||"#ccc"}}),(0,n.jsx)(p.E,{size:"sm",fw:500,truncate:!0,children:e.username})]}),(0,n.jsxs)(w.Y,{gap:4,children:[(0,n.jsx)(f.$,{size:"compact-xs",color:"teal",onClick:()=>ed(e.userId),children:"Approve"}),(0,n.jsx)(f.$,{size:"compact-xs",color:"red",variant:"subtle",onClick:()=>eu(e.userId),children:"Reject"})]})]},e.userId))})]}),(0,n.jsxs)(c.a,{style:{marginTop:12,borderRadius:8,padding:10,background:o?"rgba(255,255,255,0.04)":"#f8f9fa"},children:[(0,n.jsx)(p.E,{size:"xs",c:"dimmed",mb:8,children:"Participants"}),(0,n.jsx)(u.B,{gap:6,children:et.map(e=>{let t=e.id===er;return(0,n.jsxs)(w.Y,{justify:"space-between",wrap:"nowrap",children:[(0,n.jsxs)(p.E,{size:"sm",fw:500,truncate:!0,children:[e.username||e.id,t?" (You)":"",e.isOwner?" (Owner)":""]}),(0,n.jsxs)(w.Y,{gap:4,children:[!t&&(0,n.jsx)(h.M,{color:V===e.id?"blue":"gray",variant:V===e.id?"filled":"light","aria-label":V===e.id?"Stop following user":"Follow user",onClick:()=>eJ(e.id,e.username),children:(0,n.jsx)(j.Vap,{size:14})}),en&&!t?(0,n.jsx)(h.M,{color:"red",variant:"light","aria-label":"Kick user",onClick:()=>eo(e.id),children:(0,n.jsx)(j.JOY,{size:14})}):null]})]},e.id)})})]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(p.E,{size:"sm",c:"dimmed",children:"Create a real-time multiplayer room to draw with others. You can optionally set a password."}),(0,n.jsx)(m.y,{label:"Room Password (Optional)",placeholder:"Leave blank for public room",value:eg,onChange:e=>em(e.currentTarget.value),leftSection:(0,n.jsx)(j.Fv0,{size:14}),styles:{input:{backgroundColor:o?"rgba(255,255,255,0.05)":"#f3f4f6",border:"none"}}}),(0,n.jsx)(f.$,{size:"md",color:"blue",leftSection:(0,n.jsx)(j.aze,{size:16}),onClick:eY,style:{marginTop:10},children:"Start Session"})]})})}),(0,n.jsx)(O,{opened:ej,darkMode:o,onReplace:eT,onClose:()=>{eS(!1),ek.current=null,window.history.replaceState({},"",window.location.pathname)},onSaveToDisk:eD}),(0,n.jsx)(Q,{$ready:A,children:(0,n.jsx)("div",{className:"jsondraw-wrapper",children:(0,n.jsx)(eH,{jsondrawAPI:eN,onChange:eI,onPointerUpdate:e=>{if(e.pointer){eR.current=e.pointer;let t=R.current,r=null;if(t&&"function"==typeof t.getAppState){let e=t.getAppState(),n=e.zoom&&"number"==typeof e.zoom.value?e.zoom.value:1;r={scrollX:e.scrollX||0,scrollY:e.scrollY||0,zoom:n}}eA({...e,viewport:r})}},viewModeEnabled:!1,zenModeEnabled:!1,gridModeEnabled:!1,theme:o?"dark":"light",UIOptions:{canvasActions:{export:{saveFileToDisk:!0},clearDrawing:()=>D(!0)}},initialData:{appState:{activeTool:{type:"hand",customType:null,lastActiveTool:null,locked:!1,fromSelection:!1}}},renderTopRightUI:e=>(0,n.jsx)(c.a,{px:"md",children:(0,n.jsxs)(y.W,{shadow:"md",width:200,position:"bottom-end",children:[(0,n.jsx)(y.W.Target,{children:(0,n.jsx)(f.$,{size:"sm",color:X?"green":"violet",loading:J,leftSection:X?(0,n.jsx)(j.cfS,{size:16}):(0,n.jsx)(j.Pum,{size:16}),title:"Share canvas",children:X?"Live":"Share"})}),(0,n.jsxs)(y.W.Dropdown,{children:[(0,n.jsx)(y.W.Label,{children:"Export Options"}),(0,n.jsx)(y.W.Item,{leftSection:(0,n.jsx)(j.nxz,{size:14}),onClick:eB,children:"Share Link (Snapshot)"}),(0,n.jsx)(y.W.Divider,{}),(0,n.jsx)(y.W.Label,{children:"Realtime"}),(0,n.jsx)(y.W.Item,{color:X?"green":"blue",leftSection:X?(0,n.jsx)(j.cfS,{size:14}):(0,n.jsx)(j.aze,{size:14}),onClick:()=>eh(!0),children:X?"Manage Collab Session":"Start Live Collab"})]})]})})})})})]})};var et=r(83126),er=r(18512);let en=a.I4.span.withConfig({componentId:"sc-65e7364-0"})(["color:",";&:hover{filter:brightness(1.5);transition:filter 0.2s ease-in-out;}"],({theme:e,$nodeType:t})=>(function({$type:e,theme:t}){return"Object"===e?t.NODE_COLORS.PARENT_OBJ:"Array"===e?t.NODE_COLORS.PARENT_ARR:t.NODE_COLORS.PARENT_OBJ})({theme:e,$type:t})),el=({keyPath:e,nodeType:t})=>(0,n.jsxs)(en,{$nodeType:t,children:[e[0],":"]});var eo=r(6340);let ea=e=>{let t=(0,a.DP)(),{valueAsString:r,value:l}=e;return(0,n.jsx)("span",{style:{color:function({$value:e,theme:t}){return e&&!Number.isNaN(+e)?t.NODE_COLORS.INTEGER:"true"===e?t.NODE_COLORS.BOOL.TRUE:"false"===e?t.NODE_COLORS.BOOL.FALSE:"null"===e?t.NODE_COLORS.NULL:t.NODE_COLORS.NODE_VALUE}({theme:t,$value:r})},children:(0,n.jsx)(eo.J,{children:JSON.stringify(l)})})},ei=()=>{let e=(0,a.DP)(),t=(0,er.A)(e=>e.json);return(0,n.jsx)(et.d,{hideRoot:!0,data:JSON.parse(t),valueRenderer:(e,t)=>(0,n.jsx)(ea,{valueAsString:e,value:t}),labelRenderer:(e,t)=>(0,n.jsx)(el,{keyPath:e,nodeType:t}),theme:{extend:{overflow:"scroll",height:"100%",scheme:"monokai",author:"wimer hazenberg (http://www.monokai.nl)",base00:e.GRID_BG_COLOR}}})},es=a.Ay.div.withConfig({componentId:"sc-78d58c26-0"})(["position:relative;height:100%;background:",';overflow:auto;cursor:url("/assets/cursor.svg"),auto;& > ul{margin-top:0 !important;padding:12px !important;font-family:monospace;font-size:14px;font-weight:500;}.tab-group{position:absolute;top:10px;left:10px;z-index:2;}'],({theme:e})=>e.GRID_BG_COLOR),ec=()=>{let[e]=(0,o.F)({key:"viewMode",defaultValue:i.nE.Graph});return e===i.nE.Graph?(0,n.jsx)(s.GraphView,{}):e===i.nE.Tree?(0,n.jsx)(ei,{}):e===i.nE.JsonDraw?(0,n.jsx)(ee,{}):null},ed=()=>(0,n.jsx)(es,{onContextMenuCapture:e=>e.preventDefault(),children:(0,n.jsx)(ec,{})})}}]);
//# sourceMappingURL=75373.da944fa40d5a6fac.js.map