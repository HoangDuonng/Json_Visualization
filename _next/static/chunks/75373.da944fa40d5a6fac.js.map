{"version":3,"file":"static/chunks/75373.da944fa40d5a6fac.js","mappings":"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","sources":["webpack://_N_E/./src/features/collab/useDrawingSync.ts","webpack://_N_E/./src/features/editor/views/JsonDrawView/LoadFromLinkDialog.tsx","webpack://_N_E/./src/features/editor/views/JsonDrawView/jsonToJsonDraw.ts","webpack://_N_E/./src/lib/db.ts","webpack://_N_E/./src/features/editor/views/JsonDrawView/shareBackend.ts","webpack://_N_E/./src/features/editor/views/JsonDrawView/shareLinkUtils.ts","webpack://_N_E/./src/features/editor/views/JsonDrawView/index.tsx","webpack://_N_E/./src/features/editor/views/TreeView/Label.tsx","webpack://_N_E/./src/features/editor/views/TreeView/Value.tsx","webpack://_N_E/./src/features/editor/views/TreeView/index.tsx","webpack://_N_E/./src/features/editor/LiveEditor.tsx"],"sourcesContent":["import { useEffect, useRef } from \"react\";\n// Import reconcile utilities from the JsonDraw drawing engine\nimport { getSceneVersion, reconcileElements, restoreElements } from \"../../jsondraw\";\nimport { useCollab } from \"./CollabRoot\";\nimport { getCollabType } from \"./collabMode\";\nimport { CollabType } from \"../../constants/enumData\";\n\n// Define the shape of our JsonDraw API reference\ninterface JsonDrawAPI {\n  getSceneElementsIncludingDeleted: () => any[];\n  getAppState: () => any;\n  updateScene: (data: {\n    elements?: any[];\n    appState?: any;\n    commitToHistory?: boolean;\n    collaborators?: Map<string, any>;\n  }) => void;\n}\n\nexport const useDrawingSync = (apiRef: React.MutableRefObject<JsonDrawAPI | null>) => {\n  const collab = useCollab() as any;\n  const { socket, isCollaborating, roomId, collaborators, isRoomOwner } = collab;\n  const p2pRoom = collab._p2pRoom as any | null;\n  const canSync: boolean = typeof collab.canSync === \"boolean\" ? collab.canSync : true;\n  const collabType = getCollabType();\n\n  const lastBroadcastedVersion = useRef<number>(-1);\n  const remoteCollaboratorsRef = useRef<Map<string, any>>(new Map());\n  const hasReceivedInitialSync = useRef<boolean>(false);\n\n  const sendDrawRef = useRef<((elements: any[]) => void) | null>(null);\n  const sendPointerRef = useRef<((payload: any) => void) | null>(null);\n\n  // When room changes or collaboration stops, reset sync flag\n  useEffect(() => {\n    if (isCollaborating && canSync) {\n      hasReceivedInitialSync.current = isRoomOwner;\n    } else {\n      hasReceivedInitialSync.current = false;\n      lastBroadcastedVersion.current = -1;\n    }\n  }, [isCollaborating, isRoomOwner, canSync]);\n\n  // Convert `collaborators` state into Excalidraw Map\n  useEffect(() => {\n    const newMap = new Map();\n    collaborators.forEach((user: any) => {\n      if (socket && user.id === socket.id) return;\n      if (!socket && collabType === CollabType.P2P && user.id === collab.currentUserId) {\n        return;\n      }\n\n      const existing = remoteCollaboratorsRef.current.get(user.id);\n\n      newMap.set(user.id, {\n        pointer: existing?.pointer,\n        button: existing?.button || \"up\",\n        username: user.username,\n        color: {\n          background: user.color || \"#eee\",\n          stroke: user.color || \"#eee\",\n        },\n        id: user.id,\n        socketId: user.id,\n      });\n    });\n\n    remoteCollaboratorsRef.current = newMap;\n\n    if (apiRef.current && isCollaborating && canSync) {\n      apiRef.current.updateScene({ collaborators: newMap });\n    }\n  }, [collaborators, apiRef, isCollaborating, socket, collabType, collab, canSync]);\n\n  // 1. Listen for incoming remote drawing updates\n  useEffect(() => {\n    if (!isCollaborating || !canSync) return;\n\n    if (collabType === CollabType.Socket) {\n      if (!socket) return;\n\n      const handleClientDraw = (remoteElements: any[]) => {\n        const api = apiRef.current;\n        if (!api) return;\n\n        const localElements = api.getSceneElementsIncludingDeleted();\n        const appState = api.getAppState();\n\n        let finalElements: any[] = [];\n\n        if (!isRoomOwner && !hasReceivedInitialSync.current) {\n          finalElements = restoreElements(remoteElements, null);\n          hasReceivedInitialSync.current = true;\n        } else {\n          const restoredRemoteElements = restoreElements(remoteElements, localElements);\n          finalElements = reconcileElements(localElements, restoredRemoteElements, appState);\n        }\n\n        lastBroadcastedVersion.current = getSceneVersion(finalElements);\n\n        api.updateScene({\n          elements: finalElements,\n          commitToHistory: false,\n        });\n      };\n\n      socket.on(\"client-draw\", handleClientDraw);\n      sendDrawRef.current = (elements: any[]) => {\n        if (!roomId) return;\n        socket.emit(\"server-draw\", roomId, elements);\n      };\n\n      return () => {\n        socket.off(\"client-draw\", handleClientDraw);\n        sendDrawRef.current = null;\n      };\n    }\n\n    if (collabType === CollabType.P2P && p2pRoom) {\n      const [sendDraw, getDraw] = p2pRoom.makeAction(\"draw\");\n\n      const handleDraw = (remoteElements: any[]) => {\n        const api = apiRef.current;\n        if (!api) return;\n\n        const localElements = api.getSceneElementsIncludingDeleted();\n        const appState = api.getAppState();\n\n        let finalElements: any[] = [];\n\n        if (!isRoomOwner && !hasReceivedInitialSync.current) {\n          finalElements = restoreElements(remoteElements, null);\n          hasReceivedInitialSync.current = true;\n        } else {\n          const restoredRemoteElements = restoreElements(remoteElements, localElements);\n          finalElements = reconcileElements(localElements, restoredRemoteElements, appState);\n        }\n\n        lastBroadcastedVersion.current = getSceneVersion(finalElements);\n\n        api.updateScene({\n          elements: finalElements,\n          commitToHistory: false,\n        });\n      };\n\n      getDraw(handleDraw);\n      sendDrawRef.current = (elements: any[]) => {\n        void sendDraw(elements);\n      };\n\n      return () => {\n        sendDrawRef.current = null;\n      };\n    }\n  }, [socket, isCollaborating, apiRef, isRoomOwner, collabType, p2pRoom, roomId, canSync]);\n\n  // 2. Listen for remote pointers\n  useEffect(() => {\n    if (!isCollaborating || !canSync) return;\n\n    if (collabType === CollabType.Socket) {\n      if (!socket) return;\n\n      const handleClientPointer = (peerId: string, pointerData: any) => {\n        const api = apiRef.current;\n        if (!api) return;\n\n        const collabsMap = remoteCollaboratorsRef.current;\n        const user = collabsMap.get(peerId);\n\n        if (user) {\n          user.pointer = pointerData.pointer;\n          user.button = pointerData.button;\n          user.viewport = pointerData.viewport || user.viewport;\n\n          const newMap = new Map(collabsMap);\n          remoteCollaboratorsRef.current = newMap;\n\n          api.updateScene({ collaborators: newMap });\n\n          // If we are following this user and they sent a viewport,\n          // snap our camera to their scroll/zoom (canvas background),\n          // ignoring their pointer position.\n          try {\n            const appState =\n              typeof api.getAppState === \"function\" ? api.getAppState() : null;\n            const targetSocketId = appState?.userToFollow?.socketId as\n              | string\n              | undefined;\n\n            if (targetSocketId && targetSocketId === peerId && pointerData.viewport) {\n              const viewport = pointerData.viewport as {\n                scrollX: number;\n                scrollY: number;\n                zoom: number;\n              };\n\n              const nextZoomValue =\n                appState?.zoom && typeof appState.zoom.value === \"number\"\n                  ? { ...appState.zoom, value: viewport.zoom }\n                  : { value: viewport.zoom };\n\n              api.updateScene({\n                appState: {\n                  scrollX: viewport.scrollX,\n                  scrollY: viewport.scrollY,\n                  zoom: nextZoomValue,\n                },\n              });\n            }\n          } catch {\n            // best-effort only\n          }\n        }\n      };\n\n      socket.on(\"client-pointer\", handleClientPointer);\n      sendPointerRef.current = (pointerPayload: any) => {\n        if (!roomId) return;\n        socket.emit(\"server-pointer\", roomId, pointerPayload);\n      };\n\n      return () => {\n        socket.off(\"client-pointer\", handleClientPointer);\n        sendPointerRef.current = null;\n      };\n    }\n\n    if (collabType === CollabType.P2P && p2pRoom) {\n      const [sendPointer, getPointer] = p2pRoom.makeAction(\"pointer\");\n\n      const handlePointer = (payload: any, peerId: string) => {\n        const api = apiRef.current;\n        if (!api) return;\n\n        const collabsMap = remoteCollaboratorsRef.current;\n        const user = collabsMap.get(peerId);\n\n        if (user) {\n          user.pointer = payload.pointer;\n          user.button = payload.button;\n          user.viewport = payload.viewport || user.viewport;\n\n          const newMap = new Map(collabsMap);\n          remoteCollaboratorsRef.current = newMap;\n\n          api.updateScene({ collaborators: newMap });\n\n          // Same logic for P2P: if we are following this peer and\n          // they included a viewport, sync our canvas background.\n          try {\n            const appState =\n              typeof api.getAppState === \"function\" ? api.getAppState() : null;\n            const targetSocketId = appState?.userToFollow?.socketId as\n              | string\n              | undefined;\n\n            if (targetSocketId && targetSocketId === peerId && payload.viewport) {\n              const viewport = payload.viewport as {\n                scrollX: number;\n                scrollY: number;\n                zoom: number;\n              };\n\n              const nextZoomValue =\n                appState?.zoom && typeof appState.zoom.value === \"number\"\n                  ? { ...appState.zoom, value: viewport.zoom }\n                  : { value: viewport.zoom };\n\n              api.updateScene({\n                appState: {\n                  scrollX: viewport.scrollX,\n                  scrollY: viewport.scrollY,\n                  zoom: nextZoomValue,\n                },\n              });\n            }\n          } catch {\n            // best-effort only\n          }\n        }\n      };\n\n      getPointer(handlePointer);\n      sendPointerRef.current = (pointerPayload: any) => {\n        void sendPointer(pointerPayload);\n      };\n\n      return () => {\n        sendPointerRef.current = null;\n      };\n    }\n  }, [socket, isCollaborating, apiRef, collabType, p2pRoom, roomId, canSync]);\n\n  // 3. Broadcast local drawing changes\n  const broadcastDrawingChanges = (elements: any[]) => {\n    if (!isCollaborating || !canSync) return;\n\n    if (!isRoomOwner && !hasReceivedInitialSync.current) return;\n\n    const currentVersion = getSceneVersion(elements);\n    if (currentVersion > lastBroadcastedVersion.current) {\n      if (sendDrawRef.current) {\n        sendDrawRef.current(elements);\n      }\n      lastBroadcastedVersion.current = currentVersion;\n    }\n  };\n\n  // 4. Broadcast local pointer position\n  const broadcastPointer = (pointerPayload: any) => {\n    if (!isCollaborating) return;\n    if (sendPointerRef.current) {\n      sendPointerRef.current(pointerPayload);\n    }\n  };\n\n  // 6. Center viewport on the currently followed user immediately (best-effort).\n  const centerOnFollowedUser = () => {\n    const api = apiRef.current;\n    if (!api) return;\n\n    try {\n      const appState = typeof api.getAppState === \"function\" ? api.getAppState() : null;\n      const targetSocketId = appState?.userToFollow?.socketId as string | undefined;\n      if (!targetSocketId) return;\n\n      const collabsMap = remoteCollaboratorsRef.current;\n      const user = collabsMap.get(targetSocketId) as any;\n      const viewport = user?.viewport as\n        | { scrollX: number; scrollY: number; zoom: number }\n        | undefined;\n\n      if (viewport) {\n        const nextZoomValue =\n          appState?.zoom && typeof appState.zoom.value === \"number\"\n            ? { ...appState.zoom, value: viewport.zoom }\n            : { value: viewport.zoom };\n\n        api.updateScene({\n          appState: {\n            scrollX: viewport.scrollX,\n            scrollY: viewport.scrollY,\n            zoom: nextZoomValue,\n          },\n        });\n        return;\n      }\n\n      const pointer = user?.pointer;\n      if (!pointer) return;\n\n      const viewportWidth = appState.width || 0;\n      const viewportHeight = appState.height || 0;\n      const { x, y } = pointer;\n\n      const nextScrollX = x - viewportWidth / 2;\n      const nextScrollY = y - viewportHeight / 2;\n\n      api.updateScene({\n        appState: {\n          scrollX: nextScrollX,\n          scrollY: nextScrollY,\n        },\n      });\n    } catch {\n      // best-effort only\n    }\n  };\n\n  // 5. Handle new users requesting the latest drawing (sync init)\n  useEffect(() => {\n    if (!isCollaborating || !isRoomOwner || !canSync) return;\n\n    if (collabType === CollabType.Socket) {\n      if (!socket) return;\n\n      const handleNewUser = () => {\n        const api = apiRef.current;\n        if (!api) return;\n\n        const elements = api.getSceneElementsIncludingDeleted();\n        if (elements.length > 0 && sendDrawRef.current) {\n          sendDrawRef.current(elements);\n        }\n      };\n\n      socket.on(\"new-user\", handleNewUser);\n\n      return () => {\n        socket.off(\"new-user\", handleNewUser);\n      };\n    }\n\n    if (collabType === CollabType.P2P && p2pRoom) {\n      const handlePeerJoin = (peerId: string) => {\n        const api = apiRef.current;\n        if (!api) return;\n\n        const elements = api.getSceneElementsIncludingDeleted();\n        if (elements.length === 0) return;\n\n        const [sendDraw] = p2pRoom.makeAction(\"draw\");\n        void sendDraw(elements, peerId);\n      };\n\n      p2pRoom.onPeerJoin(handlePeerJoin);\n\n      return () => {\n        p2pRoom.onPeerJoin(() => {});\n      };\n    }\n  }, [socket, isCollaborating, roomId, apiRef, isRoomOwner, collabType, p2pRoom, canSync]);\n\n  return { broadcastDrawingChanges, broadcastPointer, centerOnFollowedUser };\n};\n","import React from \"react\";\nimport { Modal, Box, Text, Button, Stack } from \"@mantine/core\";\nimport styled from \"styled-components\";\nimport { FiAlertTriangle, FiDownload } from \"react-icons/fi\";\n\nconst WarningBanner = styled.div<{ $dark: boolean }>`\n  display: flex;\n  flex-direction: row;\n  align-items: flex-start;\n  gap: 1rem;\n  padding: 1.75rem 2rem;\n  border-radius: 0.5rem;\n  background: ${({ $dark }) => ($dark ? \"rgba(220, 38, 38, 0.12)\" : \"#fef2f2\")};\n  color: ${({ $dark }) => ($dark ? \"#fca5a5\" : \"#991b1b\")};\n\n  @media (max-width: 600px) {\n    flex-direction: column;\n    text-align: center;\n    align-items: center;\n  }\n`;\n\nconst IconWrapper = styled.div<{ $dark: boolean }>`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-shrink: 0;\n  width: 3rem;\n  height: 3rem;\n  border-radius: 50%;\n  background: ${({ $dark }) => ($dark ? \"rgba(220, 38, 38, 0.2)\" : \"#fee2e2\")};\n\n  svg {\n    width: 1.4rem;\n    height: 1.4rem;\n    color: ${({ $dark }) => ($dark ? \"#f87171\" : \"#dc2626\")};\n  }\n`;\n\nconst ActionCard = styled.div<{ $dark: boolean }>`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding: 1.5rem;\n  gap: 0.75rem;\n  text-align: center;\n\n  h4 {\n    margin: 0;\n    font-weight: 700;\n    font-size: 1.125rem;\n    color: ${({ $dark }) => ($dark ? \"#e5e5e5\" : \"#1f2937\")};\n  }\n\n  p {\n    margin: 0;\n    font-size: 0.875rem;\n    color: ${({ $dark }) => ($dark ? \"#a3a3a3\" : \"#6b7280\")};\n    line-height: 1.5;\n  }\n`;\n\nconst WarningText = styled.div<{ $dark: boolean }>`\n  flex: 1;\n  min-width: 0;\n  font-size: 0.95rem;\n  line-height: 1.5;\n  color: ${({ $dark }) => ($dark ? \"#fca5a5\" : \"#991b1b\")};\n\n  strong {\n    color: ${({ $dark }) => ($dark ? \"#f87171\" : \"#dc2626\")};\n  }\n\n  @media (max-width: 600px) {\n    text-align: center;\n  }\n`;\n\ninterface LoadFromLinkDialogProps {\n  opened: boolean;\n  darkMode: boolean;\n  onReplace: () => void;\n  onClose: () => void;\n  onSaveToDisk: () => void;\n  title?: React.ReactNode;\n  message?: React.ReactNode;\n}\n\nexport const LoadFromLinkDialog: React.FC<LoadFromLinkDialogProps> = ({\n  opened,\n  darkMode,\n  onReplace,\n  onClose,\n  onSaveToDisk,\n  title,\n  message,\n}) => {\n  return (\n    <Modal\n      opened={opened}\n      onClose={onClose}\n      title={null}\n      withCloseButton={false}\n      centered\n      size={700}\n      padding=\"xl\"\n      radius=\"lg\"\n      styles={{\n        content: {\n          backgroundColor: darkMode ? \"#1e1e1e\" : \"#ffffff\",\n        },\n        overlay: {\n          backgroundColor: darkMode ? \"rgba(0, 0, 0, 0.7)\" : \"rgba(0, 0, 0, 0.4)\",\n        },\n      }}\n    >\n      <Stack gap=\"lg\">\n        {/* Title */}\n        <Text\n          fw={700}\n          size=\"xl\"\n          style={{\n            fontFamily: \"Assistant, sans-serif\",\n            fontSize: \"1.3rem\",\n            color: darkMode ? \"#e5e5e5\" : \"#111827\",\n          }}\n        >\n          {title || \"Load from link\"}\n        </Text>\n\n        {/* Warning Banner + Replace Button */}\n        <WarningBanner $dark={darkMode}>\n          <IconWrapper $dark={darkMode}>\n            <FiAlertTriangle />\n          </IconWrapper>\n          <WarningText $dark={darkMode}>\n            {message || (\n              <>\n                Loading external drawing will <strong>replace your existing content</strong>. You\n                can back up your drawing first by using one of the options below.\n              </>\n            )}\n          </WarningText>\n          <Button color=\"red\" size=\"md\" onClick={onReplace} style={{ flexShrink: 0 }}>\n            Replace my content\n          </Button>\n        </WarningBanner>\n\n        {/* Save to disk action */}\n        <ActionCard $dark={darkMode}>\n          <h4>Save to disk</h4>\n          <p>Export the scene data to a file from which you can import later.</p>\n          <Button\n            variant=\"outline\"\n            color=\"gray\"\n            size=\"md\"\n            fullWidth\n            leftSection={<FiDownload size={16} />}\n            onClick={onSaveToDisk}\n            styles={{\n              root: {\n                maxWidth: 300,\n                borderColor: darkMode ? \"#404040\" : \"#d1d5db\",\n                color: darkMode ? \"#d4d4d4\" : \"#374151\",\n              },\n            }}\n          >\n            Save to disk\n          </Button>\n        </ActionCard>\n      </Stack>\n    </Modal>\n  );\n};\n","/**\n * Converter: JSON NodeData/EdgeData  JsonDraw Elements\n *\n * Maps the existing graph model (from jsonParser) into JsonDraw-compatible\n * element format so JSON data can be visualized on the JsonDraw whiteboard.\n */\nimport { FONT_FAMILY } from \"@jsondraw/common\";\nimport {\n  JSONDRAW_FONT_SIZE,\n  JSONDRAW_HORIZONTAL_GAP,\n  JSONDRAW_NODE_PADDING,\n  JSONDRAW_ROW_HEIGHT,\n  JSONDRAW_VERTICAL_GAP,\n} from \"../../../../constants/enumData\";\nimport type { NodeData, EdgeData } from \"../../../../types/graph\";\n\n// JsonDraw element types (simplified)\ninterface JsonDrawBaseElement {\n  id: string;\n  type: string;\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n  angle: 0;\n  strokeColor: string;\n  backgroundColor: string;\n  fillStyle: \"solid\" | \"hachure\" | \"cross-hatch\";\n  strokeWidth: number;\n  roughness: number;\n  opacity: number;\n  groupIds: string[];\n  roundness: { type: number } | null;\n  seed: number;\n  version: number;\n  versionNonce: number;\n  isDeleted: false;\n  boundElements: { id: string; type: \"text\" | \"arrow\" }[] | null;\n  index: string | null;\n  updated: number;\n  link: null;\n  locked: false;\n  frameId: null;\n}\n\ninterface JsonDrawRectangleElement extends JsonDrawBaseElement {\n  type: \"rectangle\";\n}\n\ninterface JsonDrawTextElement extends JsonDrawBaseElement {\n  type: \"text\";\n  text: string;\n  fontSize: number;\n  fontFamily: number;\n  textAlign: \"left\" | \"center\" | \"right\";\n  verticalAlign: \"top\" | \"middle\" | \"bottom\";\n  containerId: string | null;\n  originalText: string;\n  autoResize: boolean;\n  lineHeight: number;\n}\n\n// Keeping local interface for now or import?\n// The file defined JsonDrawArrowElement locally but extended Base.\n// Wait, the original file had `interface JsonDrawArrowElement extends JsonDrawBaseElement`.\n// But it imported `JsonDrawArrowElement` type from packages/element/types?\n// Step 905 line 7: `import type { JsonDrawArrowElement } from ...`\n// But line 54 defines `interface JsonDrawArrowElement extends ...`.\n// This is shadowing or extending? TS allows interface merging but here it likely conflicts if imported as type.\n// Ah, line 7 imports it, but line 54 re-declares it?\n// Actually line 7 imports `JsonDrawArrowElement`.\n// And line 54 defines `interface JsonDrawArrowElement`.\n// This would be a specialized version or augmentation?\n// No, line 7 in Step 905 is: `import type { NodeData, EdgeData } from \"../../../../types/graph\";`\n// Wait. Line 7 is NodeData/EdgeData.\n// Where is JsonDrawArrowElement imported?\n// Ah, Step 900 replaced import but failed.\n// Step 905 shows the file content.\n// It does NOT import JsonDrawArrowElement in lines 1-10.\n// Let me check imports again.\n// Line 7: `import type { NodeData, EdgeData } ...`\n// Line 9: `// JsonDraw element types (simplified)`\n// Line 54: `interface JsonDrawArrowElement extends JsonDrawBaseElement`.\n// So it defines them LOCALLY. It does not import them (except maybe `JsonDrawElement` type at line 74 union).\n// Line 74: `type JsonDrawElement = ...`\n// So this file defines its OWN types that match JsonDraw's structure.\n// So I should rename these LOCAL interfaces to JsonDraw...\n// And I don't need to import `JsonDrawArrowElement` if I define it here.\n// But `jsonToJsonDrawElements` returns `JsonDrawElement[]`.\n// Use the local type.\n// So I will rename all local interfaces and the return type.\n\ninterface JsonDrawArrowElement extends JsonDrawBaseElement {\n  type: \"arrow\";\n  points: [number, number][];\n  startBinding: {\n    elementId: string;\n    focus: number;\n    gap: number;\n    fixedPoint: [number, number];\n  } | null;\n  endBinding: {\n    elementId: string;\n    focus: number;\n    gap: number;\n    fixedPoint: [number, number];\n  } | null;\n  startArrowhead: null;\n  endArrowhead: \"arrow\";\n  elbowed: boolean;\n}\n\ntype JsonDrawElement = JsonDrawRectangleElement | JsonDrawTextElement | JsonDrawArrowElement;\n\n// Simple random seed generator\nconst randomSeed = () => Math.floor(Math.random() * 2000000000);\nconst randomNonce = () => Math.floor(Math.random() * 2000000000);\n\n/**\n * Format node text content for display inside JsonDraw rectangle\n */\nconst formatNodeText = (node: NodeData): string => {\n  if (!node.text || node.text.length === 0) return \"\";\n\n  return node.text\n    .map(row => {\n      if (row.key !== null && row.key !== undefined) {\n        if (row.type === \"object\") return `${row.key}: {${row.childrenCount ?? 0} keys}`;\n        if (row.type === \"array\") return `${row.key}: [${row.childrenCount ?? 0} items]`;\n        if (row.value === null) return `${row.key}: null`;\n        return `${row.key}: ${row.value}`;\n      }\n      return `${row.value ?? \"\"}`;\n    })\n    .join(\"\\n\");\n};\n\n/**\n * Layout nodes using a simple layered approach (BFS by depth from root).\n * Returns map of nodeId  { x, y }.\n */\nconst layoutNodes = (\n  nodes: NodeData[],\n  edges: EdgeData[]\n): Map<string, { x: number; y: number }> => {\n  const positions = new Map<string, { x: number; y: number }>();\n\n  if (nodes.length === 0) return positions;\n\n  // Build adjacency list (parent  children)\n  const children = new Map<string, string[]>();\n  const hasParent = new Set<string>();\n\n  for (const edge of edges) {\n    const ch = children.get(edge.from) ?? [];\n    ch.push(edge.to);\n    children.set(edge.from, ch);\n    hasParent.add(edge.to);\n  }\n\n  // Find root nodes (no incoming edges)\n  const roots = nodes.filter(n => !hasParent.has(n.id)).map(n => n.id);\n  if (roots.length === 0 && nodes.length > 0) {\n    roots.push(nodes[0].id);\n  }\n\n  // BFS to assign layers\n  const nodeMap = new Map(nodes.map(n => [n.id, n]));\n  const layers: string[][] = [];\n  const visited = new Set<string>();\n  let queue = [...roots];\n\n  while (queue.length > 0) {\n    const layer: string[] = [];\n    const nextQueue: string[] = [];\n\n    for (const id of queue) {\n      if (visited.has(id)) continue;\n      visited.add(id);\n      layer.push(id);\n\n      const ch = children.get(id) ?? [];\n      for (const childId of ch) {\n        if (!visited.has(childId)) nextQueue.push(childId);\n      }\n    }\n\n    if (layer.length > 0) layers.push(layer);\n    queue = nextQueue;\n  }\n\n  // Also add any orphan nodes (not connected via edges)\n  const orphans = nodes.filter(n => !visited.has(n.id)).map(n => n.id);\n  if (orphans.length > 0) layers.push(orphans);\n\n  // Assign positions by layer (horizontal layout: layers go right)\n  let currentX = 50;\n\n  for (const layer of layers) {\n    let maxWidth = 0;\n    let currentY = 50;\n\n    for (const nodeId of layer) {\n      const node = nodeMap.get(nodeId);\n      if (!node) continue;\n\n      positions.set(nodeId, { x: currentX, y: currentY });\n      currentY += node.height + JSONDRAW_VERTICAL_GAP;\n      maxWidth = Math.max(maxWidth, node.width);\n    }\n\n    currentX += maxWidth + JSONDRAW_HORIZONTAL_GAP;\n  }\n\n  return positions;\n};\n\n/**\n * Convert Json-viz NodeData[] + EdgeData[]  JsonDraw elements\n */\nexport const jsonToJsonDrawElements = (nodes: NodeData[], edges: EdgeData[]): JsonDrawElement[] => {\n  const elements: JsonDrawElement[] = [];\n  const positions = layoutNodes(nodes, edges);\n\n  const now = Date.now();\n  let indexCounter = 0;\n  const getNextIndex = () => `a${(indexCounter++).toString().padStart(6, \"0\")}`;\n\n  // Map to track rectangle element IDs for arrow bindings\n  const rectIds = new Map<string, string>();\n\n  // Create rectangle + text for each node\n  for (const node of nodes) {\n    const pos = positions.get(node.id) ?? { x: 0, y: 0 };\n    const rectId = `rect-${node.id}`;\n    const textId = `text-${node.id}`;\n    const text = formatNodeText(node);\n\n    rectIds.set(node.id, rectId);\n\n    const width = Math.max(node.width + JSONDRAW_NODE_PADDING * 2, 120);\n    const textRows = node.text?.length ?? 1;\n    const height = Math.max(textRows * JSONDRAW_ROW_HEIGHT + JSONDRAW_NODE_PADDING * 2, 50);\n\n    // Collect arrow bindings for this rectangle\n    const boundElements: { id: string; type: \"text\" | \"arrow\" }[] = [{ id: textId, type: \"text\" }];\n\n    for (const edge of edges) {\n      if (edge.from === node.id || edge.to === node.id) {\n        boundElements.push({ id: `arrow-${edge.id}`, type: \"arrow\" });\n      }\n    }\n\n    // Rectangle element\n    const rect: JsonDrawRectangleElement = {\n      id: rectId,\n      type: \"rectangle\",\n      x: pos.x,\n      y: pos.y,\n      width,\n      height,\n      angle: 0,\n      strokeColor: \"#1e1e1e\",\n      backgroundColor: \"transparent\",\n      fillStyle: \"solid\",\n      strokeWidth: 1,\n      roughness: 1,\n      opacity: 100,\n      groupIds: [],\n      roundness: { type: 3 },\n      seed: randomSeed(),\n      version: 1,\n      versionNonce: randomNonce(),\n      isDeleted: false,\n      boundElements,\n      index: getNextIndex(),\n      updated: now,\n      link: null,\n      locked: false,\n      frameId: null,\n    };\n    elements.push(rect);\n\n    // Text element (bound to rectangle)\n    const textEl: JsonDrawTextElement = {\n      id: textId,\n      type: \"text\",\n      x: pos.x + JSONDRAW_NODE_PADDING,\n      y: pos.y + JSONDRAW_NODE_PADDING,\n      width: width - JSONDRAW_NODE_PADDING * 2,\n      height: height - JSONDRAW_NODE_PADDING * 2,\n      angle: 0,\n      strokeColor: \"#1e1e1e\",\n      backgroundColor: \"transparent\",\n      fillStyle: \"solid\",\n      strokeWidth: 1,\n      roughness: 1,\n      opacity: 100,\n      groupIds: [],\n      roundness: null,\n      seed: randomSeed(),\n      version: 1,\n      versionNonce: randomNonce(),\n      isDeleted: false,\n      boundElements: null,\n      index: getNextIndex(),\n      updated: now,\n      link: null,\n      locked: false,\n      frameId: null,\n      text,\n      fontSize: JSONDRAW_FONT_SIZE,\n      fontFamily: FONT_FAMILY.Excalifont,\n      textAlign: \"left\",\n      verticalAlign: \"top\",\n      containerId: rectId,\n      originalText: text,\n      autoResize: true,\n      lineHeight: 1.25,\n    };\n    elements.push(textEl);\n  }\n\n  // Create arrows for each edge\n  for (const edge of edges) {\n    const fromRectId = rectIds.get(edge.from);\n    const toRectId = rectIds.get(edge.to);\n    if (!fromRectId || !toRectId) continue;\n\n    const fromPos = positions.get(edge.from);\n    const toPos = positions.get(edge.to);\n    if (!fromPos || !toPos) continue;\n\n    const fromNode = nodes.find(n => n.id === edge.from);\n    const toNode = nodes.find(n => n.id === edge.to);\n    if (!fromNode || !toNode) continue;\n\n    const fromWidth = Math.max(fromNode.width + JSONDRAW_NODE_PADDING * 2, 120);\n    const fromHeight = Math.max(\n      (fromNode.text?.length ?? 1) * JSONDRAW_ROW_HEIGHT + JSONDRAW_NODE_PADDING * 2,\n      50\n    );\n    const toHeight = Math.max(\n      (toNode.text?.length ?? 1) * JSONDRAW_ROW_HEIGHT + JSONDRAW_NODE_PADDING * 2,\n      50\n    );\n\n    // Arrow starts from right edge of source, ends at left edge of target\n    const startX = fromPos.x + fromWidth;\n    const startY = fromPos.y + fromHeight / 2;\n    const endX = toPos.x;\n    const endY = toPos.y + toHeight / 2;\n\n    const arrow: JsonDrawArrowElement = {\n      id: `arrow-${edge.id}`,\n      type: \"arrow\",\n      x: startX,\n      y: startY,\n      width: Math.abs(endX - startX),\n      height: Math.abs(endY - startY),\n      angle: 0,\n      strokeColor: \"#1e1e1e\",\n      backgroundColor: \"transparent\",\n      fillStyle: \"solid\",\n      strokeWidth: 1,\n      roughness: 1,\n      opacity: 100,\n      groupIds: [],\n      roundness: { type: 2 },\n      seed: randomSeed(),\n      version: 1,\n      versionNonce: randomNonce(),\n      isDeleted: false,\n      boundElements: null,\n      index: getNextIndex(),\n      updated: now,\n      link: null,\n      locked: false,\n      frameId: null,\n      points: [\n        [0, 0],\n        [endX - startX, endY - startY],\n      ],\n      startBinding: {\n        elementId: fromRectId,\n        focus: 0,\n        gap: 5,\n        fixedPoint: [1, 0.5],\n      },\n      endBinding: {\n        elementId: toRectId,\n        focus: 0,\n        gap: 5,\n        fixedPoint: [0, 0.5],\n      },\n      startArrowhead: null,\n      endArrowhead: \"arrow\",\n      elbowed: false,\n    };\n    elements.push(arrow);\n  }\n\n  return elements;\n};\n","import { initializeApp, getApps } from \"firebase/app\";\nimport { getDatabase, Database } from \"firebase/database\";\n\nconst dbConfig = {\n  apiKey: process.env.NEXT_PUBLIC_DB_API_KEY,\n  authDomain: process.env.NEXT_PUBLIC_DB_AUTH_DOMAIN,\n  databaseURL: process.env.NEXT_PUBLIC_DB_URL,\n  projectId: process.env.NEXT_PUBLIC_DB_PROJECT_ID,\n  storageBucket: process.env.NEXT_PUBLIC_DB_STORAGE_BUCKET,\n  messagingSenderId: process.env.NEXT_PUBLIC_DB_SENDER_ID,\n  appId: process.env.NEXT_PUBLIC_DB_APP_ID,\n};\n\nlet _db: Database | null = null;\n\n/**\n * Get database instance lazily  only initializes on first call.\n * This prevents the app from crashing if config is missing.\n */\nexport const getDb = (): Database => {\n  if (_db) return _db;\n\n  if (!dbConfig.databaseURL || !dbConfig.projectId) {\n    throw new Error(\n      \"Database configuration is missing. Please set NEXT_PUBLIC_DB_* environment variables.\"\n    );\n  }\n\n  const app = getApps().length === 0 ? initializeApp(dbConfig) : getApps()[0];\n  _db = getDatabase(app);\n  return _db;\n};\n","import { ref, set, get } from \"firebase/database\";\nimport { getDb } from \"../../../../lib/db\";\n\n/**\n * Convert Uint8Array to base64 string (without spread operator for TS compat)\n */\nconst uint8ToBase64 = (bytes: Uint8Array): string => {\n  let binary = \"\";\n  const chunkSize = 8000;\n  for (let i = 0; i < bytes.length; i += chunkSize) {\n    binary += String.fromCharCode.apply(null, Array.from(bytes.slice(i, i + chunkSize)));\n  }\n  return btoa(binary);\n};\n\n/**\n * Convert base64 string to Uint8Array\n */\nconst base64ToUint8 = (base64: string): Uint8Array => {\n  const binary = atob(base64);\n  const bytes = new Uint8Array(binary.length);\n  for (let i = 0; i < binary.length; i++) {\n    bytes[i] = binary.charCodeAt(i);\n  }\n  return bytes;\n};\n\n/**\n * Generate a short random ID for share links (URL-safe, 20 chars)\n */\nconst generateId = (): string => {\n  const array = new Uint8Array(15);\n  crypto.getRandomValues(array);\n  const base64 = uint8ToBase64(array);\n  return base64.replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=+$/, \"\");\n};\n\n/**\n * Generate an AES-GCM encryption key and return it as a base64url string\n */\nexport const generateEncryptionKey = async (): Promise<string> => {\n  const key = await crypto.subtle.generateKey({ name: \"AES-GCM\", length: 128 }, true, [\n    \"encrypt\",\n    \"decrypt\",\n  ]);\n  const exported = await crypto.subtle.exportKey(\"raw\", key);\n  const bytes = new Uint8Array(exported);\n  const base64 = uint8ToBase64(bytes);\n  return base64.replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=+$/, \"\");\n};\n\n/**\n * Import an AES-GCM key from a base64url string\n */\nconst importKey = async (keyStr: string): Promise<CryptoKey> => {\n  // Convert base64url back to standard base64\n  let base64 = keyStr.replace(/-/g, \"+\").replace(/_/g, \"/\");\n  while (base64.length % 4) base64 += \"=\";\n\n  const raw = base64ToUint8(base64);\n  return crypto.subtle.importKey(\"raw\", raw.buffer as ArrayBuffer, { name: \"AES-GCM\" }, false, [\n    \"encrypt\",\n    \"decrypt\",\n  ]);\n};\n\n/**\n * Encrypt data using AES-GCM.\n * Returns a Uint8Array with IV prepended to ciphertext.\n */\nconst encryptData = async (data: Uint8Array, keyStr: string): Promise<Uint8Array> => {\n  const key = await importKey(keyStr);\n  const iv = crypto.getRandomValues(new Uint8Array(12));\n  const encrypted = await crypto.subtle.encrypt(\n    { name: \"AES-GCM\", iv },\n    key,\n    data.buffer as ArrayBuffer\n  );\n  // Prepend IV to ciphertext\n  const result = new Uint8Array(iv.length + encrypted.byteLength);\n  result.set(iv);\n  result.set(new Uint8Array(encrypted), iv.length);\n  return result;\n};\n\n/**\n * Decrypt data using AES-GCM.\n * Expects IV prepended to ciphertext.\n */\nconst decryptData = async (data: Uint8Array, keyStr: string): Promise<Uint8Array> => {\n  const key = await importKey(keyStr);\n  const iv = data.slice(0, 12);\n  const ciphertext = data.slice(12);\n  const decrypted = await crypto.subtle.decrypt(\n    { name: \"AES-GCM\", iv },\n    key,\n    ciphertext.buffer as ArrayBuffer\n  );\n  return new Uint8Array(decrypted);\n};\n\n/**\n * Upload encrypted + compressed scene data to the backend.\n * Returns { id, encryptionKey } for the share link.\n */\nexport const exportToBackend = async (\n  compressedData: Uint8Array\n): Promise<{ id: string; encryptionKey: string }> => {\n  const id = generateId();\n  const encryptionKey = await generateEncryptionKey();\n\n  // Encrypt the compressed data\n  const encrypted = await encryptData(compressedData, encryptionKey);\n\n  // Convert to base64 for storage (DB stores strings)\n  const base64Data = uint8ToBase64(encrypted);\n\n  // Store in database\n  const dbRef = ref(getDb(), `shared/${id}`);\n  await set(dbRef, {\n    data: base64Data,\n    createdAt: Date.now(),\n  });\n\n  return { id, encryptionKey };\n};\n\n/**\n * Download and decrypt scene data from the backend.\n * Returns decrypted data as Uint8Array, or null if not found.\n */\nexport const importFromBackend = async (\n  id: string,\n  encryptionKey: string\n): Promise<Uint8Array | null> => {\n  try {\n    const dbRef = ref(getDb(), `shared/${id}`);\n    const snapshot = await get(dbRef);\n\n    if (!snapshot.exists()) {\n      console.error(\"Share link data not found:\", id);\n      return null;\n    }\n\n    const { data: base64Data } = snapshot.val();\n\n    // Convert base64 back to Uint8Array\n    const encrypted = base64ToUint8(base64Data);\n\n    // Decrypt\n    const decrypted = await decryptData(encrypted, encryptionKey);\n\n    return decrypted;\n  } catch (error) {\n    console.error(\"Failed to import shared data:\", error);\n    return null;\n  }\n};\n","import pako from \"pako\";\nimport { exportToBackend, importFromBackend } from \"./shareBackend\";\n\ninterface ShareSceneData {\n  elements: any[];\n  appState: any;\n  files?: Record<string, any>;\n}\n\nconst pickUsedFiles = (elements: any[], files?: Record<string, any>) => {\n  if (!files) {\n    return undefined;\n  }\n\n  const fileIds = new Set<string>();\n  for (const el of elements) {\n    if (el && typeof el === \"object\" && \"fileId\" in el && el.fileId) {\n      fileIds.add(el.fileId);\n    }\n  }\n\n  if (fileIds.size === 0) {\n    return undefined;\n  }\n\n  const usedFiles: Record<string, any> = {};\n  for (const fileId of fileIds) {\n    if (files[fileId]) {\n      usedFiles[fileId] = files[fileId];\n    }\n  }\n\n  return Object.keys(usedFiles).length ? usedFiles : undefined;\n};\n\n//  Backend-based share link \n\n/**\n * Create a shareable link by uploading encrypted data to the backend.\n * Returns a short URL like: https://jsonviz.online/draw#json=<id>,<key>\n */\nexport const createShareLink = async (\n  elements: any[],\n  appState: any,\n  files?: Record<string, any>\n): Promise<string> => {\n  const nonDeletedElements = elements\n    .filter(el => !el.isDeleted)\n    .map(el => ({ ...el, isDeleted: undefined }));\n\n  const data = {\n    elements: nonDeletedElements,\n    files: pickUsedFiles(nonDeletedElements, files),\n    appState: {\n      viewBackgroundColor: appState.viewBackgroundColor,\n      theme: appState.theme,\n    },\n  };\n\n  const jsonString = JSON.stringify(data);\n  const compressed = pako.deflate(new TextEncoder().encode(jsonString));\n\n  const { id, encryptionKey } = await exportToBackend(compressed);\n\n  // Key is stored in hash  never sent to server  end-to-end encrypted\n  const hash = `#json=${id},${encryptionKey}`;\n  return `${window.location.origin}${window.location.pathname}${hash}`;\n};\n\n/**\n * Load scene data from a share link.\n * Hash format: #json=<id>,<key>\n */\nexport const loadFromShareLink = async (hash: string): Promise<ShareSceneData | null> => {\n  const match = hash.match(/^#json=([a-zA-Z0-9_-]+),([a-zA-Z0-9_-]+)$/);\n  if (!match) return null;\n\n  const [, id, encryptionKey] = match;\n\n  const decrypted = await importFromBackend(id, encryptionKey);\n  if (!decrypted) return null;\n\n  try {\n    const jsonString = pako.inflate(decrypted, { to: \"string\" });\n    return JSON.parse(jsonString);\n  } catch (error) {\n    console.error(\"Failed to decompress share link data:\", error);\n    return null;\n  }\n};\n\n/**\n * Check if the current URL hash is a backend share link\n */\nexport const isBackendShareLink = (hash: string): boolean => {\n  return /^#json=([a-zA-Z0-9_-]+),([a-zA-Z0-9_-]+)$/.test(hash);\n};\n\n//  Legacy URL-based share link (backward compatibility) \n\n/**\n * Decode legacy #data= format (base64 in URL).\n * Kept for backward compatibility with old shared links.\n * @deprecated Use loadFromShareLink instead for new links.\n */\nexport const decodeDataFromUrlHash = (hash: string) => {\n  try {\n    let base64 = hash.replace(\"#data=\", \"\");\n\n    // Backward compatibility: try to decode legacy encodeURIComponent strings\n    try {\n      base64 = decodeURIComponent(base64);\n    } catch {\n      // Ignore\n    }\n\n    // Convert from url-safe base64 to standard base64\n    base64 = base64.replace(/-/g, \"+\").replace(/_/g, \"/\");\n    // Restore padding if necessary\n    while (base64.length % 4) {\n      base64 += \"=\";\n    }\n\n    const binaryString = window.atob(base64);\n\n    const bytes = new Uint8Array(binaryString.length);\n    for (let i = 0; i < binaryString.length; i++) {\n      bytes[i] = binaryString.charCodeAt(i);\n    }\n\n    const decompressed = pako.inflate(bytes, { to: \"string\" });\n    return JSON.parse(decompressed);\n  } catch (error) {\n    console.error(\"Failed to decode legacy sharelink data\", error);\n    return null;\n  }\n};\n","import React from \"react\";\nimport {\n  Box,\n  Modal,\n  Text,\n  Stack,\n  Button,\n  TextInput,\n  ActionIcon,\n  Menu,\n  PasswordInput,\n  Group,\n  Badge,\n} from \"@mantine/core\";\nimport styled from \"styled-components\";\nimport { toast } from \"react-hot-toast\";\nimport {\n  FiCopy,\n  FiCheck,\n  FiLock,\n  FiX,\n  FiShare2,\n  FiUsers,\n  FiLogOut,\n  FiPlay,\n  FiKey,\n  FiUserX,\n  FiEye,\n} from \"react-icons/fi\";\nimport { HamsterLoader, saveAsJSON, restoreAppState, restoreElements } from \"../../../../jsondraw\";\nimport useConfig from \"../../../../store/useConfig\";\nimport { useCollab } from \"../../../collab/CollabRoot\";\nimport { useDrawingSync } from \"../../../collab/useDrawingSync\";\nimport useGraph from \"../GraphView/stores/useGraph\";\nimport { LoadFromLinkDialog } from \"./LoadFromLinkDialog\";\nimport { jsonToJsonDrawElements } from \"./jsonToJsonDraw\";\nimport {\n  createShareLink,\n  loadFromShareLink,\n  isBackendShareLink,\n  decodeDataFromUrlHash,\n} from \"./shareLinkUtils\";\n\nconst StyledJsonDrawWrapper = styled.div<{ $ready: boolean }>`\n  width: 100%;\n  height: 100%;\n  position: relative;\n  opacity: ${({ $ready }) => ($ready ? 1 : 0)};\n  transition: opacity 0.2s ease;\n\n  .jsondraw-wrapper {\n    width: 100%;\n    height: 100%;\n  }\n`;\n\nexport const JsonDrawView = () => {\n  const nodes = useGraph(state => state.nodes);\n  const edges = useGraph(state => state.edges);\n  const darkmodeEnabled = useConfig(state => state.darkmodeEnabled);\n\n  const [JsonDrawModule, setJsonDrawModule] = React.useState<{\n    JsonDraw: React.ComponentType<any>;\n  } | null>(null);\n  const [drawReady, setDrawReady] = React.useState(false);\n\n  const jsonDrawAPIRef = React.useRef<any>(null);\n  const hasInitialized = React.useRef(false);\n  const hasUserDrawing = React.useRef(false);\n  const [showClearModal, setShowClearModal] = React.useState(false);\n\n  // Share Modal states\n  const [showShareModal, setShowShareModal] = React.useState(false);\n  const [shareUrl, setShareUrl] = React.useState(\"\");\n  const [justCopied, setJustCopied] = React.useState(false);\n  const [isSharing, setIsSharing] = React.useState(false);\n  const copyTimerRef = React.useRef<number | null>(null);\n\n  const [followedUserId, setFollowedUserId] = React.useState<string | null>(null);\n\n  // Collab States\n  const {\n    isCollaborating,\n    roomId: activeRoomId,\n    startCollaboration,\n    stopCollaboration,\n    collaborators,\n    currentUserId,\n    isRoomOwner,\n    maxCollaborators,\n    kickCollaborator,\n    passwordRequiredRoom,\n    setPasswordRequiredRoom,\n    waitingForApproval,\n    pendingRequests,\n    approveJoin,\n    rejectJoin,\n    submitRoomPassword,\n  } = useCollab();\n  const [showCollabModal, setShowCollabModal] = React.useState(false);\n  const [collabPasswordInput, setCollabPasswordInput] = React.useState(\"\");\n  const [joinPasswordInput, setJoinPasswordInput] = React.useState(\"\");\n  const [pendingCollabRoomId, setPendingCollabRoomId] = React.useState<string | null>(null);\n\n  // Load from link dialog states\n  const [showLoadFromLinkDialog, setShowLoadFromLinkDialog] = React.useState(false);\n  const pendingShareDataRef = React.useRef<{\n    elements: any[];\n    appState: any;\n    files?: Record<string, any>;\n  } | null>(null);\n  const isHandlingShareRef = React.useRef(false);\n  const lastHandledHashRef = React.useRef<string | null>(null);\n\n  // Bind drawing collab sync via Socket.IO / P2P\n  const { broadcastDrawingChanges, broadcastPointer, centerOnFollowedUser } =\n    useDrawingSync(jsonDrawAPIRef);\n\n  // Keep track of the last local pointer so we can keep sending\n  // up-to-date viewport information even when the pointer is idle.\n  const lastPointerRef = React.useRef<{ x: number; y: number; tool: string } | null>(null);\n\n  // Auto-save to localStorage and emit drawing updates\n  const handleChange = React.useCallback(\n    (elements: any, appState: any, files?: Record<string, any>) => {\n      hasUserDrawing.current = true;\n\n      // Emit changes across WS\n      broadcastDrawingChanges(elements);\n\n      try {\n        const sceneFiles = files ?? jsonDrawAPIRef.current?.getFiles?.() ?? null;\n        localStorage.setItem(\n          \"jsondraw-autosave\",\n          JSON.stringify({\n            elements,\n            files: sceneFiles,\n            appState: { theme: appState.theme, zoom: appState.zoom },\n          })\n        );\n      } catch (error) {\n        console.warn(\"Failed to save to localStorage:\", error);\n      }\n    },\n    [broadcastDrawingChanges]\n  );\n\n  // Set font asset path before loading JsonDraw\n  React.useEffect(() => {\n    if (typeof window !== \"undefined\") {\n      window.JSONDRAW_ASSET_PATH = \"/\";\n    }\n  }, []);\n\n  // Dynamic import to avoid SSR issues (Canvas API is client-only)\n  React.useEffect(() => {\n    import(\"../../../../jsondraw\").then(mod => {\n      setJsonDrawModule({ JsonDraw: mod.JsonDraw });\n      setDrawReady(false);\n    });\n\n    // Auto-join collab room if URL has it\n    if (typeof window !== \"undefined\") {\n      const hashParams = new URLSearchParams(window.location.hash.replace(/^#/, \"\"));\n      const rId = hashParams.get(\"collabRoomId\");\n      if (rId && !activeRoomId) {\n        let hasContent = false;\n        const saved = localStorage.getItem(\"jsondraw-autosave\");\n        if (saved) {\n          try {\n            const parsed = JSON.parse(saved);\n            if (Array.isArray(parsed.elements) && parsed.elements.length > 0) {\n              hasContent = true;\n            }\n          } catch (e) {\n            hasContent = true;\n          }\n        }\n\n        if (hasContent) {\n          setPendingCollabRoomId(rId);\n        } else {\n          startCollaboration(rId, undefined, { asOwner: false });\n        }\n      }\n    }\n  }, []);\n\n  const scrollToContent = React.useCallback((api: any, delay = 120) => {\n    requestAnimationFrame(() => {\n      setTimeout(() => {\n        api.scrollToContent(undefined, { fitToViewport: true, viewportZoomFactor: 0.8 });\n        setDrawReady(true);\n      }, delay);\n    });\n  }, []);\n\n  // Apply shared data to the scene (called after user confirms or if canvas is empty)\n  const applySharedData = React.useCallback(\n    (data: { elements: any[]; appState: any; files?: Record<string, any> }) => {\n      const api = jsonDrawAPIRef.current;\n      if (!api) return;\n\n      hasUserDrawing.current = true;\n      hasInitialized.current = true;\n      setDrawReady(false);\n\n      const restoredElements = restoreElements(data.elements, null);\n      const restoredAppState = {\n        ...restoreAppState(data.appState, api.getAppState()),\n        isLoading: false,\n      };\n\n      requestAnimationFrame(() => {\n        if (data.files && Object.keys(data.files).length > 0) {\n          api.addFiles(data.files);\n        }\n        api.updateScene({\n          elements: restoredElements,\n          appState: restoredAppState,\n        });\n        scrollToContent(api, 120);\n      });\n\n      // Clean up the URL hash without reloading\n      window.history.replaceState({}, \"\", window.location.pathname);\n    },\n    [scrollToContent]\n  );\n\n  // Handle replace action from LoadFromLinkDialog\n  const handleReplaceContent = React.useCallback(() => {\n    const data = pendingShareDataRef.current;\n    if (!data) return;\n\n    applySharedData(data);\n    pendingShareDataRef.current = null;\n    setShowLoadFromLinkDialog(false);\n    toast.success(\"Drawing loaded from shared link!\");\n  }, [applySharedData]);\n\n  // Handle save to disk\n  const handleSaveToDisk = React.useCallback(async () => {\n    const api = jsonDrawAPIRef.current;\n    if (!api) return;\n\n    try {\n      const elements = api.getSceneElementsIncludingDeleted();\n      const appState = api.getAppState();\n      const files = api.getFiles();\n      const name = api.getName?.() || appState.name;\n      await saveAsJSON(elements, appState, files, name);\n      toast.success(\"Drawing saved to disk!\");\n    } catch (error) {\n      toast.error(\"Failed to save drawing.\");\n    }\n  }, []);\n\n  // Helper: Initialize from localStorage or JSON data\n  const initFromLocalOrJson = React.useCallback(\n    (api: any) => {\n      // Try to restore from localStorage first\n      const saved = localStorage.getItem(\"jsondraw-autosave\");\n      if (saved) {\n        try {\n          const { elements, appState, files } = JSON.parse(saved);\n          const restoredElements = restoreElements(elements, null);\n          const restoredAppState = {\n            ...restoreAppState(appState, api.getAppState()),\n            isLoading: false,\n          };\n          hasUserDrawing.current = true;\n          setDrawReady(false);\n          requestAnimationFrame(() => {\n            if (files && Object.keys(files).length > 0) {\n              api.addFiles(files);\n            }\n            api.updateScene({\n              elements: restoredElements,\n              appState: restoredAppState,\n            });\n            scrollToContent(api, 120);\n          });\n          return;\n        } catch (error) {\n          console.warn(\"Failed to restore from localStorage:\", error);\n        }\n      }\n\n      // Set initial elements from JSON only if no saved drawing\n      if (nodes.length > 0 && !hasInitialized.current) {\n        hasInitialized.current = true;\n        const elements = restoreElements(jsonToJsonDrawElements(nodes, edges) as any, null);\n        setDrawReady(false);\n\n        requestAnimationFrame(() => {\n          api.updateScene({ elements, appState: { isLoading: false } });\n          scrollToContent(api, 200);\n        });\n      }\n    },\n    [nodes, edges, scrollToContent]\n  );\n\n  const hasExistingContent = React.useCallback(() => {\n    const saved = localStorage.getItem(\"jsondraw-autosave\");\n    if (saved) {\n      try {\n        const parsed = JSON.parse(saved);\n        if (Array.isArray(parsed.elements) && parsed.elements.length > 0) {\n          return true;\n        }\n      } catch (error) {\n        console.warn(\"Failed to parse autosave data:\", error);\n        return true;\n      }\n    }\n\n    const api = jsonDrawAPIRef.current;\n    if (!api) return false;\n    const elements = api.getSceneElementsIncludingDeleted();\n    return Array.isArray(elements) && elements.length > 0;\n  }, []);\n\n  const handleShareLinkFromHash = React.useCallback(\n    async (hash: string) => {\n      if (typeof window === \"undefined\") return false;\n      if (!hash) return false;\n      if (!isBackendShareLink(hash) && !hash.startsWith(\"#data=\")) return false;\n\n      const api = jsonDrawAPIRef.current;\n      if (!api) return false;\n\n      if (hash === lastHandledHashRef.current || isHandlingShareRef.current) return true;\n\n      lastHandledHashRef.current = hash;\n      isHandlingShareRef.current = true;\n      setDrawReady(false);\n\n      try {\n        if (isBackendShareLink(hash)) {\n          const data = await loadFromShareLink(hash);\n          if (!data || !data.elements) {\n            toast.error(\"Could not load shared drawing. The link may be invalid or expired.\");\n            initFromLocalOrJson(api);\n            return true;\n          }\n\n          if (hasExistingContent()) {\n            pendingShareDataRef.current = data;\n            setShowLoadFromLinkDialog(true);\n            initFromLocalOrJson(api);\n          } else {\n            applySharedData(data);\n          }\n          return true;\n        }\n\n        const decoded = decodeDataFromUrlHash(hash);\n        if (decoded && decoded.elements) {\n          if (hasExistingContent()) {\n            pendingShareDataRef.current = decoded;\n            setShowLoadFromLinkDialog(true);\n            initFromLocalOrJson(api);\n          } else {\n            applySharedData(decoded);\n          }\n          return true;\n        }\n\n        initFromLocalOrJson(api);\n        return true;\n      } catch (error) {\n        console.error(\"Failed to load share link:\", error);\n        toast.error(\"Failed to load shared drawing.\");\n        initFromLocalOrJson(api);\n        return true;\n      } finally {\n        isHandlingShareRef.current = false;\n      }\n    },\n    [applySharedData, hasExistingContent, initFromLocalOrJson]\n  );\n\n  // Update scene elements when nodes/edges change AFTER API is ready\n  // BUT only if user hasn't drawn anything yet\n  React.useEffect(() => {\n    const api = jsonDrawAPIRef.current;\n    if (!api || nodes.length === 0 || hasUserDrawing.current) return;\n\n    const elements = jsonToJsonDrawElements(nodes, edges);\n    api.updateScene({ elements });\n    scrollToContent(api, 80);\n  }, [nodes, edges, scrollToContent]);\n\n  const handleJsonDrawAPI = React.useCallback(\n    (api: any) => {\n      jsonDrawAPIRef.current = api;\n\n      if (typeof window === \"undefined\") return;\n\n      // Sync local follow state with JsonDraw's follow mode\n      if (api.onUserFollow) {\n        api.onUserFollow((payload: any) => {\n          if (!payload || !payload.userToFollow) {\n            setFollowedUserId(null);\n            return;\n          }\n          if (payload.action === \"FOLLOW\") {\n            setFollowedUserId(payload.userToFollow.socketId || null);\n          } else if (payload.action === \"UNFOLLOW\") {\n            setFollowedUserId(prev =>\n              prev === payload.userToFollow.socketId ? null : prev\n            );\n          }\n        });\n      }\n\n      const hash = window.location.hash;\n\n      handleShareLinkFromHash(hash).then(handled => {\n        if (!handled) {\n          initFromLocalOrJson(api);\n        }\n      });\n    },\n    [handleShareLinkFromHash, initFromLocalOrJson]\n  );\n\n  React.useEffect(() => {\n    if (typeof window === \"undefined\") return;\n\n    const handleHashChange = () => {\n      const hash = window.location.hash;\n      handleShareLinkFromHash(hash);\n    };\n\n    window.addEventListener(\"hashchange\", handleHashChange);\n    return () => window.removeEventListener(\"hashchange\", handleHashChange);\n  }, [handleShareLinkFromHash]);\n\n  const prevPendingRequestsLength = React.useRef(pendingRequests?.length || 0);\n  React.useEffect(() => {\n    if (pendingRequests && pendingRequests.length > prevPendingRequestsLength.current) {\n      const latestReq = pendingRequests[pendingRequests.length - 1];\n      toast(`${latestReq.username} wants to join the room!`, { icon: \"\" });\n    }\n    prevPendingRequestsLength.current = pendingRequests?.length || 0;\n  }, [pendingRequests]);\n\n  const handleClearDrawing = React.useCallback(() => {\n    if (!jsonDrawAPIRef.current) return;\n\n    localStorage.removeItem(\"jsondraw-autosave\");\n    hasUserDrawing.current = false;\n    hasInitialized.current = false;\n\n    const elements = jsonToJsonDrawElements(nodes, edges);\n    jsonDrawAPIRef.current.updateScene({ elements });\n    setDrawReady(false);\n    scrollToContent(jsonDrawAPIRef.current, 120);\n\n    setShowClearModal(false);\n    toast.success(\"Drawing cleared! Loaded JSON visualization.\");\n  }, [nodes, edges, scrollToContent]);\n\n  const handleCopyLink = React.useCallback(() => {\n    navigator.clipboard\n      .writeText(shareUrl)\n      .then(() => {\n        setJustCopied(true);\n        if (copyTimerRef.current) window.clearTimeout(copyTimerRef.current);\n        copyTimerRef.current = window.setTimeout(() => setJustCopied(false), 3000) as any;\n      })\n      .catch(() => toast.error(\"Failed to copy link.\"));\n  }, [shareUrl]);\n\n  const handleShareClick = React.useCallback(async () => {\n    const api = jsonDrawAPIRef.current;\n    if (!api) return;\n\n    setIsSharing(true);\n    try {\n      const elements = api.getSceneElementsIncludingDeleted();\n      const appState = api.getAppState();\n      const files = api.getFiles();\n\n      const url = await createShareLink(elements, appState, files);\n      setShareUrl(url);\n      setShowShareModal(true);\n    } catch (error: any) {\n      console.error(\"Share failed:\", error);\n      toast.error(\"Failed to create share link. Please try again.\");\n    } finally {\n      setIsSharing(false);\n    }\n  }, []);\n\n  // Periodically broadcast the current viewport so that when someone clicks\n  // \"Follow\", they can snap to the latest camera (scroll + zoom) of the user\n  // being followed, even if that user only zoomed/panned without moving\n  // their pointer recently.\n  React.useEffect(() => {\n    if (!isCollaborating) return;\n\n    const intervalId = window.setInterval(() => {\n      const api = jsonDrawAPIRef.current;\n      if (!api || typeof api.getAppState !== \"function\") return;\n\n      const state = api.getAppState();\n      const zoomValue =\n        state.zoom && typeof state.zoom.value === \"number\" ? state.zoom.value : 1;\n\n      const viewport = {\n        scrollX: state.scrollX || 0,\n        scrollY: state.scrollY || 0,\n        zoom: zoomValue,\n      };\n\n      const pointer = lastPointerRef.current;\n\n      broadcastPointer({\n        pointer: pointer || null,\n        button: \"none\",\n        viewport,\n      });\n    }, 600);\n\n    return () => {\n      window.clearInterval(intervalId);\n    };\n  }, [isCollaborating, broadcastPointer]);\n\n  const handleToggleFollowUser = React.useCallback(\n    (userId: string, username?: string | null) => {\n      const api = jsonDrawAPIRef.current;\n      if (!api || typeof api.getAppState !== \"function\") return;\n\n      const appState = api.getAppState();\n      const currentSocketId = appState?.userToFollow?.socketId as string | undefined;\n\n      if (currentSocketId && currentSocketId === userId) {\n        api.updateScene({\n          appState: {\n            userToFollow: null,\n          },\n        });\n        setFollowedUserId(null);\n      } else {\n        api.updateScene({\n          appState: {\n            userToFollow: {\n              socketId: userId,\n              username: username || \"\",\n            },\n          },\n        });\n        setFollowedUserId(userId);\n        centerOnFollowedUser();\n      }\n    },\n    [centerOnFollowedUser]\n  );\n\n  const handleStartLiveCollab = React.useCallback(() => {\n    if (!activeRoomId) {\n      // Create new session if none is active\n      const genId = Math.random().toString(36).substring(2, 10);\n      startCollaboration(genId, collabPasswordInput, { asOwner: true });\n    }\n  }, [activeRoomId, collabPasswordInput, startCollaboration]);\n\n  const handleJoinWithPassword = React.useCallback(() => {\n    if (passwordRequiredRoom) {\n      submitRoomPassword(joinPasswordInput);\n      setPasswordRequiredRoom(null);\n      setJoinPasswordInput(\"\");\n    }\n  }, [passwordRequiredRoom, joinPasswordInput, submitRoomPassword, setPasswordRequiredRoom]);\n\n  const handleCancelJoin = React.useCallback(() => {\n    setPasswordRequiredRoom(null);\n    setJoinPasswordInput(\"\");\n    if (typeof window !== \"undefined\") {\n      window.location.hash = \"\";\n    }\n  }, [setPasswordRequiredRoom]);\n\n  const handleCancelWait = React.useCallback(() => {\n    stopCollaboration();\n    if (typeof window !== \"undefined\") {\n      window.location.hash = \"\";\n    }\n  }, [stopCollaboration]);\n\n  const getCollabShareUrl = () => {\n    if (typeof window !== \"undefined\" && activeRoomId) {\n      const url = new URL(window.location.href);\n      url.search = \"\"; // clear query params\n      const hashParams = new URLSearchParams();\n      hashParams.set(\"collabRoomId\", activeRoomId);\n      url.hash = hashParams.toString();\n      return url.toString();\n    }\n    return \"\";\n  };\n\n  if (!JsonDrawModule) {\n    return (\n      <Box pos=\"relative\" h=\"100%\" w=\"100%\">\n        <Box pos=\"absolute\" inset={0} style={{ display: \"grid\", placeItems: \"center\" }}>\n          <HamsterLoader />\n        </Box>\n      </Box>\n    );\n  }\n\n  const { JsonDraw } = JsonDrawModule;\n\n  return (\n    <Box pos=\"relative\" h=\"100%\" w=\"100%\">\n      {!drawReady && (\n        <Box pos=\"absolute\" inset={0} style={{ display: \"grid\", placeItems: \"center\" }}>\n          <HamsterLoader />\n        </Box>\n      )}\n\n      {/* Clear Drawing Modal */}\n      <Modal\n        opened={showClearModal}\n        onClose={() => setShowClearModal(false)}\n        title=\"Clear Drawing Session\"\n        centered\n      >\n        <Stack gap=\"md\">\n          <Text>\n            This will <strong>permanently delete</strong> your current drawing session and load a\n            fresh visualization from the JSON data.\n          </Text>\n          <Text c=\"dimmed\" size=\"sm\">\n            Make sure to save your work first. Your current drawing will be lost and cannot be\n            recovered.\n          </Text>\n          <Box style={{ display: \"flex\", gap: \"8px\", justifyContent: \"flex-end\" }}>\n            <Button variant=\"default\" onClick={() => setShowClearModal(false)}>\n              Cancel\n            </Button>\n            <Button color=\"red\" onClick={handleClearDrawing}>\n              Clear & Load JSON\n            </Button>\n          </Box>\n        </Stack>\n      </Modal>\n\n      {/* Share Link Modal */}\n      <Modal\n        opened={showShareModal}\n        onClose={() => setShowShareModal(false)}\n        title={null}\n        withCloseButton={false}\n        centered\n        size=\"md\"\n        padding=\"xl\"\n        radius=\"lg\"\n        styles={{\n          content: {\n            backgroundColor: darkmodeEnabled ? \"#121212\" : \"#ffffff\",\n          },\n        }}\n      >\n        <Stack gap=\"lg\">\n          <Box style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\" }}>\n            <Text fw={700} size=\"xl\" style={{ fontFamily: \"Assistant, sans-serif\" }}>\n              Shareable link\n            </Text>\n            <ActionIcon variant=\"subtle\" color=\"gray\" onClick={() => setShowShareModal(false)}>\n              <FiX size={20} />\n            </ActionIcon>\n          </Box>\n          <Box style={{ display: \"flex\", gap: \"12px\", alignItems: \"flex-end\" }}>\n            <TextInput\n              label=\"Link\"\n              readOnly\n              value={shareUrl}\n              style={{ flex: 1 }}\n              styles={{\n                input: {\n                  backgroundColor: darkmodeEnabled ? \"rgba(255,255,255,0.05)\" : \"#f3f4f6\",\n                  border: \"none\",\n                  boxShadow: \"none\",\n                  height: 40,\n                },\n                label: {\n                  marginBottom: 8,\n                  fontSize: 12,\n                  fontWeight: 600,\n                  color: darkmodeEnabled ? \"#a3a3a3\" : \"#4b5563\",\n                },\n              }}\n              onClick={e => (e.target as HTMLInputElement).select()}\n            />\n            <Button\n              size=\"md\"\n              leftSection={justCopied ? <FiCheck size={18} /> : <FiCopy size={18} />}\n              color={justCopied ? \"teal\" : \"violet\"}\n              onClick={handleCopyLink}\n              style={{\n                height: 40,\n                minWidth: 120,\n                transition: \"background-color 0.2s\",\n              }}\n            >\n              Copy link\n            </Button>\n          </Box>\n          <Box\n            style={{\n              borderTop: `1px solid ${darkmodeEnabled ? \"#333\" : \"#e5e7eb\"}`,\n              paddingTop: 16,\n            }}\n          >\n            <Text\n              size=\"sm\"\n              c=\"dimmed\"\n              style={{ display: \"flex\", alignItems: \"center\", gap: \"8px\" }}\n            >\n              <FiLock size={16} /> Data is end-to-end encrypted. Only people with the link can view.\n            </Text>\n          </Box>\n        </Stack>\n      </Modal>\n\n      {/* Waiting for Approval Modal */}\n      <Modal\n        opened={waitingForApproval}\n        onClose={handleCancelWait}\n        withCloseButton={false}\n        centered\n        size=\"sm\"\n        radius=\"lg\"\n        padding=\"xl\"\n        styles={{\n          content: {\n            backgroundColor: darkmodeEnabled ? \"#121212\" : \"#ffffff\",\n          },\n        }}\n      >\n        <Stack gap=\"md\" align=\"center\">\n          <Text fw={700} size=\"lg\" style={{ fontFamily: \"Assistant, sans-serif\" }}>\n            Waiting for Approval\n          </Text>\n          <HamsterLoader />\n          <Text size=\"sm\" c=\"dimmed\" ta=\"center\">\n            Please wait while the room owner approves your request to join...\n          </Text>\n          <Button variant=\"default\" onClick={handleCancelWait} fullWidth mt=\"sm\">\n            Cancel\n          </Button>\n        </Stack>\n      </Modal>\n\n      {/* Password Required Modal */}\n      <Modal\n        opened={!!passwordRequiredRoom}\n        onClose={handleCancelJoin}\n        title={\n          <Text fw={700} size=\"xl\" style={{ fontFamily: \"Assistant, sans-serif\" }}>\n            Room Password Required\n          </Text>\n        }\n        centered\n        size=\"md\"\n        radius=\"lg\"\n        padding=\"xl\"\n        styles={{\n          content: {\n            backgroundColor: darkmodeEnabled ? \"#121212\" : \"#ffffff\",\n          },\n        }}\n      >\n        <Stack gap=\"md\">\n          <Text size=\"sm\" c=\"dimmed\">\n            This live collaboration room is protected by a password. Please enter the password to\n            join.\n          </Text>\n\n          <PasswordInput\n            label=\"Password\"\n            placeholder=\"Enter room password\"\n            value={joinPasswordInput}\n            onChange={e => setJoinPasswordInput(e.currentTarget.value)}\n            leftSection={<FiKey size={14} />}\n            styles={{\n              input: {\n                backgroundColor: darkmodeEnabled ? \"rgba(255,255,255,0.05)\" : \"#f3f4f6\",\n                border: \"none\",\n              },\n            }}\n            data-autofocus\n            onKeyDown={e => {\n              if (e.key === \"Enter\") {\n                handleJoinWithPassword();\n              }\n            }}\n          />\n\n          <Box style={{ display: \"flex\", gap: \"8px\", justifyContent: \"flex-end\", marginTop: 10 }}>\n            <Button variant=\"default\" onClick={handleCancelJoin}>\n              Cancel\n            </Button>\n            <Button color=\"blue\" onClick={handleJoinWithPassword}>\n              Join Room\n            </Button>\n          </Box>\n        </Stack>\n      </Modal>\n\n      {/* Collab Overwrite Warning Modal */}\n      <LoadFromLinkDialog\n        opened={!!pendingCollabRoomId}\n        darkMode={darkmodeEnabled}\n        title=\"Join Collaborative Room\"\n        message={\n          <>\n            Joining this room will <strong>permanently replace your existing content</strong> with\n            the room&apos;s content. You can back up your drawing first by using the option below.\n          </>\n        }\n        onReplace={() => {\n          if (pendingCollabRoomId) {\n            startCollaboration(pendingCollabRoomId, undefined, { asOwner: false });\n            setPendingCollabRoomId(null);\n          }\n        }}\n        onClose={() => setPendingCollabRoomId(null)}\n        onSaveToDisk={handleSaveToDisk}\n      />\n\n      {/* Live Collab Modal */}\n      <Modal\n        opened={showCollabModal}\n        onClose={() => setShowCollabModal(false)}\n        title={\n          <Text fw={700} size=\"xl\" style={{ fontFamily: \"Assistant, sans-serif\" }}>\n            Live Collaboration\n          </Text>\n        }\n        centered\n        size=\"md\"\n        radius=\"lg\"\n        padding=\"xl\"\n        styles={{\n          content: {\n            backgroundColor: darkmodeEnabled ? \"#121212\" : \"#ffffff\",\n          },\n        }}\n      >\n        <Stack gap=\"md\">\n          {isCollaborating && activeRoomId ? (\n            <>\n              <Text size=\"sm\" c=\"dimmed\">\n                You are live. Anyone with this link can join and draw in real-time.\n              </Text>\n\n              <Group\n                gap=\"apart\"\n                style={{\n                  background: darkmodeEnabled ? \"rgba(255,255,255,0.05)\" : \"#f8f9fa\",\n                  padding: \"10px\",\n                  borderRadius: \"8px\",\n                }}\n              >\n                <Box>\n                  <Text size=\"sm\" fw={600}>\n                    Room ID: {activeRoomId}\n                  </Text>\n                  <Badge color=\"green\" variant=\"light\" size=\"sm\">\n                    Online ({collaborators.length}/{maxCollaborators} users)\n                  </Badge>\n                </Box>\n                <Button\n                  color=\"red\"\n                  variant=\"subtle\"\n                  size=\"xs\"\n                  leftSection={<FiLogOut />}\n                  onClick={stopCollaboration}\n                >\n                  Stop Session\n                </Button>\n              </Group>\n\n              <Box style={{ display: \"flex\", gap: \"12px\", alignItems: \"flex-end\", marginTop: 10 }}>\n                <TextInput\n                  label=\"Collab Link\"\n                  readOnly\n                  value={getCollabShareUrl()}\n                  style={{ flex: 1 }}\n                  styles={{\n                    input: {\n                      backgroundColor: darkmodeEnabled ? \"rgba(255,255,255,0.05)\" : \"#f3f4f6\",\n                      border: \"none\",\n                    },\n                  }}\n                  onClick={e => (e.target as HTMLInputElement).select()}\n                />\n                <Button\n                  leftSection={justCopied ? <FiCheck size={18} /> : <FiCopy size={18} />}\n                  color={justCopied ? \"teal\" : \"blue\"}\n                  onClick={() => {\n                    navigator.clipboard.writeText(getCollabShareUrl());\n                    setJustCopied(true);\n                    if (copyTimerRef.current) window.clearTimeout(copyTimerRef.current);\n                    copyTimerRef.current = window.setTimeout(\n                      () => setJustCopied(false),\n                      3000\n                    ) as any;\n                  }}\n                >\n                  Copy\n                </Button>\n              </Box>\n\n              {pendingRequests && pendingRequests.length > 0 && (\n                <Box\n                  style={{\n                    marginTop: 12,\n                    borderRadius: 8,\n                    padding: 10,\n                    background: darkmodeEnabled ? \"rgba(255,165,0,0.1)\" : \"#fff5e6\",\n                    border: `1px solid ${darkmodeEnabled ? \"rgba(255,165,0,0.3)\" : \"#ffe0b2\"}`,\n                  }}\n                >\n                  <Text size=\"xs\" c=\"orange\" fw={600} mb={8}>\n                    Pending Requests ({pendingRequests.length})\n                  </Text>\n                  <Stack gap={6}>\n                    {pendingRequests.map(req => (\n                      <Group key={req.userId} justify=\"space-between\" wrap=\"nowrap\">\n                        <Group gap={8}>\n                          <Box\n                            w={10}\n                            h={10}\n                            style={{ borderRadius: \"50%\", background: req.color || \"#ccc\" }}\n                          />\n                          <Text size=\"sm\" fw={500} truncate>\n                            {req.username}\n                          </Text>\n                        </Group>\n                        <Group gap={4}>\n                          <Button\n                            size=\"compact-xs\"\n                            color=\"teal\"\n                            onClick={() => approveJoin(req.userId)}\n                          >\n                            Approve\n                          </Button>\n                          <Button\n                            size=\"compact-xs\"\n                            color=\"red\"\n                            variant=\"subtle\"\n                            onClick={() => rejectJoin(req.userId)}\n                          >\n                            Reject\n                          </Button>\n                        </Group>\n                      </Group>\n                    ))}\n                  </Stack>\n                </Box>\n              )}\n\n              <Box\n                style={{\n                  marginTop: 12,\n                  borderRadius: 8,\n                  padding: 10,\n                  background: darkmodeEnabled ? \"rgba(255,255,255,0.04)\" : \"#f8f9fa\",\n                }}\n              >\n                <Text size=\"xs\" c=\"dimmed\" mb={8}>\n                  Participants\n                </Text>\n                <Stack gap={6}>\n                  {collaborators.map(user => {\n                    const isMe = user.id === currentUserId;\n\n                    return (\n                      <Group key={user.id} justify=\"space-between\" wrap=\"nowrap\">\n                        <Text size=\"sm\" fw={500} truncate>\n                          {user.username || user.id}\n                          {isMe ? \" (You)\" : \"\"}\n                          {user.isOwner ? \" (Owner)\" : \"\"}\n                        </Text>\n\n                        <Group gap={4}>\n                          {!isMe && (\n                            <ActionIcon\n                              color={followedUserId === user.id ? \"blue\" : \"gray\"}\n                              variant={followedUserId === user.id ? \"filled\" : \"light\"}\n                              aria-label={\n                                followedUserId === user.id\n                                  ? \"Stop following user\"\n                                  : \"Follow user\"\n                              }\n                              onClick={() =>\n                                handleToggleFollowUser(user.id, user.username)\n                              }\n                            >\n                              <FiEye size={14} />\n                            </ActionIcon>\n                          )}\n\n                          {isRoomOwner && !isMe ? (\n                            <ActionIcon\n                              color=\"red\"\n                              variant=\"light\"\n                              aria-label=\"Kick user\"\n                              onClick={() => kickCollaborator(user.id)}\n                            >\n                              <FiUserX size={14} />\n                            </ActionIcon>\n                          ) : null}\n                        </Group>\n                      </Group>\n                    );\n                  })}\n                </Stack>\n              </Box>\n            </>\n          ) : (\n            <>\n              <Text size=\"sm\" c=\"dimmed\">\n                Create a real-time multiplayer room to draw with others. You can optionally set a\n                password.\n              </Text>\n\n              <PasswordInput\n                label=\"Room Password (Optional)\"\n                placeholder=\"Leave blank for public room\"\n                value={collabPasswordInput}\n                onChange={e => setCollabPasswordInput(e.currentTarget.value)}\n                leftSection={<FiKey size={14} />}\n                styles={{\n                  input: {\n                    backgroundColor: darkmodeEnabled ? \"rgba(255,255,255,0.05)\" : \"#f3f4f6\",\n                    border: \"none\",\n                  },\n                }}\n              />\n\n              <Button\n                size=\"md\"\n                color=\"blue\"\n                leftSection={<FiPlay size={16} />}\n                onClick={handleStartLiveCollab}\n                style={{ marginTop: 10 }}\n              >\n                Start Session\n              </Button>\n            </>\n          )}\n        </Stack>\n      </Modal>\n\n      {/* Load from Link Confirmation Dialog */}\n      <LoadFromLinkDialog\n        opened={showLoadFromLinkDialog}\n        darkMode={darkmodeEnabled}\n        onReplace={handleReplaceContent}\n        onClose={() => {\n          setShowLoadFromLinkDialog(false);\n          pendingShareDataRef.current = null;\n          // Clean URL\n          window.history.replaceState({}, \"\", window.location.pathname);\n        }}\n        onSaveToDisk={handleSaveToDisk}\n      />\n\n      <StyledJsonDrawWrapper $ready={drawReady}>\n        <div className=\"jsondraw-wrapper\">\n          <JsonDraw\n            jsondrawAPI={handleJsonDrawAPI}\n            onChange={handleChange}\n            onPointerUpdate={(payload: {\n              pointer: { x: number; y: number; tool: string };\n              button: string;\n            }) => {\n              if (payload.pointer) {\n                lastPointerRef.current = payload.pointer;\n\n                const api = jsonDrawAPIRef.current;\n                let viewport: { scrollX: number; scrollY: number; zoom: number } | null = null;\n\n                if (api && typeof api.getAppState === \"function\") {\n                  const state = api.getAppState();\n                  const zoomValue =\n                    state.zoom && typeof state.zoom.value === \"number\"\n                      ? state.zoom.value\n                      : 1;\n                  viewport = {\n                    scrollX: state.scrollX || 0,\n                    scrollY: state.scrollY || 0,\n                    zoom: zoomValue,\n                  };\n                }\n\n                broadcastPointer({\n                  ...payload,\n                  viewport,\n                });\n              }\n            }}\n            viewModeEnabled={false}\n            zenModeEnabled={false}\n            gridModeEnabled={false}\n            theme={darkmodeEnabled ? \"dark\" : \"light\"}\n            UIOptions={{\n              canvasActions: {\n                export: { saveFileToDisk: true },\n                clearDrawing: () => setShowClearModal(true),\n              },\n            }}\n            initialData={{\n              appState: {\n                activeTool: {\n                  type: \"hand\",\n                  customType: null,\n                  lastActiveTool: null,\n                  locked: false,\n                  fromSelection: false,\n                },\n              },\n            }}\n            renderTopRightUI={(isMobile: boolean) => (\n              <Box px=\"md\">\n                <Menu shadow=\"md\" width={200} position=\"bottom-end\">\n                  <Menu.Target>\n                    <Button\n                      size=\"sm\"\n                      color={isCollaborating ? \"green\" : \"violet\"}\n                      loading={isSharing}\n                      leftSection={isCollaborating ? <FiUsers size={16} /> : <FiShare2 size={16} />}\n                      title=\"Share canvas\"\n                    >\n                      {isCollaborating ? \"Live\" : \"Share\"}\n                    </Button>\n                  </Menu.Target>\n\n                  <Menu.Dropdown>\n                    <Menu.Label>Export Options</Menu.Label>\n                    <Menu.Item leftSection={<FiCopy size={14} />} onClick={handleShareClick}>\n                      Share Link (Snapshot)\n                    </Menu.Item>\n\n                    <Menu.Divider />\n\n                    <Menu.Label>Realtime</Menu.Label>\n                    <Menu.Item\n                      color={isCollaborating ? \"green\" : \"blue\"}\n                      leftSection={isCollaborating ? <FiUsers size={14} /> : <FiPlay size={14} />}\n                      onClick={() => setShowCollabModal(true)}\n                    >\n                      {isCollaborating ? \"Manage Collab Session\" : \"Start Live Collab\"}\n                    </Menu.Item>\n                  </Menu.Dropdown>\n                </Menu>\n              </Box>\n            )}\n          />\n        </div>\n      </StyledJsonDrawWrapper>\n    </Box>\n  );\n};\n","import React from \"react\";\nimport type { DefaultTheme } from \"styled-components\";\nimport { styled } from \"styled-components\";\nimport type { KeyPath } from \"react-json-tree\";\n\ninterface LabelProps {\n  keyPath: KeyPath;\n  nodeType: string;\n}\n\nfunction getLabelColor({ $type, theme }: { $type?: string; theme: DefaultTheme }) {\n  if ($type === \"Object\") return theme.NODE_COLORS.PARENT_OBJ;\n  if ($type === \"Array\") return theme.NODE_COLORS.PARENT_ARR;\n  return theme.NODE_COLORS.PARENT_OBJ;\n}\n\nconst StyledLabel = styled.span<{ $nodeType?: string }>`\n  color: ${({ theme, $nodeType }) => getLabelColor({ theme, $type: $nodeType })};\n\n  &:hover {\n    filter: brightness(1.5);\n    transition: filter 0.2s ease-in-out;\n  }\n`;\n\nexport const Label = ({ keyPath, nodeType }: LabelProps) => {\n  return <StyledLabel $nodeType={nodeType}>{keyPath[0]}:</StyledLabel>;\n};\n","import React from \"react\";\nimport type { DefaultTheme } from \"styled-components\";\nimport { useTheme } from \"styled-components\";\nimport { TextRenderer } from \"../GraphView/CustomNode/TextRenderer\";\n\ntype TextColorFn = {\n  theme: DefaultTheme;\n  $value?: string | unknown;\n};\n\nfunction getValueColor({ $value, theme }: TextColorFn) {\n  if ($value && !Number.isNaN(+$value)) return theme.NODE_COLORS.INTEGER;\n  if ($value === \"true\") return theme.NODE_COLORS.BOOL.TRUE;\n  if ($value === \"false\") return theme.NODE_COLORS.BOOL.FALSE;\n  if ($value === \"null\") return theme.NODE_COLORS.NULL;\n\n  // default\n  return theme.NODE_COLORS.NODE_VALUE;\n}\n\ninterface ValueProps {\n  valueAsString: unknown;\n  value: unknown;\n}\n\nexport const Value = (props: ValueProps) => {\n  const theme = useTheme();\n  const { valueAsString, value } = props;\n\n  return (\n    <span\n      style={{\n        color: getValueColor({\n          theme,\n          $value: valueAsString,\n        }),\n      }}\n    >\n      <TextRenderer>{JSON.stringify(value)}</TextRenderer>\n    </span>\n  );\n};\n","import React from \"react\";\nimport { useTheme } from \"styled-components\";\nimport { JSONTree } from \"react-json-tree\";\nimport useJson from \"../../../../store/useJson\";\nimport { Label } from \"./Label\";\nimport { Value } from \"./Value\";\n\nexport const TreeView = () => {\n  const theme = useTheme();\n  const json = useJson(state => state.json);\n\n  return (\n    <JSONTree\n      hideRoot\n      data={JSON.parse(json)}\n      valueRenderer={(valueAsString, value) => <Value {...{ valueAsString, value }} />}\n      labelRenderer={(keyPath, nodeType) => <Label {...{ keyPath, nodeType }} />}\n      theme={{\n        extend: {\n          overflow: \"scroll\",\n          height: \"100%\",\n          scheme: \"monokai\",\n          author: \"wimer hazenberg (http://www.monokai.nl)\",\n          base00: theme.GRID_BG_COLOR,\n        },\n      }}\n    />\n  );\n};\n","import React from \"react\";\nimport { useSessionStorage } from \"@mantine/hooks\";\nimport styled from \"styled-components\";\nimport { ViewMode } from \"../../constants/enumData\";\nimport { GraphView } from \"./views/GraphView\";\nimport { JsonDrawView } from \"./views/JsonDrawView\";\nimport { TreeView } from \"./views/TreeView\";\n\nconst StyledLiveEditor = styled.div`\n  position: relative;\n  height: 100%;\n  background: ${({ theme }) => theme.GRID_BG_COLOR};\n  overflow: auto;\n  cursor: url(\"/assets/cursor.svg\"), auto;\n\n  & > ul {\n    margin-top: 0 !important;\n    padding: 12px !important;\n    font-family: monospace;\n    font-size: 14px;\n    font-weight: 500;\n  }\n\n  .tab-group {\n    position: absolute;\n    top: 10px;\n    left: 10px;\n    z-index: 2;\n  }\n`;\n\nconst View = () => {\n  const [viewMode] = useSessionStorage({\n    key: \"viewMode\",\n    defaultValue: ViewMode.Graph,\n  });\n\n  if (viewMode === ViewMode.Graph) return <GraphView />;\n  if (viewMode === ViewMode.Tree) return <TreeView />;\n  if (viewMode === ViewMode.JsonDraw) return <JsonDrawView />;\n  return null;\n};\n\nconst LiveEditor = () => {\n  return (\n    <StyledLiveEditor onContextMenuCapture={e => e.preventDefault()}>\n      <View />\n    </StyledLiveEditor>\n  );\n};\n\nexport default LiveEditor;\n"],"names":["WarningBanner","styled","div","$dark","IconWrapper","ActionCard","WarningText","LoadFromLinkDialog","opened","darkMode","onReplace","onClose","onSaveToDisk","title","message","Modal","withCloseButton","centered","size","padding","radius","styles","content","backgroundColor","overlay","Stack","gap","Text","fw","style","fontFamily","fontSize","color","FiAlertTriangle","strong","Button","onClick","flexShrink","h4","p","variant","fullWidth","leftSection","FiDownload","root","maxWidth","borderColor","randomSeed","Math","floor","random","randomNonce","formatNodeText","text","node","length","map","row","key","undefined","type","childrenCount","value","join","jsonToJsonDrawElements","nodes","edges","elements","positions","layoutNodes","Map","children","hasParent","Set","edge","ch","get","from","push","to","set","add","roots","filter","n","has","id","nodeMap","layers","visited","queue","layer","nextQueue","childId","orphans","currentX","currentY","nodeId","x","y","height","JSONDRAW_VERTICAL_GAP","max","width","JSONDRAW_HORIZONTAL_GAP","now","Date","indexCounter","getNextIndex","toString","padStart","rectIds","pos","rectId","textId","JSONDRAW_NODE_PADDING","textRows","JSONDRAW_ROW_HEIGHT","boundElements","rect","angle","strokeColor","fillStyle","strokeWidth","roughness","opacity","groupIds","roundness","seed","version","versionNonce","isDeleted","index","updated","link","locked","frameId","textEl","JSONDRAW_FONT_SIZE","FONT_FAMILY","Excalifont","textAlign","verticalAlign","containerId","originalText","autoResize","lineHeight","fromRectId","toRectId","fromPos","toPos","fromNode","find","toNode","fromWidth","fromHeight","toHeight","startX","startY","endX","endY","arrow","abs","points","startBinding","elementId","focus","fixedPoint","endBinding","startArrowhead","endArrowhead","elbowed","dbConfig","apiKey","process","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","_db","getDb","app","getApps","initializeApp","getDatabase","binary","i","bytes","chunkSize","String","fromCharCode","apply","Array","slice","btoa","base64ToUint8","base64","atob","Uint8Array","charCodeAt","generateEncryptionKey","crypto","subtle","generateKey","name","uint8ToBase64","exported","exportKey","replace","keyStr","raw","importKey","buffer","encryptData","data","iv","getRandomValues","encrypted","encrypt","result","byteLength","decryptData","ciphertext","decrypt","exportToBackend","compressedData","array","generateId","encryptionKey","base64Data","dbRef","ref","createdAt","snapshot","exists","console","error","val","decrypted","createShareLink","appState","files","nonDeletedElements","el","jsonString","JSON","stringify","pickUsedFiles","fileIds","fileId","usedFiles","Object","keys","viewBackgroundColor","theme","compressed","pako","TextEncoder","encode","hash","window","location","origin","pathname","match","importFromBackend","parse","$ready","JsonDrawView","useGraph","state","darkmodeEnabled","useConfig","JsonDrawModule","setJsonDrawModule","React","drawReady","setDrawReady","jsonDrawAPIRef","hasInitialized","hasUserDrawing","showClearModal","setShowClearModal","showShareModal","setShowShareModal","shareUrl","setShareUrl","justCopied","setJustCopied","isSharing","setIsSharing","copyTimerRef","followedUserId","setFollowedUserId","isCollaborating","roomId","activeRoomId","startCollaboration","stopCollaboration","collaborators","currentUserId","isRoomOwner","maxCollaborators","kickCollaborator","passwordRequiredRoom","setPasswordRequiredRoom","waitingForApproval","pendingRequests","approveJoin","rejectJoin","submitRoomPassword","useCollab","showCollabModal","setShowCollabModal","collabPasswordInput","setCollabPasswordInput","joinPasswordInput","setJoinPasswordInput","pendingCollabRoomId","setPendingCollabRoomId","showLoadFromLinkDialog","setShowLoadFromLinkDialog","pendingShareDataRef","isHandlingShareRef","lastHandledHashRef","broadcastDrawingChanges","broadcastPointer","centerOnFollowedUser","useDrawingSync","apiRef","collab","socket","p2pRoom","_p2pRoom","canSync","collabType","getCollabType","lastBroadcastedVersion","useRef","remoteCollaboratorsRef","hasReceivedInitialSync","sendDrawRef","sendPointerRef","useEffect","current","newMap","forEach","user","CollabType","P2P","existing","pointer","button","username","background","stroke","socketId","updateScene","Socket","handleClientDraw","api","localElements","getSceneElementsIncludingDeleted","getAppState","finalElements","restoredRemoteElements","restoreElements","remoteElements","reconcileElements","getSceneVersion","commitToHistory","on","emit","off","sendDraw","getDraw","makeAction","handleDraw","handleClientPointer","peerId","pointerData","collabsMap","viewport","targetSocketId","userToFollow","nextZoomValue","zoom","scrollX","scrollY","pointerPayload","sendPointer","getPointer","payload","handlePointer","handleNewUser","onPeerJoin","handlePeerJoin","currentVersion","viewportWidth","viewportHeight","nextScrollX","nextScrollY","lastPointerRef","handleChange","sceneFiles","getFiles","localStorage","setItem","warn","JSONDRAW_ASSET_PATH","then","mod","JsonDraw","rId","URLSearchParams","hasContent","saved","getItem","parsed","isArray","e","asOwner","scrollToContent","delay","requestAnimationFrame","setTimeout","fitToViewport","viewportZoomFactor","applySharedData","restoredElements","restoredAppState","restoreAppState","isLoading","addFiles","history","replaceState","handleReplaceContent","toast","success","handleSaveToDisk","getName","saveAsJSON","initFromLocalOrJson","hasExistingContent","handleShareLinkFromHash","startsWith","isBackendShareLink","test","loadFromShareLink","decoded","decodeDataFromUrlHash","decodeURIComponent","binaryString","decompressed","handleJsonDrawAPI","onUserFollow","action","prev","handled","handleHashChange","addEventListener","removeEventListener","prevPendingRequestsLength","latestReq","icon","handleClearDrawing","removeItem","handleCopyLink","navigator","clipboard","writeText","clearTimeout","catch","handleShareClick","url","intervalId","setInterval","zoomValue","clearInterval","handleToggleFollowUser","userId","currentSocketId","handleStartLiveCollab","genId","substring","handleJoinWithPassword","handleCancelJoin","handleCancelWait","getCollabShareUrl","URL","href","search","hashParams","Box","h","w","inset","display","placeItems","HamsterLoader","c","justifyContent","alignItems","ActionIcon","FiX","TextInput","label","readOnly","flex","input","border","boxShadow","marginBottom","fontWeight","target","select","FiCheck","FiCopy","minWidth","transition","borderTop","paddingTop","FiLock","align","ta","mt","PasswordInput","placeholder","onChange","currentTarget","FiKey","data-autofocus","onKeyDown","marginTop","Group","borderRadius","Badge","FiLogOut","mb","req","justify","wrap","truncate","isMe","isOwner","aria-label","FiEye","FiUserX","FiPlay","StyledJsonDrawWrapper","className","jsondrawAPI","onPointerUpdate","viewModeEnabled","zenModeEnabled","gridModeEnabled","UIOptions","canvasActions","export","saveFileToDisk","clearDrawing","initialData","activeTool","customType","lastActiveTool","fromSelection","renderTopRightUI","px","Menu","shadow","position","Target","loading","FiUsers","FiShare2","Dropdown","Label","Item","Divider","StyledLabel","span","$nodeType","getLabelColor","$type","NODE_COLORS","PARENT_OBJ","PARENT_ARR","keyPath","nodeType","Value","useTheme","valueAsString","props","getValueColor","$value","Number","isNaN","INTEGER","BOOL","TRUE","FALSE","NULL","NODE_VALUE","TextRenderer","json","useJson","JSONTree","hideRoot","valueRenderer","labelRenderer","extend","overflow","scheme","author","base00","GRID_BG_COLOR","View","viewMode","useSessionStorage","defaultValue","ViewMode","Graph","GraphView","Tree","TreeView","StyledLiveEditor","onContextMenuCapture","LiveEditor","preventDefault"],"sourceRoot":"","ignoreList":[]}