"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[75373],{75373:(e,t,r)=>{r.r(t),r.d(t,{default:()=>ed});var n=r(37876),a=r(14232),l=r(38335),o=r(31158),i=r(53070),s=r(70671),d=r(95171),c=r(44969),u=r(79021),h=r(45050),f=r(44193),p=r(11210),g=r(31408),m=r(87871),x=r(74188),w=r(34826),y=r(52509),b=r(97685),j=r(18571),k=r(76664),S=r(79501),C=r(35076),v=r(9456);let E=o.Ay.div.withConfig({componentId:"sc-6476bd35-0"})(["display:flex;flex-direction:row;align-items:flex-start;gap:1rem;padding:1.75rem 2rem;border-radius:0.5rem;background:",";color:",";@media (max-width:600px){flex-direction:column;text-align:center;align-items:center;}"],({$dark:e})=>e?"rgba(220, 38, 38, 0.12)":"#fef2f2",({$dark:e})=>e?"#fca5a5":"#991b1b"),A=o.Ay.div.withConfig({componentId:"sc-6476bd35-1"})(["display:flex;align-items:center;justify-content:center;flex-shrink:0;width:3rem;height:3rem;border-radius:50%;background:",";svg{width:1.4rem;height:1.4rem;color:",";}"],({$dark:e})=>e?"rgba(220, 38, 38, 0.2)":"#fee2e2",({$dark:e})=>e?"#f87171":"#dc2626"),z=o.Ay.div.withConfig({componentId:"sc-6476bd35-2"})(["display:flex;flex-direction:column;align-items:center;padding:1.5rem;gap:0.75rem;text-align:center;h4{margin:0;font-weight:700;font-size:1.125rem;color:",";}p{margin:0;font-size:0.875rem;color:",";line-height:1.5;}"],({$dark:e})=>e?"#e5e5e5":"#1f2937",({$dark:e})=>e?"#a3a3a3":"#6b7280"),R=o.Ay.div.withConfig({componentId:"sc-6476bd35-3"})(["flex:1;min-width:0;font-size:0.95rem;line-height:1.5;color:",";strong{color:",";}@media (max-width:600px){text-align:center;}"],({$dark:e})=>e?"#fca5a5":"#991b1b",({$dark:e})=>e?"#f87171":"#dc2626"),O=({opened:e,darkMode:t,onReplace:r,onClose:a,onSaveToDisk:l,title:o,message:i})=>(0,n.jsx)(c.a,{opened:e,onClose:a,title:null,withCloseButton:!1,centered:!0,size:700,padding:"xl",radius:"lg",styles:{content:{backgroundColor:t?"#1e1e1e":"#ffffff"},overlay:{backgroundColor:t?"rgba(0, 0, 0, 0.7)":"rgba(0, 0, 0, 0.4)"}},children:(0,n.jsxs)(u.B,{gap:"lg",children:[(0,n.jsx)(h.E,{fw:700,size:"xl",style:{fontFamily:"Assistant, sans-serif",fontSize:"1.3rem",color:t?"#e5e5e5":"#111827"},children:o||"Load from link"}),(0,n.jsxs)(E,{$dark:t,children:[(0,n.jsx)(A,{$dark:t,children:(0,n.jsx)(j.eHT,{})}),(0,n.jsx)(R,{$dark:t,children:i||(0,n.jsxs)(n.Fragment,{children:["Loading external drawing will ",(0,n.jsx)("strong",{children:"replace your existing content"}),". You can back up your drawing first by using one of the options below."]})}),(0,n.jsx)(f.$,{color:"red",size:"md",onClick:r,style:{flexShrink:0},children:"Replace my content"})]}),(0,n.jsxs)(z,{$dark:t,children:[(0,n.jsx)("h4",{children:"Save to disk"}),(0,n.jsx)("p",{children:"Export the scene data to a file from which you can import later."}),(0,n.jsx)(f.$,{variant:"outline",color:"gray",size:"md",fullWidth:!0,leftSection:(0,n.jsx)(j.a4x,{size:16}),onClick:l,styles:{root:{maxWidth:300,borderColor:t?"#404040":"#d1d5db",color:t?"#d4d4d4":"#374151"}},children:"Save to disk"})]})]})});var I=r(46553);let D=()=>Math.floor(2e9*Math.random()),$=()=>Math.floor(2e9*Math.random()),T=e=>e.text&&0!==e.text.length?e.text.map(e=>null!==e.key&&void 0!==e.key?"object"===e.type?`${e.key}: {${e.childrenCount??0} keys}`:"array"===e.type?`${e.key}: [${e.childrenCount??0} items]`:null===e.value?`${e.key}: null`:`${e.key}: ${e.value}`:`${e.value??""}`).join("\n"):"",_=(e,t)=>{let r=[],n=((e,t)=>{let r=new Map;if(0===e.length)return r;let n=new Map,a=new Set;for(let e of t){let t=n.get(e.from)??[];t.push(e.to),n.set(e.from,t),a.add(e.to)}let l=e.filter(e=>!a.has(e.id)).map(e=>e.id);0===l.length&&e.length>0&&l.push(e[0].id);let o=new Map(e.map(e=>[e.id,e])),s=[],d=new Set,c=[...l];for(;c.length>0;){let e=[],t=[];for(let r of c)if(!d.has(r))for(let a of(d.add(r),e.push(r),n.get(r)??[]))d.has(a)||t.push(a);e.length>0&&s.push(e),c=t}let u=e.filter(e=>!d.has(e.id)).map(e=>e.id);u.length>0&&s.push(u);let h=50;for(let e of s){let t=0,n=50;for(let a of e){let e=o.get(a);e&&(r.set(a,{x:h,y:n}),n+=e.height+i.BF,t=Math.max(t,e.width))}h+=t+i.xy}return r})(e,t),a=Date.now(),l=0,o=()=>`a${(l++).toString().padStart(6,"0")}`,s=new Map;for(let l of e){let e=n.get(l.id)??{x:0,y:0},d=`rect-${l.id}`,c=`text-${l.id}`,u=T(l);s.set(l.id,d);let h=Math.max(l.width+2*i._k,120),f=Math.max((l.text?.length??1)*i.C+2*i._k,50),p=[{id:c,type:"text"}];for(let e of t)(e.from===l.id||e.to===l.id)&&p.push({id:`arrow-${e.id}`,type:"arrow"});let g={id:d,type:"rectangle",x:e.x,y:e.y,width:h,height:f,angle:0,strokeColor:"#1e1e1e",backgroundColor:"transparent",fillStyle:"solid",strokeWidth:1,roughness:1,opacity:100,groupIds:[],roundness:{type:3},seed:D(),version:1,versionNonce:$(),isDeleted:!1,boundElements:p,index:o(),updated:a,link:null,locked:!1,frameId:null};r.push(g);let m={id:c,type:"text",x:e.x+i._k,y:e.y+i._k,width:h-2*i._k,height:f-2*i._k,angle:0,strokeColor:"#1e1e1e",backgroundColor:"transparent",fillStyle:"solid",strokeWidth:1,roughness:1,opacity:100,groupIds:[],roundness:null,seed:D(),version:1,versionNonce:$(),isDeleted:!1,boundElements:null,index:o(),updated:a,link:null,locked:!1,frameId:null,text:u,fontSize:i.TZ,fontFamily:I.F2R.Excalifont,textAlign:"left",verticalAlign:"top",containerId:d,originalText:u,autoResize:!0,lineHeight:1.25};r.push(m)}for(let l of t){let t=s.get(l.from),d=s.get(l.to);if(!t||!d)continue;let c=n.get(l.from),u=n.get(l.to);if(!c||!u)continue;let h=e.find(e=>e.id===l.from),f=e.find(e=>e.id===l.to);if(!h||!f)continue;let p=Math.max(h.width+2*i._k,120),g=Math.max((h.text?.length??1)*i.C+2*i._k,50),m=Math.max((f.text?.length??1)*i.C+2*i._k,50),x=c.x+p,w=c.y+g/2,y=u.x,b=u.y+m/2,j={id:`arrow-${l.id}`,type:"arrow",x:x,y:w,width:Math.abs(y-x),height:Math.abs(b-w),angle:0,strokeColor:"#1e1e1e",backgroundColor:"transparent",fillStyle:"solid",strokeWidth:1,roughness:1,opacity:100,groupIds:[],roundness:{type:2},seed:D(),version:1,versionNonce:$(),isDeleted:!1,boundElements:null,index:o(),updated:a,link:null,locked:!1,frameId:null,points:[[0,0],[y-x,b-w]],startBinding:{elementId:t,focus:0,gap:5,fixedPoint:[1,.5]},endBinding:{elementId:d,focus:0,gap:5,fixedPoint:[0,.5]},startArrowhead:null,endArrowhead:"arrow",elbowed:!1};r.push(j)}return r};var L=r(278),F=r(15940),N=r(16042);let M={apiKey:"AIzaSyDvMXBp-ixnFg_voZfMIEGFaotCrbVOAcs",authDomain:"json-viz-draw.firebaseapp.com",databaseURL:"https://json-viz-draw-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"json-viz-draw",storageBucket:"json-viz-draw.firebasestorage.app",messagingSenderId:"202083822464",appId:"1:202083822464:web:870613fe58ad8f08652f65"},B=null,J=()=>{if(B)return B;if(!M.databaseURL||!M.projectId)throw Error("Database configuration is missing. Please set NEXT_PUBLIC_DB_* environment variables.");let e=0===(0,N.Dk)().length?(0,N.Wp)(M):(0,N.Dk)()[0];return B=(0,F.C3)(e)},P=e=>{let t="";for(let r=0;r<e.length;r+=8e3)t+=String.fromCharCode.apply(null,Array.from(e.slice(r,r+8e3)));return btoa(t)},U=e=>{let t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r},W=async()=>{let e=await crypto.subtle.generateKey({name:"AES-GCM",length:128},!0,["encrypt","decrypt"]);return P(new Uint8Array(await crypto.subtle.exportKey("raw",e))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")},G=async e=>{let t=e.replace(/-/g,"+").replace(/_/g,"/");for(;t.length%4;)t+="=";let r=U(t);return crypto.subtle.importKey("raw",r.buffer,{name:"AES-GCM"},!1,["encrypt","decrypt"])},Y=async(e,t)=>{let r=await G(t),n=crypto.getRandomValues(new Uint8Array(12)),a=await crypto.subtle.encrypt({name:"AES-GCM",iv:n},r,e.buffer),l=new Uint8Array(n.length+a.byteLength);return l.set(n),l.set(new Uint8Array(a),n.length),l},Z=async(e,t)=>{let r=await G(t),n=e.slice(0,12),a=e.slice(12);return new Uint8Array(await crypto.subtle.decrypt({name:"AES-GCM",iv:n},r,a.buffer))},H=async e=>{let t,r=(t=new Uint8Array(15),crypto.getRandomValues(t),P(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")),n=await W(),a=P(await Y(e,n)),l=(0,F.KR)(J(),`shared/${r}`);return await (0,F.hZ)(l,{data:a,createdAt:Date.now()}),{id:r,encryptionKey:n}},K=async(e,t)=>{try{let r=(0,F.KR)(J(),`shared/${e}`),n=await (0,F.Jt)(r);if(!n.exists())return console.error("Share link data not found:",e),null;let{data:a}=n.val(),l=U(a);return await Z(l,t)}catch(e){return console.error("Failed to import shared data:",e),null}},V=async(e,t,r)=>{let n=e.filter(e=>!e.isDeleted).map(e=>({...e,isDeleted:void 0})),a=JSON.stringify({elements:n,files:((e,t)=>{if(!t)return;let r=new Set;for(let t of e)t&&"object"==typeof t&&"fileId"in t&&t.fileId&&r.add(t.fileId);if(0===r.size)return;let n={};for(let e of r)t[e]&&(n[e]=t[e]);return Object.keys(n).length?n:void 0})(n,r),appState:{viewBackgroundColor:t.viewBackgroundColor,theme:t.theme}}),l=L.Ay.deflate(new TextEncoder().encode(a)),{id:o,encryptionKey:i}=await H(l),s=`#json=${o},${i}`;return`${window.location.origin}${window.location.pathname}${s}`},q=async e=>{let t=e.match(/^#json=([a-zA-Z0-9_-]+),([a-zA-Z0-9_-]+)$/);if(!t)return null;let[,r,n]=t,a=await K(r,n);if(!a)return null;try{let e=L.Ay.inflate(a,{to:"string"});return JSON.parse(e)}catch(e){return console.error("Failed to decompress share link data:",e),null}},X=o.Ay.div.withConfig({componentId:"sc-27ad4539-0"})(["width:100%;height:100%;position:relative;opacity:",";transition:opacity 0.2s ease;.jsondraw-wrapper{width:100%;height:100%;}"],({$ready:e})=>+!!e),Q=()=>{let e=(0,v.A)(e=>e.nodes),t=(0,v.A)(e=>e.edges),l=(0,S.A)(e=>e.darkmodeEnabled),[o,i]=a.useState(null),[s,E]=a.useState(!1),A=a.useRef(null),z=a.useRef(!1),R=a.useRef(!1),[I,D]=a.useState(!1),[$,T]=a.useState(!1),[F,N]=a.useState(""),[M,B]=a.useState(!1),[J,P]=a.useState(!1),U=a.useRef(null),{isCollaborating:W,roomId:G,startCollaboration:Y,stopCollaboration:Z,collaborators:H,currentUserId:K,isRoomOwner:Q,maxCollaborators:ee,kickCollaborator:et,passwordRequiredRoom:er,setPasswordRequiredRoom:en,waitingForApproval:ea,pendingRequests:el,approveJoin:eo,rejectJoin:ei,submitRoomPassword:es}=(0,C.H)(),[ed,ec]=a.useState(!1),[eu,eh]=a.useState(""),[ef,ep]=a.useState(""),[eg,em]=a.useState(null),[ex,ew]=a.useState(!1),ey=a.useRef(null),eb=a.useRef(!1),ej=a.useRef(null),{broadcastDrawingChanges:ek,broadcastPointer:eS}=(e=>{let{socket:t,isCollaborating:r,roomId:n,collaborators:l,isRoomOwner:o}=(0,C.H)(),i=(0,a.useRef)(-1),s=(0,a.useRef)(new Map),d=(0,a.useRef)(!1);return(0,a.useEffect)(()=>{r?d.current=o:d.current=!1},[r,o]),(0,a.useEffect)(()=>{let n=new Map;l.forEach(e=>{if(t&&e.id===t.id)return;let r=s.current.get(e.id);n.set(e.id,{pointer:r?.pointer,button:r?.button||"up",username:e.username,color:{background:e.color||"#eee",stroke:e.color||"#eee"},id:e.id,socketId:e.id})}),s.current=n,e.current&&r&&e.current.updateScene({collaborators:n})},[l,e,r,t]),(0,a.useEffect)(()=>{if(!t||!r)return;let n=t=>{let r=e.current;if(!r)return;let n=r.getSceneElementsIncludingDeleted(),a=r.getAppState(),l=[];if(o||d.current){let e=(0,k.restoreElements)(t,n);l=(0,k.reconcileElements)(n,e,a)}else l=(0,k.restoreElements)(t,null),d.current=!0;i.current=(0,k.getSceneVersion)(l),r.updateScene({elements:l,commitToHistory:!1})};return t.on("client-draw",n),()=>{t.off("client-draw",n)}},[t,r,e]),(0,a.useEffect)(()=>{if(!t||!r)return;let n=(t,r)=>{let n=e.current;if(!n)return;let a=s.current,l=a.get(t);if(l){l.pointer=r.pointer,l.button=r.button;let e=new Map(a);s.current=e,n.updateScene({collaborators:e})}};return t.on("client-pointer",n),()=>{t.off("client-pointer",n)}},[t,r,e]),(0,a.useEffect)(()=>{if(!t||!r)return;let a=()=>{if(!o)return;let r=e.current;if(!r)return;let a=r.getSceneElementsIncludingDeleted();a.length>0&&t.emit("server-draw",n,a)};return t.on("new-user",a),()=>{t.off("new-user",a)}},[t,r,n,e,o]),{broadcastDrawingChanges:e=>{if(!t||!r||!n||!o&&!d.current)return;let a=(0,k.getSceneVersion)(e);a>i.current&&(t.emit("server-draw",n,e),i.current=a)},broadcastPointer:e=>{t&&r&&n&&t.emit("server-pointer",n,e)}}})(A),eC=a.useCallback((e,t,r)=>{R.current=!0,ek(e);try{let n=r??A.current?.getFiles?.()??null;localStorage.setItem("jsondraw-autosave",JSON.stringify({elements:e,files:n,appState:{theme:t.theme,zoom:t.zoom}}))}catch(e){console.warn("Failed to save to localStorage:",e)}},[ek]);a.useEffect(()=>{window.JSONDRAW_ASSET_PATH="/"},[]),a.useEffect(()=>{Promise.resolve().then(r.bind(r,76664)).then(e=>{i({JsonDraw:e.JsonDraw}),E(!1)});{let e=new URLSearchParams(window.location.hash.replace(/^#/,"")).get("collabRoomId");if(e&&!G){let t=!1,r=localStorage.getItem("jsondraw-autosave");if(r)try{let e=JSON.parse(r);Array.isArray(e.elements)&&e.elements.length>0&&(t=!0)}catch(e){t=!0}t?em(e):Y(e,void 0,{asOwner:!1})}}},[]);let ev=a.useCallback((e,t=120)=>{requestAnimationFrame(()=>{setTimeout(()=>{e.scrollToContent(void 0,{fitToViewport:!0,viewportZoomFactor:.8}),E(!0)},t)})},[]),eE=a.useCallback(e=>{let t=A.current;if(!t)return;R.current=!0,z.current=!0,E(!1);let r=(0,k.restoreElements)(e.elements,null),n={...(0,k.restoreAppState)(e.appState,t.getAppState()),isLoading:!1};requestAnimationFrame(()=>{e.files&&Object.keys(e.files).length>0&&t.addFiles(e.files),t.updateScene({elements:r,appState:n}),ev(t,120)}),window.history.replaceState({},"",window.location.pathname)},[ev]),eA=a.useCallback(()=>{let e=ey.current;e&&(eE(e),ey.current=null,ew(!1),b.oR.success("Drawing loaded from shared link!"))},[eE]),ez=a.useCallback(async()=>{let e=A.current;if(e)try{let t=e.getSceneElementsIncludingDeleted(),r=e.getAppState(),n=e.getFiles(),a=e.getName?.()||r.name;await (0,k.saveAsJSON)(t,r,n,a),b.oR.success("Drawing saved to disk!")}catch(e){b.oR.error("Failed to save drawing.")}},[]),eR=a.useCallback(r=>{let n=localStorage.getItem("jsondraw-autosave");if(n)try{let{elements:e,appState:t,files:a}=JSON.parse(n),l=(0,k.restoreElements)(e,null),o={...(0,k.restoreAppState)(t,r.getAppState()),isLoading:!1};R.current=!0,E(!1),requestAnimationFrame(()=>{a&&Object.keys(a).length>0&&r.addFiles(a),r.updateScene({elements:l,appState:o}),ev(r,120)});return}catch(e){console.warn("Failed to restore from localStorage:",e)}if(e.length>0&&!z.current){z.current=!0;let n=(0,k.restoreElements)(_(e,t),null);E(!1),requestAnimationFrame(()=>{r.updateScene({elements:n,appState:{isLoading:!1}}),ev(r,200)})}},[e,t,ev]),eO=a.useCallback(()=>{let e=localStorage.getItem("jsondraw-autosave");if(e)try{let t=JSON.parse(e);if(Array.isArray(t.elements)&&t.elements.length>0)return!0}catch(e){return console.warn("Failed to parse autosave data:",e),!0}let t=A.current;if(!t)return!1;let r=t.getSceneElementsIncludingDeleted();return Array.isArray(r)&&r.length>0},[]),eI=a.useCallback(async e=>{if(!e||!/^#json=([a-zA-Z0-9_-]+),([a-zA-Z0-9_-]+)$/.test(e)&&!e.startsWith("#data="))return!1;let t=A.current;if(!t)return!1;if(e===ej.current||eb.current)return!0;ej.current=e,eb.current=!0,E(!1);try{if(/^#json=([a-zA-Z0-9_-]+),([a-zA-Z0-9_-]+)$/.test(e)){let r=await q(e);if(!r||!r.elements)return b.oR.error("Could not load shared drawing. The link may be invalid or expired."),eR(t),!0;return eO()?(ey.current=r,ew(!0),eR(t)):eE(r),!0}let r=(e=>{try{let t=e.replace("#data=","");try{t=decodeURIComponent(t)}catch{}for(t=t.replace(/-/g,"+").replace(/_/g,"/");t.length%4;)t+="=";let r=window.atob(t),n=new Uint8Array(r.length);for(let e=0;e<r.length;e++)n[e]=r.charCodeAt(e);let a=L.Ay.inflate(n,{to:"string"});return JSON.parse(a)}catch(e){return console.error("Failed to decode legacy sharelink data",e),null}})(e);if(r&&r.elements)return eO()?(ey.current=r,ew(!0),eR(t)):eE(r),!0;return eR(t),!0}catch(e){return console.error("Failed to load share link:",e),b.oR.error("Failed to load shared drawing."),eR(t),!0}finally{eb.current=!1}},[eE,eO,eR]);a.useEffect(()=>{let r=A.current;if(!r||0===e.length||R.current)return;let n=_(e,t);r.updateScene({elements:n}),ev(r,80)},[e,t,ev]);let eD=a.useCallback(e=>{A.current=e,eI(window.location.hash).then(t=>{t||eR(e)})},[eI,eR]);a.useEffect(()=>{let e=()=>{eI(window.location.hash)};return window.addEventListener("hashchange",e),()=>window.removeEventListener("hashchange",e)},[eI]);let e$=a.useRef(el?.length||0);a.useEffect(()=>{if(el&&el.length>e$.current){let e=el[el.length-1];(0,b.oR)(`${e.username} wants to join the room!`,{icon:"\uD83D\uDC4B"})}e$.current=el?.length||0},[el]);let eT=a.useCallback(()=>{if(!A.current)return;localStorage.removeItem("jsondraw-autosave"),R.current=!1,z.current=!1;let r=_(e,t);A.current.updateScene({elements:r}),E(!1),ev(A.current,120),D(!1),b.oR.success("Drawing cleared! Loaded JSON visualization.")},[e,t,ev]),e_=a.useCallback(()=>{navigator.clipboard.writeText(F).then(()=>{B(!0),U.current&&window.clearTimeout(U.current),U.current=window.setTimeout(()=>B(!1),3e3)}).catch(()=>b.oR.error("Failed to copy link."))},[F]),eL=a.useCallback(async()=>{let e=A.current;if(e){P(!0);try{let t=e.getSceneElementsIncludingDeleted(),r=e.getAppState(),n=e.getFiles(),a=await V(t,r,n);N(a),T(!0)}catch(e){console.error("Share failed:",e),b.oR.error("Failed to create share link. Please try again.")}finally{P(!1)}}},[]),eF=a.useCallback(()=>{G||Y(Math.random().toString(36).substring(2,10),eu,{asOwner:!0})},[G,eu,Y]),eN=a.useCallback(()=>{er&&(es(ef),en(null),ep(""))},[er,ef,es,en]),eM=a.useCallback(()=>{en(null),ep(""),window.location.hash=""},[en]),eB=a.useCallback(()=>{Z(),window.location.hash=""},[Z]),eJ=()=>{if(G){let e=new URL(window.location.href);e.search="";let t=new URLSearchParams;return t.set("collabRoomId",G),e.hash=t.toString(),e.toString()}return""};if(!o)return(0,n.jsx)(d.a,{pos:"relative",h:"100%",w:"100%",children:(0,n.jsx)(d.a,{pos:"absolute",inset:0,style:{display:"grid",placeItems:"center"},children:(0,n.jsx)(k.HamsterLoader,{})})});let{JsonDraw:eP}=o;return(0,n.jsxs)(d.a,{pos:"relative",h:"100%",w:"100%",children:[!s&&(0,n.jsx)(d.a,{pos:"absolute",inset:0,style:{display:"grid",placeItems:"center"},children:(0,n.jsx)(k.HamsterLoader,{})}),(0,n.jsx)(c.a,{opened:I,onClose:()=>D(!1),title:"Clear Drawing Session",centered:!0,children:(0,n.jsxs)(u.B,{gap:"md",children:[(0,n.jsxs)(h.E,{children:["This will ",(0,n.jsx)("strong",{children:"permanently delete"})," your current drawing session and load a fresh visualization from the JSON data."]}),(0,n.jsx)(h.E,{c:"dimmed",size:"sm",children:"Make sure to save your work first. Your current drawing will be lost and cannot be recovered."}),(0,n.jsxs)(d.a,{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:[(0,n.jsx)(f.$,{variant:"default",onClick:()=>D(!1),children:"Cancel"}),(0,n.jsx)(f.$,{color:"red",onClick:eT,children:"Clear & Load JSON"})]})]})}),(0,n.jsx)(c.a,{opened:$,onClose:()=>T(!1),title:null,withCloseButton:!1,centered:!0,size:"md",padding:"xl",radius:"lg",styles:{content:{backgroundColor:l?"#121212":"#ffffff"}},children:(0,n.jsxs)(u.B,{gap:"lg",children:[(0,n.jsxs)(d.a,{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsx)(h.E,{fw:700,size:"xl",style:{fontFamily:"Assistant, sans-serif"},children:"Shareable link"}),(0,n.jsx)(p.M,{variant:"subtle",color:"gray",onClick:()=>T(!1),children:(0,n.jsx)(j.yGN,{size:20})})]}),(0,n.jsxs)(d.a,{style:{display:"flex",gap:"12px",alignItems:"flex-end"},children:[(0,n.jsx)(g.k,{label:"Link",readOnly:!0,value:F,style:{flex:1},styles:{input:{backgroundColor:l?"rgba(255,255,255,0.05)":"#f3f4f6",border:"none",boxShadow:"none",height:40},label:{marginBottom:8,fontSize:12,fontWeight:600,color:l?"#a3a3a3":"#4b5563"}},onClick:e=>e.target.select()}),(0,n.jsx)(f.$,{size:"md",leftSection:M?(0,n.jsx)(j.YrT,{size:18}):(0,n.jsx)(j.nxz,{size:18}),color:M?"teal":"violet",onClick:e_,style:{height:40,minWidth:120,transition:"background-color 0.2s"},children:"Copy link"})]}),(0,n.jsx)(d.a,{style:{borderTop:`1px solid ${l?"#333":"#e5e7eb"}`,paddingTop:16},children:(0,n.jsxs)(h.E,{size:"sm",c:"dimmed",style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,n.jsx)(j.F5$,{size:16})," Data is end-to-end encrypted. Only people with the link can view."]})})]})}),(0,n.jsx)(c.a,{opened:ea,onClose:eB,withCloseButton:!1,centered:!0,size:"sm",radius:"lg",padding:"xl",styles:{content:{backgroundColor:l?"#121212":"#ffffff"}},children:(0,n.jsxs)(u.B,{gap:"md",align:"center",children:[(0,n.jsx)(h.E,{fw:700,size:"lg",style:{fontFamily:"Assistant, sans-serif"},children:"Waiting for Approval"}),(0,n.jsx)(k.HamsterLoader,{}),(0,n.jsx)(h.E,{size:"sm",c:"dimmed",ta:"center",children:"Please wait while the room owner approves your request to join..."}),(0,n.jsx)(f.$,{variant:"default",onClick:eB,fullWidth:!0,mt:"sm",children:"Cancel"})]})}),(0,n.jsx)(c.a,{opened:!!er,onClose:eM,title:(0,n.jsx)(h.E,{fw:700,size:"xl",style:{fontFamily:"Assistant, sans-serif"},children:"Room Password Required"}),centered:!0,size:"md",radius:"lg",padding:"xl",styles:{content:{backgroundColor:l?"#121212":"#ffffff"}},children:(0,n.jsxs)(u.B,{gap:"md",children:[(0,n.jsx)(h.E,{size:"sm",c:"dimmed",children:"This live collaboration room is protected by a password. Please enter the password to join."}),(0,n.jsx)(m.y,{label:"Password",placeholder:"Enter room password",value:ef,onChange:e=>ep(e.currentTarget.value),leftSection:(0,n.jsx)(j.Fv0,{size:14}),styles:{input:{backgroundColor:l?"rgba(255,255,255,0.05)":"#f3f4f6",border:"none"}},"data-autofocus":!0,onKeyDown:e=>{"Enter"===e.key&&eN()}}),(0,n.jsxs)(d.a,{style:{display:"flex",gap:"8px",justifyContent:"flex-end",marginTop:10},children:[(0,n.jsx)(f.$,{variant:"default",onClick:eM,children:"Cancel"}),(0,n.jsx)(f.$,{color:"blue",onClick:eN,children:"Join Room"})]})]})}),(0,n.jsx)(O,{opened:!!eg,darkMode:l,title:"Join Collaborative Room",message:(0,n.jsxs)(n.Fragment,{children:["Joining this room will ",(0,n.jsx)("strong",{children:"permanently replace your existing content"})," with the room's content. You can back up your drawing first by using the option below."]}),onReplace:()=>{eg&&(Y(eg,void 0,{asOwner:!1}),em(null))},onClose:()=>em(null),onSaveToDisk:ez}),(0,n.jsx)(c.a,{opened:ed,onClose:()=>ec(!1),title:(0,n.jsx)(h.E,{fw:700,size:"xl",style:{fontFamily:"Assistant, sans-serif"},children:"Live Collaboration"}),centered:!0,size:"md",radius:"lg",padding:"xl",styles:{content:{backgroundColor:l?"#121212":"#ffffff"}},children:(0,n.jsx)(u.B,{gap:"md",children:W&&G?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(h.E,{size:"sm",c:"dimmed",children:"You are live. Anyone with this link can join and draw in real-time."}),(0,n.jsxs)(x.Y,{gap:"apart",style:{background:l?"rgba(255,255,255,0.05)":"#f8f9fa",padding:"10px",borderRadius:"8px"},children:[(0,n.jsxs)(d.a,{children:[(0,n.jsxs)(h.E,{size:"sm",fw:600,children:["Room ID: ",G]}),(0,n.jsxs)(w.E,{color:"green",variant:"light",size:"sm",children:["Online (",H.length,"/",ee," users)"]})]}),(0,n.jsx)(f.$,{color:"red",variant:"subtle",size:"xs",leftSection:(0,n.jsx)(j.QeK,{}),onClick:Z,children:"Stop Session"})]}),(0,n.jsxs)(d.a,{style:{display:"flex",gap:"12px",alignItems:"flex-end",marginTop:10},children:[(0,n.jsx)(g.k,{label:"Collab Link",readOnly:!0,value:eJ(),style:{flex:1},styles:{input:{backgroundColor:l?"rgba(255,255,255,0.05)":"#f3f4f6",border:"none"}},onClick:e=>e.target.select()}),(0,n.jsx)(f.$,{leftSection:M?(0,n.jsx)(j.YrT,{size:18}):(0,n.jsx)(j.nxz,{size:18}),color:M?"teal":"blue",onClick:()=>{navigator.clipboard.writeText(eJ()),B(!0),U.current&&window.clearTimeout(U.current),U.current=window.setTimeout(()=>B(!1),3e3)},children:"Copy"})]}),el&&el.length>0&&(0,n.jsxs)(d.a,{style:{marginTop:12,borderRadius:8,padding:10,background:l?"rgba(255,165,0,0.1)":"#fff5e6",border:`1px solid ${l?"rgba(255,165,0,0.3)":"#ffe0b2"}`},children:[(0,n.jsxs)(h.E,{size:"xs",c:"orange",fw:600,mb:8,children:["Pending Requests (",el.length,")"]}),(0,n.jsx)(u.B,{gap:6,children:el.map(e=>(0,n.jsxs)(x.Y,{justify:"space-between",wrap:"nowrap",children:[(0,n.jsxs)(x.Y,{gap:8,children:[(0,n.jsx)(d.a,{w:10,h:10,style:{borderRadius:"50%",background:e.color||"#ccc"}}),(0,n.jsx)(h.E,{size:"sm",fw:500,truncate:!0,children:e.username})]}),(0,n.jsxs)(x.Y,{gap:4,children:[(0,n.jsx)(f.$,{size:"compact-xs",color:"teal",onClick:()=>eo(e.userId),children:"Approve"}),(0,n.jsx)(f.$,{size:"compact-xs",color:"red",variant:"subtle",onClick:()=>ei(e.userId),children:"Reject"})]})]},e.userId))})]}),(0,n.jsxs)(d.a,{style:{marginTop:12,borderRadius:8,padding:10,background:l?"rgba(255,255,255,0.04)":"#f8f9fa"},children:[(0,n.jsx)(h.E,{size:"xs",c:"dimmed",mb:8,children:"Participants"}),(0,n.jsx)(u.B,{gap:6,children:H.map(e=>{let t=e.id===K;return(0,n.jsxs)(x.Y,{justify:"space-between",wrap:"nowrap",children:[(0,n.jsxs)(h.E,{size:"sm",fw:500,truncate:!0,children:[e.username||e.id,t?" (You)":"",e.isOwner?" (Owner)":""]}),Q&&!t?(0,n.jsx)(p.M,{color:"red",variant:"light","aria-label":"Kick user",onClick:()=>et(e.id),children:(0,n.jsx)(j.JOY,{size:14})}):null]},e.id)})})]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(h.E,{size:"sm",c:"dimmed",children:"Create a real-time multiplayer room to draw with others. You can optionally set a password."}),(0,n.jsx)(m.y,{label:"Room Password (Optional)",placeholder:"Leave blank for public room",value:eu,onChange:e=>eh(e.currentTarget.value),leftSection:(0,n.jsx)(j.Fv0,{size:14}),styles:{input:{backgroundColor:l?"rgba(255,255,255,0.05)":"#f3f4f6",border:"none"}}}),(0,n.jsx)(f.$,{size:"md",color:"blue",leftSection:(0,n.jsx)(j.aze,{size:16}),onClick:eF,style:{marginTop:10},children:"Start Session"})]})})}),(0,n.jsx)(O,{opened:ex,darkMode:l,onReplace:eA,onClose:()=>{ew(!1),ey.current=null,window.history.replaceState({},"",window.location.pathname)},onSaveToDisk:ez}),(0,n.jsx)(X,{$ready:s,children:(0,n.jsx)("div",{className:"jsondraw-wrapper",children:(0,n.jsx)(eP,{jsondrawAPI:eD,onChange:eC,onPointerUpdate:e=>{e.pointer&&eS(e)},viewModeEnabled:!1,zenModeEnabled:!1,gridModeEnabled:!1,theme:l?"dark":"light",UIOptions:{canvasActions:{export:{saveFileToDisk:!0},clearDrawing:()=>D(!0)}},initialData:{appState:{activeTool:{type:"hand",customType:null,lastActiveTool:null,locked:!1,fromSelection:!1}}},renderTopRightUI:e=>(0,n.jsx)(d.a,{px:"md",children:(0,n.jsxs)(y.W,{shadow:"md",width:200,position:"bottom-end",children:[(0,n.jsx)(y.W.Target,{children:(0,n.jsx)(f.$,{size:"sm",color:W?"green":"violet",loading:J,leftSection:W?(0,n.jsx)(j.cfS,{size:16}):(0,n.jsx)(j.Pum,{size:16}),title:"Share canvas",children:W?"Live":"Share"})}),(0,n.jsxs)(y.W.Dropdown,{children:[(0,n.jsx)(y.W.Label,{children:"Export Options"}),(0,n.jsx)(y.W.Item,{leftSection:(0,n.jsx)(j.nxz,{size:14}),onClick:eL,children:"Share Link (Snapshot)"}),(0,n.jsx)(y.W.Divider,{}),(0,n.jsx)(y.W.Label,{children:"Realtime"}),(0,n.jsx)(y.W.Item,{color:W?"green":"blue",leftSection:W?(0,n.jsx)(j.cfS,{size:14}):(0,n.jsx)(j.aze,{size:14}),onClick:()=>ec(!0),children:W?"Manage Collab Session":"Start Live Collab"})]})]})})})})})]})};var ee=r(83126),et=r(18512);let er=o.I4.span.withConfig({componentId:"sc-65e7364-0"})(["color:",";&:hover{filter:brightness(1.5);transition:filter 0.2s ease-in-out;}"],({theme:e,$nodeType:t})=>(function({$type:e,theme:t}){return"Object"===e?t.NODE_COLORS.PARENT_OBJ:"Array"===e?t.NODE_COLORS.PARENT_ARR:t.NODE_COLORS.PARENT_OBJ})({theme:e,$type:t})),en=({keyPath:e,nodeType:t})=>(0,n.jsxs)(er,{$nodeType:t,children:[e[0],":"]});var ea=r(6340);let el=e=>{let t=(0,o.DP)(),{valueAsString:r,value:a}=e;return(0,n.jsx)("span",{style:{color:function({$value:e,theme:t}){return e&&!Number.isNaN(+e)?t.NODE_COLORS.INTEGER:"true"===e?t.NODE_COLORS.BOOL.TRUE:"false"===e?t.NODE_COLORS.BOOL.FALSE:"null"===e?t.NODE_COLORS.NULL:t.NODE_COLORS.NODE_VALUE}({theme:t,$value:r})},children:(0,n.jsx)(ea.J,{children:JSON.stringify(a)})})},eo=()=>{let e=(0,o.DP)(),t=(0,et.A)(e=>e.json);return(0,n.jsx)(ee.d,{hideRoot:!0,data:JSON.parse(t),valueRenderer:(e,t)=>(0,n.jsx)(el,{valueAsString:e,value:t}),labelRenderer:(e,t)=>(0,n.jsx)(en,{keyPath:e,nodeType:t}),theme:{extend:{overflow:"scroll",height:"100%",scheme:"monokai",author:"wimer hazenberg (http://www.monokai.nl)",base00:e.GRID_BG_COLOR}}})},ei=o.Ay.div.withConfig({componentId:"sc-78d58c26-0"})(["position:relative;height:100%;background:",';overflow:auto;cursor:url("/assets/cursor.svg"),auto;& > ul{margin-top:0 !important;padding:12px !important;font-family:monospace;font-size:14px;font-weight:500;}.tab-group{position:absolute;top:10px;left:10px;z-index:2;}'],({theme:e})=>e.GRID_BG_COLOR),es=()=>{let[e]=(0,l.F)({key:"viewMode",defaultValue:i.nE.Graph});return e===i.nE.Graph?(0,n.jsx)(s.GraphView,{}):e===i.nE.Tree?(0,n.jsx)(eo,{}):e===i.nE.JsonDraw?(0,n.jsx)(Q,{}):null},ed=()=>(0,n.jsx)(ei,{onContextMenuCapture:e=>e.preventDefault(),children:(0,n.jsx)(es,{})})}}]);
//# sourceMappingURL=75373.9956fdd896a5ffff.js.map