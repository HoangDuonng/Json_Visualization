{"version":3,"file":"static/chunks/75373.96686d9817a4b7a3.js","mappings":"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","sources":["webpack://_N_E/./src/features/collab/useDrawingSync.ts","webpack://_N_E/./src/features/editor/views/JsonDrawView/LoadFromLinkDialog.tsx","webpack://_N_E/./src/features/editor/views/JsonDrawView/jsonToJsonDraw.ts","webpack://_N_E/./src/lib/db.ts","webpack://_N_E/./src/features/editor/views/JsonDrawView/shareBackend.ts","webpack://_N_E/./src/features/editor/views/JsonDrawView/shareLinkUtils.ts","webpack://_N_E/./src/features/editor/views/JsonDrawView/index.tsx","webpack://_N_E/./src/features/editor/views/TreeView/Label.tsx","webpack://_N_E/./src/features/editor/views/TreeView/Value.tsx","webpack://_N_E/./src/features/editor/views/TreeView/index.tsx","webpack://_N_E/./src/features/editor/LiveEditor.tsx"],"sourcesContent":["import { useEffect, useRef } from \"react\";\n// Import reconcile utilities from the JsonDraw drawing engine\nimport { getSceneVersion, reconcileElements, restoreElements } from \"../../jsondraw\";\nimport { useCollab } from \"./CollabRoot\";\nimport { getCollabType } from \"./collabMode\";\nimport { CollabType } from \"../../constants/enumData\";\n\n// Define the shape of our JsonDraw API reference\ninterface JsonDrawAPI {\n  getSceneElementsIncludingDeleted: () => any[];\n  getAppState: () => any;\n  updateScene: (data: {\n    elements?: any[];\n    appState?: any;\n    commitToHistory?: boolean;\n    collaborators?: Map<string, any>;\n  }) => void;\n}\n\nexport const useDrawingSync = (apiRef: React.MutableRefObject<JsonDrawAPI | null>) => {\n  const collab = useCollab() as any;\n  const { socket, isCollaborating, roomId, collaborators, isRoomOwner } = collab;\n  const p2pRoom = collab._p2pRoom as any | null;\n  const canSync: boolean = typeof collab.canSync === \"boolean\" ? collab.canSync : true;\n  const collabType = getCollabType();\n\n  const lastBroadcastedVersion = useRef<number>(-1);\n  const remoteCollaboratorsRef = useRef<Map<string, any>>(new Map());\n  const hasReceivedInitialSync = useRef<boolean>(false);\n\n  const sendDrawRef = useRef<((elements: any[]) => void) | null>(null);\n  const sendPointerRef = useRef<((payload: any) => void) | null>(null);\n\n  // When room changes or collaboration stops, reset sync flag\n  useEffect(() => {\n    if (isCollaborating && canSync) {\n      hasReceivedInitialSync.current = isRoomOwner;\n    } else {\n      hasReceivedInitialSync.current = false;\n      lastBroadcastedVersion.current = -1;\n    }\n  }, [isCollaborating, isRoomOwner, canSync]);\n\n  // Convert `collaborators` state into Excalidraw Map\n  useEffect(() => {\n    const newMap = new Map();\n    collaborators.forEach((user: any) => {\n      if (socket && user.id === socket.id) return;\n      if (!socket && collabType === CollabType.P2P && user.id === collab.currentUserId) {\n        return;\n      }\n\n      const existing = remoteCollaboratorsRef.current.get(user.id);\n\n      newMap.set(user.id, {\n        pointer: existing?.pointer,\n        button: existing?.button || \"up\",\n        username: user.username,\n        color: {\n          background: user.color || \"#eee\",\n          stroke: user.color || \"#eee\",\n        },\n        id: user.id,\n        socketId: user.id,\n      });\n    });\n\n    remoteCollaboratorsRef.current = newMap;\n\n    if (apiRef.current && isCollaborating && canSync) {\n      apiRef.current.updateScene({ collaborators: newMap });\n    }\n  }, [collaborators, apiRef, isCollaborating, socket, collabType, collab, canSync]);\n\n  // 1. Listen for incoming remote drawing updates\n  useEffect(() => {\n    if (!isCollaborating || !canSync) return;\n\n    if (collabType === CollabType.Socket) {\n      if (!socket) return;\n\n      const handleClientDraw = (remoteElements: any[]) => {\n        const api = apiRef.current;\n        if (!api) return;\n\n        const localElements = api.getSceneElementsIncludingDeleted();\n        const appState = api.getAppState();\n\n        let finalElements: any[] = [];\n\n        if (!isRoomOwner && !hasReceivedInitialSync.current) {\n          finalElements = restoreElements(remoteElements, null);\n          hasReceivedInitialSync.current = true;\n        } else {\n          const restoredRemoteElements = restoreElements(remoteElements, localElements);\n          finalElements = reconcileElements(localElements, restoredRemoteElements, appState);\n        }\n\n        lastBroadcastedVersion.current = getSceneVersion(finalElements);\n\n        api.updateScene({\n          elements: finalElements,\n          commitToHistory: false,\n        });\n      };\n\n      socket.on(\"client-draw\", handleClientDraw);\n      sendDrawRef.current = (elements: any[]) => {\n        if (!roomId) return;\n        socket.emit(\"server-draw\", roomId, elements);\n      };\n\n      return () => {\n        socket.off(\"client-draw\", handleClientDraw);\n        sendDrawRef.current = null;\n      };\n    }\n\n    if (collabType === CollabType.P2P && p2pRoom) {\n      const [sendDraw, getDraw] = p2pRoom.makeAction(\"draw\");\n\n      const handleDraw = (remoteElements: any[]) => {\n        const api = apiRef.current;\n        if (!api) return;\n\n        const localElements = api.getSceneElementsIncludingDeleted();\n        const appState = api.getAppState();\n\n        let finalElements: any[] = [];\n\n        if (!isRoomOwner && !hasReceivedInitialSync.current) {\n          finalElements = restoreElements(remoteElements, null);\n          hasReceivedInitialSync.current = true;\n        } else {\n          const restoredRemoteElements = restoreElements(remoteElements, localElements);\n          finalElements = reconcileElements(localElements, restoredRemoteElements, appState);\n        }\n\n        lastBroadcastedVersion.current = getSceneVersion(finalElements);\n\n        api.updateScene({\n          elements: finalElements,\n          commitToHistory: false,\n        });\n      };\n\n      getDraw(handleDraw);\n      sendDrawRef.current = (elements: any[]) => {\n        void sendDraw(elements);\n      };\n\n      return () => {\n        sendDrawRef.current = null;\n      };\n    }\n  }, [socket, isCollaborating, apiRef, isRoomOwner, collabType, p2pRoom, roomId, canSync]);\n\n  // 2. Listen for remote pointers\n  useEffect(() => {\n    if (!isCollaborating || !canSync) return;\n\n    if (collabType === CollabType.Socket) {\n      if (!socket) return;\n\n      const handleClientPointer = (peerId: string, pointerData: any) => {\n        const api = apiRef.current;\n        if (!api) return;\n\n        const collabsMap = remoteCollaboratorsRef.current;\n        const user = collabsMap.get(peerId);\n\n        if (user) {\n          user.pointer = pointerData.pointer;\n          user.button = pointerData.button;\n\n          const newMap = new Map(collabsMap);\n          remoteCollaboratorsRef.current = newMap;\n\n          api.updateScene({ collaborators: newMap });\n        }\n      };\n\n      socket.on(\"client-pointer\", handleClientPointer);\n      sendPointerRef.current = (pointerPayload: any) => {\n        if (!roomId) return;\n        socket.emit(\"server-pointer\", roomId, pointerPayload);\n      };\n\n      return () => {\n        socket.off(\"client-pointer\", handleClientPointer);\n        sendPointerRef.current = null;\n      };\n    }\n\n    if (collabType === CollabType.P2P && p2pRoom) {\n      const [sendPointer, getPointer] = p2pRoom.makeAction(\"pointer\");\n\n      const handlePointer = (payload: any, peerId: string) => {\n        const api = apiRef.current;\n        if (!api) return;\n\n        const collabsMap = remoteCollaboratorsRef.current;\n        const user = collabsMap.get(peerId);\n\n        if (user) {\n          user.pointer = payload.pointer;\n          user.button = payload.button;\n\n          const newMap = new Map(collabsMap);\n          remoteCollaboratorsRef.current = newMap;\n\n          api.updateScene({ collaborators: newMap });\n        }\n      };\n\n      getPointer(handlePointer);\n      sendPointerRef.current = (pointerPayload: any) => {\n        void sendPointer(pointerPayload);\n      };\n\n      return () => {\n        sendPointerRef.current = null;\n      };\n    }\n  }, [socket, isCollaborating, apiRef, collabType, p2pRoom, roomId, canSync]);\n\n  // 3. Broadcast local drawing changes\n  const broadcastDrawingChanges = (elements: any[]) => {\n    if (!isCollaborating || !canSync) return;\n\n    if (!isRoomOwner && !hasReceivedInitialSync.current) return;\n\n    const currentVersion = getSceneVersion(elements);\n    if (currentVersion > lastBroadcastedVersion.current) {\n      if (sendDrawRef.current) {\n        sendDrawRef.current(elements);\n      }\n      lastBroadcastedVersion.current = currentVersion;\n    }\n  };\n\n  // 4. Broadcast local pointer position\n  const broadcastPointer = (pointerPayload: any) => {\n    if (!isCollaborating) return;\n    if (sendPointerRef.current) {\n      sendPointerRef.current(pointerPayload);\n    }\n  };\n\n  // 5. Handle new users requesting the latest drawing (sync init)\n  useEffect(() => {\n    if (!isCollaborating || !isRoomOwner || !canSync) return;\n\n    if (collabType === CollabType.Socket) {\n      if (!socket) return;\n\n      const handleNewUser = () => {\n        const api = apiRef.current;\n        if (!api) return;\n\n        const elements = api.getSceneElementsIncludingDeleted();\n        if (elements.length > 0 && sendDrawRef.current) {\n          sendDrawRef.current(elements);\n        }\n      };\n\n      socket.on(\"new-user\", handleNewUser);\n\n      return () => {\n        socket.off(\"new-user\", handleNewUser);\n      };\n    }\n\n    if (collabType === CollabType.P2P && p2pRoom) {\n      const handlePeerJoin = (peerId: string) => {\n        const api = apiRef.current;\n        if (!api) return;\n\n        const elements = api.getSceneElementsIncludingDeleted();\n        if (elements.length === 0) return;\n\n        const [sendDraw] = p2pRoom.makeAction(\"draw\");\n        void sendDraw(elements, peerId);\n      };\n\n      p2pRoom.onPeerJoin(handlePeerJoin);\n\n      return () => {\n        p2pRoom.onPeerJoin(() => {});\n      };\n    }\n  }, [socket, isCollaborating, roomId, apiRef, isRoomOwner, collabType, p2pRoom, canSync]);\n\n  return { broadcastDrawingChanges, broadcastPointer };\n};\n","import React from \"react\";\nimport { Modal, Box, Text, Button, Stack } from \"@mantine/core\";\nimport styled from \"styled-components\";\nimport { FiAlertTriangle, FiDownload } from \"react-icons/fi\";\n\nconst WarningBanner = styled.div<{ $dark: boolean }>`\n  display: flex;\n  flex-direction: row;\n  align-items: flex-start;\n  gap: 1rem;\n  padding: 1.75rem 2rem;\n  border-radius: 0.5rem;\n  background: ${({ $dark }) => ($dark ? \"rgba(220, 38, 38, 0.12)\" : \"#fef2f2\")};\n  color: ${({ $dark }) => ($dark ? \"#fca5a5\" : \"#991b1b\")};\n\n  @media (max-width: 600px) {\n    flex-direction: column;\n    text-align: center;\n    align-items: center;\n  }\n`;\n\nconst IconWrapper = styled.div<{ $dark: boolean }>`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-shrink: 0;\n  width: 3rem;\n  height: 3rem;\n  border-radius: 50%;\n  background: ${({ $dark }) => ($dark ? \"rgba(220, 38, 38, 0.2)\" : \"#fee2e2\")};\n\n  svg {\n    width: 1.4rem;\n    height: 1.4rem;\n    color: ${({ $dark }) => ($dark ? \"#f87171\" : \"#dc2626\")};\n  }\n`;\n\nconst ActionCard = styled.div<{ $dark: boolean }>`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding: 1.5rem;\n  gap: 0.75rem;\n  text-align: center;\n\n  h4 {\n    margin: 0;\n    font-weight: 700;\n    font-size: 1.125rem;\n    color: ${({ $dark }) => ($dark ? \"#e5e5e5\" : \"#1f2937\")};\n  }\n\n  p {\n    margin: 0;\n    font-size: 0.875rem;\n    color: ${({ $dark }) => ($dark ? \"#a3a3a3\" : \"#6b7280\")};\n    line-height: 1.5;\n  }\n`;\n\nconst WarningText = styled.div<{ $dark: boolean }>`\n  flex: 1;\n  min-width: 0;\n  font-size: 0.95rem;\n  line-height: 1.5;\n  color: ${({ $dark }) => ($dark ? \"#fca5a5\" : \"#991b1b\")};\n\n  strong {\n    color: ${({ $dark }) => ($dark ? \"#f87171\" : \"#dc2626\")};\n  }\n\n  @media (max-width: 600px) {\n    text-align: center;\n  }\n`;\n\ninterface LoadFromLinkDialogProps {\n  opened: boolean;\n  darkMode: boolean;\n  onReplace: () => void;\n  onClose: () => void;\n  onSaveToDisk: () => void;\n  title?: React.ReactNode;\n  message?: React.ReactNode;\n}\n\nexport const LoadFromLinkDialog: React.FC<LoadFromLinkDialogProps> = ({\n  opened,\n  darkMode,\n  onReplace,\n  onClose,\n  onSaveToDisk,\n  title,\n  message,\n}) => {\n  return (\n    <Modal\n      opened={opened}\n      onClose={onClose}\n      title={null}\n      withCloseButton={false}\n      centered\n      size={700}\n      padding=\"xl\"\n      radius=\"lg\"\n      styles={{\n        content: {\n          backgroundColor: darkMode ? \"#1e1e1e\" : \"#ffffff\",\n        },\n        overlay: {\n          backgroundColor: darkMode ? \"rgba(0, 0, 0, 0.7)\" : \"rgba(0, 0, 0, 0.4)\",\n        },\n      }}\n    >\n      <Stack gap=\"lg\">\n        {/* Title */}\n        <Text\n          fw={700}\n          size=\"xl\"\n          style={{\n            fontFamily: \"Assistant, sans-serif\",\n            fontSize: \"1.3rem\",\n            color: darkMode ? \"#e5e5e5\" : \"#111827\",\n          }}\n        >\n          {title || \"Load from link\"}\n        </Text>\n\n        {/* Warning Banner + Replace Button */}\n        <WarningBanner $dark={darkMode}>\n          <IconWrapper $dark={darkMode}>\n            <FiAlertTriangle />\n          </IconWrapper>\n          <WarningText $dark={darkMode}>\n            {message || (\n              <>\n                Loading external drawing will <strong>replace your existing content</strong>. You\n                can back up your drawing first by using one of the options below.\n              </>\n            )}\n          </WarningText>\n          <Button color=\"red\" size=\"md\" onClick={onReplace} style={{ flexShrink: 0 }}>\n            Replace my content\n          </Button>\n        </WarningBanner>\n\n        {/* Save to disk action */}\n        <ActionCard $dark={darkMode}>\n          <h4>Save to disk</h4>\n          <p>Export the scene data to a file from which you can import later.</p>\n          <Button\n            variant=\"outline\"\n            color=\"gray\"\n            size=\"md\"\n            fullWidth\n            leftSection={<FiDownload size={16} />}\n            onClick={onSaveToDisk}\n            styles={{\n              root: {\n                maxWidth: 300,\n                borderColor: darkMode ? \"#404040\" : \"#d1d5db\",\n                color: darkMode ? \"#d4d4d4\" : \"#374151\",\n              },\n            }}\n          >\n            Save to disk\n          </Button>\n        </ActionCard>\n      </Stack>\n    </Modal>\n  );\n};\n","/**\n * Converter: JSON NodeData/EdgeData  JsonDraw Elements\n *\n * Maps the existing graph model (from jsonParser) into JsonDraw-compatible\n * element format so JSON data can be visualized on the JsonDraw whiteboard.\n */\nimport { FONT_FAMILY } from \"@jsondraw/common\";\nimport {\n  JSONDRAW_FONT_SIZE,\n  JSONDRAW_HORIZONTAL_GAP,\n  JSONDRAW_NODE_PADDING,\n  JSONDRAW_ROW_HEIGHT,\n  JSONDRAW_VERTICAL_GAP,\n} from \"../../../../constants/enumData\";\nimport type { NodeData, EdgeData } from \"../../../../types/graph\";\n\n// JsonDraw element types (simplified)\ninterface JsonDrawBaseElement {\n  id: string;\n  type: string;\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n  angle: 0;\n  strokeColor: string;\n  backgroundColor: string;\n  fillStyle: \"solid\" | \"hachure\" | \"cross-hatch\";\n  strokeWidth: number;\n  roughness: number;\n  opacity: number;\n  groupIds: string[];\n  roundness: { type: number } | null;\n  seed: number;\n  version: number;\n  versionNonce: number;\n  isDeleted: false;\n  boundElements: { id: string; type: \"text\" | \"arrow\" }[] | null;\n  index: string | null;\n  updated: number;\n  link: null;\n  locked: false;\n  frameId: null;\n}\n\ninterface JsonDrawRectangleElement extends JsonDrawBaseElement {\n  type: \"rectangle\";\n}\n\ninterface JsonDrawTextElement extends JsonDrawBaseElement {\n  type: \"text\";\n  text: string;\n  fontSize: number;\n  fontFamily: number;\n  textAlign: \"left\" | \"center\" | \"right\";\n  verticalAlign: \"top\" | \"middle\" | \"bottom\";\n  containerId: string | null;\n  originalText: string;\n  autoResize: boolean;\n  lineHeight: number;\n}\n\n// Keeping local interface for now or import?\n// The file defined JsonDrawArrowElement locally but extended Base.\n// Wait, the original file had `interface JsonDrawArrowElement extends JsonDrawBaseElement`.\n// But it imported `JsonDrawArrowElement` type from packages/element/types?\n// Step 905 line 7: `import type { JsonDrawArrowElement } from ...`\n// But line 54 defines `interface JsonDrawArrowElement extends ...`.\n// This is shadowing or extending? TS allows interface merging but here it likely conflicts if imported as type.\n// Ah, line 7 imports it, but line 54 re-declares it?\n// Actually line 7 imports `JsonDrawArrowElement`.\n// And line 54 defines `interface JsonDrawArrowElement`.\n// This would be a specialized version or augmentation?\n// No, line 7 in Step 905 is: `import type { NodeData, EdgeData } from \"../../../../types/graph\";`\n// Wait. Line 7 is NodeData/EdgeData.\n// Where is JsonDrawArrowElement imported?\n// Ah, Step 900 replaced import but failed.\n// Step 905 shows the file content.\n// It does NOT import JsonDrawArrowElement in lines 1-10.\n// Let me check imports again.\n// Line 7: `import type { NodeData, EdgeData } ...`\n// Line 9: `// JsonDraw element types (simplified)`\n// Line 54: `interface JsonDrawArrowElement extends JsonDrawBaseElement`.\n// So it defines them LOCALLY. It does not import them (except maybe `JsonDrawElement` type at line 74 union).\n// Line 74: `type JsonDrawElement = ...`\n// So this file defines its OWN types that match JsonDraw's structure.\n// So I should rename these LOCAL interfaces to JsonDraw...\n// And I don't need to import `JsonDrawArrowElement` if I define it here.\n// But `jsonToJsonDrawElements` returns `JsonDrawElement[]`.\n// Use the local type.\n// So I will rename all local interfaces and the return type.\n\ninterface JsonDrawArrowElement extends JsonDrawBaseElement {\n  type: \"arrow\";\n  points: [number, number][];\n  startBinding: {\n    elementId: string;\n    focus: number;\n    gap: number;\n    fixedPoint: [number, number];\n  } | null;\n  endBinding: {\n    elementId: string;\n    focus: number;\n    gap: number;\n    fixedPoint: [number, number];\n  } | null;\n  startArrowhead: null;\n  endArrowhead: \"arrow\";\n  elbowed: boolean;\n}\n\ntype JsonDrawElement = JsonDrawRectangleElement | JsonDrawTextElement | JsonDrawArrowElement;\n\n// Simple random seed generator\nconst randomSeed = () => Math.floor(Math.random() * 2000000000);\nconst randomNonce = () => Math.floor(Math.random() * 2000000000);\n\n/**\n * Format node text content for display inside JsonDraw rectangle\n */\nconst formatNodeText = (node: NodeData): string => {\n  if (!node.text || node.text.length === 0) return \"\";\n\n  return node.text\n    .map(row => {\n      if (row.key !== null && row.key !== undefined) {\n        if (row.type === \"object\") return `${row.key}: {${row.childrenCount ?? 0} keys}`;\n        if (row.type === \"array\") return `${row.key}: [${row.childrenCount ?? 0} items]`;\n        if (row.value === null) return `${row.key}: null`;\n        return `${row.key}: ${row.value}`;\n      }\n      return `${row.value ?? \"\"}`;\n    })\n    .join(\"\\n\");\n};\n\n/**\n * Layout nodes using a simple layered approach (BFS by depth from root).\n * Returns map of nodeId  { x, y }.\n */\nconst layoutNodes = (\n  nodes: NodeData[],\n  edges: EdgeData[]\n): Map<string, { x: number; y: number }> => {\n  const positions = new Map<string, { x: number; y: number }>();\n\n  if (nodes.length === 0) return positions;\n\n  // Build adjacency list (parent  children)\n  const children = new Map<string, string[]>();\n  const hasParent = new Set<string>();\n\n  for (const edge of edges) {\n    const ch = children.get(edge.from) ?? [];\n    ch.push(edge.to);\n    children.set(edge.from, ch);\n    hasParent.add(edge.to);\n  }\n\n  // Find root nodes (no incoming edges)\n  const roots = nodes.filter(n => !hasParent.has(n.id)).map(n => n.id);\n  if (roots.length === 0 && nodes.length > 0) {\n    roots.push(nodes[0].id);\n  }\n\n  // BFS to assign layers\n  const nodeMap = new Map(nodes.map(n => [n.id, n]));\n  const layers: string[][] = [];\n  const visited = new Set<string>();\n  let queue = [...roots];\n\n  while (queue.length > 0) {\n    const layer: string[] = [];\n    const nextQueue: string[] = [];\n\n    for (const id of queue) {\n      if (visited.has(id)) continue;\n      visited.add(id);\n      layer.push(id);\n\n      const ch = children.get(id) ?? [];\n      for (const childId of ch) {\n        if (!visited.has(childId)) nextQueue.push(childId);\n      }\n    }\n\n    if (layer.length > 0) layers.push(layer);\n    queue = nextQueue;\n  }\n\n  // Also add any orphan nodes (not connected via edges)\n  const orphans = nodes.filter(n => !visited.has(n.id)).map(n => n.id);\n  if (orphans.length > 0) layers.push(orphans);\n\n  // Assign positions by layer (horizontal layout: layers go right)\n  let currentX = 50;\n\n  for (const layer of layers) {\n    let maxWidth = 0;\n    let currentY = 50;\n\n    for (const nodeId of layer) {\n      const node = nodeMap.get(nodeId);\n      if (!node) continue;\n\n      positions.set(nodeId, { x: currentX, y: currentY });\n      currentY += node.height + JSONDRAW_VERTICAL_GAP;\n      maxWidth = Math.max(maxWidth, node.width);\n    }\n\n    currentX += maxWidth + JSONDRAW_HORIZONTAL_GAP;\n  }\n\n  return positions;\n};\n\n/**\n * Convert Json-viz NodeData[] + EdgeData[]  JsonDraw elements\n */\nexport const jsonToJsonDrawElements = (nodes: NodeData[], edges: EdgeData[]): JsonDrawElement[] => {\n  const elements: JsonDrawElement[] = [];\n  const positions = layoutNodes(nodes, edges);\n\n  const now = Date.now();\n  let indexCounter = 0;\n  const getNextIndex = () => `a${(indexCounter++).toString().padStart(6, \"0\")}`;\n\n  // Map to track rectangle element IDs for arrow bindings\n  const rectIds = new Map<string, string>();\n\n  // Create rectangle + text for each node\n  for (const node of nodes) {\n    const pos = positions.get(node.id) ?? { x: 0, y: 0 };\n    const rectId = `rect-${node.id}`;\n    const textId = `text-${node.id}`;\n    const text = formatNodeText(node);\n\n    rectIds.set(node.id, rectId);\n\n    const width = Math.max(node.width + JSONDRAW_NODE_PADDING * 2, 120);\n    const textRows = node.text?.length ?? 1;\n    const height = Math.max(textRows * JSONDRAW_ROW_HEIGHT + JSONDRAW_NODE_PADDING * 2, 50);\n\n    // Collect arrow bindings for this rectangle\n    const boundElements: { id: string; type: \"text\" | \"arrow\" }[] = [{ id: textId, type: \"text\" }];\n\n    for (const edge of edges) {\n      if (edge.from === node.id || edge.to === node.id) {\n        boundElements.push({ id: `arrow-${edge.id}`, type: \"arrow\" });\n      }\n    }\n\n    // Rectangle element\n    const rect: JsonDrawRectangleElement = {\n      id: rectId,\n      type: \"rectangle\",\n      x: pos.x,\n      y: pos.y,\n      width,\n      height,\n      angle: 0,\n      strokeColor: \"#1e1e1e\",\n      backgroundColor: \"transparent\",\n      fillStyle: \"solid\",\n      strokeWidth: 1,\n      roughness: 1,\n      opacity: 100,\n      groupIds: [],\n      roundness: { type: 3 },\n      seed: randomSeed(),\n      version: 1,\n      versionNonce: randomNonce(),\n      isDeleted: false,\n      boundElements,\n      index: getNextIndex(),\n      updated: now,\n      link: null,\n      locked: false,\n      frameId: null,\n    };\n    elements.push(rect);\n\n    // Text element (bound to rectangle)\n    const textEl: JsonDrawTextElement = {\n      id: textId,\n      type: \"text\",\n      x: pos.x + JSONDRAW_NODE_PADDING,\n      y: pos.y + JSONDRAW_NODE_PADDING,\n      width: width - JSONDRAW_NODE_PADDING * 2,\n      height: height - JSONDRAW_NODE_PADDING * 2,\n      angle: 0,\n      strokeColor: \"#1e1e1e\",\n      backgroundColor: \"transparent\",\n      fillStyle: \"solid\",\n      strokeWidth: 1,\n      roughness: 1,\n      opacity: 100,\n      groupIds: [],\n      roundness: null,\n      seed: randomSeed(),\n      version: 1,\n      versionNonce: randomNonce(),\n      isDeleted: false,\n      boundElements: null,\n      index: getNextIndex(),\n      updated: now,\n      link: null,\n      locked: false,\n      frameId: null,\n      text,\n      fontSize: JSONDRAW_FONT_SIZE,\n      fontFamily: FONT_FAMILY.Excalifont,\n      textAlign: \"left\",\n      verticalAlign: \"top\",\n      containerId: rectId,\n      originalText: text,\n      autoResize: true,\n      lineHeight: 1.25,\n    };\n    elements.push(textEl);\n  }\n\n  // Create arrows for each edge\n  for (const edge of edges) {\n    const fromRectId = rectIds.get(edge.from);\n    const toRectId = rectIds.get(edge.to);\n    if (!fromRectId || !toRectId) continue;\n\n    const fromPos = positions.get(edge.from);\n    const toPos = positions.get(edge.to);\n    if (!fromPos || !toPos) continue;\n\n    const fromNode = nodes.find(n => n.id === edge.from);\n    const toNode = nodes.find(n => n.id === edge.to);\n    if (!fromNode || !toNode) continue;\n\n    const fromWidth = Math.max(fromNode.width + JSONDRAW_NODE_PADDING * 2, 120);\n    const fromHeight = Math.max(\n      (fromNode.text?.length ?? 1) * JSONDRAW_ROW_HEIGHT + JSONDRAW_NODE_PADDING * 2,\n      50\n    );\n    const toHeight = Math.max(\n      (toNode.text?.length ?? 1) * JSONDRAW_ROW_HEIGHT + JSONDRAW_NODE_PADDING * 2,\n      50\n    );\n\n    // Arrow starts from right edge of source, ends at left edge of target\n    const startX = fromPos.x + fromWidth;\n    const startY = fromPos.y + fromHeight / 2;\n    const endX = toPos.x;\n    const endY = toPos.y + toHeight / 2;\n\n    const arrow: JsonDrawArrowElement = {\n      id: `arrow-${edge.id}`,\n      type: \"arrow\",\n      x: startX,\n      y: startY,\n      width: Math.abs(endX - startX),\n      height: Math.abs(endY - startY),\n      angle: 0,\n      strokeColor: \"#1e1e1e\",\n      backgroundColor: \"transparent\",\n      fillStyle: \"solid\",\n      strokeWidth: 1,\n      roughness: 1,\n      opacity: 100,\n      groupIds: [],\n      roundness: { type: 2 },\n      seed: randomSeed(),\n      version: 1,\n      versionNonce: randomNonce(),\n      isDeleted: false,\n      boundElements: null,\n      index: getNextIndex(),\n      updated: now,\n      link: null,\n      locked: false,\n      frameId: null,\n      points: [\n        [0, 0],\n        [endX - startX, endY - startY],\n      ],\n      startBinding: {\n        elementId: fromRectId,\n        focus: 0,\n        gap: 5,\n        fixedPoint: [1, 0.5],\n      },\n      endBinding: {\n        elementId: toRectId,\n        focus: 0,\n        gap: 5,\n        fixedPoint: [0, 0.5],\n      },\n      startArrowhead: null,\n      endArrowhead: \"arrow\",\n      elbowed: false,\n    };\n    elements.push(arrow);\n  }\n\n  return elements;\n};\n","import { initializeApp, getApps } from \"firebase/app\";\nimport { getDatabase, Database } from \"firebase/database\";\n\nconst dbConfig = {\n  apiKey: process.env.NEXT_PUBLIC_DB_API_KEY,\n  authDomain: process.env.NEXT_PUBLIC_DB_AUTH_DOMAIN,\n  databaseURL: process.env.NEXT_PUBLIC_DB_URL,\n  projectId: process.env.NEXT_PUBLIC_DB_PROJECT_ID,\n  storageBucket: process.env.NEXT_PUBLIC_DB_STORAGE_BUCKET,\n  messagingSenderId: process.env.NEXT_PUBLIC_DB_SENDER_ID,\n  appId: process.env.NEXT_PUBLIC_DB_APP_ID,\n};\n\nlet _db: Database | null = null;\n\n/**\n * Get database instance lazily  only initializes on first call.\n * This prevents the app from crashing if config is missing.\n */\nexport const getDb = (): Database => {\n  if (_db) return _db;\n\n  if (!dbConfig.databaseURL || !dbConfig.projectId) {\n    throw new Error(\n      \"Database configuration is missing. Please set NEXT_PUBLIC_DB_* environment variables.\"\n    );\n  }\n\n  const app = getApps().length === 0 ? initializeApp(dbConfig) : getApps()[0];\n  _db = getDatabase(app);\n  return _db;\n};\n","import { ref, set, get } from \"firebase/database\";\nimport { getDb } from \"../../../../lib/db\";\n\n/**\n * Convert Uint8Array to base64 string (without spread operator for TS compat)\n */\nconst uint8ToBase64 = (bytes: Uint8Array): string => {\n  let binary = \"\";\n  const chunkSize = 8000;\n  for (let i = 0; i < bytes.length; i += chunkSize) {\n    binary += String.fromCharCode.apply(null, Array.from(bytes.slice(i, i + chunkSize)));\n  }\n  return btoa(binary);\n};\n\n/**\n * Convert base64 string to Uint8Array\n */\nconst base64ToUint8 = (base64: string): Uint8Array => {\n  const binary = atob(base64);\n  const bytes = new Uint8Array(binary.length);\n  for (let i = 0; i < binary.length; i++) {\n    bytes[i] = binary.charCodeAt(i);\n  }\n  return bytes;\n};\n\n/**\n * Generate a short random ID for share links (URL-safe, 20 chars)\n */\nconst generateId = (): string => {\n  const array = new Uint8Array(15);\n  crypto.getRandomValues(array);\n  const base64 = uint8ToBase64(array);\n  return base64.replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=+$/, \"\");\n};\n\n/**\n * Generate an AES-GCM encryption key and return it as a base64url string\n */\nexport const generateEncryptionKey = async (): Promise<string> => {\n  const key = await crypto.subtle.generateKey({ name: \"AES-GCM\", length: 128 }, true, [\n    \"encrypt\",\n    \"decrypt\",\n  ]);\n  const exported = await crypto.subtle.exportKey(\"raw\", key);\n  const bytes = new Uint8Array(exported);\n  const base64 = uint8ToBase64(bytes);\n  return base64.replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=+$/, \"\");\n};\n\n/**\n * Import an AES-GCM key from a base64url string\n */\nconst importKey = async (keyStr: string): Promise<CryptoKey> => {\n  // Convert base64url back to standard base64\n  let base64 = keyStr.replace(/-/g, \"+\").replace(/_/g, \"/\");\n  while (base64.length % 4) base64 += \"=\";\n\n  const raw = base64ToUint8(base64);\n  return crypto.subtle.importKey(\"raw\", raw.buffer as ArrayBuffer, { name: \"AES-GCM\" }, false, [\n    \"encrypt\",\n    \"decrypt\",\n  ]);\n};\n\n/**\n * Encrypt data using AES-GCM.\n * Returns a Uint8Array with IV prepended to ciphertext.\n */\nconst encryptData = async (data: Uint8Array, keyStr: string): Promise<Uint8Array> => {\n  const key = await importKey(keyStr);\n  const iv = crypto.getRandomValues(new Uint8Array(12));\n  const encrypted = await crypto.subtle.encrypt(\n    { name: \"AES-GCM\", iv },\n    key,\n    data.buffer as ArrayBuffer\n  );\n  // Prepend IV to ciphertext\n  const result = new Uint8Array(iv.length + encrypted.byteLength);\n  result.set(iv);\n  result.set(new Uint8Array(encrypted), iv.length);\n  return result;\n};\n\n/**\n * Decrypt data using AES-GCM.\n * Expects IV prepended to ciphertext.\n */\nconst decryptData = async (data: Uint8Array, keyStr: string): Promise<Uint8Array> => {\n  const key = await importKey(keyStr);\n  const iv = data.slice(0, 12);\n  const ciphertext = data.slice(12);\n  const decrypted = await crypto.subtle.decrypt(\n    { name: \"AES-GCM\", iv },\n    key,\n    ciphertext.buffer as ArrayBuffer\n  );\n  return new Uint8Array(decrypted);\n};\n\n/**\n * Upload encrypted + compressed scene data to the backend.\n * Returns { id, encryptionKey } for the share link.\n */\nexport const exportToBackend = async (\n  compressedData: Uint8Array\n): Promise<{ id: string; encryptionKey: string }> => {\n  const id = generateId();\n  const encryptionKey = await generateEncryptionKey();\n\n  // Encrypt the compressed data\n  const encrypted = await encryptData(compressedData, encryptionKey);\n\n  // Convert to base64 for storage (DB stores strings)\n  const base64Data = uint8ToBase64(encrypted);\n\n  // Store in database\n  const dbRef = ref(getDb(), `shared/${id}`);\n  await set(dbRef, {\n    data: base64Data,\n    createdAt: Date.now(),\n  });\n\n  return { id, encryptionKey };\n};\n\n/**\n * Download and decrypt scene data from the backend.\n * Returns decrypted data as Uint8Array, or null if not found.\n */\nexport const importFromBackend = async (\n  id: string,\n  encryptionKey: string\n): Promise<Uint8Array | null> => {\n  try {\n    const dbRef = ref(getDb(), `shared/${id}`);\n    const snapshot = await get(dbRef);\n\n    if (!snapshot.exists()) {\n      console.error(\"Share link data not found:\", id);\n      return null;\n    }\n\n    const { data: base64Data } = snapshot.val();\n\n    // Convert base64 back to Uint8Array\n    const encrypted = base64ToUint8(base64Data);\n\n    // Decrypt\n    const decrypted = await decryptData(encrypted, encryptionKey);\n\n    return decrypted;\n  } catch (error) {\n    console.error(\"Failed to import shared data:\", error);\n    return null;\n  }\n};\n","import pako from \"pako\";\nimport { exportToBackend, importFromBackend } from \"./shareBackend\";\n\ninterface ShareSceneData {\n  elements: any[];\n  appState: any;\n  files?: Record<string, any>;\n}\n\nconst pickUsedFiles = (elements: any[], files?: Record<string, any>) => {\n  if (!files) {\n    return undefined;\n  }\n\n  const fileIds = new Set<string>();\n  for (const el of elements) {\n    if (el && typeof el === \"object\" && \"fileId\" in el && el.fileId) {\n      fileIds.add(el.fileId);\n    }\n  }\n\n  if (fileIds.size === 0) {\n    return undefined;\n  }\n\n  const usedFiles: Record<string, any> = {};\n  for (const fileId of fileIds) {\n    if (files[fileId]) {\n      usedFiles[fileId] = files[fileId];\n    }\n  }\n\n  return Object.keys(usedFiles).length ? usedFiles : undefined;\n};\n\n//  Backend-based share link \n\n/**\n * Create a shareable link by uploading encrypted data to the backend.\n * Returns a short URL like: https://jsonviz.online/draw#json=<id>,<key>\n */\nexport const createShareLink = async (\n  elements: any[],\n  appState: any,\n  files?: Record<string, any>\n): Promise<string> => {\n  const nonDeletedElements = elements\n    .filter(el => !el.isDeleted)\n    .map(el => ({ ...el, isDeleted: undefined }));\n\n  const data = {\n    elements: nonDeletedElements,\n    files: pickUsedFiles(nonDeletedElements, files),\n    appState: {\n      viewBackgroundColor: appState.viewBackgroundColor,\n      theme: appState.theme,\n    },\n  };\n\n  const jsonString = JSON.stringify(data);\n  const compressed = pako.deflate(new TextEncoder().encode(jsonString));\n\n  const { id, encryptionKey } = await exportToBackend(compressed);\n\n  // Key is stored in hash  never sent to server  end-to-end encrypted\n  const hash = `#json=${id},${encryptionKey}`;\n  return `${window.location.origin}${window.location.pathname}${hash}`;\n};\n\n/**\n * Load scene data from a share link.\n * Hash format: #json=<id>,<key>\n */\nexport const loadFromShareLink = async (hash: string): Promise<ShareSceneData | null> => {\n  const match = hash.match(/^#json=([a-zA-Z0-9_-]+),([a-zA-Z0-9_-]+)$/);\n  if (!match) return null;\n\n  const [, id, encryptionKey] = match;\n\n  const decrypted = await importFromBackend(id, encryptionKey);\n  if (!decrypted) return null;\n\n  try {\n    const jsonString = pako.inflate(decrypted, { to: \"string\" });\n    return JSON.parse(jsonString);\n  } catch (error) {\n    console.error(\"Failed to decompress share link data:\", error);\n    return null;\n  }\n};\n\n/**\n * Check if the current URL hash is a backend share link\n */\nexport const isBackendShareLink = (hash: string): boolean => {\n  return /^#json=([a-zA-Z0-9_-]+),([a-zA-Z0-9_-]+)$/.test(hash);\n};\n\n//  Legacy URL-based share link (backward compatibility) \n\n/**\n * Decode legacy #data= format (base64 in URL).\n * Kept for backward compatibility with old shared links.\n * @deprecated Use loadFromShareLink instead for new links.\n */\nexport const decodeDataFromUrlHash = (hash: string) => {\n  try {\n    let base64 = hash.replace(\"#data=\", \"\");\n\n    // Backward compatibility: try to decode legacy encodeURIComponent strings\n    try {\n      base64 = decodeURIComponent(base64);\n    } catch {\n      // Ignore\n    }\n\n    // Convert from url-safe base64 to standard base64\n    base64 = base64.replace(/-/g, \"+\").replace(/_/g, \"/\");\n    // Restore padding if necessary\n    while (base64.length % 4) {\n      base64 += \"=\";\n    }\n\n    const binaryString = window.atob(base64);\n\n    const bytes = new Uint8Array(binaryString.length);\n    for (let i = 0; i < binaryString.length; i++) {\n      bytes[i] = binaryString.charCodeAt(i);\n    }\n\n    const decompressed = pako.inflate(bytes, { to: \"string\" });\n    return JSON.parse(decompressed);\n  } catch (error) {\n    console.error(\"Failed to decode legacy sharelink data\", error);\n    return null;\n  }\n};\n","import React from \"react\";\nimport {\n  Box,\n  Modal,\n  Text,\n  Stack,\n  Button,\n  TextInput,\n  ActionIcon,\n  Menu,\n  PasswordInput,\n  Group,\n  Badge,\n} from \"@mantine/core\";\nimport styled from \"styled-components\";\nimport { toast } from \"react-hot-toast\";\nimport {\n  FiCopy,\n  FiCheck,\n  FiLock,\n  FiX,\n  FiShare2,\n  FiUsers,\n  FiLogOut,\n  FiPlay,\n  FiKey,\n  FiUserX,\n} from \"react-icons/fi\";\nimport { HamsterLoader, saveAsJSON, restoreAppState, restoreElements } from \"../../../../jsondraw\";\nimport useConfig from \"../../../../store/useConfig\";\nimport { useCollab } from \"../../../collab/CollabRoot\";\nimport { useDrawingSync } from \"../../../collab/useDrawingSync\";\nimport useGraph from \"../GraphView/stores/useGraph\";\nimport { LoadFromLinkDialog } from \"./LoadFromLinkDialog\";\nimport { jsonToJsonDrawElements } from \"./jsonToJsonDraw\";\nimport {\n  createShareLink,\n  loadFromShareLink,\n  isBackendShareLink,\n  decodeDataFromUrlHash,\n} from \"./shareLinkUtils\";\n\nconst StyledJsonDrawWrapper = styled.div<{ $ready: boolean }>`\n  width: 100%;\n  height: 100%;\n  position: relative;\n  opacity: ${({ $ready }) => ($ready ? 1 : 0)};\n  transition: opacity 0.2s ease;\n\n  .jsondraw-wrapper {\n    width: 100%;\n    height: 100%;\n  }\n`;\n\nexport const JsonDrawView = () => {\n  const nodes = useGraph(state => state.nodes);\n  const edges = useGraph(state => state.edges);\n  const darkmodeEnabled = useConfig(state => state.darkmodeEnabled);\n\n  const [JsonDrawModule, setJsonDrawModule] = React.useState<{\n    JsonDraw: React.ComponentType<any>;\n  } | null>(null);\n  const [drawReady, setDrawReady] = React.useState(false);\n\n  const jsonDrawAPIRef = React.useRef<any>(null);\n  const hasInitialized = React.useRef(false);\n  const hasUserDrawing = React.useRef(false);\n  const [showClearModal, setShowClearModal] = React.useState(false);\n\n  // Share Modal states\n  const [showShareModal, setShowShareModal] = React.useState(false);\n  const [shareUrl, setShareUrl] = React.useState(\"\");\n  const [justCopied, setJustCopied] = React.useState(false);\n  const [isSharing, setIsSharing] = React.useState(false);\n  const copyTimerRef = React.useRef<number | null>(null);\n\n  // Collab States\n  const {\n    isCollaborating,\n    roomId: activeRoomId,\n    startCollaboration,\n    stopCollaboration,\n    collaborators,\n    currentUserId,\n    isRoomOwner,\n    maxCollaborators,\n    kickCollaborator,\n    passwordRequiredRoom,\n    setPasswordRequiredRoom,\n    waitingForApproval,\n    pendingRequests,\n    approveJoin,\n    rejectJoin,\n    submitRoomPassword,\n  } = useCollab();\n  const [showCollabModal, setShowCollabModal] = React.useState(false);\n  const [collabPasswordInput, setCollabPasswordInput] = React.useState(\"\");\n  const [joinPasswordInput, setJoinPasswordInput] = React.useState(\"\");\n  const [pendingCollabRoomId, setPendingCollabRoomId] = React.useState<string | null>(null);\n\n  // Load from link dialog states\n  const [showLoadFromLinkDialog, setShowLoadFromLinkDialog] = React.useState(false);\n  const pendingShareDataRef = React.useRef<{\n    elements: any[];\n    appState: any;\n    files?: Record<string, any>;\n  } | null>(null);\n  const isHandlingShareRef = React.useRef(false);\n  const lastHandledHashRef = React.useRef<string | null>(null);\n\n  // Bind drawing collab sync via Socket.IO\n  const { broadcastDrawingChanges, broadcastPointer } = useDrawingSync(jsonDrawAPIRef);\n\n  // Auto-save to localStorage and emit drawing updates\n  const handleChange = React.useCallback(\n    (elements: any, appState: any, files?: Record<string, any>) => {\n      hasUserDrawing.current = true;\n\n      // Emit changes across WS\n      broadcastDrawingChanges(elements);\n\n      try {\n        const sceneFiles = files ?? jsonDrawAPIRef.current?.getFiles?.() ?? null;\n        localStorage.setItem(\n          \"jsondraw-autosave\",\n          JSON.stringify({\n            elements,\n            files: sceneFiles,\n            appState: { theme: appState.theme, zoom: appState.zoom },\n          })\n        );\n      } catch (error) {\n        console.warn(\"Failed to save to localStorage:\", error);\n      }\n    },\n    [broadcastDrawingChanges]\n  );\n\n  // Set font asset path before loading JsonDraw\n  React.useEffect(() => {\n    if (typeof window !== \"undefined\") {\n      window.JSONDRAW_ASSET_PATH = \"/\";\n    }\n  }, []);\n\n  // Dynamic import to avoid SSR issues (Canvas API is client-only)\n  React.useEffect(() => {\n    import(\"../../../../jsondraw\").then(mod => {\n      setJsonDrawModule({ JsonDraw: mod.JsonDraw });\n      setDrawReady(false);\n    });\n\n    // Auto-join collab room if URL has it\n    if (typeof window !== \"undefined\") {\n      const hashParams = new URLSearchParams(window.location.hash.replace(/^#/, \"\"));\n      const rId = hashParams.get(\"collabRoomId\");\n      if (rId && !activeRoomId) {\n        let hasContent = false;\n        const saved = localStorage.getItem(\"jsondraw-autosave\");\n        if (saved) {\n          try {\n            const parsed = JSON.parse(saved);\n            if (Array.isArray(parsed.elements) && parsed.elements.length > 0) {\n              hasContent = true;\n            }\n          } catch (e) {\n            hasContent = true;\n          }\n        }\n\n        if (hasContent) {\n          setPendingCollabRoomId(rId);\n        } else {\n          startCollaboration(rId, undefined, { asOwner: false });\n        }\n      }\n    }\n  }, []);\n\n  const scrollToContent = React.useCallback((api: any, delay = 120) => {\n    requestAnimationFrame(() => {\n      setTimeout(() => {\n        api.scrollToContent(undefined, { fitToViewport: true, viewportZoomFactor: 0.8 });\n        setDrawReady(true);\n      }, delay);\n    });\n  }, []);\n\n  // Apply shared data to the scene (called after user confirms or if canvas is empty)\n  const applySharedData = React.useCallback(\n    (data: { elements: any[]; appState: any; files?: Record<string, any> }) => {\n      const api = jsonDrawAPIRef.current;\n      if (!api) return;\n\n      hasUserDrawing.current = true;\n      hasInitialized.current = true;\n      setDrawReady(false);\n\n      const restoredElements = restoreElements(data.elements, null);\n      const restoredAppState = {\n        ...restoreAppState(data.appState, api.getAppState()),\n        isLoading: false,\n      };\n\n      requestAnimationFrame(() => {\n        if (data.files && Object.keys(data.files).length > 0) {\n          api.addFiles(data.files);\n        }\n        api.updateScene({\n          elements: restoredElements,\n          appState: restoredAppState,\n        });\n        scrollToContent(api, 120);\n      });\n\n      // Clean up the URL hash without reloading\n      window.history.replaceState({}, \"\", window.location.pathname);\n    },\n    [scrollToContent]\n  );\n\n  // Handle replace action from LoadFromLinkDialog\n  const handleReplaceContent = React.useCallback(() => {\n    const data = pendingShareDataRef.current;\n    if (!data) return;\n\n    applySharedData(data);\n    pendingShareDataRef.current = null;\n    setShowLoadFromLinkDialog(false);\n    toast.success(\"Drawing loaded from shared link!\");\n  }, [applySharedData]);\n\n  // Handle save to disk\n  const handleSaveToDisk = React.useCallback(async () => {\n    const api = jsonDrawAPIRef.current;\n    if (!api) return;\n\n    try {\n      const elements = api.getSceneElementsIncludingDeleted();\n      const appState = api.getAppState();\n      const files = api.getFiles();\n      const name = api.getName?.() || appState.name;\n      await saveAsJSON(elements, appState, files, name);\n      toast.success(\"Drawing saved to disk!\");\n    } catch (error) {\n      toast.error(\"Failed to save drawing.\");\n    }\n  }, []);\n\n  // Helper: Initialize from localStorage or JSON data\n  const initFromLocalOrJson = React.useCallback(\n    (api: any) => {\n      // Try to restore from localStorage first\n      const saved = localStorage.getItem(\"jsondraw-autosave\");\n      if (saved) {\n        try {\n          const { elements, appState, files } = JSON.parse(saved);\n          const restoredElements = restoreElements(elements, null);\n          const restoredAppState = {\n            ...restoreAppState(appState, api.getAppState()),\n            isLoading: false,\n          };\n          hasUserDrawing.current = true;\n          setDrawReady(false);\n          requestAnimationFrame(() => {\n            if (files && Object.keys(files).length > 0) {\n              api.addFiles(files);\n            }\n            api.updateScene({\n              elements: restoredElements,\n              appState: restoredAppState,\n            });\n            scrollToContent(api, 120);\n          });\n          return;\n        } catch (error) {\n          console.warn(\"Failed to restore from localStorage:\", error);\n        }\n      }\n\n      // Set initial elements from JSON only if no saved drawing\n      if (nodes.length > 0 && !hasInitialized.current) {\n        hasInitialized.current = true;\n        const elements = restoreElements(jsonToJsonDrawElements(nodes, edges) as any, null);\n        setDrawReady(false);\n\n        requestAnimationFrame(() => {\n          api.updateScene({ elements, appState: { isLoading: false } });\n          scrollToContent(api, 200);\n        });\n      }\n    },\n    [nodes, edges, scrollToContent]\n  );\n\n  const hasExistingContent = React.useCallback(() => {\n    const saved = localStorage.getItem(\"jsondraw-autosave\");\n    if (saved) {\n      try {\n        const parsed = JSON.parse(saved);\n        if (Array.isArray(parsed.elements) && parsed.elements.length > 0) {\n          return true;\n        }\n      } catch (error) {\n        console.warn(\"Failed to parse autosave data:\", error);\n        return true;\n      }\n    }\n\n    const api = jsonDrawAPIRef.current;\n    if (!api) return false;\n    const elements = api.getSceneElementsIncludingDeleted();\n    return Array.isArray(elements) && elements.length > 0;\n  }, []);\n\n  const handleShareLinkFromHash = React.useCallback(\n    async (hash: string) => {\n      if (typeof window === \"undefined\") return false;\n      if (!hash) return false;\n      if (!isBackendShareLink(hash) && !hash.startsWith(\"#data=\")) return false;\n\n      const api = jsonDrawAPIRef.current;\n      if (!api) return false;\n\n      if (hash === lastHandledHashRef.current || isHandlingShareRef.current) return true;\n\n      lastHandledHashRef.current = hash;\n      isHandlingShareRef.current = true;\n      setDrawReady(false);\n\n      try {\n        if (isBackendShareLink(hash)) {\n          const data = await loadFromShareLink(hash);\n          if (!data || !data.elements) {\n            toast.error(\"Could not load shared drawing. The link may be invalid or expired.\");\n            initFromLocalOrJson(api);\n            return true;\n          }\n\n          if (hasExistingContent()) {\n            pendingShareDataRef.current = data;\n            setShowLoadFromLinkDialog(true);\n            initFromLocalOrJson(api);\n          } else {\n            applySharedData(data);\n          }\n          return true;\n        }\n\n        const decoded = decodeDataFromUrlHash(hash);\n        if (decoded && decoded.elements) {\n          if (hasExistingContent()) {\n            pendingShareDataRef.current = decoded;\n            setShowLoadFromLinkDialog(true);\n            initFromLocalOrJson(api);\n          } else {\n            applySharedData(decoded);\n          }\n          return true;\n        }\n\n        initFromLocalOrJson(api);\n        return true;\n      } catch (error) {\n        console.error(\"Failed to load share link:\", error);\n        toast.error(\"Failed to load shared drawing.\");\n        initFromLocalOrJson(api);\n        return true;\n      } finally {\n        isHandlingShareRef.current = false;\n      }\n    },\n    [applySharedData, hasExistingContent, initFromLocalOrJson]\n  );\n\n  // Update scene elements when nodes/edges change AFTER API is ready\n  // BUT only if user hasn't drawn anything yet\n  React.useEffect(() => {\n    const api = jsonDrawAPIRef.current;\n    if (!api || nodes.length === 0 || hasUserDrawing.current) return;\n\n    const elements = jsonToJsonDrawElements(nodes, edges);\n    api.updateScene({ elements });\n    scrollToContent(api, 80);\n  }, [nodes, edges, scrollToContent]);\n\n  const handleJsonDrawAPI = React.useCallback(\n    (api: any) => {\n      jsonDrawAPIRef.current = api;\n\n      if (typeof window === \"undefined\") return;\n\n      const hash = window.location.hash;\n\n      handleShareLinkFromHash(hash).then(handled => {\n        if (!handled) {\n          initFromLocalOrJson(api);\n        }\n      });\n    },\n    [handleShareLinkFromHash, initFromLocalOrJson]\n  );\n\n  React.useEffect(() => {\n    if (typeof window === \"undefined\") return;\n\n    const handleHashChange = () => {\n      const hash = window.location.hash;\n      handleShareLinkFromHash(hash);\n    };\n\n    window.addEventListener(\"hashchange\", handleHashChange);\n    return () => window.removeEventListener(\"hashchange\", handleHashChange);\n  }, [handleShareLinkFromHash]);\n\n  const prevPendingRequestsLength = React.useRef(pendingRequests?.length || 0);\n  React.useEffect(() => {\n    if (pendingRequests && pendingRequests.length > prevPendingRequestsLength.current) {\n      const latestReq = pendingRequests[pendingRequests.length - 1];\n      toast(`${latestReq.username} wants to join the room!`, { icon: \"\" });\n    }\n    prevPendingRequestsLength.current = pendingRequests?.length || 0;\n  }, [pendingRequests]);\n\n  const handleClearDrawing = React.useCallback(() => {\n    if (!jsonDrawAPIRef.current) return;\n\n    localStorage.removeItem(\"jsondraw-autosave\");\n    hasUserDrawing.current = false;\n    hasInitialized.current = false;\n\n    const elements = jsonToJsonDrawElements(nodes, edges);\n    jsonDrawAPIRef.current.updateScene({ elements });\n    setDrawReady(false);\n    scrollToContent(jsonDrawAPIRef.current, 120);\n\n    setShowClearModal(false);\n    toast.success(\"Drawing cleared! Loaded JSON visualization.\");\n  }, [nodes, edges, scrollToContent]);\n\n  const handleCopyLink = React.useCallback(() => {\n    navigator.clipboard\n      .writeText(shareUrl)\n      .then(() => {\n        setJustCopied(true);\n        if (copyTimerRef.current) window.clearTimeout(copyTimerRef.current);\n        copyTimerRef.current = window.setTimeout(() => setJustCopied(false), 3000) as any;\n      })\n      .catch(() => toast.error(\"Failed to copy link.\"));\n  }, [shareUrl]);\n\n  const handleShareClick = React.useCallback(async () => {\n    const api = jsonDrawAPIRef.current;\n    if (!api) return;\n\n    setIsSharing(true);\n    try {\n      const elements = api.getSceneElementsIncludingDeleted();\n      const appState = api.getAppState();\n      const files = api.getFiles();\n\n      const url = await createShareLink(elements, appState, files);\n      setShareUrl(url);\n      setShowShareModal(true);\n    } catch (error: any) {\n      console.error(\"Share failed:\", error);\n      toast.error(\"Failed to create share link. Please try again.\");\n    } finally {\n      setIsSharing(false);\n    }\n  }, []);\n\n  const handleStartLiveCollab = React.useCallback(() => {\n    if (!activeRoomId) {\n      // Create new session if none is active\n      const genId = Math.random().toString(36).substring(2, 10);\n      startCollaboration(genId, collabPasswordInput, { asOwner: true });\n    }\n  }, [activeRoomId, collabPasswordInput, startCollaboration]);\n\n  const handleJoinWithPassword = React.useCallback(() => {\n    if (passwordRequiredRoom) {\n      submitRoomPassword(joinPasswordInput);\n      setPasswordRequiredRoom(null);\n      setJoinPasswordInput(\"\");\n    }\n  }, [passwordRequiredRoom, joinPasswordInput, submitRoomPassword, setPasswordRequiredRoom]);\n\n  const handleCancelJoin = React.useCallback(() => {\n    setPasswordRequiredRoom(null);\n    setJoinPasswordInput(\"\");\n    if (typeof window !== \"undefined\") {\n      window.location.hash = \"\";\n    }\n  }, [setPasswordRequiredRoom]);\n\n  const handleCancelWait = React.useCallback(() => {\n    stopCollaboration();\n    if (typeof window !== \"undefined\") {\n      window.location.hash = \"\";\n    }\n  }, [stopCollaboration]);\n\n  const getCollabShareUrl = () => {\n    if (typeof window !== \"undefined\" && activeRoomId) {\n      const url = new URL(window.location.href);\n      url.search = \"\"; // clear query params\n      const hashParams = new URLSearchParams();\n      hashParams.set(\"collabRoomId\", activeRoomId);\n      url.hash = hashParams.toString();\n      return url.toString();\n    }\n    return \"\";\n  };\n\n  if (!JsonDrawModule) {\n    return (\n      <Box pos=\"relative\" h=\"100%\" w=\"100%\">\n        <Box pos=\"absolute\" inset={0} style={{ display: \"grid\", placeItems: \"center\" }}>\n          <HamsterLoader />\n        </Box>\n      </Box>\n    );\n  }\n\n  const { JsonDraw } = JsonDrawModule;\n\n  return (\n    <Box pos=\"relative\" h=\"100%\" w=\"100%\">\n      {!drawReady && (\n        <Box pos=\"absolute\" inset={0} style={{ display: \"grid\", placeItems: \"center\" }}>\n          <HamsterLoader />\n        </Box>\n      )}\n\n      {/* Clear Drawing Modal */}\n      <Modal\n        opened={showClearModal}\n        onClose={() => setShowClearModal(false)}\n        title=\"Clear Drawing Session\"\n        centered\n      >\n        <Stack gap=\"md\">\n          <Text>\n            This will <strong>permanently delete</strong> your current drawing session and load a\n            fresh visualization from the JSON data.\n          </Text>\n          <Text c=\"dimmed\" size=\"sm\">\n            Make sure to save your work first. Your current drawing will be lost and cannot be\n            recovered.\n          </Text>\n          <Box style={{ display: \"flex\", gap: \"8px\", justifyContent: \"flex-end\" }}>\n            <Button variant=\"default\" onClick={() => setShowClearModal(false)}>\n              Cancel\n            </Button>\n            <Button color=\"red\" onClick={handleClearDrawing}>\n              Clear & Load JSON\n            </Button>\n          </Box>\n        </Stack>\n      </Modal>\n\n      {/* Share Link Modal */}\n      <Modal\n        opened={showShareModal}\n        onClose={() => setShowShareModal(false)}\n        title={null}\n        withCloseButton={false}\n        centered\n        size=\"md\"\n        padding=\"xl\"\n        radius=\"lg\"\n        styles={{\n          content: {\n            backgroundColor: darkmodeEnabled ? \"#121212\" : \"#ffffff\",\n          },\n        }}\n      >\n        <Stack gap=\"lg\">\n          <Box style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\" }}>\n            <Text fw={700} size=\"xl\" style={{ fontFamily: \"Assistant, sans-serif\" }}>\n              Shareable link\n            </Text>\n            <ActionIcon variant=\"subtle\" color=\"gray\" onClick={() => setShowShareModal(false)}>\n              <FiX size={20} />\n            </ActionIcon>\n          </Box>\n          <Box style={{ display: \"flex\", gap: \"12px\", alignItems: \"flex-end\" }}>\n            <TextInput\n              label=\"Link\"\n              readOnly\n              value={shareUrl}\n              style={{ flex: 1 }}\n              styles={{\n                input: {\n                  backgroundColor: darkmodeEnabled ? \"rgba(255,255,255,0.05)\" : \"#f3f4f6\",\n                  border: \"none\",\n                  boxShadow: \"none\",\n                  height: 40,\n                },\n                label: {\n                  marginBottom: 8,\n                  fontSize: 12,\n                  fontWeight: 600,\n                  color: darkmodeEnabled ? \"#a3a3a3\" : \"#4b5563\",\n                },\n              }}\n              onClick={e => (e.target as HTMLInputElement).select()}\n            />\n            <Button\n              size=\"md\"\n              leftSection={justCopied ? <FiCheck size={18} /> : <FiCopy size={18} />}\n              color={justCopied ? \"teal\" : \"violet\"}\n              onClick={handleCopyLink}\n              style={{\n                height: 40,\n                minWidth: 120,\n                transition: \"background-color 0.2s\",\n              }}\n            >\n              Copy link\n            </Button>\n          </Box>\n          <Box\n            style={{\n              borderTop: `1px solid ${darkmodeEnabled ? \"#333\" : \"#e5e7eb\"}`,\n              paddingTop: 16,\n            }}\n          >\n            <Text\n              size=\"sm\"\n              c=\"dimmed\"\n              style={{ display: \"flex\", alignItems: \"center\", gap: \"8px\" }}\n            >\n              <FiLock size={16} /> Data is end-to-end encrypted. Only people with the link can view.\n            </Text>\n          </Box>\n        </Stack>\n      </Modal>\n\n      {/* Waiting for Approval Modal */}\n      <Modal\n        opened={waitingForApproval}\n        onClose={handleCancelWait}\n        withCloseButton={false}\n        centered\n        size=\"sm\"\n        radius=\"lg\"\n        padding=\"xl\"\n        styles={{\n          content: {\n            backgroundColor: darkmodeEnabled ? \"#121212\" : \"#ffffff\",\n          },\n        }}\n      >\n        <Stack gap=\"md\" align=\"center\">\n          <Text fw={700} size=\"lg\" style={{ fontFamily: \"Assistant, sans-serif\" }}>\n            Waiting for Approval\n          </Text>\n          <HamsterLoader />\n          <Text size=\"sm\" c=\"dimmed\" ta=\"center\">\n            Please wait while the room owner approves your request to join...\n          </Text>\n          <Button variant=\"default\" onClick={handleCancelWait} fullWidth mt=\"sm\">\n            Cancel\n          </Button>\n        </Stack>\n      </Modal>\n\n      {/* Password Required Modal */}\n      <Modal\n        opened={!!passwordRequiredRoom}\n        onClose={handleCancelJoin}\n        title={\n          <Text fw={700} size=\"xl\" style={{ fontFamily: \"Assistant, sans-serif\" }}>\n            Room Password Required\n          </Text>\n        }\n        centered\n        size=\"md\"\n        radius=\"lg\"\n        padding=\"xl\"\n        styles={{\n          content: {\n            backgroundColor: darkmodeEnabled ? \"#121212\" : \"#ffffff\",\n          },\n        }}\n      >\n        <Stack gap=\"md\">\n          <Text size=\"sm\" c=\"dimmed\">\n            This live collaboration room is protected by a password. Please enter the password to\n            join.\n          </Text>\n\n          <PasswordInput\n            label=\"Password\"\n            placeholder=\"Enter room password\"\n            value={joinPasswordInput}\n            onChange={e => setJoinPasswordInput(e.currentTarget.value)}\n            leftSection={<FiKey size={14} />}\n            styles={{\n              input: {\n                backgroundColor: darkmodeEnabled ? \"rgba(255,255,255,0.05)\" : \"#f3f4f6\",\n                border: \"none\",\n              },\n            }}\n            data-autofocus\n            onKeyDown={e => {\n              if (e.key === \"Enter\") {\n                handleJoinWithPassword();\n              }\n            }}\n          />\n\n          <Box style={{ display: \"flex\", gap: \"8px\", justifyContent: \"flex-end\", marginTop: 10 }}>\n            <Button variant=\"default\" onClick={handleCancelJoin}>\n              Cancel\n            </Button>\n            <Button color=\"blue\" onClick={handleJoinWithPassword}>\n              Join Room\n            </Button>\n          </Box>\n        </Stack>\n      </Modal>\n\n      {/* Collab Overwrite Warning Modal */}\n      <LoadFromLinkDialog\n        opened={!!pendingCollabRoomId}\n        darkMode={darkmodeEnabled}\n        title=\"Join Collaborative Room\"\n        message={\n          <>\n            Joining this room will <strong>permanently replace your existing content</strong> with\n            the room&apos;s content. You can back up your drawing first by using the option below.\n          </>\n        }\n        onReplace={() => {\n          if (pendingCollabRoomId) {\n            startCollaboration(pendingCollabRoomId, undefined, { asOwner: false });\n            setPendingCollabRoomId(null);\n          }\n        }}\n        onClose={() => setPendingCollabRoomId(null)}\n        onSaveToDisk={handleSaveToDisk}\n      />\n\n      {/* Live Collab Modal */}\n      <Modal\n        opened={showCollabModal}\n        onClose={() => setShowCollabModal(false)}\n        title={\n          <Text fw={700} size=\"xl\" style={{ fontFamily: \"Assistant, sans-serif\" }}>\n            Live Collaboration\n          </Text>\n        }\n        centered\n        size=\"md\"\n        radius=\"lg\"\n        padding=\"xl\"\n        styles={{\n          content: {\n            backgroundColor: darkmodeEnabled ? \"#121212\" : \"#ffffff\",\n          },\n        }}\n      >\n        <Stack gap=\"md\">\n          {isCollaborating && activeRoomId ? (\n            <>\n              <Text size=\"sm\" c=\"dimmed\">\n                You are live. Anyone with this link can join and draw in real-time.\n              </Text>\n\n              <Group\n                gap=\"apart\"\n                style={{\n                  background: darkmodeEnabled ? \"rgba(255,255,255,0.05)\" : \"#f8f9fa\",\n                  padding: \"10px\",\n                  borderRadius: \"8px\",\n                }}\n              >\n                <Box>\n                  <Text size=\"sm\" fw={600}>\n                    Room ID: {activeRoomId}\n                  </Text>\n                  <Badge color=\"green\" variant=\"light\" size=\"sm\">\n                    Online ({collaborators.length}/{maxCollaborators} users)\n                  </Badge>\n                </Box>\n                <Button\n                  color=\"red\"\n                  variant=\"subtle\"\n                  size=\"xs\"\n                  leftSection={<FiLogOut />}\n                  onClick={stopCollaboration}\n                >\n                  Stop Session\n                </Button>\n              </Group>\n\n              <Box style={{ display: \"flex\", gap: \"12px\", alignItems: \"flex-end\", marginTop: 10 }}>\n                <TextInput\n                  label=\"Collab Link\"\n                  readOnly\n                  value={getCollabShareUrl()}\n                  style={{ flex: 1 }}\n                  styles={{\n                    input: {\n                      backgroundColor: darkmodeEnabled ? \"rgba(255,255,255,0.05)\" : \"#f3f4f6\",\n                      border: \"none\",\n                    },\n                  }}\n                  onClick={e => (e.target as HTMLInputElement).select()}\n                />\n                <Button\n                  leftSection={justCopied ? <FiCheck size={18} /> : <FiCopy size={18} />}\n                  color={justCopied ? \"teal\" : \"blue\"}\n                  onClick={() => {\n                    navigator.clipboard.writeText(getCollabShareUrl());\n                    setJustCopied(true);\n                    if (copyTimerRef.current) window.clearTimeout(copyTimerRef.current);\n                    copyTimerRef.current = window.setTimeout(\n                      () => setJustCopied(false),\n                      3000\n                    ) as any;\n                  }}\n                >\n                  Copy\n                </Button>\n              </Box>\n\n              {pendingRequests && pendingRequests.length > 0 && (\n                <Box\n                  style={{\n                    marginTop: 12,\n                    borderRadius: 8,\n                    padding: 10,\n                    background: darkmodeEnabled ? \"rgba(255,165,0,0.1)\" : \"#fff5e6\",\n                    border: `1px solid ${darkmodeEnabled ? \"rgba(255,165,0,0.3)\" : \"#ffe0b2\"}`,\n                  }}\n                >\n                  <Text size=\"xs\" c=\"orange\" fw={600} mb={8}>\n                    Pending Requests ({pendingRequests.length})\n                  </Text>\n                  <Stack gap={6}>\n                    {pendingRequests.map(req => (\n                      <Group key={req.userId} justify=\"space-between\" wrap=\"nowrap\">\n                        <Group gap={8}>\n                          <Box\n                            w={10}\n                            h={10}\n                            style={{ borderRadius: \"50%\", background: req.color || \"#ccc\" }}\n                          />\n                          <Text size=\"sm\" fw={500} truncate>\n                            {req.username}\n                          </Text>\n                        </Group>\n                        <Group gap={4}>\n                          <Button\n                            size=\"compact-xs\"\n                            color=\"teal\"\n                            onClick={() => approveJoin(req.userId)}\n                          >\n                            Approve\n                          </Button>\n                          <Button\n                            size=\"compact-xs\"\n                            color=\"red\"\n                            variant=\"subtle\"\n                            onClick={() => rejectJoin(req.userId)}\n                          >\n                            Reject\n                          </Button>\n                        </Group>\n                      </Group>\n                    ))}\n                  </Stack>\n                </Box>\n              )}\n\n              <Box\n                style={{\n                  marginTop: 12,\n                  borderRadius: 8,\n                  padding: 10,\n                  background: darkmodeEnabled ? \"rgba(255,255,255,0.04)\" : \"#f8f9fa\",\n                }}\n              >\n                <Text size=\"xs\" c=\"dimmed\" mb={8}>\n                  Participants\n                </Text>\n                <Stack gap={6}>\n                  {collaborators.map(user => {\n                    const isMe = user.id === currentUserId;\n\n                    return (\n                      <Group key={user.id} justify=\"space-between\" wrap=\"nowrap\">\n                        <Text size=\"sm\" fw={500} truncate>\n                          {user.username || user.id}\n                          {isMe ? \" (You)\" : \"\"}\n                          {user.isOwner ? \" (Owner)\" : \"\"}\n                        </Text>\n\n                        {isRoomOwner && !isMe ? (\n                          <ActionIcon\n                            color=\"red\"\n                            variant=\"light\"\n                            aria-label=\"Kick user\"\n                            onClick={() => kickCollaborator(user.id)}\n                          >\n                            <FiUserX size={14} />\n                          </ActionIcon>\n                        ) : null}\n                      </Group>\n                    );\n                  })}\n                </Stack>\n              </Box>\n            </>\n          ) : (\n            <>\n              <Text size=\"sm\" c=\"dimmed\">\n                Create a real-time multiplayer room to draw with others. You can optionally set a\n                password.\n              </Text>\n\n              <PasswordInput\n                label=\"Room Password (Optional)\"\n                placeholder=\"Leave blank for public room\"\n                value={collabPasswordInput}\n                onChange={e => setCollabPasswordInput(e.currentTarget.value)}\n                leftSection={<FiKey size={14} />}\n                styles={{\n                  input: {\n                    backgroundColor: darkmodeEnabled ? \"rgba(255,255,255,0.05)\" : \"#f3f4f6\",\n                    border: \"none\",\n                  },\n                }}\n              />\n\n              <Button\n                size=\"md\"\n                color=\"blue\"\n                leftSection={<FiPlay size={16} />}\n                onClick={handleStartLiveCollab}\n                style={{ marginTop: 10 }}\n              >\n                Start Session\n              </Button>\n            </>\n          )}\n        </Stack>\n      </Modal>\n\n      {/* Load from Link Confirmation Dialog */}\n      <LoadFromLinkDialog\n        opened={showLoadFromLinkDialog}\n        darkMode={darkmodeEnabled}\n        onReplace={handleReplaceContent}\n        onClose={() => {\n          setShowLoadFromLinkDialog(false);\n          pendingShareDataRef.current = null;\n          // Clean URL\n          window.history.replaceState({}, \"\", window.location.pathname);\n        }}\n        onSaveToDisk={handleSaveToDisk}\n      />\n\n      <StyledJsonDrawWrapper $ready={drawReady}>\n        <div className=\"jsondraw-wrapper\">\n          <JsonDraw\n            jsondrawAPI={handleJsonDrawAPI}\n            onChange={handleChange}\n            onPointerUpdate={(payload: {\n              pointer: { x: number; y: number; tool: string };\n              button: string;\n            }) => {\n              if (payload.pointer) {\n                broadcastPointer(payload);\n              }\n            }}\n            viewModeEnabled={false}\n            zenModeEnabled={false}\n            gridModeEnabled={false}\n            theme={darkmodeEnabled ? \"dark\" : \"light\"}\n            UIOptions={{\n              canvasActions: {\n                export: { saveFileToDisk: true },\n                clearDrawing: () => setShowClearModal(true),\n              },\n            }}\n            initialData={{\n              appState: {\n                activeTool: {\n                  type: \"hand\",\n                  customType: null,\n                  lastActiveTool: null,\n                  locked: false,\n                  fromSelection: false,\n                },\n              },\n            }}\n            renderTopRightUI={(isMobile: boolean) => (\n              <Box px=\"md\">\n                <Menu shadow=\"md\" width={200} position=\"bottom-end\">\n                  <Menu.Target>\n                    <Button\n                      size=\"sm\"\n                      color={isCollaborating ? \"green\" : \"violet\"}\n                      loading={isSharing}\n                      leftSection={isCollaborating ? <FiUsers size={16} /> : <FiShare2 size={16} />}\n                      title=\"Share canvas\"\n                    >\n                      {isCollaborating ? \"Live\" : \"Share\"}\n                    </Button>\n                  </Menu.Target>\n\n                  <Menu.Dropdown>\n                    <Menu.Label>Export Options</Menu.Label>\n                    <Menu.Item leftSection={<FiCopy size={14} />} onClick={handleShareClick}>\n                      Share Link (Snapshot)\n                    </Menu.Item>\n\n                    <Menu.Divider />\n\n                    <Menu.Label>Realtime</Menu.Label>\n                    <Menu.Item\n                      color={isCollaborating ? \"green\" : \"blue\"}\n                      leftSection={isCollaborating ? <FiUsers size={14} /> : <FiPlay size={14} />}\n                      onClick={() => setShowCollabModal(true)}\n                    >\n                      {isCollaborating ? \"Manage Collab Session\" : \"Start Live Collab\"}\n                    </Menu.Item>\n                  </Menu.Dropdown>\n                </Menu>\n              </Box>\n            )}\n          />\n        </div>\n      </StyledJsonDrawWrapper>\n    </Box>\n  );\n};\n","import React from \"react\";\nimport type { DefaultTheme } from \"styled-components\";\nimport { styled } from \"styled-components\";\nimport type { KeyPath } from \"react-json-tree\";\n\ninterface LabelProps {\n  keyPath: KeyPath;\n  nodeType: string;\n}\n\nfunction getLabelColor({ $type, theme }: { $type?: string; theme: DefaultTheme }) {\n  if ($type === \"Object\") return theme.NODE_COLORS.PARENT_OBJ;\n  if ($type === \"Array\") return theme.NODE_COLORS.PARENT_ARR;\n  return theme.NODE_COLORS.PARENT_OBJ;\n}\n\nconst StyledLabel = styled.span<{ $nodeType?: string }>`\n  color: ${({ theme, $nodeType }) => getLabelColor({ theme, $type: $nodeType })};\n\n  &:hover {\n    filter: brightness(1.5);\n    transition: filter 0.2s ease-in-out;\n  }\n`;\n\nexport const Label = ({ keyPath, nodeType }: LabelProps) => {\n  return <StyledLabel $nodeType={nodeType}>{keyPath[0]}:</StyledLabel>;\n};\n","import React from \"react\";\nimport type { DefaultTheme } from \"styled-components\";\nimport { useTheme } from \"styled-components\";\nimport { TextRenderer } from \"../GraphView/CustomNode/TextRenderer\";\n\ntype TextColorFn = {\n  theme: DefaultTheme;\n  $value?: string | unknown;\n};\n\nfunction getValueColor({ $value, theme }: TextColorFn) {\n  if ($value && !Number.isNaN(+$value)) return theme.NODE_COLORS.INTEGER;\n  if ($value === \"true\") return theme.NODE_COLORS.BOOL.TRUE;\n  if ($value === \"false\") return theme.NODE_COLORS.BOOL.FALSE;\n  if ($value === \"null\") return theme.NODE_COLORS.NULL;\n\n  // default\n  return theme.NODE_COLORS.NODE_VALUE;\n}\n\ninterface ValueProps {\n  valueAsString: unknown;\n  value: unknown;\n}\n\nexport const Value = (props: ValueProps) => {\n  const theme = useTheme();\n  const { valueAsString, value } = props;\n\n  return (\n    <span\n      style={{\n        color: getValueColor({\n          theme,\n          $value: valueAsString,\n        }),\n      }}\n    >\n      <TextRenderer>{JSON.stringify(value)}</TextRenderer>\n    </span>\n  );\n};\n","import React from \"react\";\nimport { useTheme } from \"styled-components\";\nimport { JSONTree } from \"react-json-tree\";\nimport useJson from \"../../../../store/useJson\";\nimport { Label } from \"./Label\";\nimport { Value } from \"./Value\";\n\nexport const TreeView = () => {\n  const theme = useTheme();\n  const json = useJson(state => state.json);\n\n  return (\n    <JSONTree\n      hideRoot\n      data={JSON.parse(json)}\n      valueRenderer={(valueAsString, value) => <Value {...{ valueAsString, value }} />}\n      labelRenderer={(keyPath, nodeType) => <Label {...{ keyPath, nodeType }} />}\n      theme={{\n        extend: {\n          overflow: \"scroll\",\n          height: \"100%\",\n          scheme: \"monokai\",\n          author: \"wimer hazenberg (http://www.monokai.nl)\",\n          base00: theme.GRID_BG_COLOR,\n        },\n      }}\n    />\n  );\n};\n","import React from \"react\";\nimport { useSessionStorage } from \"@mantine/hooks\";\nimport styled from \"styled-components\";\nimport { ViewMode } from \"../../constants/enumData\";\nimport { GraphView } from \"./views/GraphView\";\nimport { JsonDrawView } from \"./views/JsonDrawView\";\nimport { TreeView } from \"./views/TreeView\";\n\nconst StyledLiveEditor = styled.div`\n  position: relative;\n  height: 100%;\n  background: ${({ theme }) => theme.GRID_BG_COLOR};\n  overflow: auto;\n  cursor: url(\"/assets/cursor.svg\"), auto;\n\n  & > ul {\n    margin-top: 0 !important;\n    padding: 12px !important;\n    font-family: monospace;\n    font-size: 14px;\n    font-weight: 500;\n  }\n\n  .tab-group {\n    position: absolute;\n    top: 10px;\n    left: 10px;\n    z-index: 2;\n  }\n`;\n\nconst View = () => {\n  const [viewMode] = useSessionStorage({\n    key: \"viewMode\",\n    defaultValue: ViewMode.Graph,\n  });\n\n  if (viewMode === ViewMode.Graph) return <GraphView />;\n  if (viewMode === ViewMode.Tree) return <TreeView />;\n  if (viewMode === ViewMode.JsonDraw) return <JsonDrawView />;\n  return null;\n};\n\nconst LiveEditor = () => {\n  return (\n    <StyledLiveEditor onContextMenuCapture={e => e.preventDefault()}>\n      <View />\n    </StyledLiveEditor>\n  );\n};\n\nexport default LiveEditor;\n"],"names":["WarningBanner","styled","div","$dark","IconWrapper","ActionCard","WarningText","LoadFromLinkDialog","opened","darkMode","onReplace","onClose","onSaveToDisk","title","message","Modal","withCloseButton","centered","size","padding","radius","styles","content","backgroundColor","overlay","Stack","gap","Text","fw","style","fontFamily","fontSize","color","FiAlertTriangle","strong","Button","onClick","flexShrink","h4","p","variant","fullWidth","leftSection","FiDownload","root","maxWidth","borderColor","randomSeed","Math","floor","random","randomNonce","formatNodeText","node","text","length","map","row","key","undefined","type","childrenCount","value","join","jsonToJsonDrawElements","nodes","edges","elements","positions","layoutNodes","Map","children","hasParent","Set","edge","ch","get","from","push","to","set","add","roots","filter","n","has","id","nodeMap","layers","visited","queue","layer","nextQueue","childId","orphans","currentX","currentY","nodeId","x","y","height","JSONDRAW_VERTICAL_GAP","max","width","JSONDRAW_HORIZONTAL_GAP","now","Date","indexCounter","getNextIndex","toString","padStart","rectIds","pos","rectId","textId","JSONDRAW_NODE_PADDING","textRows","JSONDRAW_ROW_HEIGHT","boundElements","rect","angle","strokeColor","fillStyle","strokeWidth","roughness","opacity","groupIds","roundness","seed","version","versionNonce","isDeleted","index","updated","link","locked","frameId","textEl","JSONDRAW_FONT_SIZE","FONT_FAMILY","Excalifont","textAlign","verticalAlign","containerId","originalText","autoResize","lineHeight","fromRectId","toRectId","fromPos","toPos","fromNode","find","toNode","fromWidth","fromHeight","toHeight","startX","startY","endX","endY","arrow","abs","points","startBinding","elementId","focus","fixedPoint","endBinding","startArrowhead","endArrowhead","elbowed","dbConfig","apiKey","process","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","_db","getDb","app","getApps","initializeApp","getDatabase","binary","i","bytes","chunkSize","String","fromCharCode","apply","Array","slice","btoa","base64ToUint8","atob","base64","Uint8Array","charCodeAt","generateEncryptionKey","crypto","subtle","generateKey","name","uint8ToBase64","exportKey","replace","keyStr","raw","importKey","buffer","encryptData","data","iv","getRandomValues","encrypted","encrypt","result","byteLength","decryptData","ciphertext","decrypted","decrypt","exportToBackend","compressedData","array","encryptionKey","base64Data","dbRef","ref","createdAt","snapshot","exists","console","error","val","createShareLink","appState","files","nonDeletedElements","el","jsonString","JSON","stringify","pickUsedFiles","fileIds","fileId","usedFiles","Object","keys","viewBackgroundColor","theme","compressed","pako","TextEncoder","encode","hash","window","location","origin","pathname","match","importFromBackend","parse","$ready","JsonDrawView","useGraph","state","darkmodeEnabled","useConfig","JsonDrawModule","setJsonDrawModule","React","drawReady","setDrawReady","jsonDrawAPIRef","hasInitialized","hasUserDrawing","showClearModal","setShowClearModal","showShareModal","setShowShareModal","shareUrl","setShareUrl","justCopied","setJustCopied","isSharing","setIsSharing","copyTimerRef","isCollaborating","roomId","activeRoomId","startCollaboration","stopCollaboration","collaborators","currentUserId","isRoomOwner","maxCollaborators","kickCollaborator","passwordRequiredRoom","setPasswordRequiredRoom","waitingForApproval","pendingRequests","approveJoin","rejectJoin","submitRoomPassword","useCollab","showCollabModal","setShowCollabModal","collabPasswordInput","setCollabPasswordInput","joinPasswordInput","setJoinPasswordInput","pendingCollabRoomId","setPendingCollabRoomId","showLoadFromLinkDialog","setShowLoadFromLinkDialog","pendingShareDataRef","isHandlingShareRef","lastHandledHashRef","broadcastDrawingChanges","broadcastPointer","useDrawingSync","apiRef","collab","socket","p2pRoom","_p2pRoom","canSync","collabType","getCollabType","lastBroadcastedVersion","useRef","remoteCollaboratorsRef","hasReceivedInitialSync","sendDrawRef","sendPointerRef","useEffect","current","newMap","forEach","user","CollabType","P2P","existing","pointer","button","username","background","stroke","socketId","updateScene","Socket","handleClientDraw","api","localElements","getSceneElementsIncludingDeleted","getAppState","finalElements","restoredRemoteElements","restoreElements","remoteElements","reconcileElements","getSceneVersion","commitToHistory","on","emit","off","sendDraw","getDraw","makeAction","handleDraw","handleClientPointer","peerId","pointerData","collabsMap","pointerPayload","sendPointer","getPointer","payload","handlePointer","handleNewUser","onPeerJoin","currentVersion","handleChange","sceneFiles","getFiles","localStorage","setItem","zoom","warn","JSONDRAW_ASSET_PATH","then","mod","JsonDraw","rId","URLSearchParams","hasContent","saved","getItem","parsed","isArray","e","asOwner","scrollToContent","delay","requestAnimationFrame","setTimeout","fitToViewport","viewportZoomFactor","applySharedData","restoredElements","restoredAppState","restoreAppState","isLoading","addFiles","history","replaceState","handleReplaceContent","toast","success","handleSaveToDisk","getName","saveAsJSON","initFromLocalOrJson","hasExistingContent","handleShareLinkFromHash","startsWith","isBackendShareLink","test","loadFromShareLink","decoded","decodeDataFromUrlHash","decodeURIComponent","binaryString","decompressed","handleJsonDrawAPI","handled","handleHashChange","addEventListener","removeEventListener","prevPendingRequestsLength","latestReq","icon","handleClearDrawing","removeItem","handleCopyLink","navigator","clipboard","writeText","clearTimeout","catch","handleShareClick","url","handleStartLiveCollab","genId","substring","handleJoinWithPassword","handleCancelJoin","handleCancelWait","getCollabShareUrl","URL","href","search","hashParams","Box","h","w","inset","display","placeItems","HamsterLoader","c","justifyContent","alignItems","ActionIcon","FiX","TextInput","label","readOnly","flex","input","border","boxShadow","marginBottom","fontWeight","target","select","FiCheck","FiCopy","minWidth","transition","borderTop","paddingTop","FiLock","align","ta","mt","PasswordInput","placeholder","onChange","currentTarget","FiKey","data-autofocus","onKeyDown","marginTop","Group","borderRadius","Badge","FiLogOut","mb","req","justify","wrap","truncate","userId","isMe","isOwner","aria-label","FiUserX","FiPlay","StyledJsonDrawWrapper","className","jsondrawAPI","onPointerUpdate","viewModeEnabled","zenModeEnabled","gridModeEnabled","UIOptions","canvasActions","export","saveFileToDisk","clearDrawing","initialData","activeTool","customType","lastActiveTool","fromSelection","renderTopRightUI","isMobile","px","Menu","shadow","position","Target","loading","FiUsers","FiShare2","Dropdown","Label","Item","Divider","StyledLabel","span","$nodeType","getLabelColor","$type","NODE_COLORS","PARENT_OBJ","PARENT_ARR","keyPath","nodeType","Value","props","useTheme","valueAsString","getValueColor","$value","Number","isNaN","INTEGER","BOOL","TRUE","FALSE","NULL","NODE_VALUE","TextRenderer","json","useJson","JSONTree","hideRoot","valueRenderer","labelRenderer","extend","overflow","scheme","author","base00","GRID_BG_COLOR","View","viewMode","useSessionStorage","defaultValue","ViewMode","Graph","GraphView","Tree","TreeView","StyledLiveEditor","onContextMenuCapture","LiveEditor","preventDefault"],"sourceRoot":"","ignoreList":[]}