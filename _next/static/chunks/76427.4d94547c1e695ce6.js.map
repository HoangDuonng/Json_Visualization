{"version":3,"file":"static/chunks/76427.4d94547c1e695ce6.js","mappings":"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","sources":["webpack://_N_E/./src/jsondraw/packages/math/vector.ts","webpack://_N_E/./src/jsondraw/packages/math/angle.ts","webpack://_N_E/./src/jsondraw/packages/math/constants.ts","webpack://_N_E/./src/jsondraw/packages/math/curve.ts","webpack://_N_E/./src/jsondraw/packages/math/polygon.ts","webpack://_N_E/./src/jsondraw/packages/math/range.ts","webpack://_N_E/./src/jsondraw/packages/math/rectangle.ts","webpack://_N_E/./src/jsondraw/packages/math/line.ts","webpack://_N_E/./src/jsondraw/packages/math/segment.ts","webpack://_N_E/./src/jsondraw/packages/math/triangle.ts","webpack://_N_E/./src/jsondraw/packages/math/index.ts","webpack://_N_E/./src/jsondraw/packages/math/utils.ts","webpack://_N_E/./src/jsondraw/packages/common/binary-heap.ts","webpack://_N_E/./src/jsondraw/packages/common/colors.ts","webpack://_N_E/./src/jsondraw/packages/common/constants.ts","webpack://_N_E/./src/jsondraw/packages/common/font-metadata.ts","webpack://_N_E/./src/jsondraw/packages/common/queue.ts","webpack://_N_E/./src/jsondraw/packages/common/editorInterface.ts","webpack://_N_E/./src/jsondraw/packages/common/keys.ts","webpack://_N_E/./src/jsondraw/packages/common/points.ts","webpack://_N_E/./src/jsondraw/packages/common/promise-pool.ts","webpack://_N_E/./src/jsondraw/packages/common/utils.ts","webpack://_N_E/./src/jsondraw/packages/common/random.ts","webpack://_N_E/./src/jsondraw/packages/common/url.ts","webpack://_N_E/./src/jsondraw/packages/common/emitter.ts","webpack://_N_E/./src/jsondraw/packages/common/index.ts","webpack://_N_E/./src/features/editor/views/JsonDrawView/jsonToJsonDraw.ts","webpack://_N_E/./src/features/editor/views/JsonDrawView/shareLinkUtils.ts","webpack://_N_E/./src/features/editor/views/JsonDrawView/index.tsx","webpack://_N_E/./src/features/editor/views/TreeView/Label.tsx","webpack://_N_E/./src/features/editor/views/TreeView/Value.tsx","webpack://_N_E/./src/features/editor/views/TreeView/index.tsx","webpack://_N_E/./src/features/editor/LiveEditor.tsx","webpack://_N_E/./src/jsondraw/packages/math/point.ts"],"sourcesContent":["import type { GlobalPoint, LocalPoint, Vector } from \"./types\";\n\n/**\n * Create a vector from the x and y coordiante elements.\n *\n * @param x The X aspect of the vector\n * @param y T Y aspect of the vector\n * @returns The constructed vector with X and Y as the coordinates\n */\nexport function vector(\n  x: number,\n  y: number,\n  originX: number = 0,\n  originY: number = 0,\n): Vector {\n  return [x - originX, y - originY] as Vector;\n}\n\n/**\n * Turn a point into a vector with the origin point.\n *\n * @param p The point to turn into a vector\n * @param origin The origin point in a given coordiante system\n * @param threshold The threshold to consider the vector as 'undefined'\n * @param defaultValue The default value to return if the vector is 'undefined'\n * @returns The created vector from the point and the origin or default\n */\nexport function vectorFromPoint<Point extends GlobalPoint | LocalPoint>(\n  p: Point,\n  origin: Point = [0, 0] as Point,\n  threshold?: number,\n  defaultValue: Vector = [0, 1] as Vector,\n): Vector {\n  const vec = vector(p[0] - origin[0], p[1] - origin[1]);\n\n  if (threshold && vectorMagnitudeSq(vec) < threshold * threshold) {\n    return defaultValue;\n  }\n\n  return vec;\n}\n\n/**\n * Cross product is a binary operation on two vectors in 2D space.\n * It results in a vector that is perpendicular to both vectors.\n *\n * @param a One of the vectors to use for the directed area calculation\n * @param b The other vector to use for the directed area calculation\n * @returns The directed area value for the two vectos\n */\nexport function vectorCross(a: Vector, b: Vector): number {\n  return a[0] * b[1] - b[0] * a[1];\n}\n\n/**\n * Dot product is defined as the sum of the products of the\n * two vectors.\n *\n * @param a One of the vectors for which the sum of products is calculated\n * @param b The other vector for which the sum of products is calculated\n * @returns The sum of products of the two vectors\n */\nexport function vectorDot(a: Vector, b: Vector) {\n  return a[0] * b[0] + a[1] * b[1];\n}\n\n/**\n * Determines if the value has the shape of a Vector.\n *\n * @param v The value to test\n * @returns TRUE if the value has the shape and components of a Vectors\n */\nexport function isVector(v: unknown): v is Vector {\n  return (\n    Array.isArray(v) &&\n    v.length === 2 &&\n    typeof v[0] === \"number\" &&\n    !isNaN(v[0]) &&\n    typeof v[1] === \"number\" &&\n    !isNaN(v[1])\n  );\n}\n\n/**\n * Add two vectors by adding their coordinates.\n *\n * @param a One of the vectors to add\n * @param b The other vector to add\n * @returns The sum vector of the two provided vectors\n */\nexport function vectorAdd(a: Readonly<Vector>, b: Readonly<Vector>): Vector {\n  return [a[0] + b[0], a[1] + b[1]] as Vector;\n}\n\n/**\n * Add two vectors by adding their coordinates.\n *\n * @param start One of the vectors to add\n * @param end The other vector to add\n * @returns The sum vector of the two provided vectors\n */\nexport function vectorSubtract(\n  start: Readonly<Vector>,\n  end: Readonly<Vector>,\n): Vector {\n  return [start[0] - end[0], start[1] - end[1]] as Vector;\n}\n\n/**\n * Scale vector by a scalar.\n *\n * @param v The vector to scale\n * @param scalar The scalar to multiply the vector components with\n * @returns The new scaled vector\n */\nexport function vectorScale(v: Vector, scalar: number): Vector {\n  return vector(v[0] * scalar, v[1] * scalar);\n}\n\n/**\n * Calculates the sqare magnitude of a vector. Use this if you compare\n * magnitudes as it saves you an SQRT.\n *\n * @param v The vector to measure\n * @returns The scalar squared magnitude of the vector\n */\nexport function vectorMagnitudeSq(v: Vector) {\n  return v[0] * v[0] + v[1] * v[1];\n}\n\n/**\n * Calculates the magnitude of a vector.\n *\n * @param v The vector to measure\n * @returns The scalar magnitude of the vector\n */\nexport function vectorMagnitude(v: Vector) {\n  return Math.sqrt(vectorMagnitudeSq(v));\n}\n\n/**\n * Normalize the vector (i.e. make the vector magnitue equal 1).\n *\n * @param v The vector to normalize\n * @returns The new normalized vector\n */\nexport const vectorNormalize = (v: Vector): Vector => {\n  const m = vectorMagnitude(v);\n\n  if (m === 0) {\n    return vector(0, 0);\n  }\n\n  return vector(v[0] / m, v[1] / m);\n};\n\n/**\n * Calculate the right-hand normal of the vector.\n */\nexport const vectorNormal = (v: Vector): Vector => vector(v[1], -v[0]);\n","import { PRECISION } from \"./utils\";\n\nimport type {\n  Degrees,\n  GlobalPoint,\n  LocalPoint,\n  PolarCoords,\n  Radians,\n} from \"./types\";\n\nexport const normalizeRadians = (angle: Radians): Radians =>\n  angle < 0\n    ? (((angle % (2 * Math.PI)) + 2 * Math.PI) as Radians)\n    : ((angle % (2 * Math.PI)) as Radians);\n\n/**\n * Return the polar coordinates for the given cartesian point represented by\n * (x, y) for the center point 0,0 where the first number returned is the radius,\n * the second is the angle in radians.\n */\nexport const cartesian2Polar = <P extends GlobalPoint | LocalPoint>([\n  x,\n  y,\n]: P): PolarCoords => [\n  Math.hypot(x, y),\n  normalizeRadians(Math.atan2(y, x) as Radians),\n];\n\nexport function degreesToRadians(degrees: Degrees): Radians {\n  return ((degrees * Math.PI) / 180) as Radians;\n}\n\nexport function radiansToDegrees(degrees: Radians): Degrees {\n  return ((degrees * 180) / Math.PI) as Degrees;\n}\n\n/**\n * Determines if the provided angle is a right angle.\n *\n * @param rads The angle to measure\n * @returns TRUE if the provided angle is a right angle\n */\nexport function isRightAngleRads(rads: Radians): boolean {\n  return Math.abs(Math.sin(2 * rads)) < PRECISION;\n}\n\nexport function radiansBetweenAngles(\n  a: Radians,\n  min: Radians,\n  max: Radians,\n): boolean {\n  a = normalizeRadians(a);\n  min = normalizeRadians(min);\n  max = normalizeRadians(max);\n\n  if (min < max) {\n    return a >= min && a <= max;\n  }\n\n  // The range wraps around the 0 angle\n  return a >= min || a <= max;\n}\n\nexport function radiansDifference(a: Radians, b: Radians): Radians {\n  a = normalizeRadians(a);\n  b = normalizeRadians(b);\n\n  let diff = a - b;\n\n  if (diff < -Math.PI) {\n    diff = (diff + 2 * Math.PI) as Radians;\n  } else if (diff > Math.PI) {\n    diff = (diff - 2 * Math.PI) as Radians;\n  }\n\n  return Math.abs(diff) as Radians;\n}\n","export const PRECISION = 10e-5;\n\n// Legendre-Gauss abscissae (x values) and weights for n=24\n// Refeerence: https://pomax.github.io/bezierinfo/legendre-gauss.html\nexport const LegendreGaussN24TValues = [\n  -0.0640568928626056260850430826247450385909,\n  0.0640568928626056260850430826247450385909,\n  -0.1911188674736163091586398207570696318404,\n  0.1911188674736163091586398207570696318404,\n  -0.3150426796961633743867932913198102407864,\n  0.3150426796961633743867932913198102407864,\n  -0.4337935076260451384870842319133497124524,\n  0.4337935076260451384870842319133497124524,\n  -0.5454214713888395356583756172183723700107,\n  0.5454214713888395356583756172183723700107,\n  -0.6480936519369755692524957869107476266696,\n  0.6480936519369755692524957869107476266696,\n  -0.7401241915785543642438281030999784255232,\n  0.7401241915785543642438281030999784255232,\n  -0.8200019859739029219539498726697452080761,\n  0.8200019859739029219539498726697452080761,\n  -0.8864155270044010342131543419821967550873,\n  0.8864155270044010342131543419821967550873,\n  -0.9382745520027327585236490017087214496548,\n  0.9382745520027327585236490017087214496548,\n  -0.9747285559713094981983919930081690617411,\n  0.9747285559713094981983919930081690617411,\n  -0.9951872199970213601799974097007368118745,\n  0.9951872199970213601799974097007368118745,\n];\n\nexport const LegendreGaussN24CValues = [\n  0.1279381953467521569740561652246953718517,\n  0.1279381953467521569740561652246953718517,\n  0.1258374563468282961213753825111836887264,\n  0.1258374563468282961213753825111836887264,\n  0.121670472927803391204463153476262425607,\n  0.121670472927803391204463153476262425607,\n  0.1155056680537256013533444839067835598622,\n  0.1155056680537256013533444839067835598622,\n  0.1074442701159656347825773424466062227946,\n  0.1074442701159656347825773424466062227946,\n  0.0976186521041138882698806644642471544279,\n  0.0976186521041138882698806644642471544279,\n  0.086190161531953275917185202983742667185,\n  0.086190161531953275917185202983742667185,\n  0.0733464814110803057340336152531165181193,\n  0.0733464814110803057340336152531165181193,\n  0.0592985849154367807463677585001085845412,\n  0.0592985849154367807463677585001085845412,\n  0.0442774388174198061686027482113382288593,\n  0.0442774388174198061686027482113382288593,\n  0.0285313886289336631813078159518782864491,\n  0.0285313886289336631813078159518782864491,\n  0.0123412297999871995468056670700372915759,\n  0.0123412297999871995468056670700372915759,\n];\n","import { isPoint, pointDistance, pointFrom, pointFromVector } from \"./point\";\nimport { vector, vectorNormal, vectorNormalize, vectorScale } from \"./vector\";\nimport { LegendreGaussN24CValues, LegendreGaussN24TValues } from \"./constants\";\n\nimport type { Curve, GlobalPoint, LineSegment, LocalPoint } from \"./types\";\n\n/**\n *\n * @param a\n * @param b\n * @param c\n * @param d\n * @returns\n */\nexport function curve<Point extends GlobalPoint | LocalPoint>(\n  a: Point,\n  b: Point,\n  c: Point,\n  d: Point,\n) {\n  return [a, b, c, d] as Curve<Point>;\n}\n\nfunction solveWithAnalyticalJacobian<Point extends GlobalPoint | LocalPoint>(\n  curve: Curve<Point>,\n  lineSegment: LineSegment<Point>,\n  t0: number,\n  s0: number,\n  tolerance: number = 1e-3,\n  iterLimit: number = 10,\n): number[] | null {\n  let error = Infinity;\n  let iter = 0;\n\n  while (error >= tolerance) {\n    if (iter >= iterLimit) {\n      return null;\n    }\n\n    // Compute bezier point at parameter t0\n    const bt = 1 - t0;\n    const bt2 = bt * bt;\n    const bt3 = bt2 * bt;\n    const t0_2 = t0 * t0;\n    const t0_3 = t0_2 * t0;\n\n    const bezierX =\n      bt3 * curve[0][0] +\n      3 * bt2 * t0 * curve[1][0] +\n      3 * bt * t0_2 * curve[2][0] +\n      t0_3 * curve[3][0];\n    const bezierY =\n      bt3 * curve[0][1] +\n      3 * bt2 * t0 * curve[1][1] +\n      3 * bt * t0_2 * curve[2][1] +\n      t0_3 * curve[3][1];\n\n    // Compute line point at parameter s0\n    const lineX =\n      lineSegment[0][0] + s0 * (lineSegment[1][0] - lineSegment[0][0]);\n    const lineY =\n      lineSegment[0][1] + s0 * (lineSegment[1][1] - lineSegment[0][1]);\n\n    // Function values\n    const fx = bezierX - lineX;\n    const fy = bezierY - lineY;\n\n    error = Math.abs(fx) + Math.abs(fy);\n\n    if (error < tolerance) {\n      break;\n    }\n\n    // Analytical derivatives\n    const dfx_dt =\n      -3 * bt2 * curve[0][0] +\n      3 * bt2 * curve[1][0] -\n      6 * bt * t0 * curve[1][0] -\n      3 * t0_2 * curve[2][0] +\n      6 * bt * t0 * curve[2][0] +\n      3 * t0_2 * curve[3][0];\n\n    const dfy_dt =\n      -3 * bt2 * curve[0][1] +\n      3 * bt2 * curve[1][1] -\n      6 * bt * t0 * curve[1][1] -\n      3 * t0_2 * curve[2][1] +\n      6 * bt * t0 * curve[2][1] +\n      3 * t0_2 * curve[3][1];\n\n    // Line derivatives\n    const dfx_ds = -(lineSegment[1][0] - lineSegment[0][0]);\n    const dfy_ds = -(lineSegment[1][1] - lineSegment[0][1]);\n\n    // Jacobian determinant\n    const det = dfx_dt * dfy_ds - dfx_ds * dfy_dt;\n\n    if (Math.abs(det) < 1e-12) {\n      return null;\n    }\n\n    // Newton step\n    const invDet = 1 / det;\n    const dt = invDet * (dfy_ds * -fx - dfx_ds * -fy);\n    const ds = invDet * (-dfy_dt * -fx + dfx_dt * -fy);\n\n    t0 += dt;\n    s0 += ds;\n    iter += 1;\n  }\n\n  return [t0, s0];\n}\n\nexport const bezierEquation = <Point extends GlobalPoint | LocalPoint>(\n  c: Curve<Point>,\n  t: number,\n) =>\n  pointFrom<Point>(\n    (1 - t) ** 3 * c[0][0] +\n      3 * (1 - t) ** 2 * t * c[1][0] +\n      3 * (1 - t) * t ** 2 * c[2][0] +\n      t ** 3 * c[3][0],\n    (1 - t) ** 3 * c[0][1] +\n      3 * (1 - t) ** 2 * t * c[1][1] +\n      3 * (1 - t) * t ** 2 * c[2][1] +\n      t ** 3 * c[3][1],\n  );\n\nconst initial_guesses: [number, number][] = [\n  [0.5, 0],\n  [0.2, 0],\n  [0.8, 0],\n];\n\nconst calculate = <Point extends GlobalPoint | LocalPoint>(\n  [t0, s0]: [number, number],\n  l: LineSegment<Point>,\n  c: Curve<Point>,\n) => {\n  const solution = solveWithAnalyticalJacobian(c, l, t0, s0, 1e-2, 4);\n\n  if (!solution) {\n    return null;\n  }\n\n  const [t, s] = solution;\n\n  if (t < 0 || t > 1 || s < 0 || s > 1) {\n    return null;\n  }\n\n  return bezierEquation(c, t);\n};\n\n/**\n * Computes the intersection between a cubic spline and a line segment.\n */\nexport function curveIntersectLineSegment<\n  Point extends GlobalPoint | LocalPoint,\n>(c: Curve<Point>, l: LineSegment<Point>): Point[] {\n  let solution = calculate(initial_guesses[0], l, c);\n  if (solution) {\n    return [solution];\n  }\n\n  solution = calculate(initial_guesses[1], l, c);\n  if (solution) {\n    return [solution];\n  }\n\n  solution = calculate(initial_guesses[2], l, c);\n  if (solution) {\n    return [solution];\n  }\n\n  return [];\n}\n\n/**\n * Finds the closest point on the Bezier curve from another point\n *\n * @param x\n * @param y\n * @param P0\n * @param P1\n * @param P2\n * @param P3\n * @param tolerance\n * @param maxLevel\n * @returns\n */\nexport function curveClosestPoint<Point extends GlobalPoint | LocalPoint>(\n  c: Curve<Point>,\n  p: Point,\n  tolerance: number = 1e-3,\n): Point | null {\n  const localMinimum = (\n    min: number,\n    max: number,\n    f: (t: number) => number,\n    e: number = tolerance,\n  ) => {\n    let m = min;\n    let n = max;\n    let k;\n\n    while (n - m > e) {\n      k = (n + m) / 2;\n      if (f(k - e) < f(k + e)) {\n        n = k;\n      } else {\n        m = k;\n      }\n    }\n\n    return k;\n  };\n\n  const maxSteps = 30;\n  let closestStep = 0;\n  for (let min = Infinity, step = 0; step < maxSteps; step++) {\n    const d = pointDistance(p, bezierEquation(c, step / maxSteps));\n    if (d < min) {\n      min = d;\n      closestStep = step;\n    }\n  }\n\n  const t0 = Math.max((closestStep - 1) / maxSteps, 0);\n  const t1 = Math.min((closestStep + 1) / maxSteps, 1);\n  const solution = localMinimum(t0, t1, (t) =>\n    pointDistance(p, bezierEquation(c, t)),\n  );\n\n  if (!solution) {\n    return null;\n  }\n\n  return bezierEquation(c, solution);\n}\n\n/**\n * Determines the distance between a point and the closest point on the\n * Bezier curve.\n *\n * @param c The curve to test\n * @param p The point to measure from\n */\nexport function curvePointDistance<Point extends GlobalPoint | LocalPoint>(\n  c: Curve<Point>,\n  p: Point,\n) {\n  const closest = curveClosestPoint(c, p);\n\n  if (!closest) {\n    return 0;\n  }\n\n  return pointDistance(p, closest);\n}\n\n/**\n * Determines if the parameter is a Curve\n */\nexport function isCurve<P extends GlobalPoint | LocalPoint>(\n  v: unknown,\n): v is Curve<P> {\n  return (\n    Array.isArray(v) &&\n    v.length === 4 &&\n    isPoint(v[0]) &&\n    isPoint(v[1]) &&\n    isPoint(v[2]) &&\n    isPoint(v[3])\n  );\n}\n\nexport function curveTangent<Point extends GlobalPoint | LocalPoint>(\n  [p0, p1, p2, p3]: Curve<Point>,\n  t: number,\n) {\n  return vector(\n    -3 * (1 - t) * (1 - t) * p0[0] +\n      3 * (1 - t) * (1 - t) * p1[0] -\n      6 * t * (1 - t) * p1[0] -\n      3 * t * t * p2[0] +\n      6 * t * (1 - t) * p2[0] +\n      3 * t * t * p3[0],\n    -3 * (1 - t) * (1 - t) * p0[1] +\n      3 * (1 - t) * (1 - t) * p1[1] -\n      6 * t * (1 - t) * p1[1] -\n      3 * t * t * p2[1] +\n      6 * t * (1 - t) * p2[1] +\n      3 * t * t * p3[1],\n  );\n}\n\nexport function curveCatmullRomQuadraticApproxPoints(\n  points: GlobalPoint[],\n  tension = 0.5,\n) {\n  if (points.length < 2) {\n    return;\n  }\n\n  const pointSets: [GlobalPoint, GlobalPoint][] = [];\n  for (let i = 0; i < points.length - 1; i++) {\n    const p0 = points[i - 1 < 0 ? 0 : i - 1];\n    const p1 = points[i];\n    const p2 = points[i + 1 >= points.length ? points.length - 1 : i + 1];\n    const cpX = p1[0] + ((p2[0] - p0[0]) * tension) / 2;\n    const cpY = p1[1] + ((p2[1] - p0[1]) * tension) / 2;\n\n    pointSets.push([\n      pointFrom<GlobalPoint>(cpX, cpY),\n      pointFrom<GlobalPoint>(p2[0], p2[1]),\n    ]);\n  }\n\n  return pointSets;\n}\n\nexport function curveCatmullRomCubicApproxPoints<\n  Point extends GlobalPoint | LocalPoint,\n>(points: Point[], tension = 0.5) {\n  if (points.length < 2) {\n    return;\n  }\n\n  const pointSets: Curve<Point>[] = [];\n  for (let i = 0; i < points.length - 1; i++) {\n    const p0 = points[i - 1 < 0 ? 0 : i - 1];\n    const p1 = points[i];\n    const p2 = points[i + 1 >= points.length ? points.length - 1 : i + 1];\n    const p3 = points[i + 2 >= points.length ? points.length - 1 : i + 2];\n    const tangent1 = [(p2[0] - p0[0]) * tension, (p2[1] - p0[1]) * tension];\n    const tangent2 = [(p3[0] - p1[0]) * tension, (p3[1] - p1[1]) * tension];\n    const cp1x = p1[0] + tangent1[0] / 3;\n    const cp1y = p1[1] + tangent1[1] / 3;\n    const cp2x = p2[0] - tangent2[0] / 3;\n    const cp2y = p2[1] - tangent2[1] / 3;\n\n    pointSets.push(\n      curve(\n        pointFrom(p1[0], p1[1]),\n        pointFrom(cp1x, cp1y),\n        pointFrom(cp2x, cp2y),\n        pointFrom(p2[0], p2[1]),\n      ),\n    );\n  }\n\n  return pointSets;\n}\n\nexport function curveOffsetPoints(\n  [p0, p1, p2, p3]: Curve<GlobalPoint>,\n  offset: number,\n  steps = 50,\n) {\n  const offsetPoints = [];\n\n  for (let i = 0; i <= steps; i++) {\n    const t = i / steps;\n    const c = curve(p0, p1, p2, p3);\n    const point = bezierEquation(c, t);\n    const tangent = vectorNormalize(curveTangent(c, t));\n    const normal = vectorNormal(tangent);\n\n    offsetPoints.push(pointFromVector(vectorScale(normal, offset), point));\n  }\n\n  return offsetPoints;\n}\n\nexport function offsetPointsForQuadraticBezier(\n  p0: GlobalPoint,\n  p1: GlobalPoint,\n  p2: GlobalPoint,\n  offsetDist: number,\n  steps = 50,\n) {\n  const offsetPoints = [];\n\n  for (let i = 0; i <= steps; i++) {\n    const t = i / steps;\n    const t1 = 1 - t;\n    const point = pointFrom<GlobalPoint>(\n      t1 * t1 * p0[0] + 2 * t1 * t * p1[0] + t * t * p2[0],\n      t1 * t1 * p0[1] + 2 * t1 * t * p1[1] + t * t * p2[1],\n    );\n    const tangentX = 2 * (1 - t) * (p1[0] - p0[0]) + 2 * t * (p2[0] - p1[0]);\n    const tangentY = 2 * (1 - t) * (p1[1] - p0[1]) + 2 * t * (p2[1] - p1[1]);\n    const tangent = vectorNormalize(vector(tangentX, tangentY));\n    const normal = vectorNormal(tangent);\n\n    offsetPoints.push(pointFromVector(vectorScale(normal, offsetDist), point));\n  }\n\n  return offsetPoints;\n}\n\n/**\n * Implementation based on Legendre-Gauss quadrature for more accurate arc\n * length calculation.\n *\n * Reference: https://pomax.github.io/bezierinfo/#arclength\n *\n * @param c The curve to calculate the length of\n * @returns The approximated length of the curve\n */\nexport function curveLength<P extends GlobalPoint | LocalPoint>(\n  c: Curve<P>,\n): number {\n  const z2 = 0.5;\n  let sum = 0;\n\n  for (let i = 0; i < 24; i++) {\n    const t = z2 * LegendreGaussN24TValues[i] + z2;\n    const derivativeVector = curveTangent(c, t);\n    const magnitude = Math.sqrt(\n      derivativeVector[0] * derivativeVector[0] +\n        derivativeVector[1] * derivativeVector[1],\n    );\n    sum += LegendreGaussN24CValues[i] * magnitude;\n  }\n\n  return z2 * sum;\n}\n\n/**\n * Calculates the curve length from t=0 to t=parameter using the same\n * Legendre-Gauss quadrature method used in curveLength\n *\n * @param c The curve to calculate the partial length for\n * @param t The parameter value (0 to 1) to calculate length up to\n * @returns The length of the curve from beginning to parameter t\n */\nexport function curveLengthAtParameter<P extends GlobalPoint | LocalPoint>(\n  c: Curve<P>,\n  t: number,\n): number {\n  if (t <= 0) {\n    return 0;\n  }\n  if (t >= 1) {\n    return curveLength(c);\n  }\n\n  // Scale and shift the integration interval from [0,t] to [-1,1]\n  // which is what the Legendre-Gauss quadrature expects\n  const z1 = t / 2;\n  const z2 = t / 2;\n\n  let sum = 0;\n\n  for (let i = 0; i < 24; i++) {\n    const parameter = z1 * LegendreGaussN24TValues[i] + z2;\n    const derivativeVector = curveTangent(c, parameter);\n    const magnitude = Math.sqrt(\n      derivativeVector[0] * derivativeVector[0] +\n        derivativeVector[1] * derivativeVector[1],\n    );\n    sum += LegendreGaussN24CValues[i] * magnitude;\n  }\n\n  return z1 * sum; // Scale the result back to the original interval\n}\n\n/**\n * Calculates the point at a specific percentage of a curve's total length\n * using binary search for improved efficiency and accuracy.\n *\n * @param c The curve to calculate point on\n * @param percent A value between 0 and 1 representing the percentage of the curve's length\n * @returns The point at the specified percentage of curve length\n */\nexport function curvePointAtLength<P extends GlobalPoint | LocalPoint>(\n  c: Curve<P>,\n  percent: number,\n): P {\n  if (percent <= 0) {\n    return bezierEquation(c, 0);\n  }\n\n  if (percent >= 1) {\n    return bezierEquation(c, 1);\n  }\n\n  const totalLength = curveLength(c);\n  const targetLength = totalLength * percent;\n\n  // Binary search to find parameter t where length at t equals target length\n  let tMin = 0;\n  let tMax = 1;\n  let t = percent; // Start with a reasonable guess (t = percent)\n  let currentLength = 0;\n\n  // Tolerance for length comparison and iteration limit to avoid infinite loops\n  const tolerance = totalLength * 0.0001;\n  const maxIterations = 20;\n\n  for (let iteration = 0; iteration < maxIterations; iteration++) {\n    currentLength = curveLengthAtParameter(c, t);\n    const error = Math.abs(currentLength - targetLength);\n\n    if (error < tolerance) {\n      break;\n    }\n\n    if (currentLength < targetLength) {\n      tMin = t;\n    } else {\n      tMax = t;\n    }\n\n    t = (tMin + tMax) / 2;\n  }\n\n  return bezierEquation(c, t);\n}\n","import { pointsEqual } from \"./point\";\nimport { lineSegment, pointOnLineSegment } from \"./segment\";\nimport { PRECISION } from \"./utils\";\n\nimport type { GlobalPoint, LocalPoint, Polygon } from \"./types\";\n\nexport function polygon<Point extends GlobalPoint | LocalPoint>(\n  ...points: Point[]\n) {\n  return polygonClose(points) as Polygon<Point>;\n}\n\nexport function polygonFromPoints<Point extends GlobalPoint | LocalPoint>(\n  points: Point[],\n) {\n  return polygonClose(points) as Polygon<Point>;\n}\n\nexport const polygonIncludesPoint = <Point extends LocalPoint | GlobalPoint>(\n  point: Point,\n  polygon: Polygon<Point>,\n) => {\n  const x = point[0];\n  const y = point[1];\n  let inside = false;\n\n  for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {\n    const xi = polygon[i][0];\n    const yi = polygon[i][1];\n    const xj = polygon[j][0];\n    const yj = polygon[j][1];\n\n    if (\n      ((yi > y && yj <= y) || (yi <= y && yj > y)) &&\n      x < ((xj - xi) * (y - yi)) / (yj - yi) + xi\n    ) {\n      inside = !inside;\n    }\n  }\n\n  return inside;\n};\n\nexport const polygonIncludesPointNonZero = <Point extends [number, number]>(\n  point: Point,\n  polygon: Point[],\n): boolean => {\n  const [x, y] = point;\n  let windingNumber = 0;\n\n  for (let i = 0; i < polygon.length; i++) {\n    const j = (i + 1) % polygon.length;\n    const [xi, yi] = polygon[i];\n    const [xj, yj] = polygon[j];\n\n    if (yi <= y) {\n      if (yj > y) {\n        if ((xj - xi) * (y - yi) - (x - xi) * (yj - yi) > 0) {\n          windingNumber++;\n        }\n      }\n    } else if (yj <= y) {\n      if ((xj - xi) * (y - yi) - (x - xi) * (yj - yi) < 0) {\n        windingNumber--;\n      }\n    }\n  }\n\n  return windingNumber !== 0;\n};\n\nexport const pointOnPolygon = <Point extends LocalPoint | GlobalPoint>(\n  p: Point,\n  poly: Polygon<Point>,\n  threshold = PRECISION,\n) => {\n  let on = false;\n\n  for (let i = 0, l = poly.length - 1; i < l; i++) {\n    if (pointOnLineSegment(p, lineSegment(poly[i], poly[i + 1]), threshold)) {\n      on = true;\n      break;\n    }\n  }\n\n  return on;\n};\n\nfunction polygonClose<Point extends LocalPoint | GlobalPoint>(\n  polygon: Point[],\n) {\n  return polygonIsClosed(polygon)\n    ? polygon\n    : ([...polygon, polygon[0]] as Polygon<Point>);\n}\n\nfunction polygonIsClosed<Point extends LocalPoint | GlobalPoint>(\n  polygon: Point[],\n) {\n  return pointsEqual(polygon[0], polygon[polygon.length - 1]);\n}\n","import { toBrandedType } from \"@jsondraw/common\";\n\nimport type { InclusiveRange } from \"./types\";\n\n/**\n * Create an inclusive range from the two numbers provided.\n *\n * @param start Start of the range\n * @param end End of the range\n * @returns\n */\nexport function rangeInclusive(start: number, end: number): InclusiveRange {\n  return toBrandedType<InclusiveRange>([start, end]);\n}\n\n/**\n * Turn a number pair into an inclusive range.\n *\n * @param pair The number pair to convert to an inclusive range\n * @returns The new inclusive range\n */\nexport function rangeInclusiveFromPair(pair: [start: number, end: number]) {\n  return toBrandedType<InclusiveRange>(pair);\n}\n\n/**\n * Given two ranges, return if the two ranges overlap with each other e.g.\n * [1, 3] overlaps with [2, 4] while [1, 3] does not overlap with [4, 5].\n *\n * @param param0 One of the ranges to compare\n * @param param1 The other range to compare against\n * @returns TRUE if the ranges overlap\n */\nexport const rangesOverlap = (\n  [a0, a1]: InclusiveRange,\n  [b0, b1]: InclusiveRange,\n): boolean => {\n  if (a0 <= b0) {\n    return a1 >= b0;\n  }\n\n  if (a0 >= b0) {\n    return b1 >= a0;\n  }\n\n  return false;\n};\n\n/**\n * Given two ranges,return ther intersection of the two ranges if any e.g. the\n * intersection of [1, 3] and [2, 4] is [2, 3].\n *\n * @param param0 The first range to compare\n * @param param1 The second range to compare\n * @returns The inclusive range intersection or NULL if no intersection\n */\nexport const rangeIntersection = (\n  [a0, a1]: InclusiveRange,\n  [b0, b1]: InclusiveRange,\n): InclusiveRange | null => {\n  const rangeStart = Math.max(a0, b0);\n  const rangeEnd = Math.min(a1, b1);\n\n  if (rangeStart <= rangeEnd) {\n    return toBrandedType<InclusiveRange>([rangeStart, rangeEnd]);\n  }\n\n  return null;\n};\n\n/**\n * Determine if a value is inside a range.\n *\n * @param value The value to check\n * @param range The range\n * @returns\n */\nexport const rangeIncludesValue = (\n  value: number,\n  [min, max]: InclusiveRange,\n): boolean => {\n  return value >= min && value <= max;\n};\n","import { pointFrom } from \"./point\";\nimport { lineSegment, lineSegmentIntersectionPoints } from \"./segment\";\n\nimport type { GlobalPoint, LineSegment, LocalPoint, Rectangle } from \"./types\";\n\nexport function rectangle<P extends GlobalPoint | LocalPoint>(\n  topLeft: P,\n  bottomRight: P,\n): Rectangle<P> {\n  return [topLeft, bottomRight] as Rectangle<P>;\n}\n\nexport function rectangleFromNumberSequence<\n  Point extends LocalPoint | GlobalPoint,\n>(minX: number, minY: number, maxX: number, maxY: number) {\n  return rectangle(pointFrom<Point>(minX, minY), pointFrom<Point>(maxX, maxY));\n}\n\nexport function rectangleIntersectLineSegment<\n  Point extends LocalPoint | GlobalPoint,\n>(r: Rectangle<Point>, l: LineSegment<Point>): Point[] {\n  return [\n    lineSegment(r[0], pointFrom(r[1][0], r[0][1])),\n    lineSegment(pointFrom(r[1][0], r[0][1]), r[1]),\n    lineSegment(r[1], pointFrom(r[0][0], r[1][1])),\n    lineSegment(pointFrom(r[0][0], r[1][1]), r[0]),\n  ]\n    .map((s) => lineSegmentIntersectionPoints(l, s))\n    .filter((i): i is Point => !!i);\n}\n\nexport function rectangleIntersectRectangle<\n  Point extends LocalPoint | GlobalPoint,\n>(rectangle1: Rectangle<Point>, rectangle2: Rectangle<Point>): boolean {\n  const [[minX1, minY1], [maxX1, maxY1]] = rectangle1;\n  const [[minX2, minY2], [maxX2, maxY2]] = rectangle2;\n\n  return minX1 < maxX2 && maxX1 > minX2 && minY1 < maxY2 && maxY1 > minY2;\n}\n","import { pointFrom } from \"./point\";\n\nimport type { GlobalPoint, Line, LocalPoint } from \"./types\";\n\n/**\n * Create a line from two points.\n *\n * @param points The two points lying on the line\n * @returns The line on which the points lie\n */\nexport function line<P extends GlobalPoint | LocalPoint>(a: P, b: P): Line<P> {\n  return [a, b] as Line<P>;\n}\n\n/**\n * Determines the intersection point (unless the lines are parallel) of two\n * lines\n *\n * @param a\n * @param b\n * @returns\n */\nexport function linesIntersectAt<Point extends GlobalPoint | LocalPoint>(\n  a: Line<Point>,\n  b: Line<Point>,\n): Point | null {\n  const A1 = a[1][1] - a[0][1];\n  const B1 = a[0][0] - a[1][0];\n  const A2 = b[1][1] - b[0][1];\n  const B2 = b[0][0] - b[1][0];\n  const D = A1 * B2 - A2 * B1;\n  if (D !== 0) {\n    const C1 = A1 * a[0][0] + B1 * a[0][1];\n    const C2 = A2 * b[0][0] + B2 * b[0][1];\n    return pointFrom<Point>((C1 * B2 - C2 * B1) / D, (A1 * C2 - A2 * C1) / D);\n  }\n\n  return null;\n}\n","import { line, linesIntersectAt } from \"./line\";\nimport {\n  isPoint,\n  pointCenter,\n  pointFromVector,\n  pointRotateRads,\n} from \"./point\";\nimport { PRECISION } from \"./utils\";\nimport {\n  vectorAdd,\n  vectorCross,\n  vectorFromPoint,\n  vectorScale,\n  vectorSubtract,\n} from \"./vector\";\n\nimport type { GlobalPoint, LineSegment, LocalPoint, Radians } from \"./types\";\n\n/**\n * Create a line segment from two points.\n *\n * @param points The two points delimiting the line segment on each end\n * @returns The line segment delineated by the points\n */\nexport function lineSegment<P extends GlobalPoint | LocalPoint>(\n  a: P,\n  b: P,\n): LineSegment<P> {\n  return [a, b] as LineSegment<P>;\n}\n\n/**\n *\n * @param segment\n * @returns\n */\nexport const isLineSegment = <Point extends GlobalPoint | LocalPoint>(\n  segment: unknown,\n): segment is LineSegment<Point> =>\n  Array.isArray(segment) &&\n  segment.length === 2 &&\n  isPoint(segment[0]) &&\n  isPoint(segment[0]);\n\n/**\n * Return the coordinates resulting from rotating the given line about an origin by an angle in radians\n * note that when the origin is not given, the midpoint of the given line is used as the origin.\n *\n * @param l\n * @param angle\n * @param origin\n * @returns\n */\nexport const lineSegmentRotate = <Point extends LocalPoint | GlobalPoint>(\n  l: LineSegment<Point>,\n  angle: Radians,\n  origin?: Point,\n): LineSegment<Point> => {\n  return lineSegment(\n    pointRotateRads(l[0], origin || pointCenter(l[0], l[1]), angle),\n    pointRotateRads(l[1], origin || pointCenter(l[0], l[1]), angle),\n  );\n};\n\n/**\n * Calculates the point two line segments with a definite start and end point\n * intersect at.\n */\nexport const segmentsIntersectAt = <Point extends GlobalPoint | LocalPoint>(\n  a: Readonly<LineSegment<Point>>,\n  b: Readonly<LineSegment<Point>>,\n): Point | null => {\n  const a0 = vectorFromPoint(a[0]);\n  const a1 = vectorFromPoint(a[1]);\n  const b0 = vectorFromPoint(b[0]);\n  const b1 = vectorFromPoint(b[1]);\n  const r = vectorSubtract(a1, a0);\n  const s = vectorSubtract(b1, b0);\n  const denominator = vectorCross(r, s);\n\n  if (denominator === 0) {\n    return null;\n  }\n\n  const i = vectorSubtract(vectorFromPoint(b[0]), vectorFromPoint(a[0]));\n  const u = vectorCross(i, r) / denominator;\n  const t = vectorCross(i, s) / denominator;\n\n  if (u === 0) {\n    return null;\n  }\n\n  const p = vectorAdd(a0, vectorScale(r, t));\n\n  if (t >= 0 && t < 1 && u >= 0 && u < 1) {\n    return pointFromVector<Point>(p);\n  }\n\n  return null;\n};\n\nexport const pointOnLineSegment = <Point extends LocalPoint | GlobalPoint>(\n  point: Point,\n  line: LineSegment<Point>,\n  threshold = PRECISION,\n) => {\n  const distance = distanceToLineSegment(point, line);\n\n  if (distance === 0) {\n    return true;\n  }\n\n  return distance < threshold;\n};\n\nexport const distanceToLineSegment = <Point extends LocalPoint | GlobalPoint>(\n  point: Point,\n  line: LineSegment<Point>,\n) => {\n  const [x, y] = point;\n  const [[x1, y1], [x2, y2]] = line;\n\n  const A = x - x1;\n  const B = y - y1;\n  const C = x2 - x1;\n  const D = y2 - y1;\n\n  const dot = A * C + B * D;\n  const len_sq = C * C + D * D;\n  let param = -1;\n  if (len_sq !== 0) {\n    param = dot / len_sq;\n  }\n\n  let xx;\n  let yy;\n\n  if (param < 0) {\n    xx = x1;\n    yy = y1;\n  } else if (param > 1) {\n    xx = x2;\n    yy = y2;\n  } else {\n    xx = x1 + param * C;\n    yy = y1 + param * D;\n  }\n\n  const dx = x - xx;\n  const dy = y - yy;\n  return Math.sqrt(dx * dx + dy * dy);\n};\n\n/**\n * Returns the intersection point of a segment and a line\n *\n * @param l\n * @param s\n * @returns\n */\nexport function lineSegmentIntersectionPoints<\n  Point extends GlobalPoint | LocalPoint,\n>(\n  l: LineSegment<Point>,\n  s: LineSegment<Point>,\n  threshold?: number,\n): Point | null {\n  const candidate = linesIntersectAt(line(l[0], l[1]), line(s[0], s[1]));\n\n  if (\n    !candidate ||\n    !pointOnLineSegment(candidate, s, threshold) ||\n    !pointOnLineSegment(candidate, l, threshold)\n  ) {\n    return null;\n  }\n\n  return candidate;\n}\n\nexport function lineSegmentsDistance<Point extends GlobalPoint | LocalPoint>(\n  s1: LineSegment<Point>,\n  s2: LineSegment<Point>,\n): number {\n  if (lineSegmentIntersectionPoints(s1, s2)) {\n    return 0;\n  }\n\n  return Math.min(\n    distanceToLineSegment(s1[0], s2),\n    distanceToLineSegment(s1[1], s2),\n    distanceToLineSegment(s2[0], s1),\n    distanceToLineSegment(s2[1], s1),\n  );\n}\n","import type { GlobalPoint, LocalPoint, Triangle } from \"./types\";\n\n// Types\n\n/**\n * Tests if a point lies inside a triangle. This function\n * will return FALSE if the point lies exactly on the sides\n * of the triangle.\n *\n * @param triangle The triangle to test the point for\n * @param p The point to test whether is in the triangle\n * @returns TRUE if the point is inside of the triangle\n */\nexport function triangleIncludesPoint<P extends GlobalPoint | LocalPoint>(\n  [a, b, c]: Triangle<P>,\n  p: P,\n): boolean {\n  const triangleSign = (p1: P, p2: P, p3: P) =>\n    (p1[0] - p3[0]) * (p2[1] - p3[1]) - (p2[0] - p3[0]) * (p1[1] - p3[1]);\n  const d1 = triangleSign(p, a, b);\n  const d2 = triangleSign(p, b, c);\n  const d3 = triangleSign(p, c, a);\n\n  const has_neg = d1 < 0 || d2 < 0 || d3 < 0;\n  const has_pos = d1 > 0 || d2 > 0 || d3 > 0;\n\n  return !(has_neg && has_pos);\n}\n","export * from \"./angle\";\nexport * from \"./curve\";\nexport * from \"./ellipse\";\nexport * from \"./line\";\nexport * from \"./point\";\nexport * from \"./polygon\";\nexport * from \"./range\";\nexport * from \"./rectangle\";\nexport * from \"./segment\";\nexport * from \"./triangle\";\nexport * from \"./types\";\nexport * from \"./vector\";\nexport * from \"./utils\";\n","export const PRECISION = 10e-5;\n\nexport const clamp = (value: number, min: number, max: number) => {\n  return Math.min(Math.max(value, min), max);\n};\n\nexport const round = (\n  value: number,\n  precision: number,\n  func: \"round\" | \"floor\" | \"ceil\" = \"round\",\n) => {\n  const multiplier = Math.pow(10, precision);\n\n  return Math[func]((value + Number.EPSILON) * multiplier) / multiplier;\n};\n\nexport const roundToStep = (\n  value: number,\n  step: number,\n  func: \"round\" | \"floor\" | \"ceil\" = \"round\",\n): number => {\n  const factor = 1 / step;\n  return Math[func](value * factor) / factor;\n};\n\nexport const average = (a: number, b: number) => (a + b) / 2;\n\nexport const isFiniteNumber = (value: any): value is number => {\n  return typeof value === \"number\" && Number.isFinite(value);\n};\n\nexport const isCloseTo = (a: number, b: number, precision = PRECISION) =>\n  Math.abs(a - b) < precision;\n","export class BinaryHeap<T> {\n  private content: T[] = [];\n\n  constructor(private scoreFunction: (node: T) => number) {}\n\n  sinkDown(idx: number) {\n    const node = this.content[idx];\n    const nodeScore = this.scoreFunction(node);\n    while (idx > 0) {\n      const parentN = ((idx + 1) >> 1) - 1;\n      const parent = this.content[parentN];\n      if (nodeScore < this.scoreFunction(parent)) {\n        this.content[idx] = parent;\n        idx = parentN; // TODO: Optimize\n      } else {\n        break;\n      }\n    }\n    this.content[idx] = node;\n  }\n\n  bubbleUp(idx: number) {\n    const length = this.content.length;\n    const node = this.content[idx];\n    const score = this.scoreFunction(node);\n\n    while (true) {\n      const child1N = ((idx + 1) << 1) - 1;\n      const child2N = child1N + 1;\n      let smallestIdx = idx;\n      let smallestScore = score;\n\n      // Check left child\n      if (child1N < length) {\n        const child1Score = this.scoreFunction(this.content[child1N]);\n        if (child1Score < smallestScore) {\n          smallestIdx = child1N;\n          smallestScore = child1Score;\n        }\n      }\n\n      // Check right child\n      if (child2N < length) {\n        const child2Score = this.scoreFunction(this.content[child2N]);\n        if (child2Score < smallestScore) {\n          smallestIdx = child2N;\n        }\n      }\n\n      if (smallestIdx === idx) {\n        break;\n      }\n\n      // Move the smaller child up, continue finding position for node\n      this.content[idx] = this.content[smallestIdx];\n      idx = smallestIdx;\n    }\n\n    // Place node in its final position\n    this.content[idx] = node;\n  }\n\n  push(node: T) {\n    this.content.push(node);\n    this.sinkDown(this.content.length - 1);\n  }\n\n  pop(): T | null {\n    if (this.content.length === 0) {\n      return null;\n    }\n\n    const result = this.content[0];\n    const end = this.content.pop()!;\n\n    if (this.content.length > 0) {\n      this.content[0] = end;\n      this.bubbleUp(0);\n    }\n\n    return result;\n  }\n\n  remove(node: T) {\n    if (this.content.length === 0) {\n      return;\n    }\n\n    const i = this.content.indexOf(node);\n    const end = this.content.pop()!;\n\n    if (i < this.content.length) {\n      this.content[i] = end;\n\n      if (this.scoreFunction(end) < this.scoreFunction(node)) {\n        this.sinkDown(i);\n      } else {\n        this.bubbleUp(i);\n      }\n    }\n  }\n\n  size(): number {\n    return this.content.length;\n  }\n\n  rescoreElement(node: T) {\n    this.sinkDown(this.content.indexOf(node));\n  }\n}\n","import tinycolor from \"tinycolor2\";\n\nimport { clamp } from \"@jsondraw/math\";\nimport { degreesToRadians } from \"@jsondraw/math\";\n\nimport type { Degrees } from \"@jsondraw/math\";\n\n// ---------------------------------------------------------------------------\n// Dark mode color transformation\n// ---------------------------------------------------------------------------\n\n// Browser-only cache to avoid memory leaks on server\nconst DARK_MODE_COLORS_CACHE: Map<string, string> | null =\n  typeof window !== \"undefined\" ? new Map() : null;\n\nfunction cssHueRotate(\n  red: number,\n  green: number,\n  blue: number,\n  degrees: Degrees,\n): { r: number; g: number; b: number } {\n  // normalize\n  const r = red / 255;\n  const g = green / 255;\n  const b = blue / 255;\n\n  // Convert degrees to radians\n  const a = degreesToRadians(degrees);\n\n  const c = Math.cos(a);\n  const s = Math.sin(a);\n\n  // rotation matrix\n  const matrix = [\n    0.213 + c * 0.787 - s * 0.213,\n    0.715 - c * 0.715 - s * 0.715,\n    0.072 - c * 0.072 + s * 0.928,\n    0.213 - c * 0.213 + s * 0.143,\n    0.715 + c * 0.285 + s * 0.14,\n    0.072 - c * 0.072 - s * 0.283,\n    0.213 - c * 0.213 - s * 0.787,\n    0.715 - c * 0.715 + s * 0.715,\n    0.072 + c * 0.928 + s * 0.072,\n  ];\n\n  // transform\n  const newR = r * matrix[0] + g * matrix[1] + b * matrix[2];\n  const newG = r * matrix[3] + g * matrix[4] + b * matrix[5];\n  const newB = r * matrix[6] + g * matrix[7] + b * matrix[8];\n\n  // clamp the values to [0, 1] range and convert back to [0, 255]\n  return {\n    r: Math.round(Math.max(0, Math.min(1, newR)) * 255),\n    g: Math.round(Math.max(0, Math.min(1, newG)) * 255),\n    b: Math.round(Math.max(0, Math.min(1, newB)) * 255),\n  };\n}\n\nconst cssInvert = (\n  r: number,\n  g: number,\n  b: number,\n  percent: number,\n): { r: number; g: number; b: number } => {\n  const p = clamp(percent, 0, 100) / 100;\n\n  // Function to invert a single color component\n  const invertComponent = (color: number): number => {\n    // Apply the invert formula\n    const inverted = color * (1 - p) + (255 - color) * p;\n    // Round to the nearest integer and clamp to [0, 255]\n    return Math.round(clamp(inverted, 0, 255));\n  };\n\n  // Calculate the inverted RGB components\n  const invertedR = invertComponent(r);\n  const invertedG = invertComponent(g);\n  const invertedB = invertComponent(b);\n\n  return { r: invertedR, g: invertedG, b: invertedB };\n};\n\nexport const applyDarkModeFilter = (color: string): string => {\n  const cached = DARK_MODE_COLORS_CACHE?.get(color);\n  if (cached) {\n    return cached;\n  }\n\n  const tc = tinycolor(color);\n  const alpha = tc.getAlpha();\n\n  // order of operations matters\n  // (corresponds to \"filter: invert(invertPercent) hue-rotate(hueDegrees)\" in css)\n  const rgb = tc.toRgb();\n  const inverted = cssInvert(rgb.r, rgb.g, rgb.b, 93);\n  const rotated = cssHueRotate(\n    inverted.r,\n    inverted.g,\n    inverted.b,\n    180 as Degrees,\n  );\n\n  const result = rgbToHex(rotated.r, rotated.g, rotated.b, alpha);\n\n  if (DARK_MODE_COLORS_CACHE) {\n    DARK_MODE_COLORS_CACHE.set(color, result);\n  }\n\n  return result;\n};\n\n// ---------------------------------------------------------------------------\n// Color palette\n// ---------------------------------------------------------------------------\n\n// FIXME can't put to utils.ts rn because of circular dependency\nconst pick = <R extends Record<string, any>, K extends readonly (keyof R)[]>(\n  source: R,\n  keys: K,\n) => {\n  return keys.reduce((acc, key: K[number]) => {\n    if (key in source) {\n      acc[key] = source[key];\n    }\n    return acc;\n  }, {} as Pick<R, K[number]>) as Pick<R, K[number]>;\n};\n\nexport type ColorTuple = readonly [string, string, string, string, string];\n\n// used general type instead of specific type (ColorPalette) to support custom colors\nexport type ColorPaletteCustom = { [key: string]: ColorTuple | string };\nexport type ColorShadesIndexes = [number, number, number, number, number];\n\nexport const MAX_CUSTOM_COLORS_USED_IN_CANVAS = 5;\nexport const COLORS_PER_ROW = 5;\n\nexport const DEFAULT_CHART_COLOR_INDEX = 4;\n\nexport const DEFAULT_ELEMENT_STROKE_COLOR_INDEX = 4;\nexport const DEFAULT_ELEMENT_BACKGROUND_COLOR_INDEX = 1;\n\nexport const COLOR_PALETTE = {\n  transparent: \"transparent\",\n  black: \"#1e1e1e\",\n  white: \"#ffffff\",\n  // open-color from https://github.com/yeun/open-color/blob/master/open-color.js\n  // corresponds to indexes [0,2,4,6,8] (weights: 50, 200, 400, 600, 800)\n  gray: [\"#f8f9fa\", \"#e9ecef\", \"#ced4da\", \"#868e96\", \"#343a40\"],\n  red: [\"#fff5f5\", \"#ffc9c9\", \"#ff8787\", \"#fa5252\", \"#e03131\"],\n  pink: [\"#fff0f6\", \"#fcc2d7\", \"#f783ac\", \"#e64980\", \"#c2255c\"],\n  grape: [\"#f8f0fc\", \"#eebefa\", \"#da77f2\", \"#be4bdb\", \"#9c36b5\"],\n  violet: [\"#f3f0ff\", \"#d0bfff\", \"#9775fa\", \"#7950f2\", \"#6741d9\"],\n  blue: [\"#e7f5ff\", \"#a5d8ff\", \"#4dabf7\", \"#228be6\", \"#1971c2\"],\n  cyan: [\"#e3fafc\", \"#99e9f2\", \"#3bc9db\", \"#15aabf\", \"#0c8599\"],\n  teal: [\"#e6fcf5\", \"#96f2d7\", \"#38d9a9\", \"#12b886\", \"#099268\"],\n  green: [\"#ebfbee\", \"#b2f2bb\", \"#69db7c\", \"#40c057\", \"#2f9e44\"],\n  yellow: [\"#fff9db\", \"#ffec99\", \"#ffd43b\", \"#fab005\", \"#f08c00\"],\n  orange: [\"#fff4e6\", \"#ffd8a8\", \"#ffa94d\", \"#fd7e14\", \"#e8590c\"],\n  // radix bronze shades [3,5,7,9,11]\n  bronze: [\"#f8f1ee\", \"#eaddd7\", \"#d2bab0\", \"#a18072\", \"#846358\"],\n} as const;\n\nexport type ColorPalette = typeof COLOR_PALETTE;\nexport type ColorPickerColor = keyof typeof COLOR_PALETTE;\n\nconst COMMON_ELEMENT_SHADES = pick(COLOR_PALETTE, [\n  \"cyan\",\n  \"blue\",\n  \"violet\",\n  \"grape\",\n  \"pink\",\n  \"green\",\n  \"teal\",\n  \"yellow\",\n  \"orange\",\n  \"red\",\n]);\n\n// quick picks defaults\n// -----------------------------------------------------------------------------\n\n// ORDER matters for positioning in quick picker\nexport const DEFAULT_ELEMENT_STROKE_PICKS = [\n  COLOR_PALETTE.black,\n  COLOR_PALETTE.red[DEFAULT_ELEMENT_STROKE_COLOR_INDEX],\n  COLOR_PALETTE.green[DEFAULT_ELEMENT_STROKE_COLOR_INDEX],\n  COLOR_PALETTE.blue[DEFAULT_ELEMENT_STROKE_COLOR_INDEX],\n  COLOR_PALETTE.yellow[DEFAULT_ELEMENT_STROKE_COLOR_INDEX],\n] as ColorTuple;\n\n// ORDER matters for positioning in quick picker\nexport const DEFAULT_ELEMENT_BACKGROUND_PICKS = [\n  COLOR_PALETTE.transparent,\n  COLOR_PALETTE.red[DEFAULT_ELEMENT_BACKGROUND_COLOR_INDEX],\n  COLOR_PALETTE.green[DEFAULT_ELEMENT_BACKGROUND_COLOR_INDEX],\n  COLOR_PALETTE.blue[DEFAULT_ELEMENT_BACKGROUND_COLOR_INDEX],\n  COLOR_PALETTE.yellow[DEFAULT_ELEMENT_BACKGROUND_COLOR_INDEX],\n] as ColorTuple;\n\n// ORDER matters for positioning in quick picker\nexport const DEFAULT_CANVAS_BACKGROUND_PICKS = [\n  COLOR_PALETTE.white,\n  // radix slate2\n  \"#f8f9fa\",\n  // radix blue2\n  \"#f5faff\",\n  // radix yellow2\n  \"#fffce8\",\n  // radix bronze2\n  \"#fdf8f6\",\n] as ColorTuple;\n\n// palette defaults\n// -----------------------------------------------------------------------------\n\nexport const DEFAULT_ELEMENT_STROKE_COLOR_PALETTE = {\n  // 1st row\n  transparent: COLOR_PALETTE.transparent,\n  white: COLOR_PALETTE.white,\n  gray: COLOR_PALETTE.gray,\n  black: COLOR_PALETTE.black,\n  bronze: COLOR_PALETTE.bronze,\n  // rest\n  ...COMMON_ELEMENT_SHADES,\n} as const;\n\n// ORDER matters for positioning in pallete (5x3 grid)s\nexport const DEFAULT_ELEMENT_BACKGROUND_COLOR_PALETTE = {\n  transparent: COLOR_PALETTE.transparent,\n  white: COLOR_PALETTE.white,\n  gray: COLOR_PALETTE.gray,\n  black: COLOR_PALETTE.black,\n  bronze: COLOR_PALETTE.bronze,\n\n  ...COMMON_ELEMENT_SHADES,\n} as const;\n\n// color palette helpers\n// -----------------------------------------------------------------------------\n\n// !!!MUST BE WITHOUT GRAY, TRANSPARENT AND BLACK!!!\nexport const getAllColorsSpecificShade = (index: 0 | 1 | 2 | 3 | 4) =>\n  [\n    // 2nd row\n    COLOR_PALETTE.cyan[index],\n    COLOR_PALETTE.blue[index],\n    COLOR_PALETTE.violet[index],\n    COLOR_PALETTE.grape[index],\n    COLOR_PALETTE.pink[index],\n\n    // 3rd row\n    COLOR_PALETTE.green[index],\n    COLOR_PALETTE.teal[index],\n    COLOR_PALETTE.yellow[index],\n    COLOR_PALETTE.orange[index],\n    COLOR_PALETTE.red[index],\n  ] as const;\n\n// -----------------------------------------------------------------------------\n// other helpers\n// -----------------------------------------------------------------------------\n\nexport const rgbToHex = (r: number, g: number, b: number, a?: number) => {\n  // (1 << 24) adds 0x1000000 to ensure the hex string is always 7 chars,\n  // then slice(1) removes the leading \"1\" to get exactly 6 hex digits\n  // e.g. rgb(0,0,0) -> 0x1000000 -> \"1000000\" -> \"000000\"\n  const hex6 = `#${((1 << 24) + (r << 16) + (g << 8) + b)\n    .toString(16)\n    .slice(1)}`;\n  if (a !== undefined && a < 1) {\n    // convert alpha from 0-1 float to 0-255 int, then to 2-digit hex\n    // e.g. 0.5 -> 128 -> \"80\"\n    const alphaHex = Math.round(a * 255)\n      .toString(16)\n      .padStart(2, \"0\");\n    return `${hex6}${alphaHex}`;\n  }\n  return hex6;\n};\n\n/**\n * @returns #RRGGBB or #RRGGBBAA based on color containing non-opaque alpha,\n *  null if not valid color\n */\nexport const colorToHex = (color: string): string | null => {\n  const tc = tinycolor(color);\n  if (!tc.isValid()) {\n    return null;\n  }\n  const { r, g, b, a } = tc.toRgb();\n  return rgbToHex(r, g, b, a);\n};\n\nexport const isTransparent = (color: string) => {\n  return tinycolor(color).getAlpha() === 0;\n};\n\n// -----------------------------------------------------------------------------\n// color contract helpers\n// -----------------------------------------------------------------------------\n\nexport const COLOR_OUTLINE_CONTRAST_THRESHOLD = 240;\n\nconst calculateContrast = (r: number, g: number, b: number): number => {\n  const yiq = (r * 299 + g * 587 + b * 114) / 1000;\n  return yiq;\n};\n\n// YIQ algo, inspiration from https://stackoverflow.com/a/11868398\nexport const isColorDark = (color: string, threshold = 160): boolean => {\n  // no color (\"\") -> assume it default to black\n  if (!color) {\n    return true;\n  }\n\n  if (isTransparent(color)) {\n    return false;\n  }\n\n  const tc = tinycolor(color);\n  if (!tc.isValid()) {\n    // invalid color -> assume it defaults to black\n    return true;\n  }\n\n  const { r, g, b } = tc.toRgb();\n  return calculateContrast(r, g, b) < threshold;\n};\n\n// -----------------------------------------------------------------------------\n// normalization\n// -----------------------------------------------------------------------------\n\n/**\n * tries to keep the input color as-is if it's valid, making minimal adjustments\n * (trimming whitespace or adding `#` to hex colors)\n */\nexport const normalizeInputColor = (color: string): string | null => {\n  color = color.trim();\n  if (isTransparent(color)) {\n    return color;\n  }\n\n  const tc = tinycolor(color);\n  if (tc.isValid()) {\n    // testing for `#` first fixes a bug on Electron (more specfically, an\n    // Obsidian popout window), where a hex color without `#` is considered valid\n    if (tc.getFormat() === \"hex\" && !color.startsWith(\"#\")) {\n      return `#${color}`;\n    }\n    return color;\n  }\n\n  return null;\n};\n","import type { JsonDrawElement, FontFamilyValues } from \"@jsondraw/element/types\";\nimport type { AppProps, AppState } from \"@jsondraw/jsondraw/types\";\nimport { COLOR_PALETTE } from \"./colors\";\n\nexport const supportsResizeObserver = typeof window !== \"undefined\" && \"ResizeObserver\" in window;\n\nexport const APP_NAME = \"JsonDraw\";\n\n// distance when creating text before it's considered `autoResize: false`\n// we're using higher threshold so that clicks that end up being drags\n// don't unintentionally create text elements that are wrapped to a few chars\n// (happens a lot with fast clicks with the text tool)\nexport const TEXT_AUTOWRAP_THRESHOLD = 36; // px\nexport const DRAGGING_THRESHOLD = 10; // px\nexport const MINIMUM_ARROW_SIZE = 20; // px\nexport const LINE_CONFIRM_THRESHOLD = 8; // px\nexport const ELEMENT_SHIFT_TRANSLATE_AMOUNT = 5;\nexport const ELEMENT_TRANSLATE_AMOUNT = 1;\nexport const TEXT_TO_CENTER_SNAP_THRESHOLD = 30;\nexport const SHIFT_LOCKING_ANGLE = Math.PI / 12;\nexport const DEFAULT_LASER_COLOR = \"red\";\nexport const CURSOR_TYPE = {\n  TEXT: \"text\",\n  CROSSHAIR: \"crosshair\",\n  GRABBING: \"grabbing\",\n  GRAB: \"grab\",\n  POINTER: \"pointer\",\n  MOVE: \"move\",\n  AUTO: \"\",\n};\nexport const POINTER_BUTTON = {\n  MAIN: 0,\n  WHEEL: 1,\n  SECONDARY: 2,\n  TOUCH: -1,\n  ERASER: 5,\n} as const;\n\nexport const POINTER_EVENTS = {\n  enabled: \"all\",\n  disabled: \"none\",\n  // asserted as any so it can be freely assigned to React Element\n  // \"pointerEnvets\" CSS prop\n  inheritFromUI: \"var(--ui-pointerEvents)\" as any,\n} as const;\n\nexport enum EVENT {\n  COPY = \"copy\",\n  PASTE = \"paste\",\n  CUT = \"cut\",\n  KEYDOWN = \"keydown\",\n  KEYUP = \"keyup\",\n  MOUSE_MOVE = \"mousemove\",\n  RESIZE = \"resize\",\n  UNLOAD = \"unload\",\n  FOCUS = \"focus\",\n  BLUR = \"blur\",\n  DRAG_OVER = \"dragover\",\n  DROP = \"drop\",\n  GESTURE_END = \"gestureend\",\n  BEFORE_UNLOAD = \"beforeunload\",\n  GESTURE_START = \"gesturestart\",\n  GESTURE_CHANGE = \"gesturechange\",\n  POINTER_MOVE = \"pointermove\",\n  POINTER_DOWN = \"pointerdown\",\n  POINTER_UP = \"pointerup\",\n  STATE_CHANGE = \"statechange\",\n  WHEEL = \"wheel\",\n  TOUCH_START = \"touchstart\",\n  TOUCH_END = \"touchend\",\n  HASHCHANGE = \"hashchange\",\n  VISIBILITY_CHANGE = \"visibilitychange\",\n  SCROLL = \"scroll\",\n  // custom events\n  JSONDRAW_LINK = \"jsondraw-link\",\n  MENU_ITEM_SELECT = \"menu.itemSelect\",\n  MESSAGE = \"message\",\n  FULLSCREENCHANGE = \"fullscreenchange\",\n}\n\nexport const YOUTUBE_STATES = {\n  UNSTARTED: -1,\n  ENDED: 0,\n  PLAYING: 1,\n  PAUSED: 2,\n  BUFFERING: 3,\n  CUED: 5,\n} as const;\n\nexport const ENV = {\n  TEST: \"test\",\n  DEVELOPMENT: \"development\",\n  PRODUCTION: \"production\",\n};\n\nexport const CLASSES = {\n  SIDEBAR: \"sidebar\",\n  SHAPE_ACTIONS_MENU: \"App-menu__left\",\n  ZOOM_ACTIONS: \"zoom-actions\",\n  SEARCH_MENU_INPUT_WRAPPER: \"layer-ui__search-inputWrapper\",\n  CONVERT_ELEMENT_TYPE_POPUP: \"ConvertElementTypePopup\",\n  SHAPE_ACTIONS_THEME_SCOPE: \"shape-actions-theme-scope\",\n  FRAME_NAME: \"frame-name\",\n  DROPDOWN_MENU_EVENT_WRAPPER: \"dropdown-menu-event-wrapper\",\n};\n\nexport const FONT_SIZES = {\n  sm: 16,\n  md: 20,\n  lg: 28,\n  xl: 36,\n} as const;\n\nexport const CJK_HAND_DRAWN_FALLBACK_FONT = \"Xiaolai\";\nexport const WINDOWS_EMOJI_FALLBACK_FONT = \"Segoe UI Emoji\";\n\n/**\n * // TODO: shouldn't be really `const`, likely neither have integers as values, due to value for the custom fonts, which should likely be some hash.\n *\n * Let's think this through and consider:\n * - https://developer.mozilla.org/en-US/docs/Web/CSS/generic-family\n * - https://drafts.csswg.org/css-fonts-4/#font-family-prop\n * - https://learn.microsoft.com/en-us/typography/opentype/spec/ibmfc\n */\nexport const FONT_FAMILY = {\n  Virgil: 1,\n  Helvetica: 2,\n  Cascadia: 3,\n  // leave 4 unused as it was historically used for Assistant (which we don't use anymore) or custom font (Obsidian)\n  Excalifont: 5,\n  Nunito: 6,\n  \"Lilita One\": 7,\n  \"Comic Shanns\": 8,\n  \"Liberation Sans\": 9,\n  Assistant: 10,\n};\n\n// Segoe UI Emoji fails to properly fallback for some glyphs: , , \n// so we need to have generic font fallback before it\nexport const SANS_SERIF_GENERIC_FONT = \"sans-serif\";\nexport const MONOSPACE_GENERIC_FONT = \"monospace\";\n\nexport const FONT_FAMILY_GENERIC_FALLBACKS = {\n  [SANS_SERIF_GENERIC_FONT]: 998,\n  [MONOSPACE_GENERIC_FONT]: 999,\n};\n\nexport const FONT_FAMILY_FALLBACKS = {\n  [CJK_HAND_DRAWN_FALLBACK_FONT]: 100,\n  ...FONT_FAMILY_GENERIC_FALLBACKS,\n  [WINDOWS_EMOJI_FALLBACK_FONT]: 1000,\n};\n\nexport function getGenericFontFamilyFallback(\n  fontFamily: number\n): keyof typeof FONT_FAMILY_GENERIC_FALLBACKS {\n  switch (fontFamily) {\n    case FONT_FAMILY.Cascadia:\n    case FONT_FAMILY[\"Comic Shanns\"]:\n      return MONOSPACE_GENERIC_FONT;\n\n    default:\n      return SANS_SERIF_GENERIC_FONT;\n  }\n}\n\nexport const getFontFamilyFallbacks = (\n  fontFamily: number\n): Array<keyof typeof FONT_FAMILY_FALLBACKS> => {\n  const genericFallbackFont = getGenericFontFamilyFallback(fontFamily);\n\n  switch (fontFamily) {\n    case FONT_FAMILY.Excalifont:\n      return [CJK_HAND_DRAWN_FALLBACK_FONT, genericFallbackFont, WINDOWS_EMOJI_FALLBACK_FONT];\n    default:\n      return [genericFallbackFont, WINDOWS_EMOJI_FALLBACK_FONT];\n  }\n};\n\nexport const THEME = {\n  LIGHT: \"light\",\n  DARK: \"dark\",\n} as const;\n\nexport const DARK_THEME_FILTER = \"invert(93%) hue-rotate(180deg)\";\n\nexport const FRAME_STYLE = {\n  strokeColor: \"#bbb\" as JsonDrawElement[\"strokeColor\"],\n  strokeWidth: 2 as JsonDrawElement[\"strokeWidth\"],\n  strokeStyle: \"solid\" as JsonDrawElement[\"strokeStyle\"],\n  fillStyle: \"solid\" as JsonDrawElement[\"fillStyle\"],\n  roughness: 0 as JsonDrawElement[\"roughness\"],\n  roundness: null as JsonDrawElement[\"roundness\"],\n  backgroundColor: \"transparent\" as JsonDrawElement[\"backgroundColor\"],\n  radius: 8,\n  nameOffsetY: 3,\n  nameColorLightTheme: \"#999999\",\n  nameColorDarkTheme: \"#7a7a7a\",\n  nameFontSize: 14,\n  nameLineHeight: 1.25,\n};\n\nexport const MIN_FONT_SIZE = 1;\nexport const DEFAULT_FONT_SIZE = 20;\nexport const DEFAULT_FONT_FAMILY: FontFamilyValues = FONT_FAMILY.Excalifont;\nexport const DEFAULT_TEXT_ALIGN = \"left\";\nexport const DEFAULT_VERTICAL_ALIGN = \"top\";\nexport const DEFAULT_VERSION = \"{version}\";\nexport const DEFAULT_TRANSFORM_HANDLE_SPACING = 2;\n\nexport const SIDE_RESIZING_THRESHOLD = 2 * DEFAULT_TRANSFORM_HANDLE_SPACING;\n// a small epsilon to make side resizing always take precedence\n// (avoids an increase in renders and changes to tests)\nexport const EPSILON = 0.00001;\nexport const DEFAULT_COLLISION_THRESHOLD = 2 * SIDE_RESIZING_THRESHOLD - EPSILON;\n\nexport const COLOR_WHITE = \"#ffffff\";\nexport const COLOR_CHARCOAL_BLACK = \"#1e1e1e\";\n// keep this in sync with CSS\nexport const COLOR_VOICE_CALL = \"#a2f1a6\";\n\nexport const CANVAS_ONLY_ACTIONS = [\"selectAll\"];\n\nexport const DEFAULT_GRID_SIZE = 20;\nexport const DEFAULT_GRID_STEP = 5;\n\nexport const IMAGE_MIME_TYPES = {\n  svg: \"image/svg+xml\",\n  png: \"image/png\",\n  jpg: \"image/jpeg\",\n  gif: \"image/gif\",\n  webp: \"image/webp\",\n  bmp: \"image/bmp\",\n  ico: \"image/x-icon\",\n  avif: \"image/avif\",\n  jfif: \"image/jfif\",\n} as const;\n\nexport const STRING_MIME_TYPES = {\n  text: \"text/plain\",\n  html: \"text/html\",\n  json: \"application/json\",\n  // jsondraw data\n  jsondraw: \"application/vnd.jsondraw+json\",\n  jsondrawClipboard: \"application/vnd.jsondraw.clipboard+json\",\n  // LEGACY: fully-qualified library JSON data\n  jsondrawlib: \"application/vnd.jsondrawlib+json\",\n  // list of jsondraw library item ids\n  jsondrawlibIds: \"application/vnd.jsondrawlib.ids+json\",\n} as const;\n\nexport const MIME_TYPES = {\n  ...STRING_MIME_TYPES,\n  // image-encoded jsondraw data\n  \"jsondraw.svg\": \"image/svg+xml\",\n  \"jsondraw.png\": \"image/png\",\n  // binary\n  binary: \"application/octet-stream\",\n  // image\n  ...IMAGE_MIME_TYPES,\n} as const;\n\nexport const ALLOWED_PASTE_MIME_TYPES = [\n  MIME_TYPES.text,\n  MIME_TYPES.html,\n  ...Object.values(IMAGE_MIME_TYPES),\n] as const;\n\nexport const EXPORT_IMAGE_TYPES = {\n  png: \"png\",\n  svg: \"svg\",\n  clipboard: \"clipboard\",\n} as const;\n\nexport const EXPORT_DATA_TYPES = {\n  jsondraw: \"jsondraw\",\n  jsondrawClipboard: \"jsondraw/clipboard\",\n  jsondrawLibrary: \"jsondrawlib\",\n  jsondrawClipboardWithAPI: \"jsondraw-api/clipboard\",\n} as const;\n\nexport const getExportSource = () => window.JSONDRAW_EXPORT_SOURCE || window.location.origin;\n\n// time in milliseconds\nexport const IMAGE_RENDER_TIMEOUT = 500;\nexport const TAP_TWICE_TIMEOUT = 300;\nexport const TOUCH_CTX_MENU_TIMEOUT = 500;\nexport const TITLE_TIMEOUT = 10000;\nexport const VERSION_TIMEOUT = 30000;\nexport const SCROLL_TIMEOUT = 100;\nexport const ZOOM_STEP = 0.1;\nexport const MIN_ZOOM = 0.1;\nexport const MAX_ZOOM = 30;\nexport const HYPERLINK_TOOLTIP_DELAY = 300;\n\n// Report a user inactive after IDLE_THRESHOLD milliseconds\nexport const IDLE_THRESHOLD = 60_000;\n// Report a user active each ACTIVE_THRESHOLD milliseconds\nexport const ACTIVE_THRESHOLD = 3_000;\n\nexport const URL_QUERY_KEYS = {\n  addLibrary: \"addLibrary\",\n} as const;\n\nexport const URL_HASH_KEYS = {\n  addLibrary: \"addLibrary\",\n} as const;\n\nexport const DEFAULT_UI_OPTIONS: AppProps[\"UIOptions\"] = {\n  canvasActions: {\n    changeViewBackgroundColor: true,\n    clearCanvas: true,\n    export: { saveFileToDisk: true },\n    loadScene: true,\n    saveToActiveFile: true,\n    toggleTheme: null,\n    saveAsImage: true,\n  },\n  tools: {\n    image: true,\n  },\n};\n\nexport const MAX_DECIMALS_FOR_SVG_EXPORT = 2;\n\nexport const EXPORT_SCALES = [1, 2, 3];\nexport const DEFAULT_EXPORT_PADDING = 10; // px\n\nexport const DEFAULT_MAX_IMAGE_WIDTH_OR_HEIGHT = 1440;\n\nexport const MAX_ALLOWED_FILE_BYTES = 4 * 1024 * 1024;\n\nexport const SVG_NS = \"http://www.w3.org/2000/svg\";\nexport const SVG_DOCUMENT_PREAMBLE = `<?xml version=\"1.0\" standalone=\"no\"?>\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n`;\n\nexport const ENCRYPTION_KEY_BITS = 128;\n\nexport const VERSIONS = {\n  jsondraw: 2,\n  jsondrawLibrary: 2,\n} as const;\n\nexport const BOUND_TEXT_PADDING = 5;\nexport const ARROW_LABEL_WIDTH_FRACTION = 0.7;\nexport const ARROW_LABEL_FONT_SIZE_TO_MIN_WIDTH_RATIO = 11;\n\nexport const VERTICAL_ALIGN = {\n  TOP: \"top\",\n  MIDDLE: \"middle\",\n  BOTTOM: \"bottom\",\n};\n\nexport const TEXT_ALIGN = {\n  LEFT: \"left\",\n  CENTER: \"center\",\n  RIGHT: \"right\",\n};\n\nexport const ELEMENT_READY_TO_ERASE_OPACITY = 20;\n\n// Radius represented as 25% of element's largest side (width/height).\n// Used for LEGACY and PROPORTIONAL_RADIUS algorithms, or when the element is\n// below the cutoff size.\nexport const DEFAULT_PROPORTIONAL_RADIUS = 0.25;\n// Fixed radius for the ADAPTIVE_RADIUS algorithm. In pixels.\nexport const DEFAULT_ADAPTIVE_RADIUS = 32;\n// roundness type (algorithm)\nexport const ROUNDNESS = {\n  // Used for legacy rounding (rectangles), which currently works the same\n  // as PROPORTIONAL_RADIUS, but we need to differentiate for UI purposes and\n  // forwards-compat.\n  LEGACY: 1,\n\n  // Used for linear elements & diamonds\n  PROPORTIONAL_RADIUS: 2,\n\n  // Current default algorithm for rectangles, using fixed pixel radius.\n  // It's working similarly to a regular border-radius, but attemps to make\n  // radius visually similar across differnt element sizes, especially\n  // very large and very small elements.\n  //\n  // NOTE right now we don't allow configuration and use a constant radius\n  // (see DEFAULT_ADAPTIVE_RADIUS constant)\n  ADAPTIVE_RADIUS: 3,\n} as const;\n\nexport const ROUGHNESS = {\n  architect: 0,\n  artist: 1,\n  cartoonist: 2,\n} as const;\n\nexport const STROKE_WIDTH = {\n  thin: 1,\n  bold: 2,\n  extraBold: 4,\n} as const;\n\nexport const DEFAULT_ELEMENT_PROPS: {\n  strokeColor: JsonDrawElement[\"strokeColor\"];\n  backgroundColor: JsonDrawElement[\"backgroundColor\"];\n  fillStyle: JsonDrawElement[\"fillStyle\"];\n  strokeWidth: JsonDrawElement[\"strokeWidth\"];\n  strokeStyle: JsonDrawElement[\"strokeStyle\"];\n  roughness: JsonDrawElement[\"roughness\"];\n  opacity: JsonDrawElement[\"opacity\"];\n  locked: JsonDrawElement[\"locked\"];\n} = {\n  strokeColor: COLOR_PALETTE.black,\n  backgroundColor: COLOR_PALETTE.transparent,\n  fillStyle: \"solid\",\n  strokeWidth: 2,\n  strokeStyle: \"solid\",\n  roughness: ROUGHNESS.artist,\n  opacity: 100,\n  locked: false,\n};\n\nexport const LIBRARY_SIDEBAR_TAB = \"library\";\nexport const CANVAS_SEARCH_TAB = \"search\";\n\nexport const DEFAULT_SIDEBAR = {\n  name: \"default\",\n  defaultTab: LIBRARY_SIDEBAR_TAB,\n} as const;\n\nexport const LIBRARY_DISABLED_TYPES = new Set([\"iframe\", \"embeddable\", \"image\"] as const);\n\n// use these constants to easily identify reference sites\nexport const TOOL_TYPE = {\n  selection: \"selection\",\n  lasso: \"lasso\",\n  rectangle: \"rectangle\",\n  diamond: \"diamond\",\n  ellipse: \"ellipse\",\n  arrow: \"arrow\",\n  line: \"line\",\n  freedraw: \"freedraw\",\n  text: \"text\",\n  image: \"image\",\n  eraser: \"eraser\",\n  hand: \"hand\",\n  frame: \"frame\",\n  magicframe: \"magicframe\",\n  embeddable: \"embeddable\",\n  laser: \"laser\",\n} as const;\n\nexport const EDITOR_LS_KEYS = {\n  OAI_API_KEY: \"jsondraw-oai-api-key\",\n  // legacy naming (non)scheme\n  MERMAID_TO_JSONDRAW: \"mermaid-to-jsondraw\",\n  PUBLISH_LIBRARY: \"publish-library-data\",\n} as const;\n\n/**\n * not translated as this is used only in public, stateless API as default value\n * where filename is optional and we can't retrieve name from app state\n */\nexport const DEFAULT_FILENAME = \"Untitled\";\n\nexport const STATS_PANELS = { generalStats: 1, elementProperties: 2 } as const;\n\nexport const MIN_WIDTH_OR_HEIGHT = 1;\n\nexport const ARROW_TYPE: { [T in AppState[\"currentItemArrowType\"]]: T } = {\n  sharp: \"sharp\",\n  round: \"round\",\n  elbow: \"elbow\",\n};\n\nexport const DEFAULT_REDUCED_GLOBAL_ALPHA = 0.3;\nexport const ELEMENT_LINK_KEY = \"element\";\n\n/** used in tests */\nexport const ORIG_ID = Symbol.for(\"__test__originalId__\");\n\nexport enum UserIdleState {\n  ACTIVE = \"active\",\n  AWAY = \"away\",\n  IDLE = \"idle\",\n}\n\n/**\n * distance at which we merge points instead of adding a new merge-point\n * when converting a line to a polygon (merge currently means overlaping\n * the start and end points)\n */\nexport const LINE_POLYGON_POINT_MERGE_DISTANCE = 20;\n\nexport const DOUBLE_TAP_POSITION_THRESHOLD = 35;\n\nexport const BIND_MODE_TIMEOUT = 700; // ms\n\n// glass background for mobile action buttons\nexport const MOBILE_ACTION_BUTTON_BG = {\n  background: \"var(--mobile-action-button-bg)\",\n} as const;\n","import type {\n  JsonDrawTextElement,\n  FontFamilyValues,\n} from \"@jsondraw/element/types\";\n\nimport { FONT_FAMILY, FONT_FAMILY_FALLBACKS } from \"./constants\";\n\n/**\n * Encapsulates font metrics with additional font metadata.\n * */\nexport interface FontMetadata {\n  /** for head & hhea metrics read the woff2 with https://fontdrop.info/ */\n  metrics: {\n    /** head.unitsPerEm metric */\n    unitsPerEm: 1000 | 1024 | 2048;\n    /** hhea.ascender metric */\n    ascender: number;\n    /** hhea.descender metric */\n    descender: number;\n    /** harcoded unitless line-height, https://github.com/jsondraw/jsondraw/pull/6360#issuecomment-1477635971 */\n    lineHeight: number;\n  };\n  /** flag to indicate a deprecated font */\n  deprecated?: true;\n  /**\n   * whether this is a font that users can use (= shown in font picker)\n   */\n  private?: true;\n  /** flag to indiccate a local-only font */\n  local?: true;\n  /** flag to indicate a fallback font */\n  fallback?: true;\n}\n\nexport const FONT_METADATA: Record<number, FontMetadata> = {\n  [FONT_FAMILY.Excalifont]: {\n    metrics: {\n      unitsPerEm: 1000,\n      ascender: 886,\n      descender: -374,\n      lineHeight: 1.25,\n    },\n  },\n  [FONT_FAMILY.Nunito]: {\n    metrics: {\n      unitsPerEm: 1000,\n      ascender: 1011,\n      descender: -353,\n      lineHeight: 1.25,\n    },\n  },\n  [FONT_FAMILY[\"Lilita One\"]]: {\n    metrics: {\n      unitsPerEm: 1000,\n      ascender: 923,\n      descender: -220,\n      lineHeight: 1.15,\n    },\n  },\n  [FONT_FAMILY[\"Comic Shanns\"]]: {\n    metrics: {\n      unitsPerEm: 1000,\n      ascender: 750,\n      descender: -250,\n      lineHeight: 1.25,\n    },\n  },\n  [FONT_FAMILY.Virgil]: {\n    metrics: {\n      unitsPerEm: 1000,\n      ascender: 886,\n      descender: -374,\n      lineHeight: 1.25,\n    },\n    deprecated: true,\n  },\n  [FONT_FAMILY.Helvetica]: {\n    metrics: {\n      unitsPerEm: 2048,\n      ascender: 1577,\n      descender: -471,\n      lineHeight: 1.15,\n    },\n    deprecated: true,\n    local: true,\n  },\n  [FONT_FAMILY.Cascadia]: {\n    metrics: {\n      unitsPerEm: 2048,\n      ascender: 1900,\n      descender: -480,\n      lineHeight: 1.2,\n    },\n    deprecated: true,\n  },\n  [FONT_FAMILY[\"Liberation Sans\"]]: {\n    metrics: {\n      unitsPerEm: 2048,\n      ascender: 1854,\n      descender: -434,\n      lineHeight: 1.15,\n    },\n    private: true,\n  },\n  [FONT_FAMILY.Assistant]: {\n    metrics: {\n      unitsPerEm: 2048,\n      ascender: 1021,\n      descender: -287,\n      lineHeight: 1.25,\n    },\n    private: true,\n  },\n  [FONT_FAMILY_FALLBACKS.Xiaolai]: {\n    metrics: {\n      unitsPerEm: 1000,\n      ascender: 880,\n      descender: -144,\n      lineHeight: 1.25,\n    },\n    fallback: true,\n  },\n  [FONT_FAMILY_FALLBACKS[\"Segoe UI Emoji\"]]: {\n    metrics: {\n      // reusing Excalifont metrics\n      unitsPerEm: 1000,\n      ascender: 886,\n      descender: -374,\n      lineHeight: 1.25,\n    },\n    local: true,\n    fallback: true,\n  },\n};\n\n/** Unicode ranges defined by google fonts */\nexport const GOOGLE_FONTS_RANGES = {\n  LATIN:\n    \"U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD\",\n  LATIN_EXT:\n    \"U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF\",\n  CYRILIC_EXT:\n    \"U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F\",\n  CYRILIC: \"U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116\",\n  VIETNAMESE:\n    \"U+0102-0103, U+0110-0111, U+0128-0129, U+0168-0169, U+01A0-01A1, U+01AF-01B0, U+0300-0301, U+0303-0304, U+0308-0309, U+0323, U+0329, U+1EA0-1EF9, U+20AB\",\n};\n\n/** local protocol to skip the local font from registering or inlining */\nexport const LOCAL_FONT_PROTOCOL = \"local:\";\n\n/**\n * Calculates vertical offset for a text with alphabetic baseline.\n */\nexport const getVerticalOffset = (\n  fontFamily: JsonDrawTextElement[\"fontFamily\"],\n  fontSize: JsonDrawTextElement[\"fontSize\"],\n  lineHeightPx: number,\n) => {\n  const { unitsPerEm, ascender, descender } =\n    FONT_METADATA[fontFamily]?.metrics ||\n    FONT_METADATA[FONT_FAMILY.Excalifont].metrics;\n\n  const fontSizeEm = fontSize / unitsPerEm;\n  const lineGap =\n    (lineHeightPx - fontSizeEm * ascender + fontSizeEm * descender) / 2;\n\n  const verticalOffset = fontSizeEm * ascender + lineGap;\n  return verticalOffset;\n};\n\n/**\n * Gets line height for a selected family.\n */\nexport const getLineHeight = (fontFamily: FontFamilyValues) => {\n  const { lineHeight } =\n    FONT_METADATA[fontFamily]?.metrics ||\n    FONT_METADATA[FONT_FAMILY.Excalifont].metrics;\n\n  return lineHeight as JsonDrawTextElement[\"lineHeight\"];\n};\n","import { promiseTry, resolvablePromise } from \".\";\n\nimport type { ResolvablePromise } from \".\";\n\nimport type { MaybePromise } from \"./utility-types\";\n\ntype Job<T, TArgs extends unknown[]> = (...args: TArgs) => MaybePromise<T>;\n\ntype QueueJob<T, TArgs extends unknown[]> = {\n  jobFactory: Job<T, TArgs>;\n  promise: ResolvablePromise<T>;\n  args: TArgs;\n};\n\nexport class Queue {\n  private jobs: QueueJob<any, any[]>[] = [];\n  private running = false;\n\n  private tick() {\n    if (this.running) {\n      return;\n    }\n    const job = this.jobs.shift();\n    if (job) {\n      this.running = true;\n      job.promise.resolve(\n        promiseTry(job.jobFactory, ...job.args).finally(() => {\n          this.running = false;\n          this.tick();\n        }),\n      );\n    } else {\n      this.running = false;\n    }\n  }\n\n  push<TValue, TArgs extends unknown[]>(\n    jobFactory: Job<TValue, TArgs>,\n    ...args: TArgs\n  ): Promise<TValue> {\n    const promise = resolvablePromise<TValue>();\n    this.jobs.push({ jobFactory, promise, args });\n\n    this.tick();\n\n    return promise;\n  }\n}\n","export type StylesPanelMode = \"compact\" | \"full\" | \"mobile\";\n\nexport type EditorInterface = Readonly<{\n  formFactor: \"phone\" | \"tablet\" | \"desktop\";\n  desktopUIMode: \"compact\" | \"full\";\n  userAgent: Readonly<{\n    isMobileDevice: boolean;\n    platform: \"ios\" | \"android\" | \"other\" | \"unknown\";\n  }>;\n  isTouchScreen: boolean;\n  canFitSidebar: boolean;\n  isLandscape: boolean;\n}>;\n\n// storage key\nconst DESKTOP_UI_MODE_STORAGE_KEY = \"jsondraw.desktopUIMode\";\n\n// breakpoints\nexport const MQ_MAX_MOBILE = 599;\n\nexport const MQ_MAX_WIDTH_LANDSCAPE = 1000;\nexport const MQ_MAX_HEIGHT_LANDSCAPE = 500;\n\n// tablets\nexport const MQ_MIN_TABLET = MQ_MAX_MOBILE + 1; // lower bound (excludes phones)\nexport const MQ_MAX_TABLET = 1180; // ipad air\n\n// desktop/laptop (NOTE: not used for form factor detection)\nexport const MQ_MIN_WIDTH_DESKTOP = 1440;\n\n// sidebar\nexport const MQ_RIGHT_SIDEBAR_MIN_WIDTH = 1229;\n\n// -----------------------------------------------------------------------------\n\n// user agent detections\nexport const isDarwin = /Mac|iPod|iPhone|iPad/.test(navigator.platform);\nexport const isWindows = /^Win/.test(navigator.platform);\nexport const isAndroid = /\\b(android)\\b/i.test(navigator.userAgent);\nexport const isFirefox =\n  typeof window !== \"undefined\" &&\n  \"netscape\" in window &&\n  navigator.userAgent.indexOf(\"rv:\") > 1 &&\n  navigator.userAgent.indexOf(\"Gecko\") > 1;\nexport const isChrome = navigator.userAgent.indexOf(\"Chrome\") !== -1;\nexport const isSafari =\n  !isChrome && navigator.userAgent.indexOf(\"Safari\") !== -1;\nexport const isIOS =\n  /iPad|iPhone/i.test(navigator.platform) ||\n  // iPadOS 13+\n  (navigator.userAgent.includes(\"Mac\") && \"ontouchend\" in document);\n// keeping function so it can be mocked in test\nexport const isBrave = () =>\n  (navigator as any).brave?.isBrave?.name === \"isBrave\";\n\n// export const isMobile =\n//   isIOS ||\n//   /android|webos|ipod|blackberry|iemobile|opera mini/i.test(\n//     navigator.userAgent,\n//   ) ||\n//   /android|ios|ipod|blackberry|windows phone/i.test(navigator.platform);\n\n// utilities\nexport const isMobileBreakpoint = (width: number, height: number) => {\n  return (\n    width <= MQ_MAX_MOBILE ||\n    (height < MQ_MAX_HEIGHT_LANDSCAPE && width < MQ_MAX_WIDTH_LANDSCAPE)\n  );\n};\n\nexport const isTabletBreakpoint = (\n  editorWidth: number,\n  editorHeight: number,\n) => {\n  const minSide = Math.min(editorWidth, editorHeight);\n  const maxSide = Math.max(editorWidth, editorHeight);\n\n  return minSide >= MQ_MIN_TABLET && maxSide <= MQ_MAX_TABLET;\n};\n\nconst isMobileOrTablet = (): boolean => {\n  const ua = navigator.userAgent || \"\";\n  const platform = navigator.platform || \"\";\n  const uaData = (navigator as any).userAgentData as\n    | { mobile?: boolean; platform?: string }\n    | undefined;\n\n  // --- 1) chromium: prefer ua client hints -------------------------------\n  if (uaData) {\n    const plat = (uaData.platform || \"\").toLowerCase();\n    const isDesktopOS =\n      plat === \"windows\" ||\n      plat === \"macos\" ||\n      plat === \"linux\" ||\n      plat === \"chrome os\";\n    if (uaData.mobile === true) {\n      return true;\n    }\n    if (uaData.mobile === false && plat === \"android\") {\n      const looksTouchTablet =\n        matchMedia?.(\"(hover: none)\").matches &&\n        matchMedia?.(\"(pointer: coarse)\").matches;\n      return looksTouchTablet;\n    }\n    if (isDesktopOS) {\n      return false;\n    }\n  }\n\n  // --- 2) ios (includes ipad) --------------------------------------------\n  if (isIOS) {\n    return true;\n  }\n\n  // --- 3) android legacy ua fallback -------------------------------------\n  if (isAndroid) {\n    const isAndroidPhone = /Mobile/i.test(ua);\n    const isAndroidTablet = !isAndroidPhone;\n    if (isAndroidPhone || isAndroidTablet) {\n      const looksTouchTablet =\n        matchMedia?.(\"(hover: none)\").matches &&\n        matchMedia?.(\"(pointer: coarse)\").matches;\n      return looksTouchTablet;\n    }\n  }\n\n  // --- 4) last resort desktop exclusion ----------------------------------\n  const looksDesktopPlatform =\n    /Win|Linux|CrOS|Mac/.test(platform) ||\n    /Windows NT|X11|CrOS|Macintosh/.test(ua);\n  if (looksDesktopPlatform) {\n    return false;\n  }\n  return false;\n};\n\nexport const getFormFactor = (\n  editorWidth: number,\n  editorHeight: number,\n): EditorInterface[\"formFactor\"] => {\n  if (isMobileBreakpoint(editorWidth, editorHeight)) {\n    return \"phone\";\n  }\n\n  if (isTabletBreakpoint(editorWidth, editorHeight)) {\n    return \"tablet\";\n  }\n\n  return \"desktop\";\n};\n\nexport const deriveStylesPanelMode = (\n  editorInterface: EditorInterface,\n): StylesPanelMode => {\n  if (editorInterface.formFactor === \"phone\") {\n    return \"mobile\";\n  }\n\n  if (editorInterface.formFactor === \"tablet\") {\n    return \"compact\";\n  }\n\n  return editorInterface.desktopUIMode;\n};\n\nexport const createUserAgentDescriptor = (\n  userAgentString: string,\n): EditorInterface[\"userAgent\"] => {\n  const normalizedUA = userAgentString ?? \"\";\n  let platform: EditorInterface[\"userAgent\"][\"platform\"] = \"unknown\";\n\n  if (isIOS) {\n    platform = \"ios\";\n  } else if (isAndroid) {\n    platform = \"android\";\n  } else if (normalizedUA) {\n    platform = \"other\";\n  }\n\n  return {\n    isMobileDevice: isMobileOrTablet(),\n    platform,\n  } as const;\n};\n\nexport const loadDesktopUIModePreference = () => {\n  if (typeof window === \"undefined\") {\n    return null;\n  }\n\n  try {\n    const stored = window.localStorage.getItem(DESKTOP_UI_MODE_STORAGE_KEY);\n    if (stored === \"compact\" || stored === \"full\") {\n      return stored as EditorInterface[\"desktopUIMode\"];\n    }\n  } catch (error) {\n    // ignore storage access issues (e.g., Safari private mode)\n  }\n\n  return null;\n};\n\nconst persistDesktopUIMode = (mode: EditorInterface[\"desktopUIMode\"]) => {\n  if (typeof window === \"undefined\") {\n    return;\n  }\n  try {\n    window.localStorage.setItem(DESKTOP_UI_MODE_STORAGE_KEY, mode);\n  } catch (error) {\n    // ignore storage access issues (e.g., Safari private mode)\n  }\n};\n\nexport const setDesktopUIMode = (mode: EditorInterface[\"desktopUIMode\"]) => {\n  if (mode !== \"compact\" && mode !== \"full\") {\n    return;\n  }\n\n  persistDesktopUIMode(mode);\n\n  return mode;\n};\n","import { isDarwin } from \"./editorInterface\";\n\nimport type { ValueOf } from \"./utility-types\";\n\nexport const CODES = {\n  EQUAL: \"Equal\",\n  MINUS: \"Minus\",\n  NUM_ADD: \"NumpadAdd\",\n  NUM_SUBTRACT: \"NumpadSubtract\",\n  NUM_ZERO: \"Numpad0\",\n  BRACKET_RIGHT: \"BracketRight\",\n  BRACKET_LEFT: \"BracketLeft\",\n  ONE: \"Digit1\",\n  TWO: \"Digit2\",\n  THREE: \"Digit3\",\n  NINE: \"Digit9\",\n  QUOTE: \"Quote\",\n  ZERO: \"Digit0\",\n  SLASH: \"Slash\",\n  C: \"KeyC\",\n  D: \"KeyD\",\n  H: \"KeyH\",\n  V: \"KeyV\",\n  Z: \"KeyZ\",\n  Y: \"KeyY\",\n  R: \"KeyR\",\n  S: \"KeyS\",\n} as const;\n\nexport const KEYS = {\n  ARROW_DOWN: \"ArrowDown\",\n  ARROW_LEFT: \"ArrowLeft\",\n  ARROW_RIGHT: \"ArrowRight\",\n  ARROW_UP: \"ArrowUp\",\n  PAGE_UP: \"PageUp\",\n  PAGE_DOWN: \"PageDown\",\n  BACKSPACE: \"Backspace\",\n  ALT: \"Alt\",\n  CTRL_OR_CMD: isDarwin ? \"metaKey\" : \"ctrlKey\",\n  DELETE: \"Delete\",\n  ENTER: \"Enter\",\n  ESCAPE: \"Escape\",\n  QUESTION_MARK: \"?\",\n  SPACE: \" \",\n  TAB: \"Tab\",\n  CHEVRON_LEFT: \"<\",\n  CHEVRON_RIGHT: \">\",\n  PERIOD: \".\",\n  COMMA: \",\",\n  SUBTRACT: \"-\",\n  SLASH: \"/\",\n\n  A: \"a\",\n  C: \"c\",\n  D: \"d\",\n  E: \"e\",\n  F: \"f\",\n  G: \"g\",\n  H: \"h\",\n  I: \"i\",\n  L: \"l\",\n  O: \"o\",\n  P: \"p\",\n  Q: \"q\",\n  R: \"r\",\n  S: \"s\",\n  T: \"t\",\n  V: \"v\",\n  X: \"x\",\n  Y: \"y\",\n  Z: \"z\",\n  K: \"k\",\n  W: \"w\",\n\n  0: \"0\",\n  1: \"1\",\n  2: \"2\",\n  3: \"3\",\n  4: \"4\",\n  5: \"5\",\n  6: \"6\",\n  7: \"7\",\n  8: \"8\",\n  9: \"9\",\n} as const;\n\nexport type Key = keyof typeof KEYS;\n\n// defines key code mapping for matching codes as fallback to respective keys on non-latin keyboard layouts\nexport const KeyCodeMap = new Map<ValueOf<typeof KEYS>, ValueOf<typeof CODES>>([\n  [KEYS.Z, CODES.Z],\n  [KEYS.Y, CODES.Y],\n]);\n\nexport const isLatinChar = (key: string) => /^[a-z]$/.test(key.toLowerCase());\n\n/**\n * Used to match key events for any keyboard layout, especially on Windows and Linux,\n * where non-latin character with modified (CMD) is not substituted with latin-based alternative.\n *\n * Uses `event.key` when it's latin, otherwise fallbacks to `event.code` (if mapping exists).\n *\n * Example of pressing \"z\" on different layouts, with the chosen key or code highlighted in []:\n *\n * Layout                | Code  | Key | Comment\n * --------------------- | ----- | --- | -------\n * U.S.                  |  KeyZ  | [z] |\n * Czech                 |  KeyY  | [z] |\n * Turkish               |  KeyN  | [z] |\n * French                |  KeyW  | [z] |\n * Macedonian            | [KeyZ] |    | z with cmd;  is Cyrillic equivalent of z\n * Russian               | [KeyZ] |    | z with cmd\n * Serbian               | [KeyZ] |    | z with cmd\n * Greek                 | [KeyZ] |    | z with cmd; also  is Greek equivalent of z\n * Hebrew                | [KeyZ] |    | z with cmd; also  is Hebrew equivalent of z\n * Pinyin - Simplified   |  KeyZ  | [z] | due to IME\n * Cangije - Traditional | [KeyZ] |   | z with cmd\n * Japanese              | [KeyZ] |   | z with cmd\n * 2-Set Korean          | [KeyZ] |   | z with cmd\n *\n * More details in https://github.com/jsondraw/jsondraw/pull/5944\n */\nexport const matchKey = (\n  event: KeyboardEvent | React.KeyboardEvent<Element>,\n  key: ValueOf<typeof KEYS>,\n): boolean => {\n  // for latin layouts use key\n  if (key === event.key.toLowerCase()) {\n    return true;\n  }\n\n  // non-latin layouts fallback to code\n  const code = KeyCodeMap.get(key);\n  return Boolean(code && !isLatinChar(event.key) && event.code === code);\n};\n\nexport const isArrowKey = (key: string) =>\n  key === KEYS.ARROW_LEFT ||\n  key === KEYS.ARROW_RIGHT ||\n  key === KEYS.ARROW_DOWN ||\n  key === KEYS.ARROW_UP;\n\nexport const shouldResizeFromCenter = (event: MouseEvent | KeyboardEvent) =>\n  event.altKey;\n\nexport const shouldMaintainAspectRatio = (event: MouseEvent | KeyboardEvent) =>\n  event.shiftKey;\n\nexport const shouldRotateWithDiscreteAngle = (\n  event: MouseEvent | KeyboardEvent | React.PointerEvent<HTMLCanvasElement>,\n) => event.shiftKey;\n","import {\n  pointFromPair,\n  type GlobalPoint,\n  type LocalPoint,\n} from \"@jsondraw/math\";\n\nimport type { NullableGridSize } from \"@jsondraw/jsondraw/types\";\n\nexport const getSizeFromPoints = (\n  points: readonly (GlobalPoint | LocalPoint)[],\n) => {\n  const xs = points.map((point) => point[0]);\n  const ys = points.map((point) => point[1]);\n  return {\n    width: Math.max(...xs) - Math.min(...xs),\n    height: Math.max(...ys) - Math.min(...ys),\n  };\n};\n\n/** @arg dimension, 0 for rescaling only x, 1 for y */\nexport const rescalePoints = <Point extends GlobalPoint | LocalPoint>(\n  dimension: 0 | 1,\n  newSize: number,\n  points: readonly Point[],\n  normalize: boolean,\n): Point[] => {\n  const coordinates = points.map((point) => point[dimension]);\n  const maxCoordinate = Math.max(...coordinates);\n  const minCoordinate = Math.min(...coordinates);\n  const size = maxCoordinate - minCoordinate;\n  const scale = size === 0 ? 1 : newSize / size;\n\n  let nextMinCoordinate = Infinity;\n\n  const scaledPoints = points.map((point): Point => {\n    const newCoordinate = point[dimension] * scale;\n    const newPoint = [...point];\n    newPoint[dimension] = newCoordinate;\n    if (newCoordinate < nextMinCoordinate) {\n      nextMinCoordinate = newCoordinate;\n    }\n    return newPoint as Point;\n  });\n\n  if (!normalize) {\n    return scaledPoints;\n  }\n\n  if (scaledPoints.length === 2) {\n    // we don't translate two-point lines\n    return scaledPoints;\n  }\n\n  const translation = minCoordinate - nextMinCoordinate;\n\n  const nextPoints = scaledPoints.map((scaledPoint) =>\n    pointFromPair<Point>(\n      scaledPoint.map((value, currentDimension) => {\n        return currentDimension === dimension ? value + translation : value;\n      }) as [number, number],\n    ),\n  );\n\n  return nextPoints;\n};\n\n// TODO: Rounding this point causes some shake when free drawing\nexport const getGridPoint = (\n  x: number,\n  y: number,\n  gridSize: NullableGridSize,\n): [number, number] => {\n  if (gridSize) {\n    return [\n      Math.round(x / gridSize) * gridSize,\n      Math.round(y / gridSize) * gridSize,\n    ];\n  }\n  return [x, y];\n};\n","import Pool from \"es6-promise-pool\";\n\n// extending the missing types\n// relying on the [Index, T] to keep a correct order\ntype TPromisePool<T, Index = number> = Pool<[Index, T][]> & {\n  addEventListener: (\n    type: \"fulfilled\",\n    listener: (event: { data: { result: [Index, T] } }) => void,\n  ) => (event: { data: { result: [Index, T] } }) => void;\n  removeEventListener: (\n    type: \"fulfilled\",\n    listener: (event: { data: { result: [Index, T] } }) => void,\n  ) => void;\n};\n\nexport class PromisePool<T> {\n  private readonly pool: TPromisePool<T>;\n  private readonly entries: Record<number, T> = {};\n\n  constructor(\n    source: IterableIterator<Promise<void | readonly [number, T]>>,\n    concurrency: number,\n  ) {\n    this.pool = new Pool(\n      source as unknown as () => void | PromiseLike<[number, T][]>,\n      concurrency,\n    ) as TPromisePool<T>;\n  }\n\n  public all() {\n    const listener = (event: { data: { result: void | [number, T] } }) => {\n      if (event.data.result) {\n        // by default pool does not return the results, so we are gathering them manually\n        // with the correct call order (represented by the index in the tuple)\n        const [index, value] = event.data.result;\n        this.entries[index] = value;\n      }\n    };\n\n    this.pool.addEventListener(\"fulfilled\", listener);\n\n    return this.pool.start().then(() => {\n      setTimeout(() => {\n        this.pool.removeEventListener(\"fulfilled\", listener);\n      });\n\n      return Object.values(this.entries);\n    });\n  }\n}\n","import type { FontFamilyValues, FontString } from \"@jsondraw/element/types\";\nimport type {\n  ActiveTool,\n  AppState,\n  ToolType,\n  UnsubscribeCallback,\n  Zoom,\n} from \"@jsondraw/jsondraw/types\";\nimport { average } from \"@jsondraw/math\";\nimport {\n  DEFAULT_VERSION,\n  ENV,\n  FONT_FAMILY,\n  getFontFamilyFallbacks,\n  WINDOWS_EMOJI_FALLBACK_FONT,\n} from \"./constants\";\nimport type { EVENT } from \"./constants\";\nimport type { MaybePromise, ResolutionType } from \"./utility-types\";\n\nlet mockDateTime: string | null = null;\n\nexport const setDateTimeForTests = (dateTime: string) => {\n  mockDateTime = dateTime;\n};\n\nexport const getDateTime = () => {\n  if (mockDateTime) {\n    return mockDateTime;\n  }\n\n  const date = new Date();\n  const year = date.getFullYear();\n  const month = `${date.getMonth() + 1}`.padStart(2, \"0\");\n  const day = `${date.getDate()}`.padStart(2, \"0\");\n  const hr = `${date.getHours()}`.padStart(2, \"0\");\n  const min = `${date.getMinutes()}`.padStart(2, \"0\");\n\n  return `${year}-${month}-${day}-${hr}${min}`;\n};\n\nexport const capitalizeString = (str: string) => str.charAt(0).toUpperCase() + str.slice(1);\n\nexport const isToolIcon = (target: Element | EventTarget | null): target is HTMLElement =>\n  target instanceof HTMLElement && target.className.includes(\"ToolIcon\");\n\nexport const isInputLike = (\n  target: Element | EventTarget | null\n): target is\n  | HTMLInputElement\n  | HTMLTextAreaElement\n  | HTMLSelectElement\n  | HTMLBRElement\n  | HTMLDivElement =>\n  (target instanceof HTMLElement && target.dataset.type === \"wysiwyg\") ||\n  target instanceof HTMLBRElement || // newline in wysiwyg\n  target instanceof HTMLInputElement ||\n  target instanceof HTMLTextAreaElement ||\n  target instanceof HTMLSelectElement;\n\nexport const isInteractive = (target: Element | EventTarget | null) => {\n  return isInputLike(target) || (target instanceof Element && !!target.closest(\"label, button\"));\n};\n\nexport const isWritableElement = (\n  target: Element | EventTarget | null\n): target is HTMLInputElement | HTMLTextAreaElement | HTMLBRElement | HTMLDivElement =>\n  (target instanceof HTMLElement && target.dataset.type === \"wysiwyg\") ||\n  target instanceof HTMLBRElement || // newline in wysiwyg\n  target instanceof HTMLTextAreaElement ||\n  (target instanceof HTMLInputElement &&\n    (target.type === \"text\" ||\n      target.type === \"number\" ||\n      target.type === \"password\" ||\n      target.type === \"search\"));\n\nexport const getFontFamilyString = ({ fontFamily }: { fontFamily: FontFamilyValues }) => {\n  for (const [fontFamilyString, id] of Object.entries(FONT_FAMILY)) {\n    if (id === fontFamily) {\n      return `${fontFamilyString}${getFontFamilyFallbacks(id)\n        .map(x => `, ${x}`)\n        .join(\"\")}`;\n    }\n  }\n  return WINDOWS_EMOJI_FALLBACK_FONT;\n};\n\n/** returns fontSize+fontFamily string for assignment to DOM elements */\nexport const getFontString = ({\n  fontSize,\n  fontFamily,\n}: {\n  fontSize: number;\n  fontFamily: FontFamilyValues;\n}) => {\n  return `${fontSize}px ${getFontFamilyString({ fontFamily })}` as FontString;\n};\n\n/** executes callback in the frame that's after the current one */\nexport const nextAnimationFrame = async (cb: () => any) => {\n  requestAnimationFrame(() => requestAnimationFrame(cb));\n};\n\nexport const debounce = <T extends any[]>(fn: (...args: T) => void, timeout: number) => {\n  let handle = 0;\n  let lastArgs: T | null = null;\n  const ret = (...args: T) => {\n    lastArgs = args;\n    clearTimeout(handle);\n    handle = window.setTimeout(() => {\n      lastArgs = null;\n      fn(...args);\n    }, timeout);\n  };\n  ret.flush = () => {\n    clearTimeout(handle);\n    if (lastArgs) {\n      const _lastArgs = lastArgs;\n      lastArgs = null;\n      fn(..._lastArgs);\n    }\n  };\n  ret.cancel = () => {\n    lastArgs = null;\n    clearTimeout(handle);\n  };\n  return ret;\n};\n\n// throttle callback to execute once per animation frame\nexport const throttleRAF = <T extends any[]>(\n  fn: (...args: T) => void,\n  opts?: { trailing?: boolean }\n) => {\n  let timerId: number | null = null;\n  let lastArgs: T | null = null;\n  let lastArgsTrailing: T | null = null;\n\n  const scheduleFunc = (args: T) => {\n    timerId = window.requestAnimationFrame(() => {\n      timerId = null;\n      fn(...args);\n      lastArgs = null;\n      if (lastArgsTrailing) {\n        lastArgs = lastArgsTrailing;\n        lastArgsTrailing = null;\n        scheduleFunc(lastArgs);\n      }\n    });\n  };\n\n  const ret = (...args: T) => {\n    if (isTestEnv()) {\n      fn(...args);\n      return;\n    }\n    lastArgs = args;\n    if (timerId === null) {\n      scheduleFunc(lastArgs);\n    } else if (opts?.trailing) {\n      lastArgsTrailing = args;\n    }\n  };\n  ret.flush = () => {\n    if (timerId !== null) {\n      cancelAnimationFrame(timerId);\n      timerId = null;\n    }\n    if (lastArgs) {\n      fn(...(lastArgsTrailing || lastArgs));\n      lastArgs = lastArgsTrailing = null;\n    }\n  };\n  ret.cancel = () => {\n    lastArgs = lastArgsTrailing = null;\n    if (timerId !== null) {\n      cancelAnimationFrame(timerId);\n      timerId = null;\n    }\n  };\n  return ret;\n};\n\n/**\n * Exponential ease-out method\n *\n * @param {number} k - The value to be tweened.\n * @returns {number} The tweened value.\n */\nexport const easeOut = (k: number) => {\n  return 1 - Math.pow(1 - k, 4);\n};\n\nconst easeOutInterpolate = (from: number, to: number, progress: number) => {\n  return (to - from) * easeOut(progress) + from;\n};\n\n/**\n * Animates values from `fromValues` to `toValues` using the requestAnimationFrame API.\n * Executes the `onStep` callback on each step with the interpolated values.\n * Returns a function that can be called to cancel the animation.\n *\n * @example\n * // Example usage:\n * const fromValues = { x: 0, y: 0 };\n * const toValues = { x: 100, y: 200 };\n * const onStep = ({x, y}) => {\n *   setState(x, y)\n * };\n * const onCancel = () => {\n *   console.log(\"Animation canceled\");\n * };\n *\n * const cancelAnimation = easeToValuesRAF({\n *   fromValues,\n *   toValues,\n *   onStep,\n *   onCancel,\n * });\n *\n * // To cancel the animation:\n * cancelAnimation();\n */\nexport const easeToValuesRAF = <T extends Record<keyof T, number>, K extends keyof T>({\n  fromValues,\n  toValues,\n  onStep,\n  duration = 250,\n  interpolateValue,\n  onStart,\n  onEnd,\n  onCancel,\n}: {\n  fromValues: T;\n  toValues: T;\n  /**\n   * Interpolate a single value.\n   * Return undefined to be handled by the default interpolator.\n   */\n  interpolateValue?: (\n    fromValue: number,\n    toValue: number,\n    /** no easing applied  */\n    progress: number,\n    key: K\n  ) => number | undefined;\n  onStep: (values: T) => void;\n  duration?: number;\n  onStart?: () => void;\n  onEnd?: () => void;\n  onCancel?: () => void;\n}) => {\n  let canceled = false;\n  let frameId = 0;\n  let startTime: number;\n\n  function step(timestamp: number) {\n    if (canceled) {\n      return;\n    }\n    if (startTime === undefined) {\n      startTime = timestamp;\n      onStart?.();\n    }\n\n    const elapsed = Math.min(timestamp - startTime, duration);\n    const factor = easeOut(elapsed / duration);\n\n    const newValues = {} as T;\n\n    Object.keys(fromValues).forEach(key => {\n      const _key = key as keyof T;\n      const result = ((toValues[_key] - fromValues[_key]) * factor +\n        fromValues[_key]) as T[keyof T];\n      newValues[_key] = result;\n    });\n\n    onStep(newValues);\n\n    if (elapsed < duration) {\n      const progress = elapsed / duration;\n\n      const newValues = {} as T;\n\n      Object.keys(fromValues).forEach(key => {\n        const _key = key as K;\n        const startValue = fromValues[_key];\n        const endValue = toValues[_key];\n\n        let result;\n\n        result = interpolateValue\n          ? interpolateValue(startValue, endValue, progress, _key)\n          : easeOutInterpolate(startValue, endValue, progress);\n\n        if (result == null) {\n          result = easeOutInterpolate(startValue, endValue, progress);\n        }\n\n        newValues[_key] = result as T[K];\n      });\n      onStep(newValues);\n\n      frameId = window.requestAnimationFrame(step);\n    } else {\n      onStep(toValues);\n      onEnd?.();\n    }\n  }\n\n  frameId = window.requestAnimationFrame(step);\n\n  return () => {\n    onCancel?.();\n    canceled = true;\n    window.cancelAnimationFrame(frameId);\n  };\n};\n\n// https://github.com/lodash/lodash/blob/es/chunk.js\nexport const chunk = <T extends any>(array: readonly T[], size: number): T[][] => {\n  if (!array.length || size < 1) {\n    return [];\n  }\n  let index = 0;\n  let resIndex = 0;\n  const result = Array(Math.ceil(array.length / size));\n  while (index < array.length) {\n    result[resIndex++] = array.slice(index, (index += size));\n  }\n  return result;\n};\n\nexport const selectNode = (node: Element) => {\n  const selection = window.getSelection();\n  if (selection) {\n    const range = document.createRange();\n    range.selectNodeContents(node);\n    selection.removeAllRanges();\n    selection.addRange(range);\n  }\n};\n\nexport const removeSelection = () => {\n  const selection = window.getSelection();\n  if (selection) {\n    selection.removeAllRanges();\n  }\n};\n\nexport const distance = (x: number, y: number) => Math.abs(x - y);\n\nexport const isSelectionLikeTool = (type: ToolType | \"custom\") => {\n  return type === \"selection\" || type === \"lasso\";\n};\n\nexport const updateActiveTool = (\n  appState: Pick<AppState, \"activeTool\">,\n  data: ((\n    | {\n        type: ToolType;\n      }\n    | { type: \"custom\"; customType: string }\n  ) & { locked?: boolean; fromSelection?: boolean }) & {\n    lastActiveToolBeforeEraser?: ActiveTool | null;\n  }\n): AppState[\"activeTool\"] => {\n  if (data.type === \"custom\") {\n    return {\n      ...appState.activeTool,\n      type: \"custom\",\n      customType: data.customType,\n      locked: data.locked ?? appState.activeTool.locked,\n    };\n  }\n\n  return {\n    ...appState.activeTool,\n    lastActiveTool:\n      data.lastActiveToolBeforeEraser === undefined\n        ? appState.activeTool.lastActiveTool\n        : data.lastActiveToolBeforeEraser,\n    type: data.type,\n    customType: null,\n    locked: data.locked ?? appState.activeTool.locked,\n    fromSelection: data.fromSelection ?? false,\n  };\n};\n\nexport const isFullScreen = () => document.fullscreenElement?.nodeName === \"HTML\";\n\nexport const allowFullScreen = () => document.documentElement.requestFullscreen();\n\nexport const exitFullScreen = () => document.exitFullscreen();\n\nexport const viewportCoordsToSceneCoords = (\n  { clientX, clientY }: { clientX: number; clientY: number },\n  {\n    zoom,\n    offsetLeft,\n    offsetTop,\n    scrollX,\n    scrollY,\n  }: {\n    zoom: Zoom;\n    offsetLeft: number;\n    offsetTop: number;\n    scrollX: number;\n    scrollY: number;\n  }\n) => {\n  const x = (clientX - offsetLeft) / zoom.value - scrollX;\n  const y = (clientY - offsetTop) / zoom.value - scrollY;\n\n  return { x, y };\n};\n\nexport const sceneCoordsToViewportCoords = (\n  { sceneX, sceneY }: { sceneX: number; sceneY: number },\n  {\n    zoom,\n    offsetLeft,\n    offsetTop,\n    scrollX,\n    scrollY,\n  }: {\n    zoom: Zoom;\n    offsetLeft: number;\n    offsetTop: number;\n    scrollX: number;\n    scrollY: number;\n  }\n) => {\n  const x = (sceneX + scrollX) * zoom.value + offsetLeft;\n  const y = (sceneY + scrollY) * zoom.value + offsetTop;\n  return { x, y };\n};\n\nexport const getGlobalCSSVariable = (name: string) =>\n  getComputedStyle(document.documentElement).getPropertyValue(`--${name}`);\n\nconst RS_LTR_CHARS =\n  \"A-Za-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02B8\\u0300-\\u0590\\u0800-\\u1FFF\" +\n  \"\\u2C00-\\uFB1C\\uFDFE-\\uFE6F\\uFEFD-\\uFFFF\";\nconst RS_RTL_CHARS = \"\\u0591-\\u07FF\\uFB1D-\\uFDFD\\uFE70-\\uFEFC\";\nconst RE_RTL_CHECK = new RegExp(`^[^${RS_LTR_CHARS}]*[${RS_RTL_CHARS}]`);\n/**\n * Checks whether first directional character is RTL. Meaning whether it starts\n *  with RTL characters, or indeterminate (numbers etc.) characters followed by\n *  RTL.\n * See https://github.com/jsondraw/jsondraw/pull/1722#discussion_r436340171\n */\nexport const isRTL = (text: string) => RE_RTL_CHECK.test(text);\n\nexport const tupleToCoors = (xyTuple: readonly [number, number]): { x: number; y: number } => {\n  const [x, y] = xyTuple;\n  return { x, y };\n};\n\n/** use as a rejectionHandler to mute filesystem Abort errors */\nexport const muteFSAbortError = (error?: Error) => {\n  if (error?.name === \"AbortError\") {\n    console.warn(error);\n    return;\n  }\n  throw error;\n};\n\nexport const findIndex = <T>(\n  array: readonly T[],\n  cb: (element: T, index: number, array: readonly T[]) => boolean,\n  fromIndex: number = 0\n) => {\n  if (fromIndex < 0) {\n    fromIndex = array.length + fromIndex;\n  }\n  fromIndex = Math.min(array.length, Math.max(fromIndex, 0));\n  let index = fromIndex - 1;\n  while (++index < array.length) {\n    if (cb(array[index], index, array)) {\n      return index;\n    }\n  }\n  return -1;\n};\n\nexport const findLastIndex = <T>(\n  array: readonly T[],\n  cb: (element: T, index: number, array: readonly T[]) => boolean,\n  fromIndex: number = array.length - 1\n) => {\n  if (fromIndex < 0) {\n    fromIndex = array.length + fromIndex;\n  }\n  fromIndex = Math.min(array.length - 1, Math.max(fromIndex, 0));\n  let index = fromIndex + 1;\n  while (--index > -1) {\n    if (cb(array[index], index, array)) {\n      return index;\n    }\n  }\n  return -1;\n};\n\n/** returns the first non-null mapped value */\nexport const mapFind = <T, K>(\n  collection: readonly T[],\n  iteratee: (value: T, index: number) => K | undefined | null\n): K | undefined => {\n  for (let idx = 0; idx < collection.length; idx++) {\n    const result = iteratee(collection[idx], idx);\n    if (result != null) {\n      return result;\n    }\n  }\n  return undefined;\n};\n\nexport type ResolvablePromise<T> = Promise<T> & {\n  resolve: [T] extends [undefined]\n    ? (value?: MaybePromise<Awaited<T>>) => void\n    : (value: MaybePromise<Awaited<T>>) => void;\n  reject: (error: Error) => void;\n};\nexport const resolvablePromise = <T>() => {\n  let resolve!: any;\n  let reject!: any;\n  const promise = new Promise((_resolve, _reject) => {\n    resolve = _resolve;\n    reject = _reject;\n  });\n  (promise as any).resolve = resolve;\n  (promise as any).reject = reject;\n  return promise as ResolvablePromise<T>;\n};\n\n//https://stackoverflow.com/a/9462382/8418\nexport const nFormatter = (num: number, digits: number): string => {\n  const si = [\n    { value: 1, symbol: \"b\" },\n    { value: 1e3, symbol: \"k\" },\n    { value: 1e6, symbol: \"M\" },\n    { value: 1e9, symbol: \"G\" },\n  ];\n  const rx = /\\.0+$|(\\.[0-9]*[1-9])0+$/;\n  let index;\n  for (index = si.length - 1; index > 0; index--) {\n    if (num >= si[index].value) {\n      break;\n    }\n  }\n  return (num / si[index].value).toFixed(digits).replace(rx, \"$1\") + si[index].symbol;\n};\n\nexport const getVersion = () => {\n  return (\n    document.querySelector<HTMLMetaElement>('meta[name=\"version\"]')?.content || DEFAULT_VERSION\n  );\n};\n\n// Adapted from https://github.com/Modernizr/Modernizr/blob/master/feature-detects/emoji.js\nexport const supportsEmoji = () => {\n  const canvas = document.createElement(\"canvas\");\n  const ctx = canvas.getContext(\"2d\");\n  if (!ctx) {\n    return false;\n  }\n  const offset = 12;\n  ctx.fillStyle = \"#f00\";\n  ctx.textBaseline = \"top\";\n  ctx.font = \"32px Arial\";\n  // Modernizr used , but it is sort of supported on Windows 7.\n  // Luckily  isn't supported.\n  ctx.fillText(\"\", 0, 0);\n  return ctx.getImageData(offset, offset, 1, 1).data[0] !== 0;\n};\n\nexport const getNearestScrollableContainer = (element: HTMLElement): HTMLElement | Document => {\n  let parent = element.parentElement;\n  while (parent) {\n    if (parent === document.body) {\n      return document;\n    }\n    const { overflowY } = window.getComputedStyle(parent);\n    const hasScrollableContent = parent.scrollHeight > parent.clientHeight;\n    if (\n      hasScrollableContent &&\n      (overflowY === \"auto\" || overflowY === \"scroll\" || overflowY === \"overlay\")\n    ) {\n      return parent;\n    }\n    parent = parent.parentElement;\n  }\n  return document;\n};\n\nexport const focusNearestParent = (element: HTMLInputElement) => {\n  let parent = element.parentElement;\n  while (parent) {\n    if (parent.tabIndex > -1) {\n      parent.focus();\n      return;\n    }\n    parent = parent.parentElement;\n  }\n};\n\nexport const preventUnload = (event: BeforeUnloadEvent) => {\n  event.preventDefault();\n  // NOTE: modern browsers no longer allow showing a custom message here\n  event.returnValue = \"\";\n};\n\nexport const bytesToHexString = (bytes: Uint8Array) => {\n  return Array.from(bytes)\n    .map(byte => `0${byte.toString(16)}`.slice(-2))\n    .join(\"\");\n};\n\nexport const getUpdatedTimestamp = () => (isTestEnv() ? 1 : Date.now());\n\n/**\n * Transforms array of objects containing `id` attribute,\n * or array of ids (strings), into a Map, keyd by `id`.\n */\nexport const arrayToMap = <T extends { id: string } | string>(\n  items: readonly T[] | Map<string, T>\n) => {\n  if (items instanceof Map) {\n    return items;\n  }\n  return items.reduce(\n    (acc: Map<string, T>, element) => {\n      acc.set(typeof element === \"string\" ? element : element.id, element);\n      return acc;\n    },\n    new Map() as Map<string, T>\n  );\n};\n\nexport const arrayToMapWithIndex = <T extends { id: string }>(elements: readonly T[]) =>\n  elements.reduce((acc, element: T, idx) => {\n    acc.set(element.id, [element, idx]);\n    return acc;\n  }, new Map<string, [element: T, index: number]>());\n\n/**\n * Transform array into an object, use only when array order is irrelevant.\n */\nexport const arrayToObject = <T>(array: readonly T[], groupBy?: (value: T) => string | number) =>\n  array.reduce(\n    (acc, value, idx) => {\n      acc[groupBy ? groupBy(value) : idx] = value;\n      return acc;\n    },\n    {} as { [key: string]: T }\n  );\n\n/** Doubly linked node */\nexport type Node<T> = T & {\n  prev: Node<T> | null;\n  next: Node<T> | null;\n};\n\n/**\n * Creates a circular doubly linked list by adding `prev` and `next` props to the existing array nodes.\n */\nexport const arrayToList = <T>(array: readonly T[]): Node<T>[] =>\n  array.reduce((acc, curr, index) => {\n    const node: Node<T> = { ...curr, prev: null, next: null };\n\n    // no-op for first item, we don't want circular references on a single item\n    if (index !== 0) {\n      const prevNode = acc[index - 1];\n      node.prev = prevNode;\n      prevNode.next = node;\n\n      if (index === array.length - 1) {\n        // make the references circular and connect head & tail\n        const firstNode = acc[0];\n        node.next = firstNode;\n        firstNode.prev = node;\n      }\n    }\n\n    acc.push(node);\n\n    return acc;\n  }, [] as Node<T>[]);\n\n/**\n * Converts a readonly array or map into an iterable.\n * Useful for avoiding entry allocations when iterating object / map on each iteration.\n */\nexport const toIterable = <T>(values: readonly T[] | ReadonlyMap<string, T>): Iterable<T> => {\n  return Array.isArray(values) ? values : values.values();\n};\n\n/**\n * Converts a readonly array or map into an array.\n */\nexport const toArray = <T>(values: readonly T[] | ReadonlyMap<string, T>): T[] => {\n  return Array.isArray(values) ? values : Array.from(toIterable(values));\n};\n\nexport const isTestEnv = () => import.meta.env.MODE === ENV.TEST;\n\nexport const isDevEnv = () => import.meta.env.MODE === ENV.DEVELOPMENT;\n\nexport const isProdEnv = () => import.meta.env.MODE === ENV.PRODUCTION;\n\nexport const isServerEnv = () => typeof process !== \"undefined\" && !!process?.env?.NODE_ENV;\n\nexport const wrapEvent = <T extends Event>(name: EVENT, nativeEvent: T) => {\n  return new CustomEvent(name, {\n    detail: {\n      nativeEvent,\n    },\n    cancelable: true,\n  });\n};\n\nexport const updateObject = <T extends Record<string, any>>(obj: T, updates: Partial<T>): T => {\n  let didChange = false;\n  for (const key in updates) {\n    const value = (updates as any)[key];\n    if (typeof value !== \"undefined\") {\n      if (\n        (obj as any)[key] === value &&\n        // if object, always update because its attrs could have changed\n        (typeof value !== \"object\" || value === null)\n      ) {\n        continue;\n      }\n      didChange = true;\n    }\n  }\n\n  if (!didChange) {\n    return obj;\n  }\n\n  return {\n    ...obj,\n    ...updates,\n  };\n};\n\nexport const isPrimitive = (val: any) => {\n  const type = typeof val;\n  return val == null || (type !== \"object\" && type !== \"function\");\n};\n\nexport const getFrame = () => {\n  try {\n    return window.self === window.top ? \"top\" : \"iframe\";\n  } catch (error) {\n    return \"iframe\";\n  }\n};\n\nexport const isRunningInIframe = () => getFrame() === \"iframe\";\n\nexport const isPromiseLike = (value: any): value is Promise<ResolutionType<typeof value>> => {\n  return (\n    !!value &&\n    typeof value === \"object\" &&\n    \"then\" in value &&\n    \"catch\" in value &&\n    \"finally\" in value\n  );\n};\n\nexport const queryFocusableElements = (container: HTMLElement | null) => {\n  const focusableElements = container?.querySelectorAll<HTMLElement>(\n    \"button, a, input, select, textarea, div[tabindex], label[tabindex]\"\n  );\n\n  return focusableElements\n    ? Array.from(focusableElements).filter(\n        element => element.tabIndex > -1 && !(element as HTMLInputElement).disabled\n      )\n    : [];\n};\n\n/** use as a fallback after identity check (for perf reasons) */\nconst _defaultIsShallowComparatorFallback = (a: any, b: any): boolean => {\n  // consider two empty arrays equal\n  if (Array.isArray(a) && Array.isArray(b) && a.length === 0 && b.length === 0) {\n    return true;\n  }\n  return a === b;\n};\n\n/**\n * Returns whether object/array is shallow equal.\n * Considers empty object/arrays as equal (whether top-level or second-level).\n */\nexport const isShallowEqual = <T extends Record<string, any>, K extends readonly unknown[]>(\n  objA: T,\n  objB: T,\n  comparators?:\n    | { [key in keyof T]?: (a: T[key], b: T[key]) => boolean }\n    | (keyof T extends K[number]\n        ? K extends readonly (keyof T)[]\n          ? K\n          : {\n              _error: \"keys are either missing or include keys not in compared obj\";\n            }\n        : {\n            _error: \"keys are either missing or include keys not in compared obj\";\n          }),\n  debug = false\n) => {\n  const aKeys = Object.keys(objA);\n  const bKeys = Object.keys(objB);\n  if (aKeys.length !== bKeys.length) {\n    if (debug) {\n      console.warn(\n        `%cisShallowEqual: objects don't have same properties ->`,\n        \"color: #8B4000\",\n        objA,\n        objB\n      );\n    }\n    return false;\n  }\n\n  if (comparators && Array.isArray(comparators)) {\n    for (const key of comparators) {\n      const ret =\n        objA[key] === objB[key] || _defaultIsShallowComparatorFallback(objA[key], objB[key]);\n      if (!ret) {\n        if (debug) {\n          console.warn(\n            `%cisShallowEqual: ${key} not equal ->`,\n            \"color: #8B4000\",\n            objA[key],\n            objB[key]\n          );\n        }\n        return false;\n      }\n    }\n    return true;\n  }\n\n  return aKeys.every(key => {\n    const comparator = (comparators as { [key in keyof T]?: (a: T[key], b: T[key]) => boolean })?.[\n      key as keyof T\n    ];\n    const ret = comparator\n      ? comparator(objA[key], objB[key])\n      : objA[key] === objB[key] || _defaultIsShallowComparatorFallback(objA[key], objB[key]);\n\n    if (!ret && debug) {\n      console.warn(`%cisShallowEqual: ${key} not equal ->`, \"color: #8B4000\", objA[key], objB[key]);\n    }\n    return ret;\n  });\n};\n\n// taken from Radix UI\n// https://github.com/radix-ui/primitives/blob/main/packages/core/primitive/src/primitive.tsx\nexport const composeEventHandlers = <E>(\n  originalEventHandler?: (event: E) => void,\n  ourEventHandler?: (event: E) => void,\n  { checkForDefaultPrevented = true } = {}\n) => {\n  return function handleEvent(event: E) {\n    originalEventHandler?.(event);\n\n    if (!checkForDefaultPrevented || !(event as unknown as Event)?.defaultPrevented) {\n      return ourEventHandler?.(event);\n    }\n  };\n};\n\n/**\n * supply `null` as message if non-never value is valid, you just need to\n * typecheck against it\n */\nexport const assertNever = (value: never, message: string | null, softAssert?: boolean): never => {\n  if (!message) {\n    return value;\n  }\n  if (softAssert) {\n    console.error(message);\n    return value;\n  }\n\n  throw new Error(message);\n};\n\nexport function invariant(condition: any, message: string): asserts condition {\n  if (!condition) {\n    throw new Error(message);\n  }\n}\n\n/**\n * Memoizes on values of `opts` object (strict equality).\n */\nexport const memoize = <T extends Record<string, any>, R extends any>(func: (opts: T) => R) => {\n  let lastArgs: Map<string, any> | undefined;\n  let lastResult: R | undefined;\n\n  const ret = function (opts: T) {\n    const currentArgs = Object.entries(opts);\n\n    if (lastArgs) {\n      let argsAreEqual = true;\n      for (const [key, value] of currentArgs) {\n        if (lastArgs.get(key) !== value) {\n          argsAreEqual = false;\n          break;\n        }\n      }\n      if (argsAreEqual) {\n        return lastResult;\n      }\n    }\n\n    const result = func(opts);\n\n    lastArgs = new Map(currentArgs);\n    lastResult = result;\n\n    return result;\n  };\n\n  ret.clear = () => {\n    lastArgs = undefined;\n    lastResult = undefined;\n  };\n\n  return ret as typeof func & { clear: () => void };\n};\n\n/** Checks if value is inside given collection. Useful for type-safety. */\nexport const isMemberOf = <T extends string>(\n  /** Set/Map/Array/Object */\n  collection: Set<T> | readonly T[] | Record<T, any> | Map<T, any>,\n  /** value to look for */\n  value: string\n): value is T => {\n  return collection instanceof Set || collection instanceof Map\n    ? collection.has(value as T)\n    : \"includes\" in collection\n      ? collection.includes(value as T)\n      : collection.hasOwnProperty(value);\n};\n\nexport const cloneJSON = <T>(obj: T): T => JSON.parse(JSON.stringify(obj));\n\nexport const updateStable = <T extends any[] | Record<string, any>>(prevValue: T, nextValue: T) => {\n  if (isShallowEqual(prevValue, nextValue)) {\n    return prevValue;\n  }\n  return nextValue;\n};\n\n// Window\nexport function addEventListener<K extends keyof WindowEventMap>(\n  target: Window & typeof globalThis,\n  type: K,\n  listener: (this: Window, ev: WindowEventMap[K]) => any,\n  options?: boolean | AddEventListenerOptions\n): UnsubscribeCallback;\nexport function addEventListener(\n  target: Window & typeof globalThis,\n  type: string,\n  listener: (this: Window, ev: Event) => any,\n  options?: boolean | AddEventListenerOptions\n): UnsubscribeCallback;\n// Document\nexport function addEventListener<K extends keyof DocumentEventMap>(\n  target: Document,\n  type: K,\n  listener: (this: Document, ev: DocumentEventMap[K]) => any,\n  options?: boolean | AddEventListenerOptions\n): UnsubscribeCallback;\nexport function addEventListener(\n  target: Document,\n  type: string,\n  listener: (this: Document, ev: Event) => any,\n  options?: boolean | AddEventListenerOptions\n): UnsubscribeCallback;\n// FontFaceSet (document.fonts)\nexport function addEventListener<K extends keyof FontFaceSetEventMap>(\n  target: FontFaceSet,\n  type: K,\n  listener: (this: FontFaceSet, ev: FontFaceSetEventMap[K]) => any,\n  options?: boolean | AddEventListenerOptions\n): UnsubscribeCallback;\n// HTMLElement / mix\nexport function addEventListener<K extends keyof HTMLElementEventMap>(\n  target: Document | (Window & typeof globalThis) | HTMLElement | undefined | null | false,\n  type: K,\n  listener: (this: HTMLDivElement, ev: HTMLElementEventMap[K]) => any,\n  options?: boolean | AddEventListenerOptions\n): UnsubscribeCallback;\n// implem\nexport function addEventListener(\n  /**\n   * allows for falsy values so you don't have to type check when adding\n   * event listeners to optional elements\n   */\n  target:\n    | Document\n    | (Window & typeof globalThis)\n    | FontFaceSet\n    | HTMLElement\n    | undefined\n    | null\n    | false,\n  type: keyof WindowEventMap | keyof DocumentEventMap | string,\n  listener: (ev: Event) => any,\n  options?: boolean | AddEventListenerOptions\n): UnsubscribeCallback {\n  if (!target) {\n    return () => {};\n  }\n  target?.addEventListener?.(type, listener, options);\n  return () => {\n    target?.removeEventListener?.(type, listener, options);\n  };\n}\n\nexport function getSvgPathFromStroke(points: number[][], closed = true) {\n  const len = points.length;\n\n  if (len < 4) {\n    return ``;\n  }\n\n  let a = points[0];\n  let b = points[1];\n  const c = points[2];\n\n  let result = `M${a[0].toFixed(2)},${a[1].toFixed(2)} Q${b[0].toFixed(\n    2\n  )},${b[1].toFixed(2)} ${average(b[0], c[0]).toFixed(2)},${average(b[1], c[1]).toFixed(2)} T`;\n\n  for (let i = 2, max = len - 1; i < max; i++) {\n    a = points[i];\n    b = points[i + 1];\n    result += `${average(a[0], b[0]).toFixed(2)},${average(a[1], b[1]).toFixed(2)} `;\n  }\n\n  if (closed) {\n    result += \"Z\";\n  }\n\n  return result;\n}\n\nexport const normalizeEOL = (str: string) => {\n  return str.replace(/\\r?\\n|\\r/g, \"\\n\");\n};\n\n// -----------------------------------------------------------------------------\nexport type HasBrand<T> = {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  [K in keyof T]: K extends `~brand${infer _}` | \"_brand\" ? true : never;\n}[keyof T];\n\ntype RemoveAllBrands<T> =\n  HasBrand<T> extends true\n    ? {\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        [K in keyof T as K extends `~brand~${infer _}` | \"_brand\" ? never : K]: T[K];\n      }\n    : T;\n\n// For accepting values - uses loose matching for branded types\n// Preserves readonly modifier: mutable array requires mutable input\ntype UnbrandForValue<T> =\n  T extends Map<infer E, infer F>\n    ? Map<UnbrandForValue<E>, UnbrandForValue<F>>\n    : T extends Set<infer E>\n      ? Set<UnbrandForValue<E>>\n      : T extends readonly any[]\n        ? T extends any[]\n          ? unknown[] // mutable array - require mutable input\n          : readonly unknown[] // readonly array - accept readonly input\n        : RemoveAllBrands<T>;\n\n// For return types - preserves array element unbranding\nexport type Unbrand<T> =\n  T extends Map<infer E, infer F>\n    ? Map<Unbrand<E>, Unbrand<F>>\n    : T extends Set<infer E>\n      ? Set<Unbrand<E>>\n      : T extends readonly (infer E)[]\n        ? Array<Unbrand<E>>\n        : RemoveAllBrands<T>;\n\nexport type CombineBrands<BrandedType, CurrentType> = BrandedType extends readonly (infer BE)[]\n  ? CurrentType extends readonly (infer CE)[]\n    ? Array<CE & BE>\n    : CurrentType & BrandedType\n  : CurrentType & BrandedType;\n\nexport type CombineBrandsIfNeeded<T, Required> = [T] extends [Required]\n  ? T[]\n  : HasBrand<T> extends true\n    ? CombineBrands<T, Required>[]\n    : Required[];\n\n/**\n * Makes type into a branded type, ensuring that value is assignable to\n * the base unbranded type. Optionally you can explicitly supply current value\n * type to combine both (useful for composite branded types. Make sure you\n * compose branded types which are not composite themselves.)\n */\nexport function toBrandedType<BrandedType>(value: UnbrandForValue<BrandedType>): BrandedType;\nexport function toBrandedType<BrandedType, CurrentType>(\n  value: CurrentType\n): CombineBrands<BrandedType, CurrentType>;\nexport function toBrandedType(value: unknown) {\n  return value;\n}\n\n// -----------------------------------------------------------------------------\n\n// Promise.try, adapted from https://github.com/sindresorhus/p-try\nexport const promiseTry = async <TValue, TArgs extends unknown[]>(\n  fn: (...args: TArgs) => PromiseLike<TValue> | TValue,\n  ...args: TArgs\n): Promise<TValue> => {\n  return new Promise(resolve => {\n    resolve(fn(...args));\n  });\n};\n\nexport const isAnyTrue = (...args: boolean[]): boolean =>\n  Math.max(...args.map(arg => (arg ? 1 : 0))) > 0;\n\nexport const safelyParseJSON = (json: string): Record<string, any> | null => {\n  try {\n    return JSON.parse(json);\n  } catch {\n    return null;\n  }\n};\n\n/**\n * use when you need to render unsafe string as HTML attribute, but MAKE SURE\n * the attribute is double-quoted when constructing the HTML string\n */\nexport const escapeDoubleQuotes = (str: string) => {\n  return str.replace(/\"/g, \"&quot;\");\n};\n\nexport const castArray = <T>(value: T | T[]): T[] => (Array.isArray(value) ? value : [value]);\n\n/** hack for Array.isArray type guard not working with readonly value[] */\nexport const isReadonlyArray = (value?: any): value is readonly any[] => {\n  return Array.isArray(value);\n};\n\nexport const sizeOf = (\n  value:\n    | readonly unknown[]\n    | Readonly<Map<string, unknown>>\n    | Readonly<Record<string, unknown>>\n    | ReadonlySet<unknown>\n): number => {\n  return isReadonlyArray(value)\n    ? value.length\n    : value instanceof Map || value instanceof Set\n      ? value.size\n      : Object.keys(value).length;\n};\n\nexport const reduceToCommonValue = <T, R = T>(\n  collection: readonly T[] | ReadonlySet<T>,\n  getValue?: (item: T) => R\n): R | null => {\n  if (sizeOf(collection) === 0) {\n    return null;\n  }\n\n  const valueExtractor = getValue || ((item: T) => item as unknown as R);\n\n  let commonValue: R | null = null;\n\n  for (const item of collection) {\n    const value = valueExtractor(item);\n    if ((commonValue === null || commonValue === value) && value != null) {\n      commonValue = value;\n    } else {\n      return null;\n    }\n  }\n\n  return commonValue;\n};\n\ntype FEATURE_FLAGS = {\n  COMPLEX_BINDINGS: boolean;\n};\n\nconst FEATURE_FLAGS_STORAGE_KEY = \"jsondraw-feature-flags\";\nconst DEFAULT_FEATURE_FLAGS: FEATURE_FLAGS = {\n  COMPLEX_BINDINGS: false,\n};\nlet featureFlags: FEATURE_FLAGS | null = null;\n\nexport const getFeatureFlag = <F extends keyof FEATURE_FLAGS>(flag: F): FEATURE_FLAGS[F] => {\n  if (!featureFlags) {\n    try {\n      const serializedFlags = localStorage.getItem(FEATURE_FLAGS_STORAGE_KEY);\n      if (serializedFlags) {\n        const flags = JSON.parse(serializedFlags);\n        featureFlags = flags ?? DEFAULT_FEATURE_FLAGS;\n      }\n    } catch {}\n  }\n\n  return (featureFlags || DEFAULT_FEATURE_FLAGS)[flag];\n};\n\nexport const setFeatureFlag = <F extends keyof FEATURE_FLAGS>(flag: F, value: FEATURE_FLAGS[F]) => {\n  try {\n    featureFlags = {\n      ...(featureFlags || DEFAULT_FEATURE_FLAGS),\n      [flag]: value,\n    };\n    localStorage.setItem(FEATURE_FLAGS_STORAGE_KEY, JSON.stringify(featureFlags));\n  } catch (e) {\n    console.error(\"unable to set feature flag\", e);\n  }\n};\n","import { nanoid } from \"nanoid\";\nimport { Random } from \"roughjs/bin/math\";\n\nimport { isTestEnv } from \"./utils\";\n\nlet random = new Random(Date.now());\nlet testIdBase = 0;\n\nexport const randomInteger = () => Math.floor(random.next() * 2 ** 31);\n\nexport const reseed = (seed: number) => {\n  random = new Random(seed);\n  testIdBase = 0;\n};\n\nexport const randomId = () => (isTestEnv() ? `id${testIdBase++}` : nanoid());\n","import { sanitizeUrl } from \"@braintree/sanitize-url\";\n\nimport { escapeDoubleQuotes } from \"./utils\";\n\nexport const normalizeLink = (link: string) => {\n  link = link.trim();\n  if (!link) {\n    return link;\n  }\n  return sanitizeUrl(escapeDoubleQuotes(link));\n};\n\nexport const isLocalLink = (link: string | null) => {\n  return !!(link?.includes(location.origin) || link?.startsWith(\"/\"));\n};\n\n/**\n * Returns URL sanitized and safe for usage in places such as\n * iframe's src attribute or <a> href attributes.\n */\nexport const toValidURL = (link: string) => {\n  link = normalizeLink(link);\n\n  // make relative links into fully-qualified urls\n  if (link.startsWith(\"/\")) {\n    return `${location.origin}${link}`;\n  }\n\n  try {\n    new URL(link);\n  } catch {\n    // if link does not parse as URL, assume invalid and return blank page\n    return \"about:blank\";\n  }\n\n  return link;\n};\n","import type { UnsubscribeCallback } from \"@jsondraw/jsondraw/types\";\n\ntype Subscriber<T extends any[]> = (...payload: T) => void;\n\nexport class Emitter<T extends any[] = []> {\n  public subscribers: Subscriber<T>[] = [];\n\n  /**\n   * Attaches subscriber\n   *\n   * @returns unsubscribe function\n   */\n  on(...handlers: Subscriber<T>[] | Subscriber<T>[][]): UnsubscribeCallback {\n    const _handlers = handlers\n      .flat()\n      .filter((item) => typeof item === \"function\");\n\n    this.subscribers.push(..._handlers);\n\n    return () => this.off(_handlers);\n  }\n\n  once(...handlers: Subscriber<T>[] | Subscriber<T>[][]): UnsubscribeCallback {\n    const _handlers = handlers\n      .flat()\n      .filter((item) => typeof item === \"function\");\n\n    _handlers.push(() => detach());\n\n    const detach = this.on(..._handlers);\n    return detach;\n  }\n\n  off(...handlers: Subscriber<T>[] | Subscriber<T>[][]) {\n    const _handlers = handlers.flat();\n    this.subscribers = this.subscribers.filter(\n      (handler) => !_handlers.includes(handler),\n    );\n  }\n\n  trigger(...payload: T) {\n    for (const handler of this.subscribers) {\n      handler(...payload);\n    }\n    return this;\n  }\n\n  clear() {\n    this.subscribers = [];\n  }\n}\n","export * from \"./binary-heap\";\nexport * from \"./bounds\";\nexport * from \"./colors\";\nexport * from \"./constants\";\nexport * from \"./font-metadata\";\nexport * from \"./queue\";\nexport * from \"./keys\";\nexport * from \"./points\";\nexport * from \"./promise-pool\";\nexport * from \"./random\";\nexport * from \"./url\";\nexport * from \"./utils\";\nexport * from \"./emitter\";\nexport * from \"./editorInterface\";\n","/**\n * Converter: JSON NodeData/EdgeData  JsonDraw Elements\n *\n * Maps the existing graph model (from jsonParser) into JsonDraw-compatible\n * element format so JSON data can be visualized on the JsonDraw whiteboard.\n */\nimport { FONT_FAMILY } from \"@jsondraw/common\";\nimport type { NodeData, EdgeData } from \"../../../../types/graph\";\n\n// JsonDraw element types (simplified)\ninterface JsonDrawBaseElement {\n  id: string;\n  type: string;\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n  angle: 0;\n  strokeColor: string;\n  backgroundColor: string;\n  fillStyle: \"solid\" | \"hachure\" | \"cross-hatch\";\n  strokeWidth: number;\n  roughness: number;\n  opacity: number;\n  groupIds: string[];\n  roundness: { type: number } | null;\n  seed: number;\n  version: number;\n  versionNonce: number;\n  isDeleted: false;\n  boundElements: { id: string; type: \"text\" | \"arrow\" }[] | null;\n  index: string | null;\n  updated: number;\n  link: null;\n  locked: false;\n  frameId: null;\n}\n\ninterface JsonDrawRectangleElement extends JsonDrawBaseElement {\n  type: \"rectangle\";\n}\n\ninterface JsonDrawTextElement extends JsonDrawBaseElement {\n  type: \"text\";\n  text: string;\n  fontSize: number;\n  fontFamily: number;\n  textAlign: \"left\" | \"center\" | \"right\";\n  verticalAlign: \"top\" | \"middle\" | \"bottom\";\n  containerId: string | null;\n  originalText: string;\n  autoResize: boolean;\n  lineHeight: number;\n}\n\n// Keeping local interface for now or import?\n// The file defined JsonDrawArrowElement locally but extended Base.\n// Wait, the original file had `interface JsonDrawArrowElement extends JsonDrawBaseElement`.\n// But it imported `JsonDrawArrowElement` type from packages/element/types?\n// Step 905 line 7: `import type { JsonDrawArrowElement } from ...`\n// But line 54 defines `interface JsonDrawArrowElement extends ...`.\n// This is shadowing or extending? TS allows interface merging but here it likely conflicts if imported as type.\n// Ah, line 7 imports it, but line 54 re-declares it?\n// Actually line 7 imports `JsonDrawArrowElement`.\n// And line 54 defines `interface JsonDrawArrowElement`.\n// This would be a specialized version or augmentation?\n// No, line 7 in Step 905 is: `import type { NodeData, EdgeData } from \"../../../../types/graph\";`\n// Wait. Line 7 is NodeData/EdgeData.\n// Where is JsonDrawArrowElement imported?\n// Ah, Step 900 replaced import but failed.\n// Step 905 shows the file content.\n// It does NOT import JsonDrawArrowElement in lines 1-10.\n// Let me check imports again.\n// Line 7: `import type { NodeData, EdgeData } ...`\n// Line 9: `// JsonDraw element types (simplified)`\n// Line 54: `interface JsonDrawArrowElement extends JsonDrawBaseElement`.\n// So it defines them LOCALLY. It does not import them (except maybe `JsonDrawElement` type at line 74 union).\n// Line 74: `type JsonDrawElement = ...`\n// So this file defines its OWN types that match JsonDraw's structure.\n// So I should rename these LOCAL interfaces to JsonDraw...\n// And I don't need to import `JsonDrawArrowElement` if I define it here.\n// But `jsonToJsonDrawElements` returns `JsonDrawElement[]`.\n// Use the local type.\n// So I will rename all local interfaces and the return type.\n\ninterface JsonDrawArrowElement extends JsonDrawBaseElement {\n  type: \"arrow\";\n  points: [number, number][];\n  startBinding: {\n    elementId: string;\n    focus: number;\n    gap: number;\n    fixedPoint: [number, number];\n  } | null;\n  endBinding: {\n    elementId: string;\n    focus: number;\n    gap: number;\n    fixedPoint: [number, number];\n  } | null;\n  startArrowhead: null;\n  endArrowhead: \"arrow\";\n  elbowed: boolean;\n}\n\ntype JsonDrawElement = JsonDrawRectangleElement | JsonDrawTextElement | JsonDrawArrowElement;\n\n// Simple random seed generator\nconst randomSeed = () => Math.floor(Math.random() * 2000000000);\nconst randomNonce = () => Math.floor(Math.random() * 2000000000);\n\nconst NODE_PADDING = 16;\nconst ROW_HEIGHT = 24;\nconst FONT_SIZE = 16;\nconst HORIZONTAL_GAP = 200;\nconst VERTICAL_GAP = 40;\n\n/**\n * Format node text content for display inside JsonDraw rectangle\n */\nconst formatNodeText = (node: NodeData): string => {\n  if (!node.text || node.text.length === 0) return \"\";\n\n  return node.text\n    .map(row => {\n      if (row.key !== null && row.key !== undefined) {\n        if (row.type === \"object\") return `${row.key}: {${row.childrenCount ?? 0} keys}`;\n        if (row.type === \"array\") return `${row.key}: [${row.childrenCount ?? 0} items]`;\n        if (row.value === null) return `${row.key}: null`;\n        return `${row.key}: ${row.value}`;\n      }\n      return `${row.value ?? \"\"}`;\n    })\n    .join(\"\\n\");\n};\n\n/**\n * Layout nodes using a simple layered approach (BFS by depth from root).\n * Returns map of nodeId  { x, y }.\n */\nconst layoutNodes = (\n  nodes: NodeData[],\n  edges: EdgeData[]\n): Map<string, { x: number; y: number }> => {\n  const positions = new Map<string, { x: number; y: number }>();\n\n  if (nodes.length === 0) return positions;\n\n  // Build adjacency list (parent  children)\n  const children = new Map<string, string[]>();\n  const hasParent = new Set<string>();\n\n  for (const edge of edges) {\n    const ch = children.get(edge.from) ?? [];\n    ch.push(edge.to);\n    children.set(edge.from, ch);\n    hasParent.add(edge.to);\n  }\n\n  // Find root nodes (no incoming edges)\n  const roots = nodes.filter(n => !hasParent.has(n.id)).map(n => n.id);\n  if (roots.length === 0 && nodes.length > 0) {\n    roots.push(nodes[0].id);\n  }\n\n  // BFS to assign layers\n  const nodeMap = new Map(nodes.map(n => [n.id, n]));\n  const layers: string[][] = [];\n  const visited = new Set<string>();\n  let queue = [...roots];\n\n  while (queue.length > 0) {\n    const layer: string[] = [];\n    const nextQueue: string[] = [];\n\n    for (const id of queue) {\n      if (visited.has(id)) continue;\n      visited.add(id);\n      layer.push(id);\n\n      const ch = children.get(id) ?? [];\n      for (const childId of ch) {\n        if (!visited.has(childId)) nextQueue.push(childId);\n      }\n    }\n\n    if (layer.length > 0) layers.push(layer);\n    queue = nextQueue;\n  }\n\n  // Also add any orphan nodes (not connected via edges)\n  const orphans = nodes.filter(n => !visited.has(n.id)).map(n => n.id);\n  if (orphans.length > 0) layers.push(orphans);\n\n  // Assign positions by layer (horizontal layout: layers go right)\n  let currentX = 50;\n\n  for (const layer of layers) {\n    let maxWidth = 0;\n    let currentY = 50;\n\n    for (const nodeId of layer) {\n      const node = nodeMap.get(nodeId);\n      if (!node) continue;\n\n      positions.set(nodeId, { x: currentX, y: currentY });\n      currentY += node.height + VERTICAL_GAP;\n      maxWidth = Math.max(maxWidth, node.width);\n    }\n\n    currentX += maxWidth + HORIZONTAL_GAP;\n  }\n\n  return positions;\n};\n\n/**\n * Convert Json-viz NodeData[] + EdgeData[]  JsonDraw elements\n */\nexport const jsonToJsonDrawElements = (nodes: NodeData[], edges: EdgeData[]): JsonDrawElement[] => {\n  const elements: JsonDrawElement[] = [];\n  const positions = layoutNodes(nodes, edges);\n\n  const now = Date.now();\n  let indexCounter = 0;\n  const getNextIndex = () => `a${(indexCounter++).toString().padStart(6, \"0\")}`;\n\n  // Map to track rectangle element IDs for arrow bindings\n  const rectIds = new Map<string, string>();\n\n  // Create rectangle + text for each node\n  for (const node of nodes) {\n    const pos = positions.get(node.id) ?? { x: 0, y: 0 };\n    const rectId = `rect-${node.id}`;\n    const textId = `text-${node.id}`;\n    const text = formatNodeText(node);\n\n    rectIds.set(node.id, rectId);\n\n    const width = Math.max(node.width + NODE_PADDING * 2, 120);\n    const textRows = node.text?.length ?? 1;\n    const height = Math.max(textRows * ROW_HEIGHT + NODE_PADDING * 2, 50);\n\n    // Collect arrow bindings for this rectangle\n    const boundElements: { id: string; type: \"text\" | \"arrow\" }[] = [{ id: textId, type: \"text\" }];\n\n    for (const edge of edges) {\n      if (edge.from === node.id || edge.to === node.id) {\n        boundElements.push({ id: `arrow-${edge.id}`, type: \"arrow\" });\n      }\n    }\n\n    // Rectangle element\n    const rect: JsonDrawRectangleElement = {\n      id: rectId,\n      type: \"rectangle\",\n      x: pos.x,\n      y: pos.y,\n      width,\n      height,\n      angle: 0,\n      strokeColor: \"#1e1e1e\",\n      backgroundColor: \"transparent\",\n      fillStyle: \"solid\",\n      strokeWidth: 1,\n      roughness: 1,\n      opacity: 100,\n      groupIds: [],\n      roundness: { type: 3 },\n      seed: randomSeed(),\n      version: 1,\n      versionNonce: randomNonce(),\n      isDeleted: false,\n      boundElements,\n      index: getNextIndex(),\n      updated: now,\n      link: null,\n      locked: false,\n      frameId: null,\n    };\n    elements.push(rect);\n\n    // Text element (bound to rectangle)\n    const textEl: JsonDrawTextElement = {\n      id: textId,\n      type: \"text\",\n      x: pos.x + NODE_PADDING,\n      y: pos.y + NODE_PADDING,\n      width: width - NODE_PADDING * 2,\n      height: height - NODE_PADDING * 2,\n      angle: 0,\n      strokeColor: \"#1e1e1e\",\n      backgroundColor: \"transparent\",\n      fillStyle: \"solid\",\n      strokeWidth: 1,\n      roughness: 1,\n      opacity: 100,\n      groupIds: [],\n      roundness: null,\n      seed: randomSeed(),\n      version: 1,\n      versionNonce: randomNonce(),\n      isDeleted: false,\n      boundElements: null,\n      index: getNextIndex(),\n      updated: now,\n      link: null,\n      locked: false,\n      frameId: null,\n      text,\n      fontSize: FONT_SIZE,\n      fontFamily: FONT_FAMILY.Excalifont,\n      textAlign: \"left\",\n      verticalAlign: \"top\",\n      containerId: rectId,\n      originalText: text,\n      autoResize: true,\n      lineHeight: 1.25,\n    };\n    elements.push(textEl);\n  }\n\n  // Create arrows for each edge\n  for (const edge of edges) {\n    const fromRectId = rectIds.get(edge.from);\n    const toRectId = rectIds.get(edge.to);\n    if (!fromRectId || !toRectId) continue;\n\n    const fromPos = positions.get(edge.from);\n    const toPos = positions.get(edge.to);\n    if (!fromPos || !toPos) continue;\n\n    const fromNode = nodes.find(n => n.id === edge.from);\n    const toNode = nodes.find(n => n.id === edge.to);\n    if (!fromNode || !toNode) continue;\n\n    const fromWidth = Math.max(fromNode.width + NODE_PADDING * 2, 120);\n    const fromHeight = Math.max((fromNode.text?.length ?? 1) * ROW_HEIGHT + NODE_PADDING * 2, 50);\n    const toHeight = Math.max((toNode.text?.length ?? 1) * ROW_HEIGHT + NODE_PADDING * 2, 50);\n\n    // Arrow starts from right edge of source, ends at left edge of target\n    const startX = fromPos.x + fromWidth;\n    const startY = fromPos.y + fromHeight / 2;\n    const endX = toPos.x;\n    const endY = toPos.y + toHeight / 2;\n\n    const arrow: JsonDrawArrowElement = {\n      id: `arrow-${edge.id}`,\n      type: \"arrow\",\n      x: startX,\n      y: startY,\n      width: Math.abs(endX - startX),\n      height: Math.abs(endY - startY),\n      angle: 0,\n      strokeColor: \"#1e1e1e\",\n      backgroundColor: \"transparent\",\n      fillStyle: \"solid\",\n      strokeWidth: 1,\n      roughness: 1,\n      opacity: 100,\n      groupIds: [],\n      roundness: { type: 2 },\n      seed: randomSeed(),\n      version: 1,\n      versionNonce: randomNonce(),\n      isDeleted: false,\n      boundElements: null,\n      index: getNextIndex(),\n      updated: now,\n      link: null,\n      locked: false,\n      frameId: null,\n      points: [\n        [0, 0],\n        [endX - startX, endY - startY],\n      ],\n      startBinding: {\n        elementId: fromRectId,\n        focus: 0,\n        gap: 5,\n        fixedPoint: [1, 0.5],\n      },\n      endBinding: {\n        elementId: toRectId,\n        focus: 0,\n        gap: 5,\n        fixedPoint: [0, 0.5],\n      },\n      startArrowhead: null,\n      endArrowhead: \"arrow\",\n      elbowed: false,\n    };\n    elements.push(arrow);\n  }\n\n  return elements;\n};\n","import pako from \"pako\";\n\n/**\n * Encode current jsondraw elements and app state into a base64 compressed string\n */\nexport const encodeDataToUrlHash = (elements: any[], appState: any): string => {\n  // We only keep the required fields from elements and appState\n  // to minimize the URI length\n  const data = {\n    elements: elements.filter(el => !el.isDeleted).map(el => ({ ...el, isDeleted: undefined })),\n    appState: {\n      viewBackgroundColor: appState.viewBackgroundColor,\n      theme: appState.theme,\n    },\n  };\n\n  const jsonString = JSON.stringify(data);\n  const compressed = pako.deflate(jsonString);\n\n  // Convert Uint8Array to Binary String\n  let binaryString = \"\";\n  const chunkSize = 8000;\n  for (let i = 0; i < compressed.length; i += chunkSize) {\n    binaryString += String.fromCharCode.apply(null, Array.from(compressed.slice(i, i + chunkSize)));\n  }\n\n  // Base64 encode\n  const base64 = typeof window !== \"undefined\" ? window.btoa(binaryString) : \"\";\n\n  // Make base64 url-safe if needed, but since it's in the hash, standard btoa is mostly fine.\n  return `#data=${encodeURIComponent(base64)}`;\n};\n\n/**\n * Decode from window.location.hash\n */\nexport const decodeDataFromUrlHash = (hash: string) => {\n  try {\n    const base64 = decodeURIComponent(hash.replace(\"#data=\", \"\"));\n    const binaryString = window.atob(base64);\n\n    const bytes = new Uint8Array(binaryString.length);\n    for (let i = 0; i < binaryString.length; i++) {\n      bytes[i] = binaryString.charCodeAt(i);\n    }\n\n    const decompressed = pako.inflate(bytes, { to: \"string\" });\n    return JSON.parse(decompressed);\n  } catch (error) {\n    console.error(\"Failed to decode sharelink data\", error);\n    return null;\n  }\n};\n","import React from \"react\";\nimport {\n  Box,\n  LoadingOverlay,\n  Modal,\n  Text,\n  Stack,\n  Button,\n  TextInput,\n  ActionIcon,\n} from \"@mantine/core\";\nimport styled from \"styled-components\";\nimport { toast } from \"react-hot-toast\";\nimport { FiCopy, FiCheck, FiLock, FiX } from \"react-icons/fi\";\nimport useConfig from \"../../../../store/useConfig\";\nimport useGraph from \"../GraphView/stores/useGraph\";\nimport { jsonToJsonDrawElements } from \"./jsonToJsonDraw\";\nimport { encodeDataToUrlHash, decodeDataFromUrlHash } from \"./shareLinkUtils\";\n\nconst StyledJsonDrawWrapper = styled.div<{ $ready: boolean }>`\n  width: 100%;\n  height: 100%;\n  position: relative;\n  opacity: ${({ $ready }) => ($ready ? 1 : 0)};\n  transition: opacity 0.2s ease;\n\n  .jsondraw-wrapper {\n    width: 100%;\n    height: 100%;\n  }\n`;\n\nexport const JsonDrawView = () => {\n  const nodes = useGraph(state => state.nodes);\n  const edges = useGraph(state => state.edges);\n  const darkmodeEnabled = useConfig(state => state.darkmodeEnabled);\n\n  const [JsonDrawModule, setJsonDrawModule] = React.useState<{\n    JsonDraw: React.ComponentType<any>;\n  } | null>(null);\n  const [drawReady, setDrawReady] = React.useState(false);\n\n  const jsonDrawAPIRef = React.useRef<any>(null);\n  const hasInitialized = React.useRef(false);\n  const hasUserDrawing = React.useRef(false);\n  const [showClearModal, setShowClearModal] = React.useState(false);\n  const [hasImage, setHasImage] = React.useState(false);\n\n  // Share Modal states\n  const [showShareModal, setShowShareModal] = React.useState(false);\n  const [shareUrl, setShareUrl] = React.useState(\"\");\n  const [justCopied, setJustCopied] = React.useState(false);\n  const copyTimerRef = React.useRef<number | null>(null);\n\n  // Auto-save to localStorage\n  const handleChange = React.useCallback((elements: any, appState: any, files: any) => {\n    hasUserDrawing.current = true;\n\n    const imgExists = elements.some((el: any) => el.type === \"image\" && !el.isDeleted);\n    setHasImage(prev => (prev !== imgExists ? imgExists : prev));\n\n    try {\n      localStorage.setItem(\n        \"jsondraw-autosave\",\n        JSON.stringify({ elements, appState: { theme: appState.theme, zoom: appState.zoom } })\n      );\n    } catch (error) {\n      console.warn(\"Failed to save to localStorage:\", error);\n    }\n  }, []);\n\n  // Set font asset path before loading JsonDraw\n  React.useEffect(() => {\n    if (typeof window !== \"undefined\") {\n      window.JSONDRAW_ASSET_PATH = \"/jsondraw-fonts/\"; // Keep asset path for now as fonts are there\n    }\n  }, []);\n\n  // Dynamic import to avoid SSR issues (Canvas API is client-only)\n  React.useEffect(() => {\n    import(\"../../../../jsondraw\").then(mod => {\n      setJsonDrawModule({ JsonDraw: mod.JsonDraw });\n      setDrawReady(false);\n    });\n  }, []);\n\n  const scrollToContent = React.useCallback((api: any, delay = 120) => {\n    requestAnimationFrame(() => {\n      setTimeout(() => {\n        api.scrollToContent(undefined, { fitToViewport: true, viewportZoomFactor: 0.8 });\n        setDrawReady(true);\n      }, delay);\n    });\n  }, []);\n\n  // Update scene elements when nodes/edges change AFTER API is ready\n  // BUT only if user hasn't drawn anything yet\n  React.useEffect(() => {\n    const api = jsonDrawAPIRef.current;\n    if (!api || nodes.length === 0 || hasUserDrawing.current) return;\n\n    const elements = jsonToJsonDrawElements(nodes, edges);\n    api.updateScene({ elements });\n    scrollToContent(api, 80);\n  }, [nodes, edges, scrollToContent]);\n\n  const handleJsonDrawAPI = React.useCallback(\n    (api: any) => {\n      jsonDrawAPIRef.current = api;\n\n      // Check URL for share link first\n      if (typeof window !== \"undefined\" && window.location.hash.startsWith(\"#data=\")) {\n        const decoded = decodeDataFromUrlHash(window.location.hash);\n        if (decoded && decoded.elements) {\n          hasUserDrawing.current = true;\n          hasInitialized.current = true;\n          setDrawReady(false);\n          requestAnimationFrame(() => {\n            api.updateScene({ elements: decoded.elements, appState: decoded.appState });\n            scrollToContent(api, 120);\n          });\n          return;\n        }\n      }\n\n      // Try to restore from localStorage first\n      const saved = localStorage.getItem(\"jsondraw-autosave\");\n      if (saved) {\n        try {\n          const { elements, appState } = JSON.parse(saved);\n          hasUserDrawing.current = true;\n          setDrawReady(false);\n          requestAnimationFrame(() => {\n            api.updateScene({ elements, appState });\n            scrollToContent(api, 120);\n          });\n          return;\n        } catch (error) {\n          console.warn(\"Failed to restore from localStorage:\", error);\n        }\n      }\n\n      // Set initial elements from JSON only if no saved drawing\n      if (nodes.length > 0 && !hasInitialized.current) {\n        hasInitialized.current = true;\n        const elements = jsonToJsonDrawElements(nodes, edges);\n        setDrawReady(false);\n\n        requestAnimationFrame(() => {\n          api.updateScene({ elements });\n          scrollToContent(api, 200);\n        });\n      }\n    },\n    [nodes, edges, scrollToContent]\n  );\n\n  const handleClearDrawing = React.useCallback(() => {\n    if (!jsonDrawAPIRef.current) return;\n\n    localStorage.removeItem(\"jsondraw-autosave\");\n    hasUserDrawing.current = false;\n    hasInitialized.current = false;\n\n    const elements = jsonToJsonDrawElements(nodes, edges);\n    jsonDrawAPIRef.current.updateScene({ elements });\n    setDrawReady(false);\n    scrollToContent(jsonDrawAPIRef.current, 120);\n\n    setShowClearModal(false);\n    toast.success(\"Drawing cleared! Loaded JSON visualization.\");\n  }, [nodes, edges, scrollToContent]);\n\n  const handleCopyLink = React.useCallback(() => {\n    navigator.clipboard\n      .writeText(shareUrl)\n      .then(() => {\n        setJustCopied(true);\n        if (copyTimerRef.current) window.clearTimeout(copyTimerRef.current);\n        copyTimerRef.current = window.setTimeout(() => setJustCopied(false), 3000) as any;\n      })\n      .catch(() => toast.error(\"Failed to copy link.\"));\n  }, [shareUrl]);\n\n  const handleShareClick = React.useCallback(() => {\n    const api = jsonDrawAPIRef.current;\n    if (!api) return;\n\n    const elements = api.getSceneElementsIncludingDeleted();\n    const appState = api.getAppState();\n\n    // Create compressed URL hash\n    const hash = encodeDataToUrlHash(elements, appState);\n    const url = `${window.location.origin}${window.location.pathname}${hash}`;\n\n    setShareUrl(url);\n    setShowShareModal(true);\n\n    // Warn if length is over 8000\n    if (url.length > 8000) {\n      toast.error(\"Shareable link is too large! Trnh duyt c th s khng m c y .\", {\n        duration: 5000,\n      });\n    }\n  }, []);\n\n  if (!JsonDrawModule) {\n    return (\n      <Box pos=\"relative\" h=\"100%\" w=\"100%\">\n        <LoadingOverlay visible />\n      </Box>\n    );\n  }\n\n  const { JsonDraw } = JsonDrawModule;\n\n  return (\n    <Box pos=\"relative\" h=\"100%\" w=\"100%\">\n      <LoadingOverlay visible={!drawReady} />\n      <Modal\n        opened={showClearModal}\n        onClose={() => setShowClearModal(false)}\n        title=\"Clear Drawing Session\"\n        centered\n      >\n        <Stack gap=\"md\">\n          <Text>\n            This will <strong>permanently delete</strong> your current drawing session and load a\n            fresh visualization from the JSON data.\n          </Text>\n          <Text c=\"dimmed\" size=\"sm\">\n            Make sure to save your work first. Your current drawing will be lost and cannot be\n            recovered.\n          </Text>\n          <Box style={{ display: \"flex\", gap: \"8px\", justifyContent: \"flex-end\" }}>\n            <Button variant=\"default\" onClick={() => setShowClearModal(false)}>\n              Cancel\n            </Button>\n            <Button color=\"red\" onClick={handleClearDrawing}>\n              Clear & Load JSON\n            </Button>\n          </Box>\n        </Stack>\n      </Modal>\n\n      <Modal\n        opened={showShareModal}\n        onClose={() => setShowShareModal(false)}\n        title={null}\n        withCloseButton={false}\n        centered\n        size=\"md\"\n        padding=\"xl\"\n        radius=\"lg\"\n        styles={{\n          content: {\n            backgroundColor: darkmodeEnabled ? \"#121212\" : \"#ffffff\",\n          },\n        }}\n      >\n        <Stack gap=\"lg\">\n          <Box style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\" }}>\n            <Text fw={700} size=\"xl\" style={{ fontFamily: \"Assistant, sans-serif\" }}>\n              Shareable link\n            </Text>\n            <ActionIcon variant=\"subtle\" color=\"gray\" onClick={() => setShowShareModal(false)}>\n              <FiX size={20} />\n            </ActionIcon>\n          </Box>\n          <Box style={{ display: \"flex\", gap: \"12px\", alignItems: \"flex-end\" }}>\n            <TextInput\n              label=\"Link\"\n              readOnly\n              value={shareUrl}\n              style={{ flex: 1 }}\n              styles={{\n                input: {\n                  backgroundColor: darkmodeEnabled ? \"rgba(255,255,255,0.05)\" : \"#f3f4f6\",\n                  border: \"none\",\n                  boxShadow: \"none\",\n                  height: 40,\n                },\n                label: {\n                  marginBottom: 8,\n                  fontSize: 12,\n                  fontWeight: 600,\n                  color: darkmodeEnabled ? \"#a3a3a3\" : \"#4b5563\",\n                },\n              }}\n              onClick={e => (e.target as HTMLInputElement).select()}\n            />\n            <Button\n              size=\"md\"\n              leftSection={justCopied ? <FiCheck size={18} /> : <FiCopy size={18} />}\n              color={justCopied ? \"teal\" : \"violet\"}\n              onClick={handleCopyLink}\n              style={{\n                height: 40,\n                minWidth: 120,\n                transition: \"background-color 0.2s\",\n              }}\n            >\n              Copy link\n            </Button>\n          </Box>\n          <Box\n            style={{\n              borderTop: `1px solid ${darkmodeEnabled ? \"#333\" : \"#e5e7eb\"}`,\n              paddingTop: 16,\n            }}\n          >\n            <Text\n              size=\"sm\"\n              c=\"dimmed\"\n              style={{ display: \"flex\", alignItems: \"center\", gap: \"8px\" }}\n            >\n              <FiLock size={16} /> D liu c nn v bo mt trong URL\n            </Text>\n          </Box>\n        </Stack>\n      </Modal>\n\n      <StyledJsonDrawWrapper $ready={drawReady}>\n        <div className=\"jsondraw-wrapper\">\n          <JsonDraw\n            jsondrawAPI={handleJsonDrawAPI}\n            onChange={handleChange}\n            viewModeEnabled={false}\n            zenModeEnabled={false}\n            gridModeEnabled={false}\n            theme={darkmodeEnabled ? \"dark\" : \"light\"}\n            UIOptions={{\n              canvasActions: {\n                export: { saveFileToDisk: true },\n                clearDrawing: () => setShowClearModal(true),\n              },\n            }}\n            initialData={{\n              appState: {\n                activeTool: {\n                  type: \"hand\",\n                  customType: null,\n                  lastActiveTool: null,\n                  locked: false,\n                  fromSelection: false,\n                },\n              },\n            }}\n            renderTopRightUI={(isMobile: boolean) => (\n              <Box px=\"md\">\n                <Button\n                  size=\"sm\"\n                  color=\"violet\"\n                  disabled={hasImage}\n                  onClick={handleShareClick}\n                  title={\n                    hasImage\n                      ? \"Can't share locally when an image is present due to URL size limits.\"\n                      : \"To link chia s min ph qua URL\"\n                  }\n                >\n                  Share View\n                </Button>\n              </Box>\n            )}\n          />\n        </div>\n      </StyledJsonDrawWrapper>\n    </Box>\n  );\n};\n","import React from \"react\";\nimport type { DefaultTheme } from \"styled-components\";\nimport { styled } from \"styled-components\";\nimport type { KeyPath } from \"react-json-tree\";\n\ninterface LabelProps {\n  keyPath: KeyPath;\n  nodeType: string;\n}\n\nfunction getLabelColor({ $type, theme }: { $type?: string; theme: DefaultTheme }) {\n  if ($type === \"Object\") return theme.NODE_COLORS.PARENT_OBJ;\n  if ($type === \"Array\") return theme.NODE_COLORS.PARENT_ARR;\n  return theme.NODE_COLORS.PARENT_OBJ;\n}\n\nconst StyledLabel = styled.span<{ $nodeType?: string }>`\n  color: ${({ theme, $nodeType }) => getLabelColor({ theme, $type: $nodeType })};\n\n  &:hover {\n    filter: brightness(1.5);\n    transition: filter 0.2s ease-in-out;\n  }\n`;\n\nexport const Label = ({ keyPath, nodeType }: LabelProps) => {\n  return <StyledLabel $nodeType={nodeType}>{keyPath[0]}:</StyledLabel>;\n};\n","import React from \"react\";\nimport type { DefaultTheme } from \"styled-components\";\nimport { useTheme } from \"styled-components\";\nimport { TextRenderer } from \"../GraphView/CustomNode/TextRenderer\";\n\ntype TextColorFn = {\n  theme: DefaultTheme;\n  $value?: string | unknown;\n};\n\nfunction getValueColor({ $value, theme }: TextColorFn) {\n  if ($value && !Number.isNaN(+$value)) return theme.NODE_COLORS.INTEGER;\n  if ($value === \"true\") return theme.NODE_COLORS.BOOL.TRUE;\n  if ($value === \"false\") return theme.NODE_COLORS.BOOL.FALSE;\n  if ($value === \"null\") return theme.NODE_COLORS.NULL;\n\n  // default\n  return theme.NODE_COLORS.NODE_VALUE;\n}\n\ninterface ValueProps {\n  valueAsString: unknown;\n  value: unknown;\n}\n\nexport const Value = (props: ValueProps) => {\n  const theme = useTheme();\n  const { valueAsString, value } = props;\n\n  return (\n    <span\n      style={{\n        color: getValueColor({\n          theme,\n          $value: valueAsString,\n        }),\n      }}\n    >\n      <TextRenderer>{JSON.stringify(value)}</TextRenderer>\n    </span>\n  );\n};\n","import React from \"react\";\nimport { useTheme } from \"styled-components\";\nimport { JSONTree } from \"react-json-tree\";\nimport useJson from \"../../../../store/useJson\";\nimport { Label } from \"./Label\";\nimport { Value } from \"./Value\";\n\nexport const TreeView = () => {\n  const theme = useTheme();\n  const json = useJson(state => state.json);\n\n  return (\n    <JSONTree\n      hideRoot\n      data={JSON.parse(json)}\n      valueRenderer={(valueAsString, value) => <Value {...{ valueAsString, value }} />}\n      labelRenderer={(keyPath, nodeType) => <Label {...{ keyPath, nodeType }} />}\n      theme={{\n        extend: {\n          overflow: \"scroll\",\n          height: \"100%\",\n          scheme: \"monokai\",\n          author: \"wimer hazenberg (http://www.monokai.nl)\",\n          base00: theme.GRID_BG_COLOR,\n        },\n      }}\n    />\n  );\n};\n","import React from \"react\";\nimport { useSessionStorage } from \"@mantine/hooks\";\nimport styled from \"styled-components\";\nimport { ViewMode } from \"../../enums/viewMode.enum\";\nimport { JsonDrawView } from \"./views/JsonDrawView\";\nimport { GraphView } from \"./views/GraphView\";\nimport { TreeView } from \"./views/TreeView\";\n\nconst StyledLiveEditor = styled.div`\n  position: relative;\n  height: 100%;\n  background: ${({ theme }) => theme.GRID_BG_COLOR};\n  overflow: auto;\n  cursor: url(\"/assets/cursor.svg\"), auto;\n\n  & > ul {\n    margin-top: 0 !important;\n    padding: 12px !important;\n    font-family: monospace;\n    font-size: 14px;\n    font-weight: 500;\n  }\n\n  .tab-group {\n    position: absolute;\n    top: 10px;\n    left: 10px;\n    z-index: 2;\n  }\n`;\n\nconst View = () => {\n  const [viewMode] = useSessionStorage({\n    key: \"viewMode\",\n    defaultValue: ViewMode.Graph,\n  });\n\n  if (viewMode === ViewMode.Graph) return <GraphView />;\n  if (viewMode === ViewMode.Tree) return <TreeView />;\n  if (viewMode === ViewMode.JsonDraw) return <JsonDrawView />;\n  return null;\n};\n\nconst LiveEditor = () => {\n  return (\n    <StyledLiveEditor onContextMenuCapture={e => e.preventDefault()}>\n      <View />\n    </StyledLiveEditor>\n  );\n};\n\nexport default LiveEditor;\n","import { degreesToRadians } from \"./angle\";\nimport { PRECISION } from \"./utils\";\nimport { vectorFromPoint, vectorScale } from \"./vector\";\n\nimport type {\n  LocalPoint,\n  GlobalPoint,\n  Radians,\n  Degrees,\n  Vector,\n} from \"./types\";\n\n/**\n * Create a properly typed Point instance from the X and Y coordinates.\n *\n * @param x The X coordinate\n * @param y The Y coordinate\n * @returns The branded and created point\n */\nexport function pointFrom<Point extends GlobalPoint | LocalPoint>(\n  x: number,\n  y: number,\n): Point {\n  return [x, y] as Point;\n}\n\n/**\n * Converts and remaps an array containing a pair of numbers to Point.\n *\n * @param numberArray The number array to check and to convert to Point\n * @returns The point instance\n */\nexport function pointFromArray<Point extends GlobalPoint | LocalPoint>(\n  numberArray: number[],\n): Point | undefined {\n  return numberArray.length === 2\n    ? pointFrom<Point>(numberArray[0], numberArray[1])\n    : undefined;\n}\n\n/**\n * Converts and remaps a pair of numbers to Point.\n *\n * @param pair A number pair to convert to Point\n * @returns The point instance\n */\nexport function pointFromPair<Point extends GlobalPoint | LocalPoint>(\n  pair: [number, number],\n): Point {\n  return pair as Point;\n}\n\n/**\n * Convert a vector to a point.\n *\n * @param v The vector to convert\n * @returns The point the vector points at with origin 0,0\n */\nexport function pointFromVector<P extends GlobalPoint | LocalPoint>(\n  v: Vector,\n  offset: P = pointFrom(0, 0),\n): P {\n  return pointFrom<P>(offset[0] + v[0], offset[1] + v[1]);\n}\n\n/**\n * Checks if the provided value has the shape of a Point.\n *\n * @param p The value to attempt verification on\n * @returns TRUE if the provided value has the shape of a local or global point\n */\nexport function isPoint(p: unknown): p is LocalPoint | GlobalPoint {\n  return (\n    Array.isArray(p) &&\n    p.length === 2 &&\n    typeof p[0] === \"number\" &&\n    !isNaN(p[0]) &&\n    typeof p[1] === \"number\" &&\n    !isNaN(p[1])\n  );\n}\n\n/**\n * Compare two points coordinate-by-coordinate and if\n * they are closer than INVERSE_PRECISION it returns TRUE.\n *\n * @param a Point The first point to compare\n * @param b Point The second point to compare\n * @returns TRUE if the points are sufficiently close to each other\n */\nexport function pointsEqual<Point extends GlobalPoint | LocalPoint>(\n  a: Point,\n  b: Point,\n  tolerance: number = PRECISION,\n): boolean {\n  const abs = Math.abs;\n  return abs(a[0] - b[0]) < tolerance && abs(a[1] - b[1]) < tolerance;\n}\n\n/**\n * Rotate a point by [angle] radians.\n *\n * @param point The point to rotate\n * @param center The point to rotate around, the center point\n * @param angle The radians to rotate the point by\n * @returns The rotated point\n */\nexport function pointRotateRads<Point extends GlobalPoint | LocalPoint>(\n  [x, y]: Point,\n  [cx, cy]: Point,\n  angle: Radians,\n): Point {\n  return pointFrom(\n    (x - cx) * Math.cos(angle) - (y - cy) * Math.sin(angle) + cx,\n    (x - cx) * Math.sin(angle) + (y - cy) * Math.cos(angle) + cy,\n  );\n}\n\n/**\n * Rotate a point by [angle] degree.\n *\n * @param point The point to rotate\n * @param center The point to rotate around, the center point\n * @param angle The degree to rotate the point by\n * @returns The rotated point\n */\nexport function pointRotateDegs<Point extends GlobalPoint | LocalPoint>(\n  point: Point,\n  center: Point,\n  angle: Degrees,\n): Point {\n  return pointRotateRads(point, center, degreesToRadians(angle));\n}\n\n/**\n * Translate a point by a vector.\n *\n * WARNING: This is not for translating JsonDraw element points!\n *          You need to account for rotation on base coordinates\n *          on your own.\n *          CONSIDER USING AN APPROPRIATE ELEMENT-AWARE TRANSLATE!\n *\n * @param p The point to apply the translation on\n * @param v The vector to translate by\n * @returns\n */\n// TODO 99% of use is translating between global and local coords, which need to be formalized\nexport function pointTranslate<\n  From extends GlobalPoint | LocalPoint,\n  To extends GlobalPoint | LocalPoint,\n>(p: From, v: Vector = [0, 0] as Vector): To {\n  return pointFrom(p[0] + v[0], p[1] + v[1]);\n}\n\n/**\n * Find the center point at equal distance from both points.\n *\n * @param a One of the points to create the middle point for\n * @param b The other point to create the middle point for\n * @returns The middle point\n */\nexport function pointCenter<P extends LocalPoint | GlobalPoint>(a: P, b: P): P {\n  return pointFrom((a[0] + b[0]) / 2, (a[1] + b[1]) / 2);\n}\n\n/**\n * Calculate the distance between two points.\n *\n * @param a First point\n * @param b Second point\n * @returns The euclidean distance between the two points.\n */\nexport function pointDistance<P extends LocalPoint | GlobalPoint>(\n  a: P,\n  b: P,\n): number {\n  return Math.hypot(b[0] - a[0], b[1] - a[1]);\n}\n\n/**\n * Calculate the squared distance between two points.\n *\n * Note: Use this if you only compare distances, it saves a square root.\n *\n * @param a First point\n * @param b Second point\n * @returns The euclidean distance between the two points.\n */\nexport function pointDistanceSq<P extends LocalPoint | GlobalPoint>(\n  a: P,\n  b: P,\n): number {\n  const xDiff = b[0] - a[0];\n  const yDiff = b[1] - a[1];\n\n  return xDiff * xDiff + yDiff * yDiff;\n}\n\n/**\n * Scale a point from a given origin by the multiplier.\n *\n * @param p The point to scale\n * @param mid The origin to scale from\n * @param multiplier The scaling factor\n * @returns\n */\nexport const pointScaleFromOrigin = <P extends GlobalPoint | LocalPoint>(\n  p: P,\n  mid: P,\n  multiplier: number,\n) => pointTranslate(mid, vectorScale(vectorFromPoint(p, mid), multiplier));\n\n/**\n * Returns whether `q` lies inside the segment/rectangle defined by `p` and `r`.\n * This is an approximation to \"does `q` lie on a segment `pr`\" check.\n *\n * @param p The first point to compare against\n * @param q The actual point this function checks whether is in between\n * @param r The other point to compare against\n * @returns TRUE if q is indeed between p and r\n */\nexport const isPointWithinBounds = <P extends GlobalPoint | LocalPoint>(\n  p: P,\n  q: P,\n  r: P,\n) => {\n  return (\n    q[0] <= Math.max(p[0], r[0]) &&\n    q[0] >= Math.min(p[0], r[0]) &&\n    q[1] <= Math.max(p[1], r[1]) &&\n    q[1] >= Math.min(p[1], r[1])\n  );\n};\n"],"names":["vector","x","y","originX","originY","vectorFromPoint","p","origin","threshold","defaultValue","vec","vectorMagnitudeSq","vectorCross","a","b","vectorDot","vectorAdd","vectorSubtract","start","end","vectorScale","v","scalar","vectorNormalize","m","Math","vectorMagnitude","sqrt","normalizeRadians","angle","PI","degreesToRadians","degrees","radiansToDegrees","isRightAngleRads","rads","abs","sin","PRECISION","radiansBetweenAngles","min","max","radiansDifference","diff","LegendreGaussN24TValues","curve","c","d","bezierEquation","t","pointFrom","calculate","t0","s0","l","solution","lineSegment","tolerance","iterLimit","error","Infinity","iter","bt","bt2","bt3","t0_2","t0_3","bezierX","bezierY","lineX","lineY","fx","fy","dfx_dt","dfy_dt","dfx_ds","dfy_ds","det","invDet","dt","ds","s","curveIntersectLineSegment","initial_guesses","curvePointDistance","closest","curveClosestPoint","closestStep","step","maxSteps","pointDistance","localMinimum","f","e","t1","k","n","curveTangent","p0","p1","p2","p3","curveCatmullRomCubicApproxPoints","points","tension","length","pointSets","i","tangent1","tangent2","cp1x","cp1y","cp2x","cp2y","push","curveOffsetPoints","offset","steps","offsetPoints","point","tangent","normal","vectorNormal","pointFromVector","curveLength","sum","derivativeVector","z2","magnitude","LegendreGaussN24CValues","curvePointAtLength","percent","totalLength","targetLength","tMin","tMax","currentLength","iteration","maxIterations","curveLengthAtParameter","z1","parameter","polygon","polygonClose","polygonFromPoints","polygonIncludesPointNonZero","windingNumber","j","xi","yi","xj","yj","polygonIsClosed","pointsEqual","rangeInclusive","toBrandedType","rangesOverlap","a0","a1","b0","b1","rangeIntersection","rangeStart","rangeEnd","value","rectangle","topLeft","bottomRight","pointOnLineSegment","line","distance","distanceToLineSegment","xx","yy","x1","y1","x2","y2","C","D","len_sq","param","dot","A","B","dx","dy","lineSegmentIntersectionPoints","candidate","linesIntersectAt","A1","B1","A2","B2","C1","C2","lineSegmentsDistance","s1","s2","triangleIncludesPoint","triangleSign","d1","d2","d3","has_neg","has_pos","clamp","round","precision","func","multiplier","pow","Number","EPSILON","factor","isFinite","isCloseTo","BinaryHeap","scoreFunction","content","sinkDown","idx","node","nodeScore","parentN","parent","bubbleUp","score","child1N","child2N","smallestIdx","smallestScore","child1Score","child2Score","pop","result","remove","indexOf","size","rescoreElement","EVENT","UserIdleState","DARK_MODE_COLORS_CACHE","Map","applyDarkModeFilter","r","g","cached","get","color","tc","tinycolor","alpha","getAlpha","rgb","toRgb","inverted","cssInvert","invertedR","invertComponent","invertedG","invertedB","rotated","red","green","cssHueRotate","blue","cos","newR","matrix","newG","newB","rgbToHex","set","DEFAULT_CHART_COLOR_INDEX","DEFAULT_ELEMENT_STROKE_COLOR_INDEX","transparent","black","white","gray","pink","grape","violet","cyan","teal","yellow","orange","bronze","keys","pick","reduce","acc","key","source","COLOR_PALETTE","DEFAULT_ELEMENT_STROKE_PICKS","DEFAULT_ELEMENT_BACKGROUND_COLOR_INDEX","COMMON_ELEMENT_SHADES","getAllColorsSpecificShade","index","hex6","toString","slice","undefined","alphaHex","padStart","COLOR_OUTLINE_CONTRAST_THRESHOLD","isTransparent","isValid","calculateContrast","normalizeInputColor","trim","getFormat","startsWith","supportsResizeObserver","window","TEXT_AUTOWRAP_THRESHOLD","TEXT","CROSSHAIR","GRABBING","GRAB","POINTER","MOVE","AUTO","MAIN","WHEEL","SECONDARY","TOUCH","ERASER","enabled","disabled","inheritFromUI","YOUTUBE_STATES","UNSTARTED","ENDED","PLAYING","PAUSED","BUFFERING","CUED","SIDEBAR","SHAPE_ACTIONS_MENU","ZOOM_ACTIONS","SEARCH_MENU_INPUT_WRAPPER","CONVERT_ELEMENT_TYPE_POPUP","SHAPE_ACTIONS_THEME_SCOPE","FRAME_NAME","DROPDOWN_MENU_EVENT_WRAPPER","sm","md","lg","xl","Virgil","Helvetica","Cascadia","Excalifont","Nunito","Assistant","CJK_HAND_DRAWN_FALLBACK_FONT","SANS_SERIF_GENERIC_FONT","MONOSPACE_GENERIC_FONT","WINDOWS_EMOJI_FALLBACK_FONT","FONT_FAMILY_GENERIC_FALLBACKS","genericFallbackFont","getGenericFontFamilyFallback","fontFamily","FONT_FAMILY","THEME","LIGHT","DARK","strokeColor","strokeWidth","strokeStyle","fillStyle","roughness","roundness","backgroundColor","radius","nameOffsetY","nameColorLightTheme","nameColorDarkTheme","nameFontSize","nameLineHeight","DEFAULT_COLLISION_THRESHOLD","DEFAULT_TRANSFORM_HANDLE_SPACING","SIDE_RESIZING_THRESHOLD","COLOR_WHITE","COLOR_CHARCOAL_BLACK","COLOR_VOICE_CALL","svg","png","jpg","gif","webp","bmp","ico","avif","jfif","MIME_TYPES","text","html","json","jsondraw","jsondrawClipboard","jsondrawlib","jsondrawlibIds","binary","IMAGE_MIME_TYPES","Object","values","clipboard","jsondrawLibrary","jsondrawClipboardWithAPI","JSONDRAW_EXPORT_SOURCE","location","MIN_ZOOM","MAX_ZOOM","canvasActions","changeViewBackgroundColor","clearCanvas","export","saveFileToDisk","loadScene","saveToActiveFile","toggleTheme","saveAsImage","tools","image","SVG_NS","ARROW_LABEL_WIDTH_FRACTION","ARROW_LABEL_FONT_SIZE_TO_MIN_WIDTH_RATIO","TOP","MIDDLE","BOTTOM","LEFT","CENTER","RIGHT","DEFAULT_ADAPTIVE_RADIUS","LEGACY","PROPORTIONAL_RADIUS","ADAPTIVE_RADIUS","architect","artist","cartoonist","thin","bold","extraBold","ROUGHNESS","opacity","locked","name","defaultTab","LIBRARY_SIDEBAR_TAB","Set","selection","lasso","diamond","ellipse","arrow","freedraw","eraser","hand","frame","magicframe","embeddable","laser","OAI_API_KEY","MERMAID_TO_JSONDRAW","PUBLISH_LIBRARY","generalStats","elementProperties","sharp","elbow","ELEMENT_LINK_KEY","Symbol","for","LINE_POLYGON_POINT_MERGE_DISTANCE","background","metrics","unitsPerEm","ascender","descender","lineHeight","deprecated","local","private","FONT_FAMILY_FALLBACKS","Xiaolai","fallback","LATIN","LATIN_EXT","CYRILIC_EXT","CYRILIC","VIETNAMESE","getVerticalOffset","fontSize","lineHeightPx","FONT_METADATA","fontSizeEm","Queue","tick","running","job","jobs","shift","promise","resolve","promiseTry","jobFactory","args","finally","resolvablePromise","DESKTOP_UI_MODE_STORAGE_KEY","MQ_MIN_WIDTH_DESKTOP","MQ_RIGHT_SIDEBAR_MIN_WIDTH","test","navigator","platform","userAgent","isIOS","includes","document","brave","isBrave","editorWidth","editorHeight","minSide","width","isMobileBreakpoint","height","MQ_MAX_MOBILE","MQ_MAX_WIDTH_LANDSCAPE","isTabletBreakpoint","maxSide","MQ_MAX_TABLET","deriveStylesPanelMode","editorInterface","formFactor","desktopUIMode","createUserAgentDescriptor","isAndroid","normalizedUA","isMobileDevice","isMobileOrTablet","ua","uaData","userAgentData","plat","toLowerCase","mobile","matchMedia","matches","isDesktopOS","isAndroidPhone","isAndroidTablet","stored","localStorage","getItem","mode","setItem","EQUAL","MINUS","NUM_ADD","NUM_SUBTRACT","NUM_ZERO","BRACKET_RIGHT","BRACKET_LEFT","ONE","TWO","THREE","NINE","QUOTE","ZERO","SLASH","H","V","Z","Y","R","S","ARROW_DOWN","ARROW_LEFT","ARROW_RIGHT","ARROW_UP","PAGE_UP","PAGE_DOWN","BACKSPACE","ALT","CTRL_OR_CMD","isDarwin","DELETE","ENTER","ESCAPE","QUESTION_MARK","SPACE","TAB","CHEVRON_LEFT","CHEVRON_RIGHT","PERIOD","COMMA","SUBTRACT","E","F","G","I","L","O","P","Q","T","X","K","W","KeyCodeMap","KEYS","CODES","matchKey","event","code","Boolean","isLatinChar","altKey","shiftKey","xs","map","ys","dimension","newSize","normalize","coordinates","maxCoordinate","minCoordinate","scale","nextMinCoordinate","scaledPoints","newCoordinate","newPoint","translation","pointFromPair","scaledPoint","currentDimension","gridSize","PromisePool","concurrency","entries","pool","Pool","all","listener","data","addEventListener","then","setTimeout","removeEventListener","getDateTime","date","Date","year","getFullYear","month","getMonth","day","getDate","hr","getHours","getMinutes","str","charAt","toUpperCase","target","HTMLElement","className","dataset","type","HTMLBRElement","HTMLInputElement","HTMLTextAreaElement","HTMLSelectElement","isInputLike","Element","isWritableElement","getFontFamilyString","fontFamilyString","id","getFontFamilyFallbacks","nextAnimationFrame","cb","requestAnimationFrame","fn","timeout","handle","lastArgs","ret","clearTimeout","flush","_lastArgs","cancel","opts","timerId","lastArgsTrailing","scheduleFunc","trailing","cancelAnimationFrame","easeOutInterpolate","from","to","progress","easeOut","easeToValuesRAF","fromValues","toValues","onStep","duration","interpolateValue","onStart","onEnd","onCancel","startTime","canceled","frameId","timestamp","elapsed","newValues","forEach","_key","startValue","endValue","chunk","array","resIndex","Array","ceil","updateActiveTool","appState","activeTool","customType","lastActiveTool","lastActiveToolBeforeEraser","fromSelection","viewportCoordsToSceneCoords","clientX","clientY","zoom","offsetLeft","offsetTop","scrollX","scrollY","sceneCoordsToViewportCoords","sceneX","sceneY","getGlobalCSSVariable","getComputedStyle","documentElement","getPropertyValue","RE_RTL_CHECK","RS_LTR_CHARS","RS_RTL_CHARS","isRTL","tupleToCoors","xyTuple","console","warn","fromIndex","collection","iteratee","reject","Promise","_resolve","_reject","element","parentElement","body","overflowY","scrollHeight","clientHeight","tabIndex","focus","bytesToHexString","bytes","byte","join","getUpdatedTimestamp","isTestEnv","now","items","arrayToMapWithIndex","elements","arrayToObject","groupBy","curr","prev","next","prevNode","firstNode","isArray","toArray","toIterable","isDevEnv","ENV","isProdEnv","TEST","isServerEnv","process","wrapEvent","nativeEvent","CustomEvent","NODE_ENV","detail","cancelable","updateObject","obj","updates","didChange","self","top","isPromiseLike","queryFocusableElements","focusableElements","container","querySelectorAll","filter","_defaultIsShallowComparatorFallback","isShallowEqual","objA","objB","comparators","debug","aKeys","bKeys","every","comparator","originalEventHandler","ourEventHandler","checkForDefaultPrevented","handleEvent","defaultPrevented","assertNever","message","softAssert","invariant","condition","memoize","lastResult","currentArgs","argsAreEqual","clear","has","hasOwnProperty","cloneJSON","JSON","parse","stringify","updateStable","prevValue","nextValue","options","getSvgPathFromStroke","closed","len","toFixed","average","normalizeEOL","replace","isAnyTrue","arg","castArray","reduceToCommonValue","getValue","sizeOf","valueExtractor","item","commonValue","COMPLEX_BINDINGS","featureFlags","getFeatureFlag","serializedFlags","FEATURE_FLAGS_STORAGE_KEY","DEFAULT_FEATURE_FLAGS","flag","Random","testIdBase","randomInteger","floor","random","randomId","nanoid","normalizeLink","link","sanitizeUrl","escapeDoubleQuotes","isLocalLink","toValidURL","URL","Emitter","on","handlers","_handlers","flat","subscribers","off","once","detach","handler","trigger","payload","randomSeed","randomNonce","formatNodeText","row","childrenCount","jsonToJsonDrawElements","nodes","edges","positions","children","hasParent","edge","ch","add","roots","nodeMap","layers","visited","queue","layer","nextQueue","childId","orphans","currentX","maxWidth","currentY","nodeId","VERTICAL_GAP","HORIZONTAL_GAP","indexCounter","getNextIndex","rectIds","pos","rectId","textId","NODE_PADDING","textRows","ROW_HEIGHT","boundElements","rect","groupIds","seed","version","versionNonce","isDeleted","updated","textEl","FONT_SIZE","textAlign","verticalAlign","containerId","originalText","autoResize","fromRectId","toRectId","fromPos","toPos","fromNode","find","toNode","fromWidth","fromHeight","toHeight","startX","endX","endY","startY","startBinding","elementId","gap","fixedPoint","endBinding","startArrowhead","endArrowhead","elbowed","StyledJsonDrawWrapper","styled","div","$ready","JsonDrawView","useGraph","state","darkmodeEnabled","useConfig","JsonDrawModule","setJsonDrawModule","React","drawReady","setDrawReady","jsonDrawAPIRef","hasInitialized","hasUserDrawing","showClearModal","setShowClearModal","hasImage","setHasImage","showShareModal","setShowShareModal","shareUrl","setShareUrl","justCopied","setJustCopied","copyTimerRef","handleChange","files","current","imgExists","some","el","theme","JSONDRAW_ASSET_PATH","mod","JsonDraw","scrollToContent","api","delay","fitToViewport","viewportZoomFactor","updateScene","handleJsonDrawAPI","hash","decoded","decodeDataFromUrlHash","base64","decodeURIComponent","binaryString","atob","Uint8Array","charCodeAt","decompressed","pako","saved","handleClearDrawing","removeItem","toast","success","handleCopyLink","writeText","catch","handleShareClick","encodeDataToUrlHash","jsonString","viewBackgroundColor","compressed","chunkSize","String","fromCharCode","apply","encodeURIComponent","getSceneElementsIncludingDeleted","getAppState","url","pathname","Box","h","w","LoadingOverlay","visible","Modal","opened","onClose","title","centered","Stack","Text","strong","style","display","justifyContent","Button","variant","onClick","withCloseButton","padding","styles","alignItems","fw","ActionIcon","FiX","TextInput","label","readOnly","flex","input","border","boxShadow","marginBottom","fontWeight","select","leftSection","FiCheck","FiCopy","minWidth","transition","borderTop","paddingTop","FiLock","jsondrawAPI","onChange","viewModeEnabled","zenModeEnabled","gridModeEnabled","UIOptions","clearDrawing","initialData","renderTopRightUI","px","StyledLabel","span","$nodeType","getLabelColor","$type","NODE_COLORS","PARENT_OBJ","PARENT_ARR","Label","keyPath","nodeType","Value","useTheme","valueAsString","props","getValueColor","$value","isNaN","INTEGER","BOOL","TRUE","FALSE","NULL","NODE_VALUE","TextRenderer","useJson","JSONTree","hideRoot","valueRenderer","labelRenderer","extend","overflow","scheme","author","base00","GRID_BG_COLOR","View","viewMode","useSessionStorage","ViewMode","Graph","GraphView","Tree","TreeView","StyledLiveEditor","onContextMenuCapture","LiveEditor","preventDefault","pointFromArray","numberArray","pair","pointRotateRads","cx","cy","pointTranslate","pointCenter","hypot","pointDistanceSq","xDiff","yDiff","pointScaleFromOrigin","mid","isPointWithinBounds","q"],"sourceRoot":"","ignoreList":[]}