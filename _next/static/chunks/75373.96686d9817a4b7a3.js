"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[75373],{75373:(e,t,r)=>{r.r(t),r.d(t,{default:()=>ed});var n=r(37876),l=r(14232),a=r(38335),o=r(31158),i=r(53070),s=r(70671),c=r(95171),d=r(44969),u=r(79021),f=r(45050),h=r(44193),p=r(11210),g=r(31408),m=r(87871),x=r(74188),w=r(34826),y=r(52509),b=r(97685),j=r(18571),k=r(76664),S=r(79501),C=r(98417),v=r(51641),E=r(9456);let A=o.Ay.div.withConfig({componentId:"sc-6476bd35-0"})(["display:flex;flex-direction:row;align-items:flex-start;gap:1rem;padding:1.75rem 2rem;border-radius:0.5rem;background:",";color:",";@media (max-width:600px){flex-direction:column;text-align:center;align-items:center;}"],({$dark:e})=>e?"rgba(220, 38, 38, 0.12)":"#fef2f2",({$dark:e})=>e?"#fca5a5":"#991b1b"),z=o.Ay.div.withConfig({componentId:"sc-6476bd35-1"})(["display:flex;align-items:center;justify-content:center;flex-shrink:0;width:3rem;height:3rem;border-radius:50%;background:",";svg{width:1.4rem;height:1.4rem;color:",";}"],({$dark:e})=>e?"rgba(220, 38, 38, 0.2)":"#fee2e2",({$dark:e})=>e?"#f87171":"#dc2626"),R=o.Ay.div.withConfig({componentId:"sc-6476bd35-2"})(["display:flex;flex-direction:column;align-items:center;padding:1.5rem;gap:0.75rem;text-align:center;h4{margin:0;font-weight:700;font-size:1.125rem;color:",";}p{margin:0;font-size:0.875rem;color:",";line-height:1.5;}"],({$dark:e})=>e?"#e5e5e5":"#1f2937",({$dark:e})=>e?"#a3a3a3":"#6b7280"),O=o.Ay.div.withConfig({componentId:"sc-6476bd35-3"})(["flex:1;min-width:0;font-size:0.95rem;line-height:1.5;color:",";strong{color:",";}@media (max-width:600px){text-align:center;}"],({$dark:e})=>e?"#fca5a5":"#991b1b",({$dark:e})=>e?"#f87171":"#dc2626"),I=({opened:e,darkMode:t,onReplace:r,onClose:l,onSaveToDisk:a,title:o,message:i})=>(0,n.jsx)(d.a,{opened:e,onClose:l,title:null,withCloseButton:!1,centered:!0,size:700,padding:"xl",radius:"lg",styles:{content:{backgroundColor:t?"#1e1e1e":"#ffffff"},overlay:{backgroundColor:t?"rgba(0, 0, 0, 0.7)":"rgba(0, 0, 0, 0.4)"}},children:(0,n.jsxs)(u.B,{gap:"lg",children:[(0,n.jsx)(f.E,{fw:700,size:"xl",style:{fontFamily:"Assistant, sans-serif",fontSize:"1.3rem",color:t?"#e5e5e5":"#111827"},children:o||"Load from link"}),(0,n.jsxs)(A,{$dark:t,children:[(0,n.jsx)(z,{$dark:t,children:(0,n.jsx)(j.eHT,{})}),(0,n.jsx)(O,{$dark:t,children:i||(0,n.jsxs)(n.Fragment,{children:["Loading external drawing will ",(0,n.jsx)("strong",{children:"replace your existing content"}),". You can back up your drawing first by using one of the options below."]})}),(0,n.jsx)(h.$,{color:"red",size:"md",onClick:r,style:{flexShrink:0},children:"Replace my content"})]}),(0,n.jsxs)(R,{$dark:t,children:[(0,n.jsx)("h4",{children:"Save to disk"}),(0,n.jsx)("p",{children:"Export the scene data to a file from which you can import later."}),(0,n.jsx)(h.$,{variant:"outline",color:"gray",size:"md",fullWidth:!0,leftSection:(0,n.jsx)(j.a4x,{size:16}),onClick:a,styles:{root:{maxWidth:300,borderColor:t?"#404040":"#d1d5db",color:t?"#d4d4d4":"#374151"}},children:"Save to disk"})]})]})});var D=r(46553);let $=()=>Math.floor(2e9*Math.random()),T=()=>Math.floor(2e9*Math.random()),_=e=>e.text&&0!==e.text.length?e.text.map(e=>null!==e.key&&void 0!==e.key?"object"===e.type?`${e.key}: {${e.childrenCount??0} keys}`:"array"===e.type?`${e.key}: [${e.childrenCount??0} items]`:null===e.value?`${e.key}: null`:`${e.key}: ${e.value}`:`${e.value??""}`).join("\n"):"",L=(e,t)=>{let r=[],n=((e,t)=>{let r=new Map;if(0===e.length)return r;let n=new Map,l=new Set;for(let e of t){let t=n.get(e.from)??[];t.push(e.to),n.set(e.from,t),l.add(e.to)}let a=e.filter(e=>!l.has(e.id)).map(e=>e.id);0===a.length&&e.length>0&&a.push(e[0].id);let o=new Map(e.map(e=>[e.id,e])),s=[],c=new Set,d=[...a];for(;d.length>0;){let e=[],t=[];for(let r of d)if(!c.has(r))for(let l of(c.add(r),e.push(r),n.get(r)??[]))c.has(l)||t.push(l);e.length>0&&s.push(e),d=t}let u=e.filter(e=>!c.has(e.id)).map(e=>e.id);u.length>0&&s.push(u);let f=50;for(let e of s){let t=0,n=50;for(let l of e){let e=o.get(l);e&&(r.set(l,{x:f,y:n}),n+=e.height+i.BF,t=Math.max(t,e.width))}f+=t+i.xy}return r})(e,t),l=Date.now(),a=0,o=()=>`a${(a++).toString().padStart(6,"0")}`,s=new Map;for(let a of e){let e=n.get(a.id)??{x:0,y:0},c=`rect-${a.id}`,d=`text-${a.id}`,u=_(a);s.set(a.id,c);let f=Math.max(a.width+2*i._k,120),h=Math.max((a.text?.length??1)*i.C+2*i._k,50),p=[{id:d,type:"text"}];for(let e of t)(e.from===a.id||e.to===a.id)&&p.push({id:`arrow-${e.id}`,type:"arrow"});let g={id:c,type:"rectangle",x:e.x,y:e.y,width:f,height:h,angle:0,strokeColor:"#1e1e1e",backgroundColor:"transparent",fillStyle:"solid",strokeWidth:1,roughness:1,opacity:100,groupIds:[],roundness:{type:3},seed:$(),version:1,versionNonce:T(),isDeleted:!1,boundElements:p,index:o(),updated:l,link:null,locked:!1,frameId:null};r.push(g);let m={id:d,type:"text",x:e.x+i._k,y:e.y+i._k,width:f-2*i._k,height:h-2*i._k,angle:0,strokeColor:"#1e1e1e",backgroundColor:"transparent",fillStyle:"solid",strokeWidth:1,roughness:1,opacity:100,groupIds:[],roundness:null,seed:$(),version:1,versionNonce:T(),isDeleted:!1,boundElements:null,index:o(),updated:l,link:null,locked:!1,frameId:null,text:u,fontSize:i.TZ,fontFamily:D.F2R.Excalifont,textAlign:"left",verticalAlign:"top",containerId:c,originalText:u,autoResize:!0,lineHeight:1.25};r.push(m)}for(let a of t){let t=s.get(a.from),c=s.get(a.to);if(!t||!c)continue;let d=n.get(a.from),u=n.get(a.to);if(!d||!u)continue;let f=e.find(e=>e.id===a.from),h=e.find(e=>e.id===a.to);if(!f||!h)continue;let p=Math.max(f.width+2*i._k,120),g=Math.max((f.text?.length??1)*i.C+2*i._k,50),m=Math.max((h.text?.length??1)*i.C+2*i._k,50),x=d.x+p,w=d.y+g/2,y=u.x,b=u.y+m/2,j={id:`arrow-${a.id}`,type:"arrow",x:x,y:w,width:Math.abs(y-x),height:Math.abs(b-w),angle:0,strokeColor:"#1e1e1e",backgroundColor:"transparent",fillStyle:"solid",strokeWidth:1,roughness:1,opacity:100,groupIds:[],roundness:{type:2},seed:$(),version:1,versionNonce:T(),isDeleted:!1,boundElements:null,index:o(),updated:l,link:null,locked:!1,frameId:null,points:[[0,0],[y-x,b-w]],startBinding:{elementId:t,focus:0,gap:5,fixedPoint:[1,.5]},endBinding:{elementId:c,focus:0,gap:5,fixedPoint:[0,.5]},startArrowhead:null,endArrowhead:"arrow",elbowed:!1};r.push(j)}return r};var F=r(278),N=r(15940),M=r(16042);let P={apiKey:"AIzaSyDvMXBp-ixnFg_voZfMIEGFaotCrbVOAcs",authDomain:"json-viz-draw.firebaseapp.com",databaseURL:"https://json-viz-draw-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"json-viz-draw",storageBucket:"json-viz-draw.firebasestorage.app",messagingSenderId:"202083822464",appId:"1:202083822464:web:870613fe58ad8f08652f65"},U=null,B=()=>{if(U)return U;if(!P.databaseURL||!P.projectId)throw Error("Database configuration is missing. Please set NEXT_PUBLIC_DB_* environment variables.");let e=0===(0,M.Dk)().length?(0,M.Wp)(P):(0,M.Dk)()[0];return U=(0,N.C3)(e)},J=e=>{let t="";for(let r=0;r<e.length;r+=8e3)t+=String.fromCharCode.apply(null,Array.from(e.slice(r,r+8e3)));return btoa(t)},W=e=>{let t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r},V=async()=>{let e=await crypto.subtle.generateKey({name:"AES-GCM",length:128},!0,["encrypt","decrypt"]);return J(new Uint8Array(await crypto.subtle.exportKey("raw",e))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")},G=async e=>{let t=e.replace(/-/g,"+").replace(/_/g,"/");for(;t.length%4;)t+="=";let r=W(t);return crypto.subtle.importKey("raw",r.buffer,{name:"AES-GCM"},!1,["encrypt","decrypt"])},Y=async(e,t)=>{let r=await G(t),n=crypto.getRandomValues(new Uint8Array(12)),l=await crypto.subtle.encrypt({name:"AES-GCM",iv:n},r,e.buffer),a=new Uint8Array(n.length+l.byteLength);return a.set(n),a.set(new Uint8Array(l),n.length),a},H=async(e,t)=>{let r=await G(t),n=e.slice(0,12),l=e.slice(12);return new Uint8Array(await crypto.subtle.decrypt({name:"AES-GCM",iv:n},r,l.buffer))},Z=async e=>{let t,r=(t=new Uint8Array(15),crypto.getRandomValues(t),J(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")),n=await V(),l=J(await Y(e,n)),a=(0,N.KR)(B(),`shared/${r}`);return await (0,N.hZ)(a,{data:l,createdAt:Date.now()}),{id:r,encryptionKey:n}},K=async(e,t)=>{try{let r=(0,N.KR)(B(),`shared/${e}`),n=await (0,N.Jt)(r);if(!n.exists())return console.error("Share link data not found:",e),null;let{data:l}=n.val(),a=W(l);return await H(a,t)}catch(e){return console.error("Failed to import shared data:",e),null}},q=async(e,t,r)=>{let n=e.filter(e=>!e.isDeleted).map(e=>({...e,isDeleted:void 0})),l=JSON.stringify({elements:n,files:((e,t)=>{if(!t)return;let r=new Set;for(let t of e)t&&"object"==typeof t&&"fileId"in t&&t.fileId&&r.add(t.fileId);if(0===r.size)return;let n={};for(let e of r)t[e]&&(n[e]=t[e]);return Object.keys(n).length?n:void 0})(n,r),appState:{viewBackgroundColor:t.viewBackgroundColor,theme:t.theme}}),a=F.Ay.deflate(new TextEncoder().encode(l)),{id:o,encryptionKey:i}=await Z(a),s=`#json=${o},${i}`;return`${window.location.origin}${window.location.pathname}${s}`},X=async e=>{let t=e.match(/^#json=([a-zA-Z0-9_-]+),([a-zA-Z0-9_-]+)$/);if(!t)return null;let[,r,n]=t,l=await K(r,n);if(!l)return null;try{let e=F.Ay.inflate(l,{to:"string"});return JSON.parse(e)}catch(e){return console.error("Failed to decompress share link data:",e),null}},Q=o.Ay.div.withConfig({componentId:"sc-e83a0370-0"})(["width:100%;height:100%;position:relative;opacity:",";transition:opacity 0.2s ease;.jsondraw-wrapper{width:100%;height:100%;}"],({$ready:e})=>+!!e),ee=()=>{let e=(0,E.A)(e=>e.nodes),t=(0,E.A)(e=>e.edges),a=(0,S.A)(e=>e.darkmodeEnabled),[o,s]=l.useState(null),[A,z]=l.useState(!1),R=l.useRef(null),O=l.useRef(!1),D=l.useRef(!1),[$,T]=l.useState(!1),[_,N]=l.useState(!1),[M,P]=l.useState(""),[U,B]=l.useState(!1),[J,W]=l.useState(!1),V=l.useRef(null),{isCollaborating:G,roomId:Y,startCollaboration:H,stopCollaboration:Z,collaborators:K,currentUserId:ee,isRoomOwner:et,maxCollaborators:er,kickCollaborator:en,passwordRequiredRoom:el,setPasswordRequiredRoom:ea,waitingForApproval:eo,pendingRequests:ei,approveJoin:es,rejectJoin:ec,submitRoomPassword:ed}=(0,C.H)(),[eu,ef]=l.useState(!1),[eh,ep]=l.useState(""),[eg,em]=l.useState(""),[ex,ew]=l.useState(null),[ey,eb]=l.useState(!1),ej=l.useRef(null),ek=l.useRef(!1),eS=l.useRef(null),{broadcastDrawingChanges:eC,broadcastPointer:ev}=(e=>{let t=(0,C.H)(),{socket:r,isCollaborating:n,roomId:a,collaborators:o,isRoomOwner:s}=t,c=t._p2pRoom,d="boolean"!=typeof t.canSync||t.canSync,u=(0,v.mv)(),f=(0,l.useRef)(-1),h=(0,l.useRef)(new Map),p=(0,l.useRef)(!1),g=(0,l.useRef)(null),m=(0,l.useRef)(null);return(0,l.useEffect)(()=>{n&&d?p.current=s:(p.current=!1,f.current=-1)},[n,s,d]),(0,l.useEffect)(()=>{let l=new Map;o.forEach(e=>{if(r&&e.id===r.id||!r&&u===i.UV.P2P&&e.id===t.currentUserId)return;let n=h.current.get(e.id);l.set(e.id,{pointer:n?.pointer,button:n?.button||"up",username:e.username,color:{background:e.color||"#eee",stroke:e.color||"#eee"},id:e.id,socketId:e.id})}),h.current=l,e.current&&n&&d&&e.current.updateScene({collaborators:l})},[o,e,n,r,u,t,d]),(0,l.useEffect)(()=>{if(n&&d){if(u===i.UV.Socket){if(!r)return;let t=t=>{let r=e.current;if(!r)return;let n=r.getSceneElementsIncludingDeleted(),l=r.getAppState(),a=[];if(s||p.current){let e=(0,k.restoreElements)(t,n);a=(0,k.reconcileElements)(n,e,l)}else a=(0,k.restoreElements)(t,null),p.current=!0;f.current=(0,k.getSceneVersion)(a),r.updateScene({elements:a,commitToHistory:!1})};return r.on("client-draw",t),g.current=e=>{a&&r.emit("server-draw",a,e)},()=>{r.off("client-draw",t),g.current=null}}if(u===i.UV.P2P&&c){let[t,r]=c.makeAction("draw");return r(t=>{let r=e.current;if(!r)return;let n=r.getSceneElementsIncludingDeleted(),l=r.getAppState(),a=[];if(s||p.current){let e=(0,k.restoreElements)(t,n);a=(0,k.reconcileElements)(n,e,l)}else a=(0,k.restoreElements)(t,null),p.current=!0;f.current=(0,k.getSceneVersion)(a),r.updateScene({elements:a,commitToHistory:!1})}),g.current=e=>{t(e)},()=>{g.current=null}}}},[r,n,e,s,u,c,a,d]),(0,l.useEffect)(()=>{if(n&&d){if(u===i.UV.Socket){if(!r)return;let t=(t,r)=>{let n=e.current;if(!n)return;let l=h.current,a=l.get(t);if(a){a.pointer=r.pointer,a.button=r.button;let e=new Map(l);h.current=e,n.updateScene({collaborators:e})}};return r.on("client-pointer",t),m.current=e=>{a&&r.emit("server-pointer",a,e)},()=>{r.off("client-pointer",t),m.current=null}}if(u===i.UV.P2P&&c){let[t,r]=c.makeAction("pointer");return r((t,r)=>{let n=e.current;if(!n)return;let l=h.current,a=l.get(r);if(a){a.pointer=t.pointer,a.button=t.button;let e=new Map(l);h.current=e,n.updateScene({collaborators:e})}}),m.current=e=>{t(e)},()=>{m.current=null}}}},[r,n,e,u,c,a,d]),(0,l.useEffect)(()=>{if(n&&s&&d){if(u===i.UV.Socket){if(!r)return;let t=()=>{let t=e.current;if(!t)return;let r=t.getSceneElementsIncludingDeleted();r.length>0&&g.current&&g.current(r)};return r.on("new-user",t),()=>{r.off("new-user",t)}}if(u===i.UV.P2P&&c)return c.onPeerJoin(t=>{let r=e.current;if(!r)return;let n=r.getSceneElementsIncludingDeleted();if(0===n.length)return;let[l]=c.makeAction("draw");l(n,t)}),()=>{c.onPeerJoin(()=>{})}}},[r,n,a,e,s,u,c,d]),{broadcastDrawingChanges:e=>{if(!n||!d||!s&&!p.current)return;let t=(0,k.getSceneVersion)(e);t>f.current&&(g.current&&g.current(e),f.current=t)},broadcastPointer:e=>{n&&m.current&&m.current(e)}}})(R),eE=l.useCallback((e,t,r)=>{D.current=!0,eC(e);try{let n=r??R.current?.getFiles?.()??null;localStorage.setItem("jsondraw-autosave",JSON.stringify({elements:e,files:n,appState:{theme:t.theme,zoom:t.zoom}}))}catch(e){console.warn("Failed to save to localStorage:",e)}},[eC]);l.useEffect(()=>{window.JSONDRAW_ASSET_PATH="/"},[]),l.useEffect(()=>{Promise.resolve().then(r.bind(r,76664)).then(e=>{s({JsonDraw:e.JsonDraw}),z(!1)});{let e=new URLSearchParams(window.location.hash.replace(/^#/,"")).get("collabRoomId");if(e&&!Y){let t=!1,r=localStorage.getItem("jsondraw-autosave");if(r)try{let e=JSON.parse(r);Array.isArray(e.elements)&&e.elements.length>0&&(t=!0)}catch(e){t=!0}t?ew(e):H(e,void 0,{asOwner:!1})}}},[]);let eA=l.useCallback((e,t=120)=>{requestAnimationFrame(()=>{setTimeout(()=>{e.scrollToContent(void 0,{fitToViewport:!0,viewportZoomFactor:.8}),z(!0)},t)})},[]),ez=l.useCallback(e=>{let t=R.current;if(!t)return;D.current=!0,O.current=!0,z(!1);let r=(0,k.restoreElements)(e.elements,null),n={...(0,k.restoreAppState)(e.appState,t.getAppState()),isLoading:!1};requestAnimationFrame(()=>{e.files&&Object.keys(e.files).length>0&&t.addFiles(e.files),t.updateScene({elements:r,appState:n}),eA(t,120)}),window.history.replaceState({},"",window.location.pathname)},[eA]),eR=l.useCallback(()=>{let e=ej.current;e&&(ez(e),ej.current=null,eb(!1),b.oR.success("Drawing loaded from shared link!"))},[ez]),eO=l.useCallback(async()=>{let e=R.current;if(e)try{let t=e.getSceneElementsIncludingDeleted(),r=e.getAppState(),n=e.getFiles(),l=e.getName?.()||r.name;await (0,k.saveAsJSON)(t,r,n,l),b.oR.success("Drawing saved to disk!")}catch(e){b.oR.error("Failed to save drawing.")}},[]),eI=l.useCallback(r=>{let n=localStorage.getItem("jsondraw-autosave");if(n)try{let{elements:e,appState:t,files:l}=JSON.parse(n),a=(0,k.restoreElements)(e,null),o={...(0,k.restoreAppState)(t,r.getAppState()),isLoading:!1};D.current=!0,z(!1),requestAnimationFrame(()=>{l&&Object.keys(l).length>0&&r.addFiles(l),r.updateScene({elements:a,appState:o}),eA(r,120)});return}catch(e){console.warn("Failed to restore from localStorage:",e)}if(e.length>0&&!O.current){O.current=!0;let n=(0,k.restoreElements)(L(e,t),null);z(!1),requestAnimationFrame(()=>{r.updateScene({elements:n,appState:{isLoading:!1}}),eA(r,200)})}},[e,t,eA]),eD=l.useCallback(()=>{let e=localStorage.getItem("jsondraw-autosave");if(e)try{let t=JSON.parse(e);if(Array.isArray(t.elements)&&t.elements.length>0)return!0}catch(e){return console.warn("Failed to parse autosave data:",e),!0}let t=R.current;if(!t)return!1;let r=t.getSceneElementsIncludingDeleted();return Array.isArray(r)&&r.length>0},[]),e$=l.useCallback(async e=>{if(!e||!/^#json=([a-zA-Z0-9_-]+),([a-zA-Z0-9_-]+)$/.test(e)&&!e.startsWith("#data="))return!1;let t=R.current;if(!t)return!1;if(e===eS.current||ek.current)return!0;eS.current=e,ek.current=!0,z(!1);try{if(/^#json=([a-zA-Z0-9_-]+),([a-zA-Z0-9_-]+)$/.test(e)){let r=await X(e);if(!r||!r.elements)return b.oR.error("Could not load shared drawing. The link may be invalid or expired."),eI(t),!0;return eD()?(ej.current=r,eb(!0),eI(t)):ez(r),!0}let r=(e=>{try{let t=e.replace("#data=","");try{t=decodeURIComponent(t)}catch{}for(t=t.replace(/-/g,"+").replace(/_/g,"/");t.length%4;)t+="=";let r=window.atob(t),n=new Uint8Array(r.length);for(let e=0;e<r.length;e++)n[e]=r.charCodeAt(e);let l=F.Ay.inflate(n,{to:"string"});return JSON.parse(l)}catch(e){return console.error("Failed to decode legacy sharelink data",e),null}})(e);if(r&&r.elements)return eD()?(ej.current=r,eb(!0),eI(t)):ez(r),!0;return eI(t),!0}catch(e){return console.error("Failed to load share link:",e),b.oR.error("Failed to load shared drawing."),eI(t),!0}finally{ek.current=!1}},[ez,eD,eI]);l.useEffect(()=>{let r=R.current;if(!r||0===e.length||D.current)return;let n=L(e,t);r.updateScene({elements:n}),eA(r,80)},[e,t,eA]);let eT=l.useCallback(e=>{R.current=e,e$(window.location.hash).then(t=>{t||eI(e)})},[e$,eI]);l.useEffect(()=>{let e=()=>{e$(window.location.hash)};return window.addEventListener("hashchange",e),()=>window.removeEventListener("hashchange",e)},[e$]);let e_=l.useRef(ei?.length||0);l.useEffect(()=>{if(ei&&ei.length>e_.current){let e=ei[ei.length-1];(0,b.oR)(`${e.username} wants to join the room!`,{icon:"\uD83D\uDC4B"})}e_.current=ei?.length||0},[ei]);let eL=l.useCallback(()=>{if(!R.current)return;localStorage.removeItem("jsondraw-autosave"),D.current=!1,O.current=!1;let r=L(e,t);R.current.updateScene({elements:r}),z(!1),eA(R.current,120),T(!1),b.oR.success("Drawing cleared! Loaded JSON visualization.")},[e,t,eA]),eF=l.useCallback(()=>{navigator.clipboard.writeText(M).then(()=>{B(!0),V.current&&window.clearTimeout(V.current),V.current=window.setTimeout(()=>B(!1),3e3)}).catch(()=>b.oR.error("Failed to copy link."))},[M]),eN=l.useCallback(async()=>{let e=R.current;if(e){W(!0);try{let t=e.getSceneElementsIncludingDeleted(),r=e.getAppState(),n=e.getFiles(),l=await q(t,r,n);P(l),N(!0)}catch(e){console.error("Share failed:",e),b.oR.error("Failed to create share link. Please try again.")}finally{W(!1)}}},[]),eM=l.useCallback(()=>{Y||H(Math.random().toString(36).substring(2,10),eh,{asOwner:!0})},[Y,eh,H]),eP=l.useCallback(()=>{el&&(ed(eg),ea(null),em(""))},[el,eg,ed,ea]),eU=l.useCallback(()=>{ea(null),em(""),window.location.hash=""},[ea]),eB=l.useCallback(()=>{Z(),window.location.hash=""},[Z]),eJ=()=>{if(Y){let e=new URL(window.location.href);e.search="";let t=new URLSearchParams;return t.set("collabRoomId",Y),e.hash=t.toString(),e.toString()}return""};if(!o)return(0,n.jsx)(c.a,{pos:"relative",h:"100%",w:"100%",children:(0,n.jsx)(c.a,{pos:"absolute",inset:0,style:{display:"grid",placeItems:"center"},children:(0,n.jsx)(k.HamsterLoader,{})})});let{JsonDraw:eW}=o;return(0,n.jsxs)(c.a,{pos:"relative",h:"100%",w:"100%",children:[!A&&(0,n.jsx)(c.a,{pos:"absolute",inset:0,style:{display:"grid",placeItems:"center"},children:(0,n.jsx)(k.HamsterLoader,{})}),(0,n.jsx)(d.a,{opened:$,onClose:()=>T(!1),title:"Clear Drawing Session",centered:!0,children:(0,n.jsxs)(u.B,{gap:"md",children:[(0,n.jsxs)(f.E,{children:["This will ",(0,n.jsx)("strong",{children:"permanently delete"})," your current drawing session and load a fresh visualization from the JSON data."]}),(0,n.jsx)(f.E,{c:"dimmed",size:"sm",children:"Make sure to save your work first. Your current drawing will be lost and cannot be recovered."}),(0,n.jsxs)(c.a,{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:[(0,n.jsx)(h.$,{variant:"default",onClick:()=>T(!1),children:"Cancel"}),(0,n.jsx)(h.$,{color:"red",onClick:eL,children:"Clear & Load JSON"})]})]})}),(0,n.jsx)(d.a,{opened:_,onClose:()=>N(!1),title:null,withCloseButton:!1,centered:!0,size:"md",padding:"xl",radius:"lg",styles:{content:{backgroundColor:a?"#121212":"#ffffff"}},children:(0,n.jsxs)(u.B,{gap:"lg",children:[(0,n.jsxs)(c.a,{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsx)(f.E,{fw:700,size:"xl",style:{fontFamily:"Assistant, sans-serif"},children:"Shareable link"}),(0,n.jsx)(p.M,{variant:"subtle",color:"gray",onClick:()=>N(!1),children:(0,n.jsx)(j.yGN,{size:20})})]}),(0,n.jsxs)(c.a,{style:{display:"flex",gap:"12px",alignItems:"flex-end"},children:[(0,n.jsx)(g.k,{label:"Link",readOnly:!0,value:M,style:{flex:1},styles:{input:{backgroundColor:a?"rgba(255,255,255,0.05)":"#f3f4f6",border:"none",boxShadow:"none",height:40},label:{marginBottom:8,fontSize:12,fontWeight:600,color:a?"#a3a3a3":"#4b5563"}},onClick:e=>e.target.select()}),(0,n.jsx)(h.$,{size:"md",leftSection:U?(0,n.jsx)(j.YrT,{size:18}):(0,n.jsx)(j.nxz,{size:18}),color:U?"teal":"violet",onClick:eF,style:{height:40,minWidth:120,transition:"background-color 0.2s"},children:"Copy link"})]}),(0,n.jsx)(c.a,{style:{borderTop:`1px solid ${a?"#333":"#e5e7eb"}`,paddingTop:16},children:(0,n.jsxs)(f.E,{size:"sm",c:"dimmed",style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,n.jsx)(j.F5$,{size:16})," Data is end-to-end encrypted. Only people with the link can view."]})})]})}),(0,n.jsx)(d.a,{opened:eo,onClose:eB,withCloseButton:!1,centered:!0,size:"sm",radius:"lg",padding:"xl",styles:{content:{backgroundColor:a?"#121212":"#ffffff"}},children:(0,n.jsxs)(u.B,{gap:"md",align:"center",children:[(0,n.jsx)(f.E,{fw:700,size:"lg",style:{fontFamily:"Assistant, sans-serif"},children:"Waiting for Approval"}),(0,n.jsx)(k.HamsterLoader,{}),(0,n.jsx)(f.E,{size:"sm",c:"dimmed",ta:"center",children:"Please wait while the room owner approves your request to join..."}),(0,n.jsx)(h.$,{variant:"default",onClick:eB,fullWidth:!0,mt:"sm",children:"Cancel"})]})}),(0,n.jsx)(d.a,{opened:!!el,onClose:eU,title:(0,n.jsx)(f.E,{fw:700,size:"xl",style:{fontFamily:"Assistant, sans-serif"},children:"Room Password Required"}),centered:!0,size:"md",radius:"lg",padding:"xl",styles:{content:{backgroundColor:a?"#121212":"#ffffff"}},children:(0,n.jsxs)(u.B,{gap:"md",children:[(0,n.jsx)(f.E,{size:"sm",c:"dimmed",children:"This live collaboration room is protected by a password. Please enter the password to join."}),(0,n.jsx)(m.y,{label:"Password",placeholder:"Enter room password",value:eg,onChange:e=>em(e.currentTarget.value),leftSection:(0,n.jsx)(j.Fv0,{size:14}),styles:{input:{backgroundColor:a?"rgba(255,255,255,0.05)":"#f3f4f6",border:"none"}},"data-autofocus":!0,onKeyDown:e=>{"Enter"===e.key&&eP()}}),(0,n.jsxs)(c.a,{style:{display:"flex",gap:"8px",justifyContent:"flex-end",marginTop:10},children:[(0,n.jsx)(h.$,{variant:"default",onClick:eU,children:"Cancel"}),(0,n.jsx)(h.$,{color:"blue",onClick:eP,children:"Join Room"})]})]})}),(0,n.jsx)(I,{opened:!!ex,darkMode:a,title:"Join Collaborative Room",message:(0,n.jsxs)(n.Fragment,{children:["Joining this room will ",(0,n.jsx)("strong",{children:"permanently replace your existing content"})," with the room's content. You can back up your drawing first by using the option below."]}),onReplace:()=>{ex&&(H(ex,void 0,{asOwner:!1}),ew(null))},onClose:()=>ew(null),onSaveToDisk:eO}),(0,n.jsx)(d.a,{opened:eu,onClose:()=>ef(!1),title:(0,n.jsx)(f.E,{fw:700,size:"xl",style:{fontFamily:"Assistant, sans-serif"},children:"Live Collaboration"}),centered:!0,size:"md",radius:"lg",padding:"xl",styles:{content:{backgroundColor:a?"#121212":"#ffffff"}},children:(0,n.jsx)(u.B,{gap:"md",children:G&&Y?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(f.E,{size:"sm",c:"dimmed",children:"You are live. Anyone with this link can join and draw in real-time."}),(0,n.jsxs)(x.Y,{gap:"apart",style:{background:a?"rgba(255,255,255,0.05)":"#f8f9fa",padding:"10px",borderRadius:"8px"},children:[(0,n.jsxs)(c.a,{children:[(0,n.jsxs)(f.E,{size:"sm",fw:600,children:["Room ID: ",Y]}),(0,n.jsxs)(w.E,{color:"green",variant:"light",size:"sm",children:["Online (",K.length,"/",er," users)"]})]}),(0,n.jsx)(h.$,{color:"red",variant:"subtle",size:"xs",leftSection:(0,n.jsx)(j.QeK,{}),onClick:Z,children:"Stop Session"})]}),(0,n.jsxs)(c.a,{style:{display:"flex",gap:"12px",alignItems:"flex-end",marginTop:10},children:[(0,n.jsx)(g.k,{label:"Collab Link",readOnly:!0,value:eJ(),style:{flex:1},styles:{input:{backgroundColor:a?"rgba(255,255,255,0.05)":"#f3f4f6",border:"none"}},onClick:e=>e.target.select()}),(0,n.jsx)(h.$,{leftSection:U?(0,n.jsx)(j.YrT,{size:18}):(0,n.jsx)(j.nxz,{size:18}),color:U?"teal":"blue",onClick:()=>{navigator.clipboard.writeText(eJ()),B(!0),V.current&&window.clearTimeout(V.current),V.current=window.setTimeout(()=>B(!1),3e3)},children:"Copy"})]}),ei&&ei.length>0&&(0,n.jsxs)(c.a,{style:{marginTop:12,borderRadius:8,padding:10,background:a?"rgba(255,165,0,0.1)":"#fff5e6",border:`1px solid ${a?"rgba(255,165,0,0.3)":"#ffe0b2"}`},children:[(0,n.jsxs)(f.E,{size:"xs",c:"orange",fw:600,mb:8,children:["Pending Requests (",ei.length,")"]}),(0,n.jsx)(u.B,{gap:6,children:ei.map(e=>(0,n.jsxs)(x.Y,{justify:"space-between",wrap:"nowrap",children:[(0,n.jsxs)(x.Y,{gap:8,children:[(0,n.jsx)(c.a,{w:10,h:10,style:{borderRadius:"50%",background:e.color||"#ccc"}}),(0,n.jsx)(f.E,{size:"sm",fw:500,truncate:!0,children:e.username})]}),(0,n.jsxs)(x.Y,{gap:4,children:[(0,n.jsx)(h.$,{size:"compact-xs",color:"teal",onClick:()=>es(e.userId),children:"Approve"}),(0,n.jsx)(h.$,{size:"compact-xs",color:"red",variant:"subtle",onClick:()=>ec(e.userId),children:"Reject"})]})]},e.userId))})]}),(0,n.jsxs)(c.a,{style:{marginTop:12,borderRadius:8,padding:10,background:a?"rgba(255,255,255,0.04)":"#f8f9fa"},children:[(0,n.jsx)(f.E,{size:"xs",c:"dimmed",mb:8,children:"Participants"}),(0,n.jsx)(u.B,{gap:6,children:K.map(e=>{let t=e.id===ee;return(0,n.jsxs)(x.Y,{justify:"space-between",wrap:"nowrap",children:[(0,n.jsxs)(f.E,{size:"sm",fw:500,truncate:!0,children:[e.username||e.id,t?" (You)":"",e.isOwner?" (Owner)":""]}),et&&!t?(0,n.jsx)(p.M,{color:"red",variant:"light","aria-label":"Kick user",onClick:()=>en(e.id),children:(0,n.jsx)(j.JOY,{size:14})}):null]},e.id)})})]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(f.E,{size:"sm",c:"dimmed",children:"Create a real-time multiplayer room to draw with others. You can optionally set a password."}),(0,n.jsx)(m.y,{label:"Room Password (Optional)",placeholder:"Leave blank for public room",value:eh,onChange:e=>ep(e.currentTarget.value),leftSection:(0,n.jsx)(j.Fv0,{size:14}),styles:{input:{backgroundColor:a?"rgba(255,255,255,0.05)":"#f3f4f6",border:"none"}}}),(0,n.jsx)(h.$,{size:"md",color:"blue",leftSection:(0,n.jsx)(j.aze,{size:16}),onClick:eM,style:{marginTop:10},children:"Start Session"})]})})}),(0,n.jsx)(I,{opened:ey,darkMode:a,onReplace:eR,onClose:()=>{eb(!1),ej.current=null,window.history.replaceState({},"",window.location.pathname)},onSaveToDisk:eO}),(0,n.jsx)(Q,{$ready:A,children:(0,n.jsx)("div",{className:"jsondraw-wrapper",children:(0,n.jsx)(eW,{jsondrawAPI:eT,onChange:eE,onPointerUpdate:e=>{e.pointer&&ev(e)},viewModeEnabled:!1,zenModeEnabled:!1,gridModeEnabled:!1,theme:a?"dark":"light",UIOptions:{canvasActions:{export:{saveFileToDisk:!0},clearDrawing:()=>T(!0)}},initialData:{appState:{activeTool:{type:"hand",customType:null,lastActiveTool:null,locked:!1,fromSelection:!1}}},renderTopRightUI:e=>(0,n.jsx)(c.a,{px:"md",children:(0,n.jsxs)(y.W,{shadow:"md",width:200,position:"bottom-end",children:[(0,n.jsx)(y.W.Target,{children:(0,n.jsx)(h.$,{size:"sm",color:G?"green":"violet",loading:J,leftSection:G?(0,n.jsx)(j.cfS,{size:16}):(0,n.jsx)(j.Pum,{size:16}),title:"Share canvas",children:G?"Live":"Share"})}),(0,n.jsxs)(y.W.Dropdown,{children:[(0,n.jsx)(y.W.Label,{children:"Export Options"}),(0,n.jsx)(y.W.Item,{leftSection:(0,n.jsx)(j.nxz,{size:14}),onClick:eN,children:"Share Link (Snapshot)"}),(0,n.jsx)(y.W.Divider,{}),(0,n.jsx)(y.W.Label,{children:"Realtime"}),(0,n.jsx)(y.W.Item,{color:G?"green":"blue",leftSection:G?(0,n.jsx)(j.cfS,{size:14}):(0,n.jsx)(j.aze,{size:14}),onClick:()=>ef(!0),children:G?"Manage Collab Session":"Start Live Collab"})]})]})})})})})]})};var et=r(83126),er=r(18512);let en=o.I4.span.withConfig({componentId:"sc-65e7364-0"})(["color:",";&:hover{filter:brightness(1.5);transition:filter 0.2s ease-in-out;}"],({theme:e,$nodeType:t})=>(function({$type:e,theme:t}){return"Object"===e?t.NODE_COLORS.PARENT_OBJ:"Array"===e?t.NODE_COLORS.PARENT_ARR:t.NODE_COLORS.PARENT_OBJ})({theme:e,$type:t})),el=({keyPath:e,nodeType:t})=>(0,n.jsxs)(en,{$nodeType:t,children:[e[0],":"]});var ea=r(6340);let eo=e=>{let t=(0,o.DP)(),{valueAsString:r,value:l}=e;return(0,n.jsx)("span",{style:{color:function({$value:e,theme:t}){return e&&!Number.isNaN(+e)?t.NODE_COLORS.INTEGER:"true"===e?t.NODE_COLORS.BOOL.TRUE:"false"===e?t.NODE_COLORS.BOOL.FALSE:"null"===e?t.NODE_COLORS.NULL:t.NODE_COLORS.NODE_VALUE}({theme:t,$value:r})},children:(0,n.jsx)(ea.J,{children:JSON.stringify(l)})})},ei=()=>{let e=(0,o.DP)(),t=(0,er.A)(e=>e.json);return(0,n.jsx)(et.d,{hideRoot:!0,data:JSON.parse(t),valueRenderer:(e,t)=>(0,n.jsx)(eo,{valueAsString:e,value:t}),labelRenderer:(e,t)=>(0,n.jsx)(el,{keyPath:e,nodeType:t}),theme:{extend:{overflow:"scroll",height:"100%",scheme:"monokai",author:"wimer hazenberg (http://www.monokai.nl)",base00:e.GRID_BG_COLOR}}})},es=o.Ay.div.withConfig({componentId:"sc-78d58c26-0"})(["position:relative;height:100%;background:",';overflow:auto;cursor:url("/assets/cursor.svg"),auto;& > ul{margin-top:0 !important;padding:12px !important;font-family:monospace;font-size:14px;font-weight:500;}.tab-group{position:absolute;top:10px;left:10px;z-index:2;}'],({theme:e})=>e.GRID_BG_COLOR),ec=()=>{let[e]=(0,a.F)({key:"viewMode",defaultValue:i.nE.Graph});return e===i.nE.Graph?(0,n.jsx)(s.GraphView,{}):e===i.nE.Tree?(0,n.jsx)(ei,{}):e===i.nE.JsonDraw?(0,n.jsx)(ee,{}):null},ed=()=>(0,n.jsx)(es,{onContextMenuCapture:e=>e.preventDefault(),children:(0,n.jsx)(ec,{})})}}]);
//# sourceMappingURL=75373.96686d9817a4b7a3.js.map